<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A4 Document</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bg-gray: #f2f2f2;
            --heading-blue: #1d7dec;
            --box-gray: #555;
            --box-light-gray: #999;
        }

        @page {
            size: A4 portrait;
            margin: 20mm 15mm 25mm 15mm;
        }

        @font-face {
            font-family: "Connections";
            src: url("assets/OnlineWebFonts_COM_c21316a52e2c3a9fd845b29d61ff329b/Connections/Web Fonts/818e0cbab8a64eb716ce66593cdfa750.eot");
            src: url("assets/OnlineWebFonts_COM_c21316a52e2c3a9fd845b29d61ff329b/Connections/Web Fonts/818e0cbab8a64eb716ce66593cdfa750.eot?#iefix") format("embedded-opentype"),
                url("assets/OnlineWebFonts_COM_c21316a52e2c3a9fd845b29d61ff329b/Connections/Web Fonts/818e0cbab8a64eb716ce66593cdfa750.woff") format("woff"),
                url("assets/OnlineWebFonts_COM_c21316a52e2c3a9fd845b29d61ff329b/Connections/Web Fonts/818e0cbab8a64eb716ce66593cdfa750.woff2") format("woff2"),
                url("assets/OnlineWebFonts_COM_c21316a52e2c3a9fd845b29d61ff329b/Connections/Web Fonts/818e0cbab8a64eb716ce66593cdfa750.ttf") format("truetype"),
                url("assets/OnlineWebFonts_COM_c21316a52e2c3a9fd845b29d61ff329b/Connections/Web Fonts/818e0cbab8a64eb716ce66593cdfa750.svg#Connections") format("svg");
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Body style */
        body {
            font-family: 'Connections', 'Arial', sans-serif;
            background-color: #525659;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            flex-wrap: wrap;
        }

        /* Page style */
        .page {
            width: 210mm;
            background-color: white;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            padding: 7mm;
            overflow-x: hidden;
            position: relative;
        }

        /* Grey box */
        .gray-box {
            background-color: var(--bg-gray);
            padding: 10px;
            height: fit-content;
        }

        .heading {
            color: var(--heading-blue);
            font-size: 13px;
            text-transform: uppercase;
            margin-top: 8px;
        }

        .paragraph {
            font-size: 12px;
            color: var(--box-gray);
            font-weight: lighter;
        }
        /* Print styles */
        @media print {
            @page {
                size: A4 portrait;
                margin: 15mm;
            }
            body {
                background-color: white !important;
                padding: 0 !important;
                margin: 0 !important;
            }

            .page {
                width: auto !important;
                min-height: auto !important;
                padding: 0 !important;
                margin: 0 !important;
                box-shadow: none !important;
                page-break-after: auto !important;
            }

            .button-container, .toast-message {
                display: none !important;
            }

            /* Better page breaks */
            .gray-box, table {
                page-break-inside: avoid !important;
            }

            h1, h2, h3, h4, h5 {
                page-break-after: avoid !important;
            }
            
            img, object, embed, svg {
                max-width: 100% !important;
                page-break-inside: avoid !important;
                display: block !important;
            }
            
            img.logo, img.banner {
                position: absolute !important;
                display: block !important;
                z-index: 5 !important;
            }
            
            table {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
            }
            
            a[href]:after {
                content: none !important;
            }
            
            .weight-dot, .table4-weight-dot {
                print-color-adjust: exact !important;
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            /* Fix for PDF display in print */
            object[type="application/pdf"], embed[type="application/pdf"] {
                display: block !important;
                height: auto !important;
            }
            
            /* Ensure all colors print correctly */
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
        }

        /* Weight indicator styles - adjusted for 35% width */
        .weight-indicator {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 16px;
            min-width: 120px;
        }

        .weight-dot {
            width: 11px;
            height: 11px;
            border-radius: 50%;
            border: 0.5px solid #ddd;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .weight-dot.filled {
            border-color: transparent;
        }

        .weight-dot.empty {
            background-color: #b8b8b8;
            width: 6px;
            height: 6px;
        }

        .weight-dot.filled.overweight { background-color: #4CAF50; border: 1px solid #333;}
        .weight-dot.filled.neutral { background-color: #FFC107; border: 1px solid #333;}
        .weight-dot.filled.underweight { background-color: #ef4444; border: 1px solid #333;}

        .weight-dot:hover {
            transform: scale(1.2);
            
        }

        .weight-dot.empty:hover { border-color: #666; }
        .weight-dot.filled.overweight:hover { border-color: #333; }
        .weight-dot.filled.neutral:hover { border-color: #333; }
        .weight-dot.filled.underweight:hover { border-color: #333; }

        /* Table styling - adjusted for 35% width */
        .factors-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 0;
        }

        .factors-table th {
            background-color: #f8f9fa;
            font-weight: lighter;
            color: #333;
            font-size: 10px;
        }

        .factors-table tbody tr:hover {
            background-color: #f8f9fa;
        }

        /* Alternative investment group styling */
        .alt-investment-group {
            padding: 0 !important;
            border: none !important;
        }

        .alt-investment-container {
            display: flex;
            align-items: stretch;
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
        }

        .alt-investment-labels {
            display: flex;
            flex-direction: column;
            justify-content: space-around;
        }
        .alt-investment-indicator {
            flex: 0 0 100px;
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            cursor: pointer;
        }

        .alt-line-container {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 100%;
            position: absolute;
            transition: left 0.3s ease;
        }
        
        /* Position classes for alternative investments */
        .alt-line-container.position-1 {
            left: 25%;
        }
        
        .alt-line-container.position-2 {
            left: 40%;
        }
        
        .alt-line-container.position-3 {
            left: 56%;
        }
        
        .alt-line-container.position-4 {
            left: 72%;
        }
        
        .alt-line-container.position-5 {
            left: 85%;
        }

        .alt-dot {
            width: 8px;
            height: 8px;
            background-color: #999;
            border-radius: 50%;
            position: relative;
            z-index: 2;
            flex-shrink: 0;
        }

        .alt-line {
            width: 2px;
            background-color: #999;
            position: absolute;
            top: 8px;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1;
        }

        /* Separated row styling */
        .separated-row {
            border-top: 1px solid #333;
            border-bottom: 1px solid #333;
        }
        
        /* Table 4 (Sidebar table) trend styles */
        #table4-view-body .weight-dot {
            position: relative;
        }
        
        #table4-view-body .trend-triangle {
            position: absolute;
            width: 0;
            height: 0;
            z-index: 10;
            cursor: pointer;
        }

        #table4-view-body .trend-triangle.left {
            border-left: 12px solid #ef4444;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
            left: -100%;
            top: 50%;
            transform: translateY(-50%);
            margin-right: 2px;
        }

        #table4-view-body .trend-triangle.right {
            border-right: 12px solid #ef4444;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
            left: -100%;
            top: 50%;
            transform: translateY(-50%);
            margin-left: 2px;
        }

        /* Trend row highlights for table 4 - red border on both columns */
        #table4-view-body tr.trend-row-up td,
        #table4-view-body tr.trend-row-down td {
            position: relative;
        }

        #table4-view-body tr.trend-row-up td:first-child::before,
        #table4-view-body tr.trend-row-down td:first-child::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            height: 30px;
            width: calc(200% + 20px); /* Covers both columns */
            border: 2px solid #ef2121;
            pointer-events: none;
            z-index: 1;
        }
        
        /* Table 4 row hover effect for editing */
        #table4-view-body tr[data-asset-index]:hover {
            background-color: #f9fafb;
            cursor: pointer;
        }
        
        /* Fade out animation for dialog */
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        /* Hover effect for editable elements */
        [data-has-edit-handler="true"]:hover {
            outline: 1px dashed #4CAF50;
            cursor: pointer;
            transition: outline 0.2s ease;
        }
    </style>
    <script>
        // Show toast message
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toastMessage');
            toast.textContent = message;
            toast.className = `toast-message toast-${type} show`;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Reset button - Reload data from JSON
        async function resetData() {
            try {
                const response = await fetch('data.json');
                if (response.ok) {
                    const jsonData = await response.json();
                    documentData = jsonData;
                    document.getElementById('documentTitle').textContent = documentData.title;
                    document.getElementById('documentDate').textContent = documentData.date;
                    
                    // Clear localStorage
                    localStorage.removeItem('documentData');
                    
                    showToast('‚úì Data reset from JSON file', 'success');
                    console.log('Reset to original data:', JSON.stringify(documentData, null, 2));
                } else {
                    showToast('‚úó Could not load data.json', 'error');
                }
            } catch (error) {
                showToast('‚úó Error loading data: ' + error.message, 'error');
            }
        }

        // Save Updates button - Save to data.json file
        async function saveUpdates() {
            try {
                // Note: Saving to file requires a server-side endpoint
                // This will download the file or you need to implement a backend
                const dataStr = JSON.stringify(documentData, null, 2);
                
                // Method 1: Download as file (client-side only)
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'data.json';
                link.click();
                URL.revokeObjectURL(url);
                
                showToast('‚úì JSON file downloaded! Replace the old file.', 'success');
                console.log('Saved data:', dataStr);
                
                // If you have a backend API, use this instead:
                // const response = await fetch('/api/save-data', {
                //     method: 'POST',
                //     headers: { 'Content-Type': 'application/json' },
                //     body: dataStr
                // });
                // if (response.ok) {
                //     showToast('‚úì Data saved successfully', 'success');
                // }
            } catch (error) {
                showToast('‚úó Error saving data: ' + error.message, 'error');
            }
        }

        // Copy JSON button - Copy to clipboard
        async function copyJSON() {
            try {
                const dataStr = JSON.stringify(documentData, null, 2);
                await navigator.clipboard.writeText(dataStr);
                showToast('‚úì JSON copied to clipboard!', 'success');
                console.log('Copied JSON:', dataStr);
            } catch (error) {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = JSON.stringify(documentData, null, 2);
                textArea.style.position = 'fixed';
                textArea.style.opacity = '0';
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    showToast('‚úì JSON copied to clipboard!', 'success');
                } catch (err) {
                    showToast('‚úó Could not copy: ' + err.message, 'error');
                }
                document.body.removeChild(textArea);
            }
        }

        // Load JSON button - Load JSON from file
        async function loadJSONFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Check if it's a JSON file
            if (!file.name.endsWith('.json')) {
                showToast('‚úó Please select a valid JSON file', 'error');
                event.target.value = ''; // Reset input
                return;
            }

            try {
                const text = await file.text();
                const jsonData = JSON.parse(text);
                
                // Validate that the JSON has the required structure
                if (!jsonData || typeof jsonData !== 'object') {
                    throw new Error('Invalid JSON structure');
                }
                
                // Update DocumentData
                DocumentData = jsonData;
                
                // Save to localStorage (using lowercase 'documentData' to match the rest of the code)
                localStorage.setItem('documentData', JSON.stringify(DocumentData));
                
                // Reload the page to apply all changes
                showToast('‚úì JSON loaded successfully! Reloading page...', 'success');
                
                // Reload after a short delay to show the toast
                setTimeout(() => {
                    location.reload();
                }, 1000);
                
                console.log('Loaded JSON data:', jsonData);
            } catch (error) {
                showToast('‚úó Error loading JSON: ' + error.message, 'error');
                console.error('JSON Load Error:', error);
            }
            
            // Reset file input
            event.target.value = '';
        }

        // Function to open paste JSON dialog
        function openPasteDialog() {
            // Check if dialog already exists
            const existingDialog = document.querySelector('.paste-json-dialog-overlay');
            if (existingDialog) {
                existingDialog.remove();
            }

            // Create dialog overlay
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay paste-json-dialog-overlay';
            
            // Create dialog
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            
            // Dialog header
            const header = document.createElement('div');
            header.className = 'edit-dialog-header';
            
            const title = document.createElement('h3');
            title.className = 'edit-dialog-title';
            title.textContent = 'Paste JSON Data';
            
            const closeBtn = document.createElement('button');
            closeBtn.className = 'edit-dialog-close';
            closeBtn.innerHTML = '√ó';
            closeBtn.onclick = () => overlay.remove();
            
            header.appendChild(title);
            header.appendChild(closeBtn);
            
            // Dialog body
            const body = document.createElement('div');
            body.className = 'edit-dialog-body';
            body.style.padding = '24px';
            
            const instruction = document.createElement('p');
            instruction.style.marginBottom = '12px';
            instruction.style.color = '#6b7280';
            instruction.style.fontSize = '14px';
            instruction.textContent = 'Paste your JSON data below:';
            
            const textarea = document.createElement('textarea');
            textarea.style.width = '100%';
            textarea.style.minHeight = '300px';
            textarea.style.padding = '12px';
            textarea.style.border = '1px solid #d1d5db';
            textarea.style.borderRadius = '8px';
            textarea.style.fontFamily = 'monospace';
            textarea.style.fontSize = '13px';
            textarea.style.resize = 'vertical';
            textarea.placeholder = 'Paste JSON here...';
            textarea.focus();
            
            body.appendChild(instruction);
            body.appendChild(textarea);
            
            // Dialog footer
            const footer = document.createElement('div');
            footer.className = 'edit-dialog-footer';
            
            const cancelBtn = document.createElement('button');
            cancelBtn.className = 'edit-dialog-btn edit-dialog-btn-cancel';
            cancelBtn.textContent = 'Cancel';
            cancelBtn.onclick = () => overlay.remove();
            
            const loadBtn = document.createElement('button');
            loadBtn.className = 'edit-dialog-btn edit-dialog-btn-save';
            loadBtn.textContent = 'Load JSON';
            loadBtn.onclick = () => loadPastedJSON(textarea.value, overlay);
            
            footer.appendChild(cancelBtn);
            footer.appendChild(loadBtn);
            
            // Assemble dialog
            dialog.appendChild(header);
            dialog.appendChild(body);
            dialog.appendChild(footer);
            overlay.appendChild(dialog);
            
            // Add to document
            document.body.appendChild(overlay);
            
            // Close on overlay click
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    overlay.remove();
                }
            });
            
            // Close on Escape key
            const escapeHandler = (e) => {
                if (e.key === 'Escape') {
                    overlay.remove();
                    document.removeEventListener('keydown', escapeHandler);
                }
            };
            document.addEventListener('keydown', escapeHandler);
            
            // Focus textarea
            setTimeout(() => textarea.focus(), 100);
        }

        // Function to load pasted JSON data
        function loadPastedJSON(jsonText, overlay) {
            console.log('loadPastedJSON called');
            console.log('JSON Text length:', jsonText.length);
            
            try {
                // Trim whitespace
                jsonText = jsonText.trim();
                
                // Check if empty
                if (!jsonText) {
                    showToast('‚ö† Please paste JSON data', 'error');
                    return;
                }
                
                console.log('Attempting to parse JSON...');
                
                // Parse JSON
                const jsonData = JSON.parse(jsonText);
                
                console.log('JSON parsed successfully:', jsonData);
                
                // Validate JSON structure
                if (!jsonData || typeof jsonData !== 'object') {
                    showToast('‚úó Invalid JSON structure', 'error');
                    return;
                }
                
                console.log('Updating DocumentData...');
                
                // Update DocumentData
                DocumentData = jsonData;
                
                console.log('Saving to localStorage...');
                
                // Save to localStorage (using lowercase 'documentData' to match the rest of the code)
                localStorage.setItem('documentData', JSON.stringify(DocumentData));
                
                console.log('localStorage updated');
                
                // Close dialog
                overlay.remove();
                
                // Show success message
                showToast('‚úì JSON data loaded successfully', 'success');
                
                console.log('Reloading page in 1 second...');
                
                // Reload page after a short delay
                setTimeout(() => {
                    location.reload();
                }, 1000);
                
            } catch (error) {
                showToast('‚úó Invalid JSON format: ' + error.message, 'error');
                console.error('JSON Parse Error:', error);
            }
        }

        // Function to export JSON (keeping for compatibility)
        function exportJSON() {
            saveUpdates();
        }
    </script>
</head>
<body>
    <div class="page relative">
        <!-- Page Heading styles-->
        <style>
            /* Logo and banner styles */
            .logo {
                position: absolute;
                top: -15mm;
                right: 5mm;
                height: 180px;
                object-fit: contain;
            }
            .banner {
                position: absolute;
                top: 65px;
                left: 0;
                width: 101%;
                height: auto;
                z-index: 1;
            }
            .pageTitle {
                position: relative;
                margin-top: 150px;
                z-index: 2;
                display: flex;
                justify-content: space-between;
                align-items: baseline;
            }

            /* Sticky button container */
            .button-container {
                position: fixed;
                top: 20px;
                right: 20px;
                display: flex;
                flex-direction: column;
                gap: 12px;
                z-index: 1000;
            }

            /* Modern button styles */
            .action-btn {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                padding: 10px 18px;
                border: none;
                border-radius: 8px;
                font-family: 'Connections', 'Arial', sans-serif;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                transition: all 0.3s ease;
                outline: none;
                white-space: nowrap;
            }

            .action-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            }

            .action-btn:active {
                transform: translateY(0);
            }

            /* Save button - Green */
            .btn-save {
                background: linear-gradient(135deg, #51cf66, #37b24d);
                color: white;
            }

            .btn-save:hover {
                background: linear-gradient(135deg, #40c057, #2f9e44);
            }

            /* Copy button - Blue */
            .btn-copy {
                background: linear-gradient(135deg, #4dabf7, #339af0);
                color: white;
            }

            .btn-copy:hover {
                background: linear-gradient(135deg, #3b9cf5, #228be6);
            }

            /* Load button - Purple */
            .btn-load {
                background: linear-gradient(135deg, #9775fa, #845ef7);
                color: white;
            }

            .btn-load:hover {
                background: linear-gradient(135deg, #845ef7, #7950f2);
            }

            /* Paste button - Orange */
            .btn-paste {
                background: linear-gradient(135deg, #ff922b, #fd7e14);
                color: white;
            }

            .btn-paste:hover {
                background: linear-gradient(135deg, #fd7e14, #f76707);
            }

            /* Button icons */
            .btn-icon {
                font-size: 16px;
            }

            /* Success/Error message */
            .toast-message {
                position: fixed;
                top: 20px;
                left: 20px;
                padding: 12px 20px;
                border-radius: 8px;
                color: white;
                font-size: 14px;
                font-weight: 500;
                z-index: 1001;
                opacity: 0;
                transform: translateY(-20px);
                transition: all 0.3s ease;
                pointer-events: none;
            }

            .toast-message.show {
                opacity: 1;
                transform: translateY(0);
            }

            .toast-success {
                background: linear-gradient(135deg, #51cf66, #37b24d);
            }

            .toast-error {
                background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
            }

            @media print {
                .button-container {
                    display: none;
                }
            }

            /* Preview button - Teal */
            .btn-preview {
                background: linear-gradient(135deg, #20c997, #12b886);
                color: white;
            }

            .btn-preview:hover {
                background: linear-gradient(135deg, #12b886, #0ca678);
            }

            /* Preview mode styles */
            body.preview-mode {
                background-color: #525659;
            }

            body.preview-mode .page {
                padding: 20mm 0 30mm 0 !important;
                margin-bottom: 20px;
            }

            body.preview-mode .button-container {
                position: fixed;
                top: 20px;
                right: 20px;
            }

            .pageTitle p {
                font-size: 12px;
                color: #555;
            }
        </style>
        <!-- Title and Date Editable Script -->
        <script>
            // JSON structure to store document data
            let documentData = {
                step1: {
                    documentTitle: "Document Title",
                    documentMonth: "Document Month",
                    disclaimer: "Disclaimer text"
                },
                step2: {
                    inBrief: [],
                    cioAssetClassViews: "",
                    hyperlinks: [],
                    summary: {
                        components: []
                    },
                    tableData: {
                        headers: {
                            assetClassHeader: "",
                            cioViewHeader: ""
                        },
                        footnote: "",
                        data: []
                    }
                }
            };

            // Load initial data from data.json
            async function loadInitialData() {
                try {
                    const response = await fetch('data.json');
                    if (response.ok) {
                        const jsonData = await response.json();
                        documentData = jsonData;
                        // Update the page with loaded data
                        document.getElementById('documentTitle').textContent = documentData.step1.documentTitle;
                        document.getElementById('documentDate').textContent = documentData.step1.documentMonth;
                        console.log('Loaded data from data.json:', JSON.stringify(documentData, null, 2));
                    } else {
                        console.warn('Could not load data.json, using default values');
                    }
                } catch (error) {
                    console.warn('Error loading data.json:', error.message, '- using default values');
                }
            }

            // Function to make element editable on double-click
            function makeEditable(element, dataKey) {
                element.addEventListener('dblclick', function() {
                    const currentText = this.textContent;
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.value = currentText;
                    input.style.cssText = window.getComputedStyle(this).cssText;
                    input.style.width = '100%';
                    input.style.border = '2px solid #4CAF50';
                    input.style.padding = '5px';
                    
                    // Replace element with input
                    this.textContent = '';
                    this.appendChild(input);
                    input.focus();
                    input.select();
                    
                    // Save on blur or Enter key
                    const saveEdit = () => {
                        const newValue = input.value || currentText;
                        documentData[dataKey] = newValue;
                        this.textContent = newValue;
                        console.log('Updated documentData:', JSON.stringify(documentData, null, 2));
                        
                        // Optional: Save to localStorage
                        localStorage.setItem('documentData', JSON.stringify(documentData));
                    };
                    
                    input.addEventListener('blur', saveEdit);
                    input.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            input.blur();
                        }
                    });
                    
                    // Cancel on Escape
                    input.addEventListener('keydown', function(e) {
                        if (e.key === 'Escape') {
                            this.textContent = currentText;
                            input.remove();
                        }
                    }.bind(this));
                });
                
                // Add visual indicator on hover
                element.style.cursor = 'pointer';
                element.title = 'Double-click to edit';
            }

            // Initialize on page load
            window.addEventListener('DOMContentLoaded', async function() {
                // First, load data from JSON file
                await loadInitialData();
                
                // Then check localStorage for any saved edits (overrides JSON file)
                const savedData = localStorage.getItem('documentData');
                if (savedData) {
                    documentData = JSON.parse(savedData);
                    document.getElementById('documentTitle').textContent = documentData.step1.documentTitle;
                    document.getElementById('documentDate').textContent = documentData.step1.documentMonth;
                    console.log('Loaded saved edits from localStorage:', JSON.stringify(documentData, null, 2));
                }
                
                // Make elements editable
                makeEditable(document.getElementById('documentTitle'), 'step1.documentTitle');
                makeEditable(document.getElementById('documentDate'), 'step1.documentMonth');
                
                console.log('Initial documentData:', JSON.stringify(documentData, null, 2));
            });

            // Function to export JSON
            function exportJSON() {
                const dataStr = JSON.stringify(documentData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'document-data.json';
                link.click();
            }

            // Function to toggle preview mode
            function togglePreviewMode() {
                const body = document.body;
                const previewBtn = document.querySelector('.btn-preview span');

                if (body.classList.contains('preview-mode')) {
                    // Exit preview mode
                    body.classList.remove('preview-mode');
                    if (previewBtn) previewBtn.textContent = 'üëÅÔ∏è Preview PDF';
                    showToast('‚úì Exited preview mode', 'success');
                } else {
                    // Enter preview mode
                    body.classList.add('preview-mode');
                    if (previewBtn) previewBtn.textContent = '‚úèÔ∏è Edit Mode';
                    showToast('‚úì Preview mode activated - Ready for PDF download', 'success');
                }
            }

            // Function to download as PDF (uses print)
            function downloadPDF() {
                // Trigger browser print dialog
                window.print();
            }
        </script>
        
        <!-- Sticky Button Container -->
        <div class="button-container">
            <button class="action-btn btn-pdf" onclick="downloadPDF()" title="Download as PDF">
                <span>Download PDF</span>
            </button>
            <button class="action-btn btn-save" onclick="saveUpdates()" title="Save changes to JSON file">
                <span>Save Updates</span>
            </button>
            <button class="action-btn btn-copy" onclick="copyJSON()" title="Copy JSON to clipboard">
                <span>Copy JSON</span>
            </button>
            <button class="action-btn btn-load" onclick="document.getElementById('jsonFileInput').click()" title="Load JSON file">
                <span>Load JSON</span>
            </button>
            <button class="action-btn btn-paste" onclick="openPasteDialog()" title="Paste JSON data">
                <span>Paste JSON</span>
            </button>
            <input type="file" id="jsonFileInput" accept=".json" style="display: none;" onchange="loadJSONFile(event)">
        </div>

        <!-- Toast Message -->
        <div id="toastMessage" class="toast-message"></div>
        
        <!-- Page Heading -->
         <img src="assets/logo.png" alt="Logo" class="absolute w-40 top-0 right-0" style="max-width: 160px; height: auto;">
        <div>
            <img class="banner" src="assets/banner.png" alt="Merrill Banner">
            <div class="pageTitle">
                <h3 id="documentTitle"></h3>
                <p id="documentDate"></p>
            </div>
        </div>
        
        <!-- Section 1 -->
        <section class="sectionOne mt-8">
            <style>
                .sectionOne .brief ul li {
                    font-size: 12px;
                    font-weight: lighter;
                    color: var(--box-gray);
                }

                .sectionOne .brief ul li::marker {
                    color: var(--heading-blue);
                }
            </style>
            <div>
                <p id="disclaimer" class="text-xs font-bold"></p>
                <div class="flex gap-3 mt-[10px]">
                    <div style="width: 65%;">
                        <div class="brief gray-box" >
                            <h5 id="inBriefHeading" class="heading"></h5>
                        <ul id="briefList" class="list-disc pl-5 mt-2">
                        <!-- List items will be injected by script -->
                        </ul>
                        </div>
                        <!-- Section 2: Summary Components -->
                        <section class="mt-4">
                            <div id="summaryComponents">
                                <!-- Components will be dynamically added here -->
                            </div>
                        </section>
                        <footer class=" absolute top-[265mm] w-[60%] hidden">
                            <p id="footerText" class="text-[9px] text-gray-500">Merrill Lynch, Pierce, Fenner & Smith Incorporated (also referred to as ‚ÄúMLPF&S‚Äù or ‚ÄúMerrill‚Äù) makes available certain investment
products sponsored, managed, distributed or provided by companies that are affiliates of Bank of America Corporation (‚ÄúBofA Corp.‚Äù).
MLPF&S is a registered broker-dealer, registered investment adviser, Member SIPC and a wholly owned subsidiary of BofA Corp.
Investment products:</p>
                            <table class="table-fixed border-collapse border border-black">
                                <colgroup>
                                    <col class="w-1/3" />
                                    <col class="w-1/3" />
                                    <col class="w-1/3" />
                                </colgroup>
                                <tr>
                                    <td class="text-[11px] font-bold text-center py-1 px-3">Are Not FDIC Insured</td>
                                    <td class="text-[11px] font-bold text-center py-1 px-3 border-l border-black">Are Not Bank Guaranteed</td>
                                    <td class="text-[11px] font-bold text-center py-1 px-3 border-l border-black">May Lose Value</td>
                                </tr>
                            </table>
                            <div class="flex gap-16 items-center">
                                <p class="text-[11px] font-black">Please see last page for important disclosure information.</p>
                                <div class="flex gap-4 items-center">
                                    <p id="footerDisclaimer" class="text-[11px] text-[--box-gray]">8107742</p>
                                    <p id="footerDisclaimer" class="text-[11px] text-[--box-gray]">7/2025</p>
                                </div>
                            </div>
                        </footer>
                    </div>
                    <div class="flex-wrap flex flex-col gap-3" style="width: 35%;">

                        <!-- CIO Asset Class Views Gray Box -->
                        <div class="gray-box">
                            <h5 id="CIOHeading" class="mb-2 text-xs text-black"></h5>
                            <p id="cioViews" class="text-[11px] flex flex-wrap text-[--box-light-gray]"></p>
                        </div>

                        <!-- HyperLinks -->
                        <div id="hyperlinks" class="text-red-500 text-xs mt-2 font-bold flex flex-col gap-2"></div>

                        <!-- Table Data -->
                        <section class="">
                                <div class="overflow-x-auto">
                                    <table class="w-full factors-table ">
                                        <thead class="border-t border-b border-black">
                                            <tr class="align-middle">
                                                <th id="table4-header-1" rowspan="2" class="align-middle text-[11px] px-2 py-0.5"></th>
                                                <th id="table4-header-2" class="align-middle text-center text-[11px] px-2 py-0.5 w-[55%]"></th>
                                            </tr>
                                            <tr>
                                                <th class="text-[11px] px-2 py-0.5 border-t border-black">
                                                    <div class="flex justify-between ">
                                                        <span class="text-[8px] font-thin">Underweight</span>
                                                        <span class="text-[9px] font-thin">Neutral</span>
                                                        <span class="text-[8px] font-thin">Overweight</span>
                                                    </div>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody id="table4-view-body">
                                            <!-- Table 4 rows will be inserted here by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                                <div class="text-xs text-gray-600 mt-2">
                                    <p class="font-light text-[11px]" id="table4-footnote"></p>
                </div>
        </section>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 2  -->
        <section class="mt-8">
            <div>
                <h1 id="s2Title" class="heading"></h1>
                <p id="s2Description" class="description paragraph w-[65%]"></p>
            </div>
            <main class="mt-8">
                <!-- Table 2 Specific Styles -->
                <style>
                /* Range Slider Styles for Table 1 */
                .factors-table tbody td:nth-child(2) {
                    text-align: center;
                    vertical-align: middle;
                    width: 250px;
                    padding: 8px;
                }

                .range-slider {
                    position: relative;
                    width: 200px;
                    height: 30px;
                    margin: 0 auto;
                    display: flex;
                    align-items: center;
                }

                .range-track {
                    width: 100%;
                    height: 4px;
                    background-color: #ccc;
                    border-radius: 4px;
                    position: relative;
                    margin: 0 10px;
                }

                .range-thumb {
                    position: absolute;
                    top: 50%;
                    transform: translate(-50%, -50%);
                    display: flex;
                    align-items: center;
                    gap: 4px;
                    z-index: 2;
                }

                .range-handle {
                    width: 15px;
                    height: 15px;
                    background-color: white;
                    border: 3px solid #333;
                    border-radius: 50%;
                    cursor: pointer !important;
                }

                /* Handle colors based on implication */
                .range-handle.positive { background-color: #22c55e; }
                .range-handle.neutral { background-color: #facc15; }
                .range-handle.negative { background-color: #ef4444; }

                /* SVG Arrow Styles */
                .svg-arrow {
                    display: inline-flex;
                    align-items: center;
                    color: #333;
                    width: 20px;
                    height: 15px;
                }

                .svg-arrow.left { transform: rotate(180deg); }
                .svg-arrow.right { transform: rotate(0deg); }
                .svg-arrow svg { width: 100%; height: 100%; }

                /* Range edit popover styles */
                .range-edit-popover {
                    animation: popoverFadeIn 0.2s ease-out;
                }

                @keyframes popoverFadeIn {
                    from { opacity: 0; transform: translateY(-10px); }
                    to { opacity: 1; transform: translateY(0); }
                }

                .range-edit-popover input[type="range"] {
                    -webkit-appearance: none;
                    appearance: none;
                    height: 6px;
                    background: #ddd;
                    border-radius: 3px;
                    outline: none;
                }

                .range-edit-popover input[type="range"]::-webkit-slider-thumb {
                    -webkit-appearance: none;
                    appearance: none;
                    width: 18px;
                    height: 18px;
                    background: #007bff;
                    border-radius: 50%;
                    cursor: pointer;
                }

                .range-edit-popover input[type="range"]::-moz-range-thumb {
                    width: 18px;
                    height: 18px;
                    background: #007bff;
                    border-radius: 50%;
                    cursor: pointer;
                    border: none;
                }

                /* Additional hover feedback for range sliders */
                .range-slider:hover .range-track {
                    opacity: 0.8;
                }
                </style>

                <!-- Table 2 Specific JavaScript Functions -->
                <script>
                // Table 1: Create factor row with range slider
                window.createFactorRow = function(item, index, allItems) {
                    // Create SVG arrow based on trend
                    let trendArrow = '';
                    const svgArrow = `<svg width="28" height="21" viewBox="0 0 122.88 108.06" xmlns="http://www.w3.org/2000/svg">
                    <path d="M58.94,24.28a14.27,14.27,0,0,1,20.35-20l39.49,40.16a14.28,14.28,0,0,1,0,20L80.09,103.79a14.27,14.27,0,1,1-20.35-20L74.82,68.41l-60.67-.29a14.27,14.27,0,0,1,.24-28.54l59.85.28L58.94,24.28Z" fill="currentColor"/>
                    </svg>`;
                    
                    switch(item.trend) {
                    case 'up':
                        trendArrow = `<span class="svg-arrow right">${svgArrow}</span>`;
                        break;
                    case 'down':
                        trendArrow = `<span class="svg-arrow left">${svgArrow}</span>`;
                        break;
                    case 'neutral':
                    default:
                        trendArrow = '';
                        break;
                    }

                    // Determine handle color class based on value (not implication)
                    // 0, 25 = red (negative), 50 = yellow (neutral), 75, 100 = green (positive)
                    let handleColorClass = '';
                    console.log('Item value for factor', item.factor, ':', item.value);
                    const value = (item.value !== null && item.value !== undefined) ? item.value : 0;
                    
                    if (value <= 25) {
                        handleColorClass = 'negative'; // red
                    } else if (value === 50) {
                        handleColorClass = 'neutral'; // yellow
                    } else {
                        handleColorClass = 'positive'; // green
                    }

                    // Calculate position based on value (0-100) as percentage
                    // Don't constrain 0 to minimum 3%, allow it to be at the actual position
                    const rawPosition = value;
                    console.log('Raw position for value', value, ':', rawPosition);
                    const constrainedPosition = rawPosition;
                    
                    // Create the range slider visualization
                    const rangeSlider = `
                    <div class="range-slider">
                        <div class="range-track">
                        <div class="range-thumb" style="left: ${constrainedPosition}%;">
                            ${trendArrow}
                            <div class="range-handle ${handleColorClass}"></div>
                        </div>
                        </div>
                    </div>
                    `;

                    const classAttr = '';

                    // Handle hidden comment cells
                    const commentStyle = item.commentHidden ? ' style="display: none;"' : '';
                    const commentContent = item.commentHidden ? '' : (item.comments || '');

                    return `
                    <tr${classAttr}>
                        <td class="text-[11px] font-bold px-1">${item.factor}</td>
                        <td>${rangeSlider}</td>
                        <td class="text-[11px] font-thin">${item.cioView}</td>
                        <td ${commentStyle} class="text-[11px] font-thin">${commentContent}</td>
                    </tr>
                    `;
                };

                // Table 1: Range handle editing functionality
                function addRangeHandleEditing() {
                    const rangeHandles = document.querySelectorAll('.range-handle');
                    console.log('Found range handles:', rangeHandles.length);
                    rangeHandles.forEach((handle, index) => {
                    handle.addEventListener('dblclick', function(e) {
                        e.stopPropagation();
                        console.log('Range handle double-clicked!', index);
                        
                        const row = this.closest('tr');
                        const rowIndex = Array.from(row.parentElement.children).indexOf(row);
                        const factorData = window.factorsData[rowIndex];
                        console.log('Factor data for popover:', factorData);
                        
                        showRangeEditPopover(this, factorData, rowIndex);
                    });
                    
                    handle.style.cursor = 'pointer';
                    });
                }

                // Table 1: Show range edit popover
                function showRangeEditPopover(handle, factorData, rowIndex) {
                    // Remove existing popover if any
                    const existingPopover = document.querySelector('.range-edit-popover');
                    if (existingPopover) {
                    existingPopover.remove();
                    }

                    // Create popover
                    const popover = document.createElement('div');
                    popover.className = 'range-edit-popover';
                    popover.style.cssText = `
                    position: absolute;
                    background: white;
                    border: 1px solid #ddd;
                    border-radius: 8px;
                    padding: 20px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                    z-index: 1000;
                    min-width: 250px;
                    font-size: 14px;
                    `;

                    // Get handle position
                    const handleRect = handle.getBoundingClientRect();
                    popover.style.left = (handleRect.left + window.scrollX - 125) + 'px';
                    popover.style.top = (handleRect.bottom + window.scrollY + 10) + 'px';

                    // Create form content
                    popover.innerHTML = `
                    <h3 style="margin: 0 0 15px 0; font-size: 16px; font-weight: bold;">Go Edit Range Settings</h3>
                    
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">Trend:</label>
                        <select id="popover-trend" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="up" ${(factorData.trend || '') === 'up' ? 'selected' : ''}>Up</option>
                        <option value="neutral" ${(factorData.trend || '') === 'neutral' ? 'selected' : ''}>Neutral</option>
                        <option value="down" ${(factorData.trend || '') === 'down' ? 'selected' : ''}>Down</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">Value:</label>
                        <select id="popover-value" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="0" ${factorData.value === 0 ? 'selected' : ''}>0</option>
                        <option value="25" ${factorData.value === 25 ? 'selected' : ''}>25</option>
                        <option value="50" ${factorData.value === 50 ? 'selected' : ''}>50</option>
                        <option value="75" ${factorData.value === 75 ? 'selected' : ''}>75</option>
                        <option value="100" ${factorData.value === 100 ? 'selected' : ''}>100</option>
                        </select>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button onclick="closeRangePopover()" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancel</button>
                        <button onclick="saveRangeChanges(${rowIndex})" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Save</button>
                    </div>
                    `;

                    document.body.appendChild(popover);
                    window.currentRangePopover = popover;

                    // Close popover when clicking outside
                    setTimeout(() => {
                    document.addEventListener('click', closePopoverOnOutsideClick);
                    }, 100);
                }

                // Table 1: Range popover utility functions
                function closePopoverOnOutsideClick(e) {
                    const popover = document.querySelector('.range-edit-popover');
                    if (popover && !popover.contains(e.target)) {
                    closeRangePopover();
                    }
                }

                window.closeRangePopover = function() {
                    const popover = document.querySelector('.range-edit-popover');
                    if (popover) {
                    popover.remove();
                    document.removeEventListener('click', closePopoverOnOutsideClick);
                    }
                };

                window.saveRangeChanges = function(rowIndex) {
                    const trend = document.getElementById('popover-trend').value;
                    const value = parseInt(document.getElementById('popover-value').value);

                    // Auto-set implication based on value
                    let implication;
                    if (value === 0) {
                    implication = 'Negative';
                    } else if (value === 25 || value === 50) {
                    implication = 'Neutral';
                    } else {
                    implication = 'Positive';
                    }

                    console.log('Final value for factor', window.factorsData[rowIndex].factor, ':', value);
                    // Update the data
                    window.factorsData[rowIndex].implication = implication;
                    window.factorsData[rowIndex].trend = trend;
                    window.factorsData[rowIndex].value = value;

                    // Regenerate the table to reflect changes
                    const tbody = document.getElementById("factors-body");
                    tbody.innerHTML = window.factorsData.map((item, index) => window.createFactorRow(item, index, window.factorsData)).join("");
                    
                    // Re-initialize editable functionality
                    makeHeadersEditable();
                    makeTextCellsEditable();
                    addRangeHandleEditing();

                    // Save changes and close popover
                    closeRangePopover();
                    showRangeUpdateNotification();
                };

                // Table 1: Show notification for range updates
                function showRangeUpdateNotification() {
                    const notification = document.createElement('div');
                    notification.textContent = 'Range settings updated successfully!';
                    notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #28a745;
                    color: white;
                    padding: 10px 15px;
                    border-radius: 4px;
                    z-index: 1001;
                    font-size: 14px;
                    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
                    `;
                    
                    document.body.appendChild(notification);
                    
                    setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                    }, 3000);
                }
                </script>

                <h2 id="s2Subtitle" class="text-xs font-bold mb-6 pb-2 border-b border-gray-300">Current readings on the key drivers of Equities for investors to consider, with arrows representing the recent trend:</h2>
                <div class="overflow-x-auto">
                    <table class="w-full factors-table">
                    <thead>
                        <tr>
                        <th rowspan="2" class="align-middle"><span id="s2HeaderFactor">Factor</span></th>
                        <th class="align-middle border-b border-black"><span id="s2HeaderImplication">Implication for Equities</span></th>
                        <th rowspan="2" class="align-middle"><span id="s2HeaderCioView">CIO View</span></th>
                        </tr>
                        <tr>
                        <th class="text-xs">
                            <div class="flex justify-between px-4">
                            <span id="s2HeaderNegative">Negative</span>
                            <span id="s2HeaderNeutral">Neutral</span>
                            <span id="s2HeaderPositive">Positive</span>
                            </div>
                        </th>
                        </tr>
                    </thead>
                    <tbody id="factors-body"></tbody>
                    </table>
                </div>
                <div class="paragraph border-t border-black pt-2">
                    <p id="s2Footnote">Source: Chief Investment Office.</p>
                </div>
            </main>
        </section>

        <!-- Section 3 -->
         <section>
            <h1 id="s3Title" class="heading"></h1>
            <div class="flex gap-3 mt-3">
                <div id="s3Subsection" class="w-[65%]"></div>
                <div id="rightContainer" class="w-[35%] flex flex-col gap-3">
                    <div class="gray-box">
                        <h1 class="heading">EQUITY WATCH LIST</h1>
                        <ul id="s3EquityList" class="list-disc pl-5 mt-2"></ul>
                        <h1 class="heading">RISK CONSIDERATIONS</h1>
                        <ul id="s3RiskList" class="list-disc pl-5 mt-2"></ul>
                    </div>

                    <div class="mt-4">
                        <style>
                    /* Table 9 Specific Styles */
                    .table9-container {
                        width: 100%;
                        max-width: 800px;
                        margin: 0 auto;
                    }

                    .table9-title {
                        font-size: var(--text-xs);
                        font-weight: bold;
                        color: #000;
                        margin-bottom: 10px;
                        text-align: left;
                    }

                    .table9-legend {
                        display: flex;
                        justify-content: center;
                        gap: 10px;
                        margin-bottom: 10px;
                        font-size: 10px;
                    }

                    .table9-legend-item {
                        display: flex;
                        align-items: center;
                        gap: 8px;
                    }

                    .table9-legend-dot {
                        width: 6px;
                        height: 6px;
                        border-radius: 50%;
                    }

                    .table9-legend-dot.current {
                        background-color: #1e3a8a;
                    }

                    .table9-legend-dot.average {
                        background-color: #dc2626;
                    }

                    .table9-chart {
                        border-collapse: collapse;
                        width: 100%;
                        border-top: 2px solid #000;
                    }

                    .table9-chart tbody tr {
                        border-bottom: 1px solid #d1d5db;
                    }

                    .table9-chart tbody tr:last-child {
                        border-bottom: 2px solid #000;
                    }

                    .table9-sector-label {
                        text-align: right;
                        padding: 3px 4px;
                        font-size: 10px;
                        font-weight: normal;
                        width: 90px;
                        border-right: 1px solid #d1d5db;
                    }

                    .table9-chart-area {
                        position: relative;
                        padding: 6px 0;
                        background-image: 
                        linear-gradient(to right, #d1d5db 1px, transparent 1px),
                        linear-gradient(to right, #e5e7eb 1px, transparent 1px);
                        background-size: 20% 100%, 10% 100%;
                        background-position: 0 0, 0 0;
                    }

                    .table9-chart-container {
                        position: relative;
                        height: 10px;
                        margin: 0 10px;
                    }

                    .table9-dot {
                        position: absolute;
                        width: 6px;
                        height: 6px;
                        border-radius: 50%;
                        top: 50%;
                        transform: translateY(-50%);
                    }

                    .table9-dot.current {
                        background-color: #1e3a8a;
                        z-index: 2;
                    }

                    .table9-dot.average {
                        background-color: #dc2626;
                        z-index: 1;
                    }

                    .table9-x-axis {
                        text-align: center;
                        padding: 8px 0;
                        font-size: 10px;
                        color: #666;
                        border-right: 1px solid #d1d5db;
                        border-top: 0;
                    }

                    .table9-x-axis-labels {
                        display: flex;
                        justify-content: space-between;
                        padding: 4px 5px;
                        font-size: 10px;
                        color: #666;
                        font-weight: 500;
                    }

                    .table9-x-axis-labels span {
                        flex: 0 0 auto;
                        text-align: center;
                    }

                    .table9-subtitle {
                        text-align: center;
                        font-size: 9px;
                        color: #666;
                        margin-top: 8px;
                        font-weight: 500;
                    }

                    /* Hover effects */
                    .table9-title:hover {
                        background-color: #f0f0f0;
                        cursor: pointer;
                        transition: background-color 0.2s ease;
                    }

                    .table9-sector-label:hover {
                        background-color: #f9fafb;
                        cursor: pointer;
                        transition: background-color 0.2s ease;
                    }

                    .table9-chart-area:hover {
                        background-color: rgba(249, 250, 251, 0.5);
                        cursor: pointer;
                        transition: background-color 0.2s ease;
                    }

                    .table9-chart tbody tr:hover {
                        background-color: #f9fafb;
                    }

                    .table9-x-axis-labels:hover {
                        background-color: #f0f0f0;
                        transition: background-color 0.2s ease;
                    }

                    .table9-dot {
                        cursor: pointer;
                        transition: transform 0.2s ease;
                    }

                    .table9-dot:hover {
                        transform: translateY(-50%) scale(1.3);
                    }
                        </style>

                        <script>
                        // Table 9: Create sector row
                        window.createSectorTableRow = function(sector, index) {
                            const config = window.table9XAxisConfig || { start: 10, end: 35 };
                            const minValue = config.start;
                            const maxValue = config.end;
                            const range = maxValue - minValue;

                            // Calculate positions as percentages
                            const currentPos = ((sector.currentPE - minValue) / range) * 100;
                            const averagePos = ((sector.averagePE - minValue) / range) * 100;

                            return `
                            <tr data-row-index="${index}">
                                <td class="table9-sector-label">${sector.name}</td>
                                <td class="table9-chart-area">
                                <div class="table9-chart-container">
                                    <div class="table9-dot average" style="left: ${averagePos}%;"></div>
                                    <div class="table9-dot current" style="left: ${currentPos}%;"></div>
                                </div>
                                </td>
                            </tr>
                            `;
                        };

                        // Table 9: Initialize
                        function initializeTable9() {
                            console.log('Initializing Table 9...');
                            
                            // Initialize x-axis configuration
                            if (!window.table9XAxisConfig) {
                            window.table9XAxisConfig = {
                                start: 10,
                                end: 35,
                                interval: 5
                            };
                            }
                            
                            if (!window.table9ViewData) {
                            // Default data matching the image
                            window.table9ViewData = [
                                { name: "S&P 500", currentPE: 23.5, averagePE: 17.5 },
                                { name: "Information Technology", currentPE: 29.5, averagePE: 18.5 },
                                { name: "Consumer Discretionary", currentPE: 25.0, averagePE: 20.5 },
                                { name: "Healthcare", currentPE: 19.0, averagePE: 16.5 },
                                { name: "Financials", currentPE: 17.5, averagePE: 14.5 },
                                { name: "Communication Services", currentPE: 19.5, averagePE: 17.0 },
                                { name: "Industrials", currentPE: 23.0, averagePE: 18.0 },
                                { name: "Consumer Staples", currentPE: 21.0, averagePE: 19.0 },
                                { name: "Energy", currentPE: 13.0, averagePE: 34.0 },
                                { name: "Real Estate", currentPE: 20.5, averagePE: 20.5 },
                                { name: "Materials", currentPE: 21.0, averagePE: 16.5 },
                                { name: "Utilities", currentPE: 19.0, averagePE: 16.5 }
                            ];
                            }

                            const table9Body = document.getElementById('table9-body');
                            if (table9Body && window.table9ViewData) {
                            table9Body.innerHTML = window.table9ViewData
                                .map((sector, index) => createSectorTableRow(sector, index))
                                .join('');
                            }

                            // Render x-axis labels
                            renderTable9XAxisLabels();

                            // Add editing functionality
                            addTable9Editing();

                            console.log('Table 9 initialized');
                        }

                        // Table 9: Add editing functionality
                        function addTable9Editing() {
                            console.log('Initializing Table 9 editing...');

                            // Make title editable
                            const table9Title = document.querySelector('.table9-title');
                            if (table9Title) {
                            table9Title.addEventListener('dblclick', function(e) {
                                e.stopPropagation();
                                makeTable9TitleEditable(table9Title);
                            });
                            }

                            // Make sector labels editable
                            const table9Body = document.getElementById('table9-body');
                            if (table9Body) {
                            table9Body.addEventListener('dblclick', function(e) {
                                const label = e.target.closest('.table9-sector-label');
                                if (label) {
                                const row = label.closest('tr');
                                const rowIndex = Array.from(table9Body.children).indexOf(row);
                                makeTable9SectorLabelEditable(label, rowIndex);
                                return;
                                }

                                // Check if clicked on chart area or dots
                                const chartArea = e.target.closest('.table9-chart-area');
                                if (chartArea) {
                                const row = chartArea.closest('tr');
                                const rowIndex = Array.from(table9Body.children).indexOf(row);
                                showTable9EditPopover(rowIndex);
                                }
                            });
                            }

                            // Make x-axis editable (single click on x-axis labels)
                            const xAxisLabels = document.querySelector('.table9-x-axis-labels');
                            if (xAxisLabels) {
                            xAxisLabels.addEventListener('click', function(e) {
                                e.stopPropagation();
                                showTable9XAxisEditPopover();
                            });
                            xAxisLabels.style.cursor = 'pointer';
                            }

                            console.log('Table 9 editing initialization complete');
                        }

                        // Table 9: Make title editable
                        function makeTable9TitleEditable(element) {
                            if (element.querySelector('input')) return;

                            const originalText = element.textContent.trim();
                            const input = document.createElement('input');
                            input.type = 'text';
                            input.value = originalText;
                            input.style.cssText = `
                            background: #fff3cd;
                            border: 1px solid #ffc107;
                            border-radius: 2px;
                            padding: 4px 8px;
                            font-size: inherit;
                            font-weight: inherit;
                            color: inherit;
                            width: 100%;
                            outline: none;
                            `;

                            element.innerHTML = '';
                            element.appendChild(input);
                            input.focus();
                            input.select();

                            function saveEdit() {
                            const newValue = input.value.trim();
                            element.textContent = newValue || originalText;
                            saveDataToStorage();
                            showTable9UpdateNotification();
                            }

                            input.addEventListener('blur', saveEdit);
                            input.addEventListener('keydown', function(e) {
                            if (e.key === 'Enter') {
                                e.preventDefault();
                                saveEdit();
                            } else if (e.key === 'Escape') {
                                element.textContent = originalText;
                            }
                            });
                        }

                        // Table 9: Make sector label editable
                        function makeTable9SectorLabelEditable(label, rowIndex) {
                            if (label.querySelector('input')) return;

                            const originalText = label.textContent.trim();
                            const input = document.createElement('input');
                            input.type = 'text';
                            input.value = originalText;
                            input.style.cssText = `
                            background: #fff3cd;
                            border: 1px solid #ffc107;
                            border-radius: 2px;
                            padding: 4px 8px;
                            font-size: inherit;
                            color: inherit;
                            width: 100%;
                            outline: none;
                            `;

                            label.innerHTML = '';
                            label.appendChild(input);
                            input.focus();
                            input.select();

                            function saveEdit() {
                            const newValue = input.value.trim();
                            label.textContent = newValue || originalText;
                            
                            if (window.table9ViewData && window.table9ViewData[rowIndex]) {
                                window.table9ViewData[rowIndex].name = newValue;
                                saveDataToStorage();
                                showTable9UpdateNotification();
                            }
                            }

                            input.addEventListener('blur', saveEdit);
                            input.addEventListener('keydown', function(e) {
                            if (e.key === 'Enter') {
                                e.preventDefault();
                                saveEdit();
                            } else if (e.key === 'Escape') {
                                label.textContent = originalText;
                            }
                            });
                        }

                        // Table 9: Show edit popover for P/E values
                        function showTable9EditPopover(rowIndex) {
                            // Remove existing popover if any
                            const existingPopover = document.querySelector('.table9-edit-popover');
                            if (existingPopover) {
                            existingPopover.remove();
                            }

                            const sector = window.table9ViewData[rowIndex];
                            if (!sector) return;

                            // Create popover
                            const popover = document.createElement('div');
                            popover.className = 'table9-edit-popover';
                            popover.style.cssText = `
                            position: fixed;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            background: white;
                            border: 2px solid #1e3a8a;
                            border-radius: 8px;
                            padding: 24px;
                            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
                            z-index: 1000;
                            min-width: 350px;
                            font-size: 14px;
                            `;

                            popover.innerHTML = `
                            <div style="margin-bottom: 16px; font-weight: bold; font-size: 16px; color: #1e3a8a;">
                                Edit P/E Values - ${sector.name}
                            </div>
                            <div style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 6px; font-weight: 500;">
                                Current Fwd P/E (10-35):
                                </label>
                                <input type="number" id="table9-current-pe" value="${sector.currentPE}" 
                                min="10" max="35" step="0.5"
                                style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px;">
                            </div>
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 6px; font-weight: 500;">
                                15 Year Average P/E (10-35):
                                </label>
                                <input type="number" id="table9-average-pe" value="${sector.averagePE}" 
                                min="10" max="35" step="0.5"
                                style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px;">
                            </div>
                            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                                <button id="table9-cancel-btn" style="padding: 8px 16px; border: 1px solid #d1d5db; background: white; border-radius: 4px; cursor: pointer; font-size: 14px;">
                                Cancel
                                </button>
                                <button id="table9-save-btn" style="padding: 8px 16px; border: none; background: #1e3a8a; color: white; border-radius: 4px; cursor: pointer; font-weight: 500; font-size: 14px;">
                                Save
                                </button>
                            </div>
                            `;

                            // Create backdrop
                            const backdrop = document.createElement('div');
                            backdrop.className = 'table9-popover-backdrop';
                            backdrop.style.cssText = `
                            position: fixed;
                            top: 0;
                            left: 0;
                            right: 0;
                            bottom: 0;
                            background: rgba(0,0,0,0.3);
                            z-index: 999;
                            `;

                            document.body.appendChild(backdrop);
                            document.body.appendChild(popover);

                            // Handle save
                            document.getElementById('table9-save-btn').addEventListener('click', function() {
                            const currentPE = parseFloat(document.getElementById('table9-current-pe').value);
                            const averagePE = parseFloat(document.getElementById('table9-average-pe').value);

                            // Validate
                            if (currentPE < 10 || currentPE > 35 || averagePE < 10 || averagePE > 35) {
                                alert('P/E values must be between 10 and 35');
                                return;
                            }

                            // Update data
                            window.table9ViewData[rowIndex].currentPE = currentPE;
                            window.table9ViewData[rowIndex].averagePE = averagePE;

                            // Re-render the row
                            const table9Body = document.getElementById('table9-body');
                            const rows = table9Body.querySelectorAll('tr');
                            if (rows[rowIndex]) {
                                rows[rowIndex].outerHTML = createSectorTableRow(window.table9ViewData[rowIndex], rowIndex);
                            }

                            // Save and close
                            saveDataToStorage();
                            showTable9UpdateNotification();
                            backdrop.remove();
                            popover.remove();
                            });

                            // Handle cancel
                            function closePopover() {
                            backdrop.remove();
                            popover.remove();
                            }

                            document.getElementById('table9-cancel-btn').addEventListener('click', closePopover);
                            backdrop.addEventListener('click', closePopover);

                            // Handle Escape key
                            function handleEscape(e) {
                            if (e.key === 'Escape') {
                                closePopover();
                                document.removeEventListener('keydown', handleEscape);
                            }
                            }
                            document.addEventListener('keydown', handleEscape);
                        }

                        // Table 9: Show update notification
                        function showTable9UpdateNotification() {
                            showUpdateNotification('Sector Valuations updated successfully!');
                        }

                        // Table 9: Generate x-axis labels
                        function generateTable9XAxisLabels(table9XAxisConfig) {
                            const config = table9XAxisConfig || { start: 10, end: 35, interval: 5 };
                            const labels = [];
                            for (let value = config.start; value <= config.end; value += config.interval) {
                            labels.push(value);
                            }
                            return labels;
                        }

                        // Table 9: Render x-axis labels
                        function renderTable9XAxisLabels(table9XAxisConfig) {
                            const labelsContainer = document.getElementById('s3XAxisLabels');
                            if (labelsContainer) {
                            const labels = generateTable9XAxisLabels(table9XAxisConfig);
                            labelsContainer.innerHTML = labels.map(label => `<span>${label}</span>`).join('');
                            }
                        }

                        // Table 9: Show x-axis edit popover
                        function showTable9XAxisEditPopover() {
                            // Remove existing popover if any
                            const existingPopover = document.getElementById('s3XAxisLabels');
                            if (existingPopover) {
                            existingPopover.remove();
                            }

                            const config = table9XAxisConfig || { start: 10, end: 35, interval: 5 };

                            // Create popover
                            const popover = document.createElement('div');
                            popover.className = 'table9-xaxis-popover';
                            popover.style.cssText = `
                            position: fixed;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            background: white;
                            border: 2px solid #1e3a8a;
                            border-radius: 8px;
                            padding: 24px;
                            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
                            z-index: 1000;
                            min-width: 350px;
                            font-size: 14px;
                            `;

                            popover.innerHTML = `
                            <div style="margin-bottom: 16px; font-weight: bold; font-size: 16px; color: #1e3a8a;">
                                Edit X-Axis Configuration
                            </div>
                            <div style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 6px; font-weight: 500;">
                                Start Value:
                                </label>
                                <input type="number" id="table9-xaxis-start" value="${config.start}" 
                                step="1"
                                style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px;">
                            </div>
                            <div style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 6px; font-weight: 500;">
                                End Value:
                                </label>
                                <input type="number" id="table9-xaxis-end" value="${config.end}" 
                                step="1"
                                style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px;">
                            </div>
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 6px; font-weight: 500;">
                                Interval:
                                </label>
                                <input type="number" id="table9-xaxis-interval" value="${config.interval}" 
                                min="1" step="1"
                                style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px;">
                            </div>
                            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                                <button id="table9-xaxis-cancel-btn" style="padding: 8px 16px; border: 1px solid #d1d5db; background: white; border-radius: 4px; cursor: pointer; font-size: 14px;">
                                Cancel
                                </button>
                                <button id="table9-xaxis-save-btn" style="padding: 8px 16px; border: none; background: #1e3a8a; color: white; border-radius: 4px; cursor: pointer; font-weight: 500; font-size: 14px;">
                                Save
                                </button>
                            </div>
                            `;

                            // Create backdrop
                            const backdrop = document.createElement('div');
                            backdrop.className = 'table9-xaxis-backdrop';
                            backdrop.style.cssText = `
                            position: fixed;
                            top: 0;
                            left: 0;
                            right: 0;
                            bottom: 0;
                            background: rgba(0,0,0,0.3);
                            z-index: 999;
                            `;

                            document.body.appendChild(backdrop);
                            document.body.appendChild(popover);

                            // Handle save
                            document.getElementById('table9-xaxis-save-btn').addEventListener('click', function() {
                            const start = parseFloat(document.getElementById('table9-xaxis-start').value);
                            const end = parseFloat(document.getElementById('table9-xaxis-end').value);
                            const interval = parseFloat(document.getElementById('table9-xaxis-interval').value);

                            // Validate
                            if (isNaN(start) || isNaN(end) || isNaN(interval)) {
                                alert('Please enter valid numbers');
                                return;
                            }
                            if (start >= end) {
                                alert('Start value must be less than end value');
                                return;
                            }
                            if (interval <= 0) {
                                alert('Interval must be greater than 0');
                                return;
                            }

                            // Update config
                            window.table9XAxisConfig = { start, end, interval };

                            // Re-render x-axis labels
                            renderTable9XAxisLabels();

                            // Re-render all rows with new scale
                            const table9Body = document.getElementById('table9-body');
                            if (table9Body && window.table9ViewData) {
                                table9Body.innerHTML = window.table9ViewData
                                .map((sector, index) => createSectorTableRow(sector, index))
                                .join('');
                            }

                            // Save and close
                            saveDataToStorage();
                            showTable9UpdateNotification();
                            backdrop.remove();
                            popover.remove();
                            });

                            // Handle cancel
                            function closePopover() {
                            backdrop.remove();
                            popover.remove();
                            }

                            document.getElementById('table9-xaxis-cancel-btn').addEventListener('click', closePopover);
                            backdrop.addEventListener('click', closePopover);

                            // Handle Escape key
                            function handleEscape(e) {
                            if (e.key === 'Escape') {
                                closePopover();
                                document.removeEventListener('keydown', handleEscape);
                            }
                            }
                            document.addEventListener('keydown', handleEscape);
                        }
                        </script>
                        <div class="table9-container">
                            <div class="table9-title border-b-2 border-black font-bold">Sector Valuations</div>
                            
                            <div class="table9-legend">
                            <div class="table9-legend-item">
                                <div class="table9-legend-dot current"></div>
                                <span>Current Fwd P/E</span>
                            </div>
                            <div class="table9-legend-item">
                                <div class="table9-legend-dot average"></div>
                                <span>15 Year Average</span>
                            </div>
                            </div>

                            <table class="table9-chart">
                            <tbody id="s3SectorTable">
                                <!-- Rows will be populated by JavaScript -->
                            </tbody>
                             <!-- <img id="s3SectorImg" src="" alt="img sector valuation" style="width:100%; height:auto;"/> -->
                            <tfoot id="sectorFoot">
                                <tr>
                                <td class="table9-x-axis"></td>
                                <td class="table9-chart-area">
                                    <div id="s3XAxisLabels" class="table9-x-axis-labels">
                                    </div>
                                </td>
                                </tr>
                            </tfoot>
                            </table>

                            <div class="s3SectorSubtitle border-t border-black text-[9px] pt-2 text-gray-600">
                            Forward Price-to-Earnings (P/E) for S&P 500 Sectors
                            </div>
                        </div>
                    </div>
                </div>
            </div>
         </section>

        <!-- Section 4 -->
         <section class="mt-8">
            <h1 id="s4Title" class="heading"></h1>
            <div class="flex gap-3">
                <div id="s4Subsection" class="w-[65%]"></div>
                <div class="w-[35%] gray-box">
                    <h1 id="s4IncomeTitle" class="heading">Fixed Income Watch List</h1>
                    <ul id="s4IncomeList" class="list-disc pl-5 mt-2"></ul>
                    <h1 id="s4RiskTitle" class="heading">RISK CONSIDERATIONS</h1>
                    <ul id="s4RiskList" class="list-disc pl-5 mt-2"></ul>
                </div>
            </div>
         </section>

         <!-- Section 5 -->
         <section class="mt-8">
            <h1 id="s5Title" class="heading"></h1>
            <div class="flex  gap-3">
                <div class="w-[65%]">
                    <div id="s5AltBox" class="gray-box"></div>
                    <div id="s5Subsection" class="mt-2"></div>
                </div>
                <div class="w-[35%]">
                    <h1>CIO Views on Alts Strategies</h1>
                    <div id="s5CIOViews" class="mt-2"></div>
                </div>
            </div>
            <div class="w-full gray-box mt-4">
                <h1 class="heading" id="s5StrategyTitle"></h1>
                <ul class="list-disc pl-5 mt-2" id="s5StrategyList"></ul>
            </div>
            
         </section>

         <!-- Section 6 -->
          <section class="mt-8">
            <h1 id="s6Title" class="heading"></h1>
            <div class="flex gap-3 mt-4">
                <div class="w-[60%]">
                    <main class="w-full">
                        <!-- Table 6 Specific Styles -->
                        <style>
                        /* Table 6 Economic Forecasts specific styles */
                        .table6-container {
                            border-collapse: collapse;
                            width: 100%;
                            font-family: Arial, sans-serif;
                        }

                        .table6-container th:first-child {
                            text-align: left;
                            border-right: none;
                        }

                        .table6-container td,
                        .table6-container th {
                            padding: 8px 12px;
                            text-align: center;
                            border: none;
                            width: auto; /* can fine-tune widths with Tailwind w-[..] if needed */
                            font-size: 9px;
                        }

                        .table6-container th:first-child,
                        .table6-container td:first-child {
                            text-align: left;
                            font-weight: bold;
                            width: 150px; /* match your header‚Äôs first column */
                        }

                        /* Alternating row colors - even rows (2nd, 4th, 6th) are gray */
                        .table6-container tbody tr:nth-child(even) td {
                            background-color: #e8e8e8;
                        }

                        /* Odd rows (1st, 3rd, 5th) are white */
                        .table6-container tbody tr:nth-child(odd) td {
                            background-color: white;
                        }

                        .table6-container tbody tr:last-child td {
                            border-bottom: 1px solid #000;
                        }
                        
                        /* Editable header elements */
                        #table6-title:hover,
                        #table6-date-text:hover,
                        #table6-footnote:hover {
                            background-color: #f0f0f0;
                            border-radius: 3px;
                            padding: 2px 4px;
                            transition: background-color 0.2s ease;
                            cursor: pointer;
                        }

                        /* Editable table column headers */
                        .table6-container thead th:hover {
                            background-color: #f0f0f0;
                            cursor: pointer;
                            transition: background-color 0.2s ease;
                        }

                        /* Editable cell styling */
                        .table6-container td:hover {
                            background-color: #e3f2fd;
                            cursor: pointer;
                        }

                        .table6-container td input {
                            border: none;
                            background: transparent;
                            width: 100%;
                            text-align: center;
                            font-family: inherit;
                            font-size: inherit;
                        }

                        .table6-container td:first-child input {
                            text-align: left;
                        }

                        .table6-container td input:focus {
                            outline: 2px solid #2196f3;
                            background-color: #fff;
                            border-radius: 2px;
                        }
                        </style>

                        <!-- Table 6 Specific JavaScript Functions -->
                        <script>
                        

                        // Table 6: Add editing functionality
                        function addTable6Editing() {
                            console.log('Initializing Table 6 editing...');
                            
                            const table6Body = document.getElementById('table6-body');
                            if (!table6Body) {
                            console.warn('Table 6 body not found!');
                            return;
                            }

                            // Make all cells editable on double-click
                            table6Body.addEventListener('dblclick', function(e) {
                            const cell = e.target.closest('td');
                            if (!cell) return;

                            const field = cell.getAttribute('data-field');
                            const rowIndex = Array.from(table6Body.children).indexOf(cell.closest('tr'));
                            
                            makeTable6CellEditable(cell, field, rowIndex);
                            });

                            // Make header title editable
                            const table6Title = document.getElementById('table6-title');
                            console.log('Table 6 title element:', table6Title);
                            if (table6Title) {
                            table6Title.addEventListener('dblclick', function(e) {
                                console.log('Title double-clicked!');
                                e.stopPropagation();
                                makeTable6HeaderEditable(table6Title, 'title');
                            });
                            console.log('Title event listener added');
                            } else {
                            console.warn('Table 6 title element not found!');
                            }

                            // Make header date editable
                            const table6Date = document.getElementById('table6-date-text');
                            console.log('Table 6 date element:', table6Date);
                            if (table6Date) {
                            table6Date.addEventListener('dblclick', function(e) {
                                console.log('Date double-clicked!');
                                e.stopPropagation();
                                makeTable6HeaderEditable(table6Date, 'date');
                            });
                            console.log('Date event listener added');
                            } else {
                            console.warn('Table 6 date element not found!');
                            }

                            // Make footnote editable
                            const table6Footnote = document.getElementById('table6-footnote');
                            console.log('Table 6 footnote element:', table6Footnote);
                            if (table6Footnote) {
                            table6Footnote.addEventListener('dblclick', function(e) {
                                console.log('Footnote double-clicked!');
                                e.stopPropagation();
                                makeTable6FootnoteEditable(table6Footnote);
                            });
                            console.log('Footnote event listener added');
                            } else {
                            console.warn('Table 6 footnote element not found!');
                            }

                            // Make table column headers editable
                            const table6Headers = document.querySelectorAll('.table6-container thead th');
                            console.log('Found', table6Headers.length, 'column headers');
                            table6Headers.forEach((header, index) => {
                            header.addEventListener('dblclick', function(e) {
                                console.log('Column header', index, 'double-clicked!');
                                e.stopPropagation();
                                makeTable6ColumnHeaderEditable(header, index);
                            });
                            });
                            
                            console.log('Table 6 editing initialization complete');
                        }

                        // Table 6: Make header editable
                        function makeTable6HeaderEditable(element, field) {
                            if (element.querySelector('input')) return; // Already editing

                            const originalText = element.textContent;
                            const input = document.createElement('input');
                            input.type = 'text';
                            input.value = originalText;
                            input.style.cssText = `
                            background: #fff3cd;
                            border: 1px solid #ffc107;
                            border-radius: 2px;
                            padding: 2px 6px;
                            font-size: inherit;
                            font-weight: inherit;
                            color: inherit;
                            outline: none;
                            `;
                            
                            // Clear element and add input
                            element.innerHTML = '';
                            element.appendChild(input);
                            input.focus();
                            input.select();

                            // Save on Enter or blur
                            function saveEdit() {
                            const newValue = input.value.trim();
                            element.textContent = newValue || originalText;
                            
                            // Update metadata
                            if (window.table6MetaData) {
                                if (field === 'title') {
                                window.table6MetaData.title = newValue;
                                } else if (field === 'date') {
                                if (!window.table6MetaData.headers) {
                                    window.table6MetaData.headers = {};
                                }
                                window.table6MetaData.headers.dateHeader = newValue;
                                }
                                saveDataToStorage();
                                showTable6UpdateNotification();
                            }
                            }

                            input.addEventListener('blur', saveEdit);
                            input.addEventListener('keydown', function(e) {
                            if (e.key === 'Enter') {
                                e.preventDefault();
                                saveEdit();
                            } else if (e.key === 'Escape') {
                                element.textContent = originalText;
                            }
                            });
                        }

                        // Table 6: Make footnote editable
                        function makeTable6FootnoteEditable(element) {
                            if (element.querySelector('textarea')) return; // Already editing

                            const originalText = element.textContent.trim();
                            const textarea = document.createElement('textarea');
                            textarea.value = originalText;
                            textarea.style.cssText = `
                            background: #fff3cd;
                            border: 1px solid #ffc107;
                            border-radius: 4px;
                            padding: 8px;
                            font-size: inherit;
                            font-family: inherit;
                            color: inherit;
                            outline: none;
                            width: 100%;
                            min-height: 120px;
                            resize: vertical;
                            `;
                            
                            // Clear element and add textarea
                            element.innerHTML = '';
                            element.appendChild(textarea);
                            textarea.focus();
                            textarea.select();

                            // Save on blur
                            function saveEdit() {
                            const newValue = textarea.value.trim();
                            element.textContent = newValue || originalText;
                            
                            // Update metadata
                            if (window.table6MetaData) {
                                window.table6MetaData.footnote = newValue;
                                saveDataToStorage();
                                showTable6UpdateNotification();
                            }
                            }

                            textarea.addEventListener('blur', saveEdit);
                            textarea.addEventListener('keydown', function(e) {
                            // Save on Ctrl+Enter or Cmd+Enter
                            if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
                                e.preventDefault();
                                saveEdit();
                            } else if (e.key === 'Escape') {
                                element.textContent = originalText;
                            }
                            });
                        }

                        // Table 6: Make column header editable
                        function makeTable6ColumnHeaderEditable(header, index) {
                            if (header.querySelector('input')) return; // Already editing

                            const originalText = header.textContent.trim();
                            const input = document.createElement('input');
                            input.type = 'text';
                            input.value = originalText;
                            input.style.cssText = `
                            background: #fff3cd;
                            border: 1px solid #ffc107;
                            border-radius: 2px;
                            padding: 4px 8px;
                            font-size: inherit;
                            font-weight: inherit;
                            text-align: center;
                            color: inherit;
                            outline: none;
                            width: 100%;
                            `;
                            
                            // Clear header and add input
                            header.innerHTML = '';
                            header.appendChild(input);
                            input.focus();
                            input.select();

                            // Save on Enter or blur
                            function saveEdit() {
                            const newValue = input.value.trim();
                            header.textContent = newValue || originalText;
                            
                            // Update metadata
                            if (window.table6MetaData) {
                                if (!window.table6MetaData.headers) {
                                window.table6MetaData.headers = {};
                                }
                                
                                // Map index to column names
                                const columnNames = ['empty', 'Q1 2025A', 'Q2 2025A', 'Q3 2025E', 'Q4 2025E', '2025E', '2026E'];
                                const columnKey = `column${index}`;
                                
                                if (index === 0) {
                                window.table6MetaData.headers.firstColumn = newValue;
                                } else {
                                window.table6MetaData.headers[columnKey] = newValue;
                                }
                                
                                saveDataToStorage();
                                showTable6UpdateNotification();
                            }
                            }

                            input.addEventListener('blur', saveEdit);
                            input.addEventListener('keydown', function(e) {
                            if (e.key === 'Enter') {
                                e.preventDefault();
                                saveEdit();
                            } else if (e.key === 'Escape') {
                                header.textContent = originalText;
                            }
                            });
                        }

                        // Table 6: Make cell editable
                        function makeTable6CellEditable(cell, field, rowIndex) {
                            if (cell.querySelector('input')) return; // Already editing

                            const originalText = cell.textContent;
                            const input = document.createElement('input');
                            input.type = 'text';
                            input.value = originalText;
                            input.style.width = '100%';
                            
                            // Clear cell and add input
                            cell.innerHTML = '';
                            cell.appendChild(input);
                            input.focus();
                            input.select();

                            // Save on Enter or blur
                            function saveEdit() {
                            const newValue = input.value.trim();
                            cell.textContent = newValue;
                            
                            // Update data
                            if (window.table6ViewData && window.table6ViewData[rowIndex]) {
                                window.table6ViewData[rowIndex][field] = newValue;
                                saveDataToStorage();
                                showTable6UpdateNotification();
                            }
                            }

                            input.addEventListener('blur', saveEdit);
                            input.addEventListener('keydown', function(e) {
                            if (e.key === 'Enter') {
                                e.preventDefault();
                                saveEdit();
                            } else if (e.key === 'Escape') {
                                cell.textContent = originalText;
                            }
                            });
                        }

                        // Table 6: Show update notification
                        function showTable6UpdateNotification() {
                            showUpdateNotification('Economic forecasts updated successfully!');
                        }
                        </script>
                        <table class="table6-container table-fixed">
                            <thead>
                                <tr id="s6T1Header" class="border-t border-b border-black"><th class="text-left w-[150px]"></th></tr>
                            </thead>
                            <tbody id="s6T1Body" class="w-fit">
                                <!-- Table 6 rows will be populated by JavaScript -->
                            </tbody>
                        </table>
                        <div id="s6T1Footnote" class="pt-3 text-[9px] text-gray-600"></div>
                    </main>
                </div>
                <div class="w-[40%]">
                    <div id="s6SidebarBox" class="gray-box">
                        <h1 id="s6SidebarTitle" class="heading"></h1>
                        <div id="s6SidebarContent" class="mt-2 paragraph"></div>
                        <div class="mt-2">
                            <style>

                            .table7-container {
                                border-collapse: collapse;
                                width: 100%;
                                font-family: Arial, sans-serif;
                                border: 1px solid #333;
                                font-weight: lighter;
                            }

                            .table7-container th {
                                background-color: white;
                                color: #000;
                                padding: 12px 10px;
                                text-align: center;
                                border: 1px solid #333;
                                font-size: 8px;
                            }

                            .table7-container th:first-child {
                                text-align: center;
                                background-color: white;
                            }

                            .table7-container thead tr:first-child th {
                                border-bottom: 1px solid #333;
                            }

                            .table7-container td {
                                padding: 10px;
                                text-align: center;
                                border: 1px solid #333;
                                background-color: white;
                                font-size: 9px;
                            }

                            .table7-container thead {
                                text-align: center;
                                font-weight: bold;
                            }
                            /* Editable cell styling */
                            .table7-container td:hover {
                                cursor: pointer;
                            }

                            .table7-container td input {
                                border: none;
                                background: transparent;
                                width: 100%;
                                text-align: center;
                                font-family: inherit;
                                font-size: inherit;
                            }

                            .table7-container td input:focus {
                                outline: 2px solid #2196f3;
                                background-color: #fff;
                                border-radius: 2px;
                            }

                            /* Footnote styling */
                            .table7-footnote {
                                font-size: 8px;
                                color: #666;
                                line-height: 1.2;
                            }
                            </style>

                            <div class="overflow-x-auto">
                                <table class="table7-container">
                                <thead id="s6T2Header"></thead>
                                <tbody id="s6T2Body">
                                    <!-- Table 7 rows will be populated by JavaScript -->
                                </tbody>
                                </table>
                            </div>
                            
                            <div id="s6T2Footnote" class="table7-footnote pt-3"></div>
                        </div>
                    </div>
                </div>
            </div>
          </section>

        <!-- Section 7 -->
         <section class="s7" class="mt-8">
            <style>
            /* Weight indicator styles for Table 2 */
            .s7 .weight-indicator {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
                padding-top: 15px;
                padding-bottom: 5px;
                cursor: pointer;
            }

            .s7 .weight-dot {
                width: 16px;
                height: 16px;
                border-radius: 50%;
                border: 2px solid #666;
                cursor: pointer;
                position: relative;
            }

            .s7 .weight-dot.filled {
                border-color: #333;
            }

            .s7 .weight-dot.empty {
                background-color: #d3d3d3;
                border-color: #d3d3d3;
                width: 10px;
                height: 10px;
            }

            /* Weight dot colors based on position */
            .s7 .weight-dot.filled.overweight { background-color: #4CAF50; } /* Green */
            .s7 .weight-dot.filled.neutral { background-color: #FFC107; } /* Yellow */
            .s7 .weight-dot.filled.underweight { background-color: #ef4444; } /* Red */

            /* Hover effects for weight dots */
            .s7 .weight-dot:hover {
                transform: scale(1.1);
                box-shadow: 0 2px 4px rgba(0,0,0,0.2);
                transition: all 0.2s ease;
            }

            .s7 .weight-dot.empty:hover { border-color: #666; }
            .s7 .weight-dot.filled.overweight:hover { border-color: #2E7D32; }
            .s7 .weight-dot.filled.neutral:hover { border-color: #F57F17; }
            .s7 .weight-dot.filled.underweight:hover { border-color: #E65100; }

            /* Hidden weight indicators (when position is -1) */
            .s7 .weight-indicator.hidden {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
                padding-top: 15px;
                padding-bottom: 5px;
                cursor: pointer;
                min-height: 20px;
                background-color: rgba(211, 211, 211, 0.1);
                border-radius: 4px;
                transition: background-color 0.2s ease;
            }

            .s7 .weight-indicator.hidden:hover {
                background-color: rgba(211, 211, 211, 0.2);
            }
            </style>

            <!-- Table 2 Specific JavaScript Functions -->
            <script>
            // Table 2: Create asset class row with weight indicators
            function createAssetClassRow(item, index, allItems) {
                // Determine if row should have separation borders and trend classes
                let rowClass = item.separate === 1 ? 'separated-row' : '';
                
                // Add trend border class if there's a trend
                if (item.trend === 1) {
                    rowClass += (rowClass ? ' ' : '') + 'trend-row-up';
                } else if (item.trend === -1) {
                    rowClass += (rowClass ? ' ' : '') + 'trend-row-down';
                }
                
                const classAttr = rowClass ? ` class="${rowClass.trim()}"` : '';
                
                // Check if previous row has merge=1 (this row's comment cell should be hidden)
                const previousItem = index > 0 ? allItems[index - 1] : null;
                const isPreviousMerged = previousItem && previousItem.merge === 1;
                
                // If position is -1, hide all dots
                if (item.position === -1) {
                const weightIndicator = `
                    <div class="weight-indicator hidden" title="Double-click to set weight position">
                    </div>
                `;

                // If previous row merged, don't render comment cell
                if (isPreviousMerged) {
                    return `
                        <tr${classAttr}>
                        <td class="text-[11px] font-bold">${item.assetClass}</td>
                        <td>${weightIndicator}</td>
                        </tr>
                    `;
                }

                // If this row has merge=1, add rowspan and center
                const mergeAttr = item.merge === 1 ? ' rowspan="2" style="text-align: center; vertical-align: middle;"' : '';
                
                return `
                    <tr${classAttr}>
                    <td class="text-[11px] font-bold">${item.assetClass}</td>
                    <td>${weightIndicator}</td>
                    <td${mergeAttr} class="text-[11px] font-thin">${item.comments}</td>
                    </tr>
                `;
                }

                // Create weight indicator dots for normal positions
                const totalDots = 5;
                let dotsHtml = '';
                
                for (let i = 1; i <= totalDots; i++) {
                let dotClass = 'weight-dot';
                let triangleHtml = '';
                
                if (i === item.position) {
                    // Only the selected position gets color
                    if (i <= 2) {
                    dotClass += ' filled underweight'; // Red for positions 1-2
                    } else if (i === 3) {
                    dotClass += ' filled neutral'; // Yellow for position 3
                    } else {
                    dotClass += ' filled overweight'; // Green for positions 4-5
                    }
                } else {
                    dotClass += ' empty'; // All other dots are empty/gray
                }

                // Add trend triangle based on trend value and position
                if (item.trend !== undefined && item.trend !== 0 && item.position !== -1) {
                    if (item.trend === 1 && i === (item.position - 1) && i >= 1) {
                    // Show upward trend triangle on the dot to the LEFT of the selected position
                    triangleHtml = '<div class="trend-triangle trend-row-up left"></div>';
                    } else if (item.trend === -1 && i === (item.position + 1) && i <= 5) {
                    // Show downward trend triangle on the dot to the RIGHT of the selected position
                    triangleHtml = '<div class="trend-triangle trend-row-down right"></div>';
                    }
                }
                
                dotsHtml += `<div class="${dotClass}" data-position="${i}">${triangleHtml}</div>`;
                }
                

                const weightIndicator = `
                <div class="weight-indicator">
                    ${dotsHtml}
                </div>
                `;

                // If previous row merged, don't render comment cell
                if (isPreviousMerged) {
                    return `
                    <tr${classAttr}>
                        <td class="text-[11px] font-bold">${item.assetClass}</td>
                        <td>${weightIndicator}</td>
                    </tr>
                    `;
                }

                // Handle hidden comment cells or merged cells
                const commentStyle = item.commentHidden ? ' style="display: none;"' : '';
                const commentContent = item.commentHidden ? '' : (item.comments || '');
                
                // If this row has merge=1, add rowspan and center
                const mergeAttr = item.merge === 1 ? ' rowspan="2" style="text-align: center; vertical-align: middle;"' : '';

                return `
                <tr${classAttr}>
                    <td class="text-[11px] font-bold pl-2">${item.assetClass}</td>
                    <td>${weightIndicator}</td>
                    <td${commentStyle}${mergeAttr} class="text-[11px] font-thin">${commentContent}</td>
                </tr>
                `;
            };

            // Table 2: Weight indicator editing functionality
            function addTable2WeightIndicatorEditing() {
                const weightIndicators = document.querySelectorAll('#cio-view-body .weight-indicator');
                weightIndicators.forEach((indicator, index) => {
                // Handle hidden weight indicators (when position is -1)
                if (indicator.classList.contains('hidden')) {
                    indicator.addEventListener('dblclick', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const row = this.closest('tr');
                    if (!row) return;
                    const tbody = row.parentElement;
                    if (!tbody) return;
                    const rowIndex = Array.from(tbody.children).indexOf(row);
                    
                    if (window.cioViewData && window.cioViewData[rowIndex]) {
                        showWeightEditPopover(this, window.cioViewData[rowIndex], rowIndex, 'cio-view');
                    }
                    });
                    return; // Skip regular functionality for hidden indicators
                }

                // Single click for position selection (Table 2 only)
                indicator.addEventListener('click', function(e) {
                    const dots = this.querySelectorAll('.weight-dot');
                    const clickedDot = e.target.closest('.weight-dot');
                    
                    if (!clickedDot) return;
                    
                    const dotIndex = parseInt(clickedDot.getAttribute('data-position'));
                    
                    // Update the visual state - only the clicked dot gets color
                    dots.forEach((dot, i) => {
                    const dotPosition = parseInt(dot.getAttribute('data-position'));
                    
                    if (dotPosition === dotIndex) {
                        // Only the selected position gets color
                        if (dotIndex <= 2) {
                        dot.className = 'weight-dot filled underweight';
                        } else if (dotIndex === 3) {
                        dot.className = 'weight-dot filled neutral';
                        } else {
                        dot.className = 'weight-dot filled overweight';
                        }
                    } else {
                        dot.className = 'weight-dot empty';
                    }
                    });
                    
                    // Update the data
                    const row = this.closest('tr');
                    if (!row) return;
                    const tbody = row.parentElement;
                    if (!tbody) return;
                    const rowIndex = Array.from(tbody.children).indexOf(row);
                    
                    if (window.cioViewData && window.cioViewData[rowIndex]) {
                    window.cioViewData[rowIndex].position = dotIndex;
                    
                    // Update weight based on position
                    if (dotIndex <= 2) {
                        window.cioViewData[rowIndex].weight = 'underweight';
                    } else if (dotIndex === 3) {
                        window.cioViewData[rowIndex].weight = 'neutral';
                    } else {
                        window.cioViewData[rowIndex].weight = 'overweight';
                    }
                    
                    // Ensure fields exist
                    if (window.cioViewData[rowIndex].separate === undefined) {
                        window.cioViewData[rowIndex].separate = 0;
                    }
                    if (window.cioViewData[rowIndex].trend === undefined) {
                        window.cioViewData[rowIndex].trend = 0;
                    }
                    
                    saveDataToStorage();
                    showWeightUpdateNotification();
                    }
                });

                // Double click for weight editing or hiding dots
                indicator.addEventListener('dblclick', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const clickedDot = e.target.closest('.weight-dot');
                    const row = this.closest('tr');
                    if (!row) return;
                    const tbody = row.parentElement;
                    if (!tbody) return;
                    const rowIndex = Array.from(tbody.children).indexOf(row);
                    
                    if (clickedDot && clickedDot.classList.contains('filled')) {
                    // Open weight edit popover for filled dots
                    if (window.cioViewData && window.cioViewData[rowIndex]) {
                        showWeightEditPopover(clickedDot, window.cioViewData[rowIndex], rowIndex, 'cio-view');
                    }
                    } else {
                    // Double-click on empty area - hide all dots (set position to -1)
                    if (window.cioViewData && window.cioViewData[rowIndex]) {
                        window.cioViewData[rowIndex].position = -1;
                        window.cioViewData[rowIndex].weight = 'none';
                        
                        // Ensure fields exist
                        if (window.cioViewData[rowIndex].separate === undefined) {
                        window.cioViewData[rowIndex].separate = 0;
                        }
                        if (window.cioViewData[rowIndex].trend === undefined) {
                        window.cioViewData[rowIndex].trend = 0;
                        }
                        
                        // Regenerate Table 2
                        const cioTbody = document.getElementById("cio-view-body");
                        cioTbody.innerHTML = window.cioViewData.map((item, index) => window.createAssetClassRow(item, index, window.cioViewData)).join("");
                        
                        // Re-initialize functionality
                        makeHeadersEditable();
                        makeTextCellsEditable();
                        addTable2WeightIndicatorEditing();
                        
                        saveDataToStorage();
                        showWeightUpdateNotification();
                    }
                    }
                });
                });
            }

            // Table 2: Show weight update notification
            function showWeightUpdateNotification() {
                const notification = document.createElement('div');
                notification.textContent = 'Weight updated successfully!';
                notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: #28a745;
                color: white;
                padding: 10px 15px;
                border-radius: 4px;
                z-index: 1001;
                font-size: 14px;
                box-shadow: 0 2px 5px rgba(0,0,0,0.2);
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
                }, 3000);
            }
            </script>

            <h2 id="s7Title" class="heading"></h2>
                <table class="w-full factors-table">
                    <thead id="s7Header" class="border-t border-b border-black"></thead>
                    <tbody id="s7TableBody"></tbody>
                </table>
            <div id="s7Footnote" class="text-[11px] font-thin text-gray-500"></div>
        </section>

        <!-- Section 8 -->
         <section class="s8 mt-8">
            <h1 id="s8Title" class="heading"></h1>
            <p id="s8Content" class="paragraph"></p>
            <main class="mt-4">
                <!-- Table 3 Specific Styles -->
                <style>
                .s8 .weight-indicator {
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 10px;
                    padding-top: 15px;
                    padding-bottom: 5px;
                    cursor: pointer;
                }

                .s8 .weight-dot {
                    width: 16px;
                    height: 16px;
                    border-radius: 50%;
                    border: 2px solid #666;
                    cursor: pointer;
                    position: relative;
                }

                .s8 .weight-dot.filled {
                    border-color: #333;
                }

                .s8 .weight-dot.empty {
                    background-color: #d3d3d3;
                    border-color: #d3d3d3;
                    width: 10px;
                    height: 10px;
                }

                /* Weight dot colors based on position */
                .s8 .weight-dot.filled.overweight { background-color: #4CAF50; } /* Green */
                .s8 .weight-dot.filled.neutral { background-color: #FFC107; } /* Yellow */
                .s8 .weight-dot.filled.underweight { background-color: #ef4444; } /* Red */

                /* Hover effects for weight dots */
                .s8 .weight-dot:hover {
                    transform: scale(1.1);
                    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
                    transition: all 0.2s ease;
                }

                .s8 .weight-dot.empty:hover { border-color: #666; }
                .s8 .weight-dot.filled.overweight:hover { border-color: #2E7D32; }
                .s8 .weight-dot.filled.neutral:hover { border-color: #F57F17; }
                .s8 .weight-dot.filled.underweight:hover { border-color: #E65100; }

                /* Hidden weight indicators (when position is -1) */
                .s8 .weight-indicator.hidden {
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 10px;
                    padding-top: 15px;
                    padding-bottom: 5px;
                    cursor: pointer;
                    min-height: 20px;
                    background-color: rgba(211, 211, 211, 0.1);
                    border-radius: 4px;
                    transition: background-color 0.2s ease;
                }

                .s8 .weight-indicator.hidden:hover {
                    background-color: rgba(211, 211, 211, 0.2);
                }
                /* Trend triangles for Table 3 weight indicators */
                .trend-triangle {
                    position: absolute;
                    width: 0;
                    height: 0;
                    z-index: 10;
                    cursor: pointer;
                    transition: all 0.2s ease;
                }

                .trend-triangle:hover {
                    transform: translateX(50%) scale(1.1);
                    filter: brightness(1.2);
                }

                .trend-triangle.left {
                    border-left: 15px solid #ef4444;
                    border-top: 8px solid transparent;
                    border-bottom: 8px solid transparent;
                    left: 100%;
                    top: -6px;
                    transform: translateX(-50%);
                }

                .trend-triangle.right {
                    border-right: 15px solid #ef4444;
                    border-top: 8px solid transparent;
                    border-bottom: 8px solid transparent;
                    top: -6px;
                    transform: translateX(-50%);
                }

                /* Table 3 trend row highlights - Fixed height red border */
                .trend-row-up td:first-child,
                .trend-row-down td:first-child {
                    position: relative;
                }

                .trend-row-up td:first-child::before,
                .trend-row-down td:first-child::before {
                    content: '';
                    position: absolute;
                    left: 0;
                    top: 50%;
                    transform: translateY(-50%);
                    height: 40px; /* Fixed height */
                    border: 2px solid #ef2121;
                    pointer-events: none;
                    z-index: 1;
                }

                .trend-row-up td:first-child::before,
                .trend-row-down td:first-child::before {
                    width: calc(250% + 96px); /* Covers first two columns */
                    border-right: 2px solid #ef2121;
                }

                

                /* Table 3 rows are clickable */
                #table3-view-body tr {
                    cursor: pointer;
                }

                #table3-view-body tr:hover {
                    background-color: #f8f9fa !important;
                }
                .s8 .weight-dot { position: relative; }
                </style>

                <!-- Table 3 Specific JavaScript Functions -->
                <script>
                // Table 3: Enhanced createAssetClassRow with trend triangles
                function createSectorRow(item, index, allItems) {
                    // Determine if row should have separation borders
                    let rowClass = item.separate === 1 ? 'separated-row' : '';
                    
                    // Add trend border class if there's a trend
                    if (item.trend === 1) {
                    rowClass += ' trend-row-up';
                    } else if (item.trend === -1) {
                    rowClass += ' trend-row-down';
                    }
                    

                    
                    // Add class attribute if there are any classes
                    const classAttr = rowClass ? ` class="${rowClass.trim()}"` : '';
                    
                    // If position is -1, hide all dots
                    if (item.position === -1) {
                    const weightIndicator = `
                        <div class="weight-indicator hidden">
                        <!-- No dots displayed when position is -1 -->
                        </div>
                    `;

                    return `
                        <tr${classAttr}>
                        <td class="text-[11px] font-bold">${item.sector}</td>
                        <td>${weightIndicator}</td>
                        <td class="text-[11px] font-thin">${item.comments}</td>
                        </tr>
                    `;
                    }

                    // Create weight indicator dots for normal positions
                    const totalDots = 5;
                    let dotsHtml = '';
                    
                    for (let i = 1; i <= totalDots; i++) {
                    let dotClass = 'weight-dot';
                    let triangleHtml = '';
                    
                    if (i === item.position) {
                        // Only the selected position gets color
                        if (i <= 2) {
                        dotClass += ' filled underweight'; // Red for positions 1-2
                        } else if (i === 3) {
                        dotClass += ' filled neutral'; // Yellow for position 3
                        } else {
                        dotClass += ' filled overweight'; // Green for positions 4-5
                        }
                    } else {
                        dotClass += ' empty'; // All other dots are empty/gray
                    }
                    
                    // Add trend triangle based on trend value and position
                    if (item.trend !== undefined && item.trend !== 0 && item.position !== -1) {
                        if (item.trend === 1 && i === (item.position - 1) && i >= 1) {
                        // Show upward trend triangle on the dot to the LEFT of the selected position
                        triangleHtml = '<div class="trend-triangle left"></div>';
                        } else if (item.trend === -1 && i === (item.position + 1) && i <= 5) {
                        // Show downward trend triangle on the dot to the RIGHT of the selected position  
                        triangleHtml = '<div class="trend-triangle right"></div>';
                        }
                    }
                    
                    dotsHtml += `<div class="${dotClass}" data-position="${i}">${triangleHtml}</div>`;
                    }

                    const weightIndicator = `
                    <div class="weight-indicator">
                        ${dotsHtml}
                    </div>
                    `;

                    // Handle hidden comment cells
                    const commentStyle = item.commentHidden ? ' style="display: none;"' : '';
                    const commentContent = item.commentHidden ? '' : (item.comments || '');

                    return `
                    <tr${classAttr}>
                        <td class="text-[11px] font-bold pl-2">${item.sector}</td>
                        <td>${weightIndicator}</td>
                        <td${commentStyle} class="text-[11px] font-thin">${commentContent}</td>
                    </tr>
                    `;
                };

                // Table 3: Weight indicator editing functionality (double-click only)
                function addTable3WeightIndicatorEditing() {
                    const weightIndicators = document.querySelectorAll('#table3-view-body .weight-indicator');
                    weightIndicators.forEach((indicator, index) => {
                    // Double click for editing
                    indicator.addEventListener('dblclick', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        const clickedTriangle = e.target.closest('.trend-triangle');
                        const clickedDot = e.target.closest('.weight-dot');
                        
                        const row = this.closest('tr');
                        const tbody = row.parentElement;
                        const rowIndex = Array.from(tbody.children).indexOf(row);
                        
                        if (clickedTriangle) {
                        // Handle trend triangle double-click
                        showTrendEditPopover(clickedTriangle, window.table3ViewData[rowIndex], rowIndex, 'table3');
                        return;
                        } else if (clickedDot && clickedDot.classList.contains('filled')) {
                        // Handle weight dot double-click for filled dots
                        if (window.table3ViewData && window.table3ViewData[rowIndex]) {
                            showWeightEditPopover(clickedDot, window.table3ViewData[rowIndex], rowIndex, 'table3');
                        }
                        return;
                        } else {
                        // Double-click on empty area - open popover
                        if (window.table3ViewData && window.table3ViewData[rowIndex]) {
                            showWeightEditPopover(this, window.table3ViewData[rowIndex], rowIndex, 'table3');
                        }
                        }
                    });
                    });
                }

                // Table 3: Row double-click functionality
                function addTable3RowEditing() {
                    const table3Rows = document.querySelectorAll('#table3-view-body tr');
                    table3Rows.forEach((row, index) => {
                    row.addEventListener('dblclick', function(e) {
                        // Prevent if already editing text or if clicking on an input
                        if (e.target.tagName === 'INPUT' || e.target.closest('input')) {
                        return;
                        }
                        
                        e.preventDefault();
                        e.stopPropagation();
                        
                        const tbody = this.parentElement;
                        const rowIndex = Array.from(tbody.children).indexOf(this);
                        
                        if (window.table3ViewData && window.table3ViewData[rowIndex]) {
                        // Open weight edit popover for this row
                        const weightIndicator = this.querySelector('.weight-indicator');
                        if (weightIndicator) {
                            showWeightEditPopover(weightIndicator, window.table3ViewData[rowIndex], rowIndex, 'table3');
                        } else {
                            console.error('Weight indicator not found for Table 3 row:', rowIndex);
                        }
                        } else {
                        console.error('Table 3 data not found for row:', rowIndex, 'Data:', window.table3ViewData);
                        }
                    });
                    
                    // Add visual feedback
                    row.style.cursor = 'pointer';
                    row.title = 'Double-click to edit weight settings';
                    });
                }

                // Table 3: Show trend edit popover
                function showTrendEditPopover(triangle, data, rowIndex, tableType) {
                    // Remove existing popover if any
                    const existingPopover = document.querySelector('.trend-edit-popover');
                    if (existingPopover) {
                    existingPopover.remove();
                    }

                    // Create popover
                    const popover = document.createElement('div');
                    popover.className = 'trend-edit-popover';
                    popover.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: white;
                    border: 1px solid #ddd;
                    border-radius: 8px;
                    padding: 20px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                    z-index: 1000;
                    min-width: 220px;
                    font-size: 14px;
                    `;

                    // Create form content
                    popover.innerHTML = `
                    <h3 style="margin: 0 0 15px 0; font-size: 16px; font-weight: bold;">Edit Trend Direction</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">Trend Direction:</label>
                        <select id="popover-trend-direction" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="0" ${data.trend === 0 ? 'selected' : ''}>No Trend</option>
                        <option value="1" ${data.trend === 1 ? 'selected' : ''}>Upward Trend (‚Üí)</option>
                        <option value="-1" ${data.trend === -1 ? 'selected' : ''}>Downward Trend (‚Üê)</option>
                        </select>
                        <div style="font-size: 12px; color: #666; margin-top: 5px;">
                        Trend triangles show direction of movement relative to current position
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button onclick="closeTrendPopover()" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancel</button>
                        <button onclick="saveTrendChanges(${rowIndex}, '${tableType}')" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Save</button>
                    </div>
                    `;

                    document.body.appendChild(popover);
                    window.currentTrendPopover = popover;

                    // Close popover when clicking outside
                    setTimeout(() => {
                    document.addEventListener('click', closeTrendPopoverOnOutsideClick);
                    }, 100);
                }

                // Table 3: Trend popover utility functions
                function closeTrendPopoverOnOutsideClick(e) {
                    const popover = document.querySelector('.trend-edit-popover');
                    if (popover && !popover.contains(e.target)) {
                    closeTrendPopover();
                    }
                }

                window.closeTrendPopover = function() {
                    const popover = document.querySelector('.trend-edit-popover');
                    if (popover) {
                    popover.remove();
                    document.removeEventListener('click', closeTrendPopoverOnOutsideClick);
                    }
                };

                window.saveTrendChanges = function(rowIndex, tableType) {
                    const trendValue = parseInt(document.getElementById('popover-trend-direction').value);

                    // Update the data
                    if (tableType === 'table3' && window.table3ViewData && window.table3ViewData[rowIndex]) {
                    window.table3ViewData[rowIndex].trend = trendValue;
                    
                    // Regenerate Table 3 to reflect changes
                    const table3Tbody = document.getElementById("table3-view-body");
                    table3Tbody.innerHTML = window.table3ViewData.map(window.createTable3sectorRow).join("");
                    
                    // Re-initialize editable functionality
                    makeHeadersEditable();
                    makeTextCellsEditable();
                    addTable3WeightIndicatorEditing();
                    addTable3RowEditing();
                    
                    console.log(`Updated trend for Table 3 row ${rowIndex} to ${trendValue}`);
                    }

                    // Save changes
                    saveDataToStorage();
                    closeTrendPopover();
                    showTrendUpdateNotification();
                };

                // Table 3: Show trend update notification
                function showTrendUpdateNotification() {
                    const notification = document.createElement('div');
                    notification.textContent = 'Trend direction updated successfully!';
                    notification.style.cssText = `
                    position: fixed;
                    top: 80px;
                    right: 20px;
                    background: #28a745;
                    color: white;
                    padding: 10px 15px;
                    border-radius: 4px;
                    z-index: 1001;
                    font-size: 14px;
                    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
                    `;
                    
                    document.body.appendChild(notification);
                    
                    setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                    }, 3000);
                }
                </script>
                <table class="w-full factors-table">
                    <thead id="s8Header" class="border-t border-b border-black"></thead>
                    <tbody id="s8TableBody"></tbody>
                </table>
                <p id="s8Footnote" class="text-gray-500 text-[9px] font-thin pt-2"></p>
            </main>
         </section>

        <!-- Section 9 -->
         <section class="s9 mt-8">
            <h1 class="heading" id="s9Title"></h1>
            <p class="paragraph" id="s9Content"></p>
            <!-- Table 5 Specific Styles -->
            <style>
            /* Table 5 specific styles */
            .table5-container {
                border-collapse: separate;
                border-spacing: 30px 8px;
                width: 100%;
            }

            .table5-container th {
                background-color: #f8f9fa;
                font-weight: bold;
                text-align: left;
                border-top: 1px solid #333;
                border-bottom: 1px solid #333;
            }

            .table5-container td {
                padding: 12px 8px;
                vertical-align: top;
                border: none;
            }

            /* Level 1 column styling */
            .table5-level1 {
                width: 35%;
                position: relative;
            }

            .table5-level1-title {
                color: #0066cc;
                font-weight: bold;
                font-size: 11px;
                margin-bottom: 8px;
            }

            .table5-level1-list {
                list-style: none;
                padding-left: 0;
                margin: 0;
            }

            .table5-level1-list li {
                padding-left: 18px;
                position: relative;
                font-size: 10px;
                line-height: 1.5;
            }

            .table5-level1-list li:before {
                content: "‚óè";
                position: absolute;
                left: 0;
                color: #0066cc;
                font-size: 8px;
                top: 6px;
            }

            /* Red arrow indicator - auto adjusts to row height */
            .table5-arrow {
                position: absolute;
                right: -22px;
                top: 0;
                bottom: 0;
                width: 45px;
                background: linear-gradient(to right, transparent 0%, transparent 50%, #ef4444 50%, #ef4444 100%);
                clip-path: polygon(0 0, 50% 0, 100% 50%, 50% 100%, 0 100%);
                z-index: 1;
            }

            /* Level 2 column styling */
            .table5-level2 {
                width: 65%;
                padding-left: 40px;
                font-size: 10px;
                line-height: 1.4;
            }

            .table5-level2-item {
                margin-bottom: 2px;
            }

            .table5-level2-header {
                font-weight: bold;
                display: inline;
                color: #000;
                font-size: 11px;
            }

            .table5-level2-description {
                display: inline;
                color: #333;
            }

            /* Make cells editable on double-click */
            .table5-level1-title:hover,
            .table5-level1-list li:hover,
            .table5-level2:hover {
                background-color: #f8f9fa;
                cursor: pointer;
            }

            /* Same gray color for all rows */
            .table5-row:nth-child(even),
            .table5-row:nth-child(odd) {
                background-color: #f3f4f6;
            }
            </style>

            <!-- Table 5 Specific JavaScript Functions -->
            <script>
            // Table 5: Create thematic investment row
            function createSectionNineRow(item, index) {
                
                // Generate Level 1 list items
                const level1Items = item.leftData.map(subItem => 
                `<li>${subItem}</li>`
                ).join('');

                // Generate Level 2 description items
                const level2Items = item.rightData.map(desc => 
                `<div class="table5-level2-item">
                    <span class="table5-level2-header">${desc.header}:</span> 
                    <span class="table5-level2-description">${desc.description}</span>
                </div>`
                ).join('');

                return `
                <tr class="table5-row" data-row-index="${index}">
                    <td class="table5-level1">
                    <div class="table5-level1-title">${item.category}</div>
                    <ul class="table5-level1-list">
                        ${level1Items}
                    </ul>
                    <div class="table5-arrow"></div>
                    </td>
                    <td class="table5-level2">
                    ${level2Items}
                    </td>
                </tr>
                `;
            };

            // Table 5: Comprehensive editing functionality
            function addTable5Editing() {
                // Make table headers editable
                const table5Headers = document.querySelectorAll('#table5-container th');
                table5Headers.forEach((header, index) => {
                header.addEventListener('dblclick', (e) => {
                    e.stopPropagation();
                    makeElementEditable(header, () => {
                    console.log('Header updated:', header.textContent);
                    });
                });
                });

                const table5Rows = document.querySelectorAll('#table5-body tr');
                
                table5Rows.forEach((row, rowIndex) => {
                // Disable any row-level editing - remove all event listeners on the row itself
                row.style.cursor = 'default';
                row.onclick = null;
                row.ondblclick = null;
                
                // Disable any row-level click events for Level 1 column
                const level1Column = row.querySelector('td:first-child');
                if (level1Column) {
                    level1Column.style.cursor = 'default';
                    level1Column.onclick = null;
                    level1Column.ondblclick = null;
                    level1Column.addEventListener('click', (e) => {
                    e.stopPropagation();
                    // Prevent any row-level editing
                    });
                    level1Column.addEventListener('dblclick', (e) => {
                    e.stopPropagation();
                    // Prevent any row-level editing
                    });
                }

                // Make category title editable (double-click only)
                const title = row.querySelector('.table5-level1-title');
                if (title) {
                    title.style.cursor = 'pointer';
                    title.addEventListener('dblclick', (e) => {
                    e.stopPropagation();
                    makeElementEditable(title, () => {
                        if (window.table5ViewData && window.table5ViewData.assetClasses && window.table5ViewData.assetClasses[rowIndex]) {
                        window.table5ViewData.assetClasses[rowIndex].category = title.textContent;
                        saveDataToStorage();
                        }
                    }, {
                        fontSize: '16px',
                        fontWeight: 'bold',
                        color: '#0066cc'
                    });
                    });
                }

                // Make bullet points editable (double-click only)
                const listItems = row.querySelectorAll('.table5-level1-list li');
                listItems.forEach((li, liIndex) => {
                    li.style.cursor = 'pointer';
                    li.addEventListener('dblclick', (e) => {
                    e.stopPropagation();
                    makeElementEditable(li, () => {
                        if (window.table5ViewData && window.table5ViewData.assetClasses && window.table5ViewData.assetClasses[rowIndex]) {
                        window.table5ViewData.assetClasses[rowIndex].items[liIndex] = li.textContent;
                        saveDataToStorage();
                        }
                    });
                    });
                });

                // Make Level 2 items editable
                const level2Items = row.querySelectorAll('.table5-level2-item');
                level2Items.forEach((item, itemIndex) => {
                    const header = item.querySelector('.table5-level2-header');
                    const description = item.querySelector('.table5-level2-description');
                    
                    // Edit header
                    if (header) {
                    header.addEventListener('dblclick', (e) => {
                        e.stopPropagation();
                        const headerText = header.textContent.replace(':', '').trim();
                        makeElementEditable(header, () => {
                        if (window.table5ViewData && window.table5ViewData.assetClasses && window.table5ViewData.assetClasses[rowIndex]) {
                            window.table5ViewData.assetClasses[rowIndex].descriptions[itemIndex].title = header.textContent.replace(':', '').trim();
                            header.textContent = header.textContent.replace(':', '').trim() + ':';
                            saveDataToStorage();
                        }
                        }, { fontWeight: 'bold' });
                    });
                    }

                    // Edit description
                    if (description) {
                    description.addEventListener('dblclick', (e) => {
                        e.stopPropagation();
                        makeElementEditable(description, () => {
                        if (window.table5ViewData && window.table5ViewData.assetClasses && window.table5ViewData.assetClasses[rowIndex]) {
                            window.table5ViewData.assetClasses[rowIndex].descriptions[itemIndex].description = description.textContent.trim();
                            saveDataToStorage();
                        }
                        });
                    });
                    }
                });
                });
            }

            // Helper function to make any element editable
            function makeElementEditable(element, onSave, customStyles = {}) {
                const originalText = element.textContent;
                const input = document.createElement('input');
                input.value = originalText;
                
                const defaultStyles = {
                width: '100%',
                fontSize: 'inherit',
                fontWeight: 'inherit',
                color: 'inherit',
                fontFamily: 'inherit',
                background: '#fff3cd',
                border: '1px solid #ffc107',
                borderRadius: '2px',
                padding: '2px 4px',
                outline: 'none'
                };
                
                const styles = { ...defaultStyles, ...customStyles };
                Object.assign(input.style, styles);
                
                element.innerHTML = '';
                element.appendChild(input);
                input.focus();
                input.select();
                
                const saveEdit = () => {
                const newValue = input.value.trim();
                element.textContent = newValue || originalText;
                if (onSave) onSave();
                };
                
                const cancelEdit = () => {
                element.textContent = originalText;
                };
                
                input.addEventListener('blur', saveEdit);
                input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') saveEdit();
                if (e.key === 'Escape') cancelEdit();
                });
            }
            </script>

            <table class="table5-container">
                <thead id="s9Header">
                </thead>
                <tbody id="s9TableBody">
                    <!-- Table 5 rows will be inserted here by JavaScript -->
                </tbody>
            </table>
         </section>

        <!-- Section 10 -->
        <section class="s10 mt-8">
            <h1 id="s10Title" class="font-bold text-lg"></h1>
            <p id="s10Disclaimer" class="text-[9px] font-bold"></p>
            <div id="s10Subsection" class="flex flex-col gap-1 mt-2"></div>
        </section>

        <!-- section 11 -->
         <section class="s11 mt-8 mb-8">
            <h1 id="s11Title" class="font-bold text-lg"></h1>
            <p id="s11Subsection" class="flex flex-col gap-1 mt-2"></p>
            <p id="s11Copyright" class="text-[9px] text-gray-500"></p>
         </section>

        <!-- Section 1 Editable Script -->
        <script>
        // Utility: Set nested value in object
        function setNestedValue(obj, path, value) {
            const keys = path.split('.');
            const lastKey = keys.pop();
            const target = keys.reduce((o, k) => o[k] = o[k] || {}, obj);
            target[lastKey] = value;
        }
        function getNestedValue(obj, path) {
            return path.split('.').reduce((o, k) => (o || {})[k], obj);
        }
        function makeEditable(element, dataPath, isTextArea = false) {
            // Mark this element as having an edit handler to prevent duplicates
            element.dataset.hasEditHandler = 'true';
            
            element.addEventListener('dblclick', function() {
                // Get innerHTML to preserve <br> tags, then convert to plain text with newlines
                const currentHTML = this.innerHTML;
                const currentText = currentHTML.replace(/<br\s*\/?>\s*<br\s*\/?>/gi, '\n').replace(/<br\s*\/?>/gi, '\n').replace(/<[^>]+>/g, '');
                
                // Show edit dialog
                showEditDialog(this, currentText, dataPath, isTextArea);
            });
            
            element.style.cursor = 'pointer';
            element.title = 'Double-click to edit';
        }

        // Make Section 1 components editable via event delegation
        function makeSectionOneEditable() {
            const section = document.querySelector('.sectionOne');
            if (!section) return;

            // Track custom keys for elements without IDs
            let customKeyCounter = 0;
            
            section.addEventListener('dblclick', function(e) {
                // Ignore clicks on links, buttons, inputs, or already editing
                if (e.target.closest('a, button, input, textarea')) return;
                if (e.target.querySelector('input, textarea')) return;

                // Find the text element to edit
                let el = e.target;
                
                // Check if this element already has editing enabled via makeEditable()
                // If so, don't handle it here (let the original handler work)
                if (el.dataset.hasEditHandler === 'true') return;
                
                // Only allow editing certain element types
                const editableTags = ['P', 'H1', 'H2', 'H3', 'H4', 'H5', 'LI', 'TD', 'TH', 'SPAN', 'DIV'];
                if (!editableTags.includes(el.tagName)) return;
                
                // Skip structural containers without meaningful text
                if (!el.textContent || !el.textContent.trim()) return;
                
                // Skip if element has child elements (complex structure), BUT allow H4, SPAN, and P with data-path
                if (el.children.length > 0 && el.tagName !== 'LI' && el.tagName !== 'H4' && el.tagName !== 'SPAN' && el.tagName !== 'P' && !el.dataset.path) return;
                
                // For H4 elements, only edit if they have a data-path or if no children have data-path
                if (el.tagName === 'H4' && el.children.length > 0 && !el.dataset.path) {
                    // Don't edit the H4 itself if it contains a SPAN with data-path
                    if (el.querySelector('[data-path]')) return;
                }
                
                // For P elements, allow editing if they have a data-path (even with child <br> tags)
                if (el.tagName === 'P' && el.dataset.path) {
                    // This is an editable paragraph, proceed
                }

                // Determine dataPath based on element
                let dataPath = null;
                
                // First check if element has a data-path attribute (for summary components)
                if (el.dataset.path) {
                    dataPath = el.dataset.path;
                }
                // Check if element has an ID
                else if (el.id) {
                    dataPath = `step1.${el.id}`;
                } 
                // Check if it's a brief list item
                else if (el.tagName === 'LI' && el.closest('#briefList')) {
                    const briefList = document.getElementById('briefList');
                    const idx = Array.from(briefList.children).indexOf(el);
                    if (idx >= 0) dataPath = `step2.inBrief[${idx}]`;
                }
                // Check if it's the CIO heading
                else if (el.id === 'CIOHeading' || el.closest('#CIOHeading')) {
                    dataPath = 'step2.cioAssetClassViews.heading';
                }
                // Check if it's the CIO views paragraph
                else if (el.id === 'cioViews' || el.closest('#cioViews')) {
                    dataPath = 'step2.cioAssetClassViews';
                }
                // Check if it's the IN BRIEF heading
                else if (el.id === 'inBriefHeading' || el.closest('.brief h5')) {
                    dataPath = 'step2.inBriefHeading';
                }
                // Generate custom key for unmapped elements
                else {
                    if (!el.dataset.editKey) {
                        el.dataset.editKey = `custom${++customKeyCounter}`;
                    }
                    dataPath = `step1.custom.${el.dataset.editKey}`;
                }

                if (!dataPath) return;

                // Determine if textarea is needed (multi-line content)
                const isTextArea = ['P', 'DIV'].includes(el.tagName) || el.textContent.length > 80;

                // Get innerHTML to preserve <br> tags, then convert to plain text with newlines
                const currentHTML = el.innerHTML;
                const currentText = currentHTML.replace(/<br\s*\/?>\s*<br\s*\/?>/gi, '\n').replace(/<br\s*\/?>/gi, '\n').replace(/<[^>]+>/g, '');
                
                // Show edit dialog
                showEditDialog(el, currentText, dataPath, isTextArea);

                e.stopPropagation();
            });

            // Add hover effect to show editability
            const style = document.createElement('style');
            style.textContent = `
                .sectionOne p:hover,
                .sectionOne h1:hover,
                .sectionOne h2:hover,
                .sectionOne h3:hover,
                .sectionOne h4:hover,
                .sectionOne h5:hover,
                .sectionOne li:hover,
                .sectionOne td:hover,
                .sectionOne th:hover,
                .sectionOne span:hover {
                    outline: 1px dashed #4CAF50;
                    cursor: pointer;
                }
                .sectionOne a:hover,
                .sectionOne button:hover {
                    outline: none !important;
                }
                
                /* Edit Dialog Styles */
                .edit-dialog-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.5);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 10000;
                    animation: fadeIn 0.2s ease;
                }
                
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                
                .edit-dialog {
                    background: white;
                    border-radius: 12px;
                    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                    width: 90%;
                    max-width: 600px;
                    max-height: 80vh;
                    display: flex;
                    flex-direction: column;
                    animation: slideUp 0.3s ease;
                }
                
                @keyframes slideUp {
                    from { 
                        opacity: 0;
                        transform: translateY(20px);
                    }
                    to { 
                        opacity: 1;
                        transform: translateY(0);
                    }
                }
                
                .edit-dialog-header {
                    padding: 20px 24px;
                    border-bottom: 1px solid #e5e7eb;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                
                .edit-dialog-title {
                    font-size: 18px;
                    font-weight: 600;
                    color: #1f2937;
                    margin: 0;
                }
                
                .edit-dialog-close {
                    background: none;
                    border: none;
                    font-size: 24px;
                    color: #6b7280;
                    cursor: pointer;
                    padding: 0;
                    width: 32px;
                    height: 32px;
                    border-radius: 6px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: all 0.2s;
                }
                
                .edit-dialog-close:hover {
                    background: #f3f4f6;
                    color: #1f2937;
                }
                
                .edit-dialog-body {
                    padding: 24px;
                    overflow-y: auto;
                    flex: 1;
                }
                
                .edit-dialog-label {
                    display: block;
                    font-size: 14px;
                    font-weight: 500;
                    color: #374151;
                    margin-bottom: 8px;
                }
                
                .edit-dialog-input,
                .edit-dialog-textarea {
                    width: 100%;
                    padding: 12px;
                    border: 2px solid #e5e7eb;
                    border-radius: 8px;
                    font-family: 'Connections', 'Arial', sans-serif;
                    font-size: 14px;
                    color: #1f2937;
                    transition: all 0.2s;
                    outline: none;
                }
                
                .edit-dialog-input:focus,
                .edit-dialog-textarea:focus {
                    border-color: #4CAF50;
                    box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
                }
                
                .edit-dialog-textarea {
                    min-height: 150px;
                    resize: vertical;
                    line-height: 1.6;
                }
                
                .edit-dialog-footer {
                    padding: 16px 24px;
                    border-top: 1px solid #e5e7eb;
                    display: flex;
                    justify-content: flex-end;
                    gap: 12px;
                }
                
                .edit-dialog-btn {
                    padding: 10px 20px;
                    border: none;
                    border-radius: 8px;
                    font-family: 'Connections', 'Arial', sans-serif;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    transition: all 0.2s;
                    outline: none;
                }
                
                .edit-dialog-btn-cancel {
                    background: #f3f4f6;
                    color: #374151;
                }
                
                .edit-dialog-btn-cancel:hover {
                    background: #e5e7eb;
                }
                
                .edit-dialog-btn-save {
                    background: linear-gradient(135deg, #4CAF50, #45a049);
                    color: white;
                }
                
                .edit-dialog-btn-save:hover {
                    background: linear-gradient(135deg, #45a049, #3d8b40);
                    box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
                }
                
                .edit-dialog-hint {
                    font-size: 12px;
                    color: #6b7280;
                    margin-top: 8px;
                    font-style: italic;
                }
                
                /* Additional button styles for Section 3 */
                .edit-dialog-btn-primary {
                    padding: 10px 20px;
                    border: none;
                    border-radius: 8px;
                    font-family: 'Connections', 'Arial', sans-serif;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    transition: all 0.2s;
                    outline: none;
                    background: linear-gradient(135deg, #4CAF50, #45a049);
                    color: white;
                }
                
                .edit-dialog-btn-primary:hover {
                    background: linear-gradient(135deg, #45a049, #3d8b40);
                    box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
                }
                
                .edit-dialog-btn-secondary {
                    padding: 10px 20px;
                    border: none;
                    border-radius: 8px;
                    font-family: 'Connections', 'Arial', sans-serif;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    transition: all 0.2s;
                    outline: none;
                    background: #f3f4f6;
                    color: #374151;
                }
                
                .edit-dialog-btn-secondary:hover {
                    background: #e5e7eb;
                }
                
                .edit-dialog-btn-danger {
                    padding: 10px 20px;
                    border: none;
                    border-radius: 8px;
                    font-family: 'Connections', 'Arial', sans-serif;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    transition: all 0.2s;
                    outline: none;
                    background: linear-gradient(135deg, #ef4444, #dc2626);
                    color: white;
                }
                
                .edit-dialog-btn-danger:hover {
                    background: linear-gradient(135deg, #dc2626, #b91c1c);
                    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
                }
            `;
            document.head.appendChild(style);
        }

        // Show edit dialog for Section 1 components
        function showEditDialog(element, currentText, dataPath, isTextArea) {
            // Remove existing dialog if any
            const existingDialog = document.querySelector('.edit-dialog-overlay');
            if (existingDialog) {
                existingDialog.remove();
            }

            // Check if this is a bottom-line component (editing subsection or bottomLine)
            const isBottomLineComponent = dataPath.includes('components[') && 
                (dataPath.includes('.subsections[') || dataPath.includes('.bottomLine'));
            
            // Check if this is a numbered-bottom-line bullet point
            const isNumberedBottomLineBullet = dataPath.includes('components[') && dataPath.includes('.bulletPoints[');
            
            // Check if this is a regular subsection (has both heading and content)
            const isSubsection = dataPath.includes('subsections[') && (dataPath.includes('.heading') || dataPath.includes('.content') || dataPath.includes('.subheading'));
            
            // Check if this is a bottom-line subsection
            const isBottomLineSubsection = dataPath.includes('subsections[') && dataPath.includes('.subheading');
            
            // If editing any part of a numbered-bottom-line bullet point, show 3 fields
            let numberedBulletData = null;
            if (isNumberedBottomLineBullet) {
                // Extract component and bullet point indices
                const componentMatch = dataPath.match(/components\[(\d+)\]/);
                const bulletMatch = dataPath.match(/bulletPoints\[(\d+)\]/);
                
                if (componentMatch && bulletMatch) {
                    const componentIdx = parseInt(componentMatch[1]);
                    const bulletIdx = parseInt(bulletMatch[1]);
                    const component = DocumentData.step2?.summary?.components?.[componentIdx];
                    
                    if (component && component.bulletPoints && component.bulletPoints[bulletIdx]) {
                        const bulletPoint = component.bulletPoints[bulletIdx];
                        const bottomLine = component.bottomLine || {};
                        
                        numberedBulletData = {
                            componentIdx: componentIdx,
                            bulletIdx: bulletIdx,
                            subheading: (bulletPoint.subheading || '').replace(/<br\s*\/?>\s*<br\s*\/?>/gi, '\n').replace(/<br\s*\/?>/gi, '\n').replace(/<[^>]+>/g, ''),
                            content: (bulletPoint.content || '').replace(/<br\s*\/?>\s*<br\s*\/?>/gi, '\n').replace(/<br\s*\/?>/gi, '\n').replace(/<[^>]+>/g, ''),
                            bottomLineHeading: typeof bottomLine === 'object' ? ((bottomLine.heading || '').replace(/<br\s*\/?>\s*<br\s*\/?>/gi, '\n').replace(/<br\s*\/?>/gi, '\n').replace(/<[^>]+>/g, '')) : '',
                            bottomLineContent: typeof bottomLine === 'object' ? ((bottomLine.content || '').replace(/<br\s*\/?>\s*<br\s*\/?>/gi, '\n').replace(/<br\s*\/?>/gi, '\n').replace(/<[^>]+>/g, '')) : (bottomLine || '').replace(/<br\s*\/?>\s*<br\s*\/?>/gi, '\n').replace(/<br\s*\/?>/gi, '\n').replace(/<[^>]+>/g, '')
                        };
                    }
                }
            }
            
            // If editing any part of a bottom-line component, we need to edit all 3 fields
            let bottomLineComponentData = null;
            if (isBottomLineComponent && !numberedBulletData) {
                // Extract the component index
                const componentMatch = dataPath.match(/components\[(\d+)\]/);
                if (componentMatch) {
                    const componentIdx = parseInt(componentMatch[1]);
                    const component = DocumentData.step2?.summary?.components?.[componentIdx];
                    
                    if (component && component.subsections && component.subsections.length > 0 && component.subsections[0].subheading !== undefined) {
                        // This is a bottom-line component
                        const subsection = component.subsections[0] || {};
                        bottomLineComponentData = {
                            componentIdx: componentIdx,
                            subheading: (subsection.subheading || '').replace(/<br\s*\/?>\s*<br\s*\/?>/gi, '\n').replace(/<br\s*\/?>/gi, '\n').replace(/<[^>]+>/g, ''),
                            content: (subsection.content || '').replace(/<br\s*\/?>\s*<br\s*\/?>/gi, '\n').replace(/<br\s*\/?>/gi, '\n').replace(/<[^>]+>/g, ''),
                            bottomLine: (component.bottomLine || '').replace(/<br\s*\/?>\s*<br\s*\/?>/gi, '\n').replace(/<br\s*\/?>/gi, '\n').replace(/<[^>]+>/g, '')
                        };
                    }
                }
            }
            
            // If editing heading or content of subsection (non-bottom-line), we need to edit both
            let subsectionData = null;
            if (isSubsection && !bottomLineComponentData) {
                // Extract the base path to the subsection
                const basePath = dataPath.replace(/\.(heading|content|subheading)$/, '');
                
                // Get the subsection object
                const parts = [];
                let current = '';
                let inBracket = false;
                
                for (let i = 0; i < basePath.length; i++) {
                    const char = basePath[i];
                    if (char === '[') {
                        inBracket = true;
                        current += char;
                    } else if (char === ']') {
                        inBracket = false;
                        current += char;
                    } else if (char === '.' && !inBracket) {
                        if (current) parts.push(current);
                        current = '';
                    } else {
                        current += char;
                    }
                }
                if (current) parts.push(current);
                
                // Navigate to the subsection object
                let target = DocumentData;
                for (let i = 0; i < parts.length; i++) {
                    const part = parts[i];
                    const match = part.match(/(.+)\[(\d+)\]/);
                    if (match) {
                        const prop = match[1];
                        const idx = parseInt(match[2]);
                        target = target[prop][idx];
                    } else {
                        target = target[part];
                    }
                }
                
                // Build subsection data based on type
                if (isBottomLineSubsection) {
                    subsectionData = {
                        basePath: basePath,
                        type: 'bottom-line',
                        subheading: (target.subheading || '').replace(/<br\s*\/?>\s*<br\s*\/?>/gi, '\n').replace(/<br\s*\/?>/gi, '\n').replace(/<[^>]+>/g, ''),
                        content: (target.content || '').replace(/<br\s*\/?>\s*<br\s*\/?>/gi, '\n').replace(/<br\s*\/?>/gi, '\n').replace(/<[^>]+>/g, '')
                    };
                } else {
                    subsectionData = {
                        basePath: basePath,
                        type: 'regular',
                        heading: (target.heading || '').replace(/<br\s*\/?>\s*<br\s*\/?>/gi, '\n').replace(/<br\s*\/?>/gi, '\n').replace(/<[^>]+>/g, ''),
                        content: (target.content || '').replace(/<br\s*\/?>\s*<br\s*\/?>/gi, '\n').replace(/<br\s*\/?>/gi, '\n').replace(/<[^>]+>/g, '')
                    };
                }
            }

            // Create dialog overlay
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            
            // Create dialog
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            
            // Get element type for title
            const elementType = element.tagName.toLowerCase();
            const elementLabel = {
                'h1': 'Heading',
                'h2': 'Heading',
                'h3': 'Heading',
                'h4': (isSubsection || bottomLineComponentData || numberedBulletData) ? 'Bottom Line Component' : 'Heading',
                'h5': 'Heading',
                'p': (bottomLineComponentData || numberedBulletData) ? 'Bottom Line Component' : 'Paragraph',
                'li': numberedBulletData ? 'Numbered Bullet Point' : 'List Item',
                'span': (isSubsection || bottomLineComponentData || numberedBulletData) ? 'Bottom Line Component' : 'Text',
                'div': 'Content'
            }[elementType] || 'Content';
            
            // Build dialog content based on type
            let dialogBody = '';
            if (numberedBulletData) {
                // Three-field layout for numbered-bottom-line bullet points (subheading + content + bottomLine)
                dialogBody = `
                    <div class="edit-dialog-body">
                        <div style="margin-bottom: 20px;">
                            <label class="edit-dialog-label">Bullet Point Subheading</label>
                            <input type="text" class="edit-dialog-input" id="editDialogSubheading" value="${numberedBulletData.subheading.replace(/"/g, '&quot;')}" />
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label class="edit-dialog-label">Bullet Point Content</label>
                            <textarea class="edit-dialog-textarea" id="editDialogContent" style="min-height: 80px;">${numberedBulletData.content}</textarea>
                            <div class="edit-dialog-hint">Press Enter for new lines</div>
                        </div>
                        <div>
                            <label class="edit-dialog-label">Bottom Line Content</label>
                            <textarea class="edit-dialog-textarea" id="editDialogBottomLine" style="min-height: 80px;">${numberedBulletData.bottomLineContent}</textarea>
                            <div class="edit-dialog-hint">Press Enter for new lines</div>
                        </div>
                    </div>
                `;
            } else if (bottomLineComponentData) {
                // Three-field layout for bottom-line components (subheading + content + bottomLine)
                dialogBody = `
                    <div class="edit-dialog-body">
                        <div style="margin-bottom: 20px;">
                            <label class="edit-dialog-label">Subheading</label>
                            <input type="text" class="edit-dialog-input" id="editDialogSubheading" value="${bottomLineComponentData.subheading.replace(/"/g, '&quot;')}" />
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label class="edit-dialog-label">Content</label>
                            <textarea class="edit-dialog-textarea" id="editDialogContent" style="min-height: 80px;">${bottomLineComponentData.content}</textarea>
                            <div class="edit-dialog-hint">Press Enter for new lines</div>
                        </div>
                        <div>
                            <label class="edit-dialog-label">Bottom Line</label>
                            <textarea class="edit-dialog-textarea" id="editDialogBottomLine" style="min-height: 80px;">${bottomLineComponentData.bottomLine}</textarea>
                            <div class="edit-dialog-hint">Press Enter for new lines</div>
                        </div>
                    </div>
                `;
            } else if (isSubsection && subsectionData) {
                if (subsectionData.type === 'bottom-line') {
                    // Two-field layout for bottom-line subsections (subheading + content)
                    dialogBody = `
                        <div class="edit-dialog-body">
                            <div style="margin-bottom: 20px;">
                                <label class="edit-dialog-label">Subheading</label>
                                <input type="text" class="edit-dialog-input" id="editDialogSubheading" value="${subsectionData.subheading.replace(/"/g, '&quot;')}" />
                            </div>
                            <div>
                                <label class="edit-dialog-label">Content</label>
                                <textarea class="edit-dialog-textarea" id="editDialogContent">${subsectionData.content}</textarea>
                                <div class="edit-dialog-hint">Press Enter for new lines</div>
                            </div>
                        </div>
                    `;
                } else {
                    // Two-field layout for regular subsections (heading + content)
                    dialogBody = `
                        <div class="edit-dialog-body">
                            <div style="margin-bottom: 20px;">
                                <label class="edit-dialog-label">Heading</label>
                                <input type="text" class="edit-dialog-input" id="editDialogHeading" value="${subsectionData.heading.replace(/"/g, '&quot;')}" />
                            </div>
                            <div>
                                <label class="edit-dialog-label">Content</label>
                                <textarea class="edit-dialog-textarea" id="editDialogContent">${subsectionData.content}</textarea>
                                <div class="edit-dialog-hint">Press Enter for new lines</div>
                            </div>
                        </div>
                    `;
                }
            } else {
                // Single-field layout for other elements
                dialogBody = `
                    <div class="edit-dialog-body">
                        <label class="edit-dialog-label">Content</label>
                        ${isTextArea 
                            ? `<textarea class="edit-dialog-textarea" id="editDialogInput">${currentText}</textarea>
                               <div class="edit-dialog-hint">Press Enter for new lines</div>`
                            : `<input type="text" class="edit-dialog-input" id="editDialogInput" value="${currentText.replace(/"/g, '&quot;')}" />`
                        }
                    </div>
                `;
            }
            
            dialog.innerHTML = `
                <div class="edit-dialog-header">
                    <h3 class="edit-dialog-title">Edit ${elementLabel}</h3>
                    <button class="edit-dialog-close" onclick="closeEditDialog()">&times;</button>
                </div>
                ${dialogBody}
                <div class="edit-dialog-footer">
                    <button class="edit-dialog-btn edit-dialog-btn-cancel" onclick="closeEditDialog()">Cancel</button>
                    <button class="edit-dialog-btn edit-dialog-btn-save" id="saveDialogBtn">Save Changes</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            // Focus input
            if (numberedBulletData || bottomLineComponentData) {
                const subheadingInput = document.getElementById('editDialogSubheading');
                setTimeout(() => {
                    subheadingInput.focus();
                    subheadingInput.select();
                }, 100);
            } else if (isSubsection && subsectionData) {
                if (subsectionData.type === 'bottom-line') {
                    const subheadingInput = document.getElementById('editDialogSubheading');
                    setTimeout(() => {
                        subheadingInput.focus();
                        subheadingInput.select();
                    }, 100);
                } else {
                    const headingInput = document.getElementById('editDialogHeading');
                    setTimeout(() => {
                        headingInput.focus();
                        headingInput.select();
                    }, 100);
                }
            } else {
                const input = document.getElementById('editDialogInput');
                setTimeout(() => {
                    input.focus();
                    if (!isTextArea) input.select();
                }, 100);
            }
            
            // Save handler
            const saveBtn = document.getElementById('saveDialogBtn');
            saveBtn.onclick = () => {
                if (numberedBulletData) {
                    // Three-field save for numbered-bottom-line bullet point
                    const newSubheading = document.getElementById('editDialogSubheading').value || numberedBulletData.subheading;
                    const newContent = document.getElementById('editDialogContent').value || numberedBulletData.content;
                    const newBottomLineContent = document.getElementById('editDialogBottomLine').value || numberedBulletData.bottomLineContent;
                    
                    // Update DocumentData
                    const componentIdx = numberedBulletData.componentIdx;
                    const bulletIdx = numberedBulletData.bulletIdx;
                    const component = DocumentData.step2.summary.components[componentIdx];
                    
                    if (component.bulletPoints && component.bulletPoints[bulletIdx]) {
                        component.bulletPoints[bulletIdx].subheading = newSubheading;
                        component.bulletPoints[bulletIdx].content = newContent;
                    }
                    
                    // Update bottom line content
                    if (typeof component.bottomLine === 'object') {
                        component.bottomLine.content = newBottomLineContent;
                    } else {
                        component.bottomLine = { heading: '', content: newBottomLineContent };
                    }
                    
                    // Update DOM - find the component container
                    const componentDiv = document.querySelector(`[data-component-id="${componentIdx}"]`);
                    if (componentDiv) {
                        // Update bullet point subheading and content
                        const liElement = componentDiv.querySelector(`li[data-path*=".bulletPoints[${bulletIdx}]"]`);
                        if (liElement) {
                            // Clear and rebuild the li content
                            liElement.innerHTML = '';
                            
                            // Add subheading span
                            const subheadingSpan = document.createElement('span');
                            subheadingSpan.className = 'font-semibold';
                            subheadingSpan.setAttribute('data-path', `step2.summary.components[${componentIdx}].bulletPoints[${bulletIdx}].subheading`);
                            subheadingSpan.textContent = newSubheading;
                            liElement.appendChild(subheadingSpan);
                            
                            // Add content span
                            const contentSpan = document.createElement('span');
                            contentSpan.className = 'paragraph';
                            contentSpan.setAttribute('data-path', `step2.summary.components[${componentIdx}].bulletPoints[${bulletIdx}].content`);
                            contentSpan.innerHTML = '‚Äî' + newContent.replace(/\n/g, '<br><br>');
                            liElement.appendChild(contentSpan);
                            
                            // Re-apply data-path to li
                            liElement.setAttribute('data-path', `step2.summary.components[${componentIdx}].bulletPoints[${bulletIdx}]`);
                        }
                        
                        // Update bottom line content
                        const bottomLineP = componentDiv.querySelector(`p[data-path*=".bottomLine.content"]`);
                        if (bottomLineP) {
                            bottomLineP.innerHTML = newBottomLineContent.replace(/\n/g, '<br><br>');
                        }
                    }
                    
                    localStorage.setItem('documentData', JSON.stringify(DocumentData));
                    showToast('‚úì Numbered bullet point updated', 'success');
                } else if (bottomLineComponentData) {
                    // Three-field save for bottom-line component
                    const newSubheading = document.getElementById('editDialogSubheading').value || bottomLineComponentData.subheading;
                    const newContent = document.getElementById('editDialogContent').value || bottomLineComponentData.content;
                    const newBottomLine = document.getElementById('editDialogBottomLine').value || bottomLineComponentData.bottomLine;
                    
                    // Update DocumentData
                    const componentIdx = bottomLineComponentData.componentIdx;
                    const component = DocumentData.step2.summary.components[componentIdx];
                    
                    if (component.subsections && component.subsections[0]) {
                        component.subsections[0].subheading = newSubheading;
                        component.subsections[0].content = newContent;
                    }
                    component.bottomLine = newBottomLine;
                    
                    // Update DOM - find the component container
                    const componentDiv = document.querySelector(`[data-component-id="${componentIdx}"]`);
                    if (componentDiv) {
                        // Update subheading and content (they are in the same h4 structure)
                        const h4Element = componentDiv.querySelector(`h4[data-path*=".subsections[0].subheading"]`);
                        if (h4Element) {
                            // Clear and rebuild the h4 content with subheading + colon + content span
                            h4Element.innerHTML = '';
                            
                            // Add subheading text
                            const subheadingText = document.createTextNode(newSubheading);
                            h4Element.appendChild(subheadingText);
                            
                            // Add colon and space
                            const colonText = document.createTextNode(': ');
                            h4Element.appendChild(colonText);
                            
                            // Add content span
                            const contentSpan = document.createElement('span');
                            contentSpan.className = 'paragraph leading-relaxed';
                            contentSpan.setAttribute('data-path', `step2.summary.components[${componentIdx}].subsections[0].content`);
                            contentSpan.innerHTML = newContent.replace(/\n/g, '<br><br>');
                            h4Element.appendChild(contentSpan);
                            
                            // Re-apply data-path to h4
                            h4Element.setAttribute('data-path', `step2.summary.components[${componentIdx}].subsections[0].subheading`);
                        }
                        
                        // Update bottom line
                        const bottomLineEl = componentDiv.querySelector(`[data-path*=".bottomLine"]`);
                        if (bottomLineEl) {
                            bottomLineEl.innerHTML = newBottomLine.replace(/\n/g, '<br><br>');
                        }
                    }
                    
                    localStorage.setItem('documentData', JSON.stringify(DocumentData));
                    showToast('‚úì Bottom Line component updated', 'success');
                } else if (isSubsection && subsectionData) {
                    let newHeading, newSubheading, newContent;
                    
                    if (subsectionData.type === 'bottom-line') {
                        // Bottom-line subsection (subheading + content)
                        newSubheading = document.getElementById('editDialogSubheading').value || subsectionData.subheading;
                        newContent = document.getElementById('editDialogContent').value || subsectionData.content;
                    } else {
                        // Regular subsection (heading + content)
                        newHeading = document.getElementById('editDialogHeading').value || subsectionData.heading;
                        newContent = document.getElementById('editDialogContent').value || subsectionData.content;
                    }
                    
                    // Parse the base path to navigate to subsection
                    const parts = [];
                    let current = '';
                    let inBracket = false;
                    
                    for (let i = 0; i < subsectionData.basePath.length; i++) {
                        const char = subsectionData.basePath[i];
                        if (char === '[') {
                            inBracket = true;
                            current += char;
                        } else if (char === ']') {
                            inBracket = false;
                            current += char;
                        } else if (char === '.' && !inBracket) {
                            if (current) parts.push(current);
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    if (current) parts.push(current);
                    
                    // Navigate to the target subsection
                    let target = DocumentData;
                    for (let i = 0; i < parts.length; i++) {
                        const part = parts[i];
                        const match = part.match(/(.+)\[(\d+)\]/);
                        if (match) {
                            const prop = match[1];
                            const idx = parseInt(match[2]);
                            target = target[prop][idx];
                        } else {
                            target = target[part];
                        }
                    }
                    
                    // Update based on subsection type
                    if (subsectionData.type === 'bottom-line') {
                        target.subheading = newSubheading;
                        target.content = newContent;
                    } else {
                        target.heading = newHeading;
                        target.content = newContent;
                    }
                    
                    // Update the DOM
                    if (subsectionData.type === 'bottom-line') {
                        // Bottom-line subsection: Update subheading and content separately
                        const parentDiv = element.closest('.flex.items-start.gap-2.mb-2');
                        if (parentDiv) {
                            const subheadingSpan = parentDiv.querySelector('span[data-path*=".subheading"]');
                            const contentSpan = parentDiv.querySelector('span[data-path*=".content"]');
                            if (subheadingSpan) {
                                subheadingSpan.innerHTML = newSubheading.replace(/\n/g, '<br><br>');
                            }
                            if (contentSpan) {
                                contentSpan.innerHTML = newContent.replace(/\n/g, '<br><br>');
                            }
                        }
                    } else {
                        // Regular subsection: Update h4 element with heading and content
                        const h4Element = element.closest('h4') || (element.tagName === 'H4' ? element : null);
                        if (h4Element) {
                            // Update heading (text node before the colon)
                            const headingText = document.createTextNode(newHeading);
                            const colonText = document.createTextNode(': ');
                            
                            // Clear and rebuild the h4 content
                            h4Element.innerHTML = '';
                            h4Element.appendChild(headingText);
                            h4Element.appendChild(colonText);
                            
                            // Re-create the content span
                            const newSpan = document.createElement('span');
                            newSpan.className = 'paragraph leading-relaxed';
                            newSpan.setAttribute('data-path', subsectionData.basePath + '.content');
                            newSpan.innerHTML = newContent.replace(/\n/g, '<br><br>');
                            h4Element.appendChild(newSpan);
                            
                            // Re-apply data-path to h4
                            h4Element.setAttribute('data-path', subsectionData.basePath + '.heading');
                        }
                    }
                    
                    localStorage.setItem('documentData', JSON.stringify(DocumentData));
                    showToast('‚úì Subsection updated', 'success');
                } else {
                    // Single field save
                    const input = document.getElementById('editDialogInput');
                    const newValue = input.value || currentText;
                    
                    // Handle complex nested array paths
                    if (dataPath.includes('[')) {
                        const parts = [];
                        let current = '';
                        let inBracket = false;
                        
                        for (let i = 0; i < dataPath.length; i++) {
                            const char = dataPath[i];
                            if (char === '[') {
                                inBracket = true;
                                current += char;
                            } else if (char === ']') {
                                inBracket = false;
                                current += char;
                            } else if (char === '.' && !inBracket) {
                                if (current) parts.push(current);
                                current = '';
                            } else {
                                current += char;
                            }
                        }
                        if (current) parts.push(current);
                        
                        // Navigate to the target
                        let target = DocumentData;
                        for (let i = 0; i < parts.length - 1; i++) {
                            const part = parts[i];
                            const match = part.match(/(.+)\[(\d+)\]/);
                            if (match) {
                                const prop = match[1];
                                const idx = parseInt(match[2]);
                                target = target[prop][idx];
                            } else {
                                target = target[part];
                            }
                        }
                        
                        // Set the final value
                        const lastPart = parts[parts.length - 1];
                        const lastMatch = lastPart.match(/(.+)\[(\d+)\]/);
                        if (lastMatch) {
                            const prop = lastMatch[1];
                            const idx = parseInt(lastMatch[2]);
                            target[prop][idx] = newValue;
                        } else {
                            target[lastPart] = newValue;
                        }
                    } else {
                        setNestedValue(DocumentData, dataPath, newValue);
                    }
                    
                    // Display with <br><br> tags for line breaks
                    element.innerHTML = newValue.replace(/\n/g, '<br><br>');
                    localStorage.setItem('documentData', JSON.stringify(DocumentData));
                    showToast('‚úì Section 1 content updated', 'success');
                }
                
                closeEditDialog();
            };
            
            // Close on Escape key
            const handleEscape = (e) => {
                if (e.key === 'Escape') {
                    closeEditDialog();
                }
            };
            overlay.addEventListener('keydown', handleEscape);
            
            // Close on overlay click
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    closeEditDialog();
                }
            });
            
            // Save on Ctrl+Enter
            if (numberedBulletData || bottomLineComponentData) {
                const subheadingInput = document.getElementById('editDialogSubheading');
                const contentInput = document.getElementById('editDialogContent');
                const bottomLineInput = document.getElementById('editDialogBottomLine');
                
                if (subheadingInput) {
                    subheadingInput.addEventListener('keydown', (e) => {
                        if (e.ctrlKey && e.key === 'Enter') {
                            saveBtn.click();
                        }
                    });
                }
                
                if (contentInput) {
                    contentInput.addEventListener('keydown', (e) => {
                        if (e.ctrlKey && e.key === 'Enter') {
                            saveBtn.click();
                        }
                    });
                }
                
                if (bottomLineInput) {
                    bottomLineInput.addEventListener('keydown', (e) => {
                        if (e.ctrlKey && e.key === 'Enter') {
                            saveBtn.click();
                        }
                    });
                }
            } else if (isSubsection && subsectionData) {
                const headingInput = document.getElementById('editDialogHeading') || document.getElementById('editDialogSubheading');
                const contentInput = document.getElementById('editDialogContent');
                
                if (headingInput) {
                    headingInput.addEventListener('keydown', (e) => {
                        if (e.ctrlKey && e.key === 'Enter') {
                            saveBtn.click();
                        }
                    });
                }
                
                if (contentInput) {
                    contentInput.addEventListener('keydown', (e) => {
                        if (e.ctrlKey && e.key === 'Enter') {
                            saveBtn.click();
                        }
                    });
                }
            } else {
                const input = document.getElementById('editDialogInput');
                input.addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.key === 'Enter') {
                        saveBtn.click();
                    }
                });
            }
        }

        // Close edit dialog
        window.closeEditDialog = function() {
            const overlay = document.querySelector('.edit-dialog-overlay');
            if (overlay) {
                overlay.style.animation = 'fadeOut 0.2s ease';
                setTimeout(() => overlay.remove(), 200);
            }
        };

        // Load initial data from data.json and populate Section 1
        let DocumentData = {};
        window.addEventListener('DOMContentLoaded', async function() {
            try {
                const response = await fetch('data.json');
                if (response.ok) {
                    DocumentData = await response.json();
                    // Disclaimer
                    document.getElementById('disclaimer').textContent = DocumentData.step1?.disclaimer || '';
                    // IN BRIEF heading
                    document.getElementById('inBriefHeading').textContent = 'IN BRIEF';
                    // InBrief list items
                    const briefList = document.getElementById('briefList');
                    briefList.innerHTML = '';
                    (DocumentData.step2?.inBrief || []).forEach((text, idx) => {
                        const li = document.createElement('li');
                        li.textContent = text;
                        briefList.appendChild(li);
                        makeEditable(li, `step2.inBrief[${idx}]`);
                    });
                    // CIO heading
                    const cioHeadingEl = document.getElementById('CIOHeading');
                    if (cioHeadingEl) {
                        cioHeadingEl.textContent = 'CIO ASSET CLASS VIEWS';
                    }
                    // CIO Asset Class Views
                    document.getElementById('cioViews').textContent = DocumentData.step2?.cioAssetClassViews || '';
                    // Hyperlinks
                    const hyperlinksDiv = document.getElementById('hyperlinks');
                    if (hyperlinksDiv && DocumentData.step2?.hyperlinks) {
                        hyperlinksDiv.innerHTML = '';
                        DocumentData.step2.hyperlinks.forEach((linkObj, idx) => {
                            const a = document.createElement('a');
                            a.href = linkObj.url;
                            a.textContent = linkObj.name;
                            a.target = '_blank';
                            a.className = 'mb-1';
                            // Add right arrow triangle
                            const triangle = document.createElement('span');
                            triangle.style.display = 'inline-block';
                            triangle.style.verticalAlign = 'middle';
                            triangle.style.marginLeft = '4px';
                            triangle.style.width = '0';
                            triangle.style.height = '0';
                            triangle.style.borderTop = '6px solid transparent';
                            triangle.style.borderBottom = '6px solid transparent';
                            triangle.style.borderLeft = '12px solid #e25b59';
                            a.appendChild(triangle);
                            hyperlinksDiv.appendChild(a);
                        });
                    }
                }
            } catch (err) {
                console.warn('Could not load initial data from data.json:', err);
            }
            // Make editable after loading
            const disclaimerEl = document.getElementById('disclaimer');
            if (disclaimerEl) makeEditable(disclaimerEl, 'step1.disclaimer');
            const briefHeadingEl = document.querySelector('.brief h5');
            if (briefHeadingEl) makeEditable(briefHeadingEl, 'step2.inBrief');
            // NOTE: List items already have makeEditable attached during creation above
            // document.querySelectorAll('.brief ul li').forEach((item, idx) => {
            //     if (item) makeEditable(item, `step2.inBrief[${idx}]`);
            // });
            const cioHeadingEl2 = document.querySelector('.flex-wrap.gray-box h5');
            if (cioHeadingEl2) makeEditable(cioHeadingEl2, 'step2.cioAssetClassViews');
            const cioViewsEl = document.getElementById('cioViews');
            if (cioViewsEl) makeEditable(cioViewsEl, 'step2.cioAssetClassViews', true);

            // Enable comprehensive double-click editing for all Section 1 components
            makeSectionOneEditable();

            // Populate Summary Components
            populateSummaryComponents(DocumentData.step2?.summary?.components || []);
            
            // Populate Table Data
            populateTableData(DocumentData.step2?.tableData || {});

            // Populate Section 2
            populateSectionTwo(DocumentData.step3 || {});
            
            // Enable Section 2 editing
            makeSectionTwoEditable();

            // Populate Section 3
            populateSectionThree(DocumentData.step4 || {});
            
            // Enable Section 3 editing
            makeSectionThreeEditable();

            // Populate Section 4
            populateSectionFour(DocumentData.step5 || {});
            
            // Enable Section 4 editing
            makeSectionFourEditable();

            // Populate Section 5
            populateSectionFive(DocumentData.step6 || {});
            
            // Enable Section 5 editing
            makeSectionFiveEditable();

            // Populate Section 6
            populateSectionSix(DocumentData.step7 || {});
            
            // Enable Section 6 editing
            makeSectionSixEditable();

            // Populate Section 7
            populateSectionSeven(DocumentData.step8 || {});
            
            // Enable Section 7 editing
            makeSectionSevenEditable();

            // Populate Section 8
            populateSectionEight(DocumentData.step9 || {});
            
            // Enable Section 8 editing
            makeSectionEightEditable();

            // Populate Section 9
            populateSectionNine(DocumentData.step10 || {});
            
            // Enable Section 9 editing
            makeSectionNineEditable();

            // Populate Section 10
            populateSectionTen(DocumentData.step11 || {});
            
            // Enable Section 10 editing
            makeSectionTenEditable();

            // Populate Section 11
            populateSectionEleven(DocumentData.step12 || {});
            
            // Enable Section 11 editing
            makeSectionElevenEditable();
        });

        // Function to populate summary components
        function populateSummaryComponents(components) {
            const container = document.getElementById('summaryComponents');
            container.innerHTML = '';
            
            components.forEach((component, idx) => {
                const div = document.createElement('div');
                div.setAttribute('data-component-id', idx);
                div.setAttribute('data-component-type', component.type);
                let html = ``;
                
                switch(component.type) {
                    case 'paragraph':
                        html += `
                                    <p class="paragraph mt-4" data-path="step2.summary.components[${idx}].content">${(component.content || '').replace(/\n/g, '<br><br>')}</p>
                        `;
                        break;
                        
                    case 'header':
                        html += `
                            <h1 class="heading" data-path="step2.summary.components[${idx}].heading">${(component.heading || '').replace(/\n/g, '<br><br>')}</h1>
                        `
                        break;
                    
                    case 'subsections':
                        html += '<div class="space-y-3 mt-2">';
                        (component.subsections || []).forEach((subsection, subIdx) => {
                            html += `
                                <div class="flex">
                                    <h4 class="text-xs font-semibold text-gray-800" data-path="step2.summary.components[${idx}].subsections[${subIdx}].heading">${subsection.heading || ''}: 
                                        <span class="paragraph leading-relaxed" data-path="step2.summary.components[${idx}].subsections[${subIdx}].content">${(subsection.content || '').replace(/\n/g, '<br><br>')}</span>
                                    </h4>
                                </div>
                            `;
                        });
                        html += '</div>';
                        break;
                        
                    case 'compare-table':
                        html += `
                            <div class="grid grid-cols-2 w-[196mm] mt-4">
                                <div>
                                    <h4 class="text-xs font-semibold bg-[--bg-gray] mb-2 text-center">${component.mainHeading1 || ''}</h4>
                                    <h5 class="text-xs font-semibold text-gray-800 mb-2 px-2">${component.subHeading1 || ''}</h5>
                                    <ul class="paragraph disc-list space-y-1 px-2">
                                        ${(component.leftPoints || []).map(point => `<li>‚Ä¢ ${(point).replace(/\n/g, '<br><br>')}</li>`).join('')}
                                    </ul>
                                </div>
                                <div>
                                    <h4 class="text-xs font-semibold bg-[--bg-gray] mb-2 text-center">${component.mainHeading2 || ''}</h4>
                                    <h5 class="text-xs font-semibold text-gray-800 mb-2 px-2">${component.subHeading2 || ''}</h5>
                                    <ul class="paragraph space-y-1 px-2">
                                        ${(component.rightPoints || []).map(point => `<li>‚Ä¢ ${point.replace(/\n/g, '<br><br>')}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                        `;
                        break;
                        
                    case 'bottom-line':
                        html += '<div class="space-y-3 flex justify-between w-[196mm] mt-4">';
                        (component.subsections || []).forEach((subsection, subIdx) => {
                            html += `
                                <div class="flex w-[65%]">
                                    <h4 class="text-xs font-semibold text-gray-800" data-path="step2.summary.components[${idx}].subsections[${subIdx}].subheading">${subsection.subheading || ''}: 
                                        <span class="paragraph leading-relaxed" data-path="step2.summary.components[${idx}].subsections[${subIdx}].content">${(subsection.content || '').replace(/\n/g, '<br><br>')}</span>
                                    </h4>
                                </div>
                            `;
                        });
                        html += `
                            <div class=" px-4 py-6 w-[30%] bg-[--bg-gray] h-fit pt-3">
                                <h4 class="text-xs font-semibold text-gray-800 mb-1">Bottom Line</h4>
                                <p class="paragraph" data-path="step2.summary.components[${idx}].bottomLine">${(component.bottomLine || '').replace(/\n/g, '<br><br>')}</p>
                            </div>
                        `;
                        html += '</div>';
                        break;
                        
                    case 'numbered-bottom-line':
                        // Handle both old format (string) and new format (object with heading/content)
                        const bottomLineHeading = typeof component.bottomLine === 'object' ? (component.bottomLine?.heading || '') : '';
                        const bottomLineContent = typeof component.bottomLine === 'object' ? (component.bottomLine?.content || '') : (component.bottomLine || '');

                        html += `
                            <div class="flex justify-between w-[196mm] mt-2 gap-4">
                                <div class="w-[65%]">
                                    <h4 class="heading mb-3" data-path="step2.summary.components[${idx}].mainHeading">${component.mainHeading || ''}</h4>
                                    <ol class="list-decimal list-outside ml-5 space-y-2">
                                        ${(component.bulletPoints || []).map((point, pointIdx) => {
                                            if (point.subheading) {
                                                return `<li class="text-[12px]" data-path="step2.summary.components[${idx}].bulletPoints[${pointIdx}]"><span class="font-semibold" data-path="step2.summary.components[${idx}].bulletPoints[${pointIdx}].subheading">${point.subheading}</span><span class="paragraph" data-path="step2.summary.components[${idx}].bulletPoints[${pointIdx}].content">‚Äî${point.content || ''}</span></li>`;
                                            } else {
                                                return `<li class="paragraph" data-path="step2.summary.components[${idx}].bulletPoints[${pointIdx}].content">${point.content || ''}</li>`;
                                            }
                                        }).join('')}
                                    </ol>
                                </div>
                                <div class="w-[30%] gray-box px-4 py-3">
                                    <h4 class="text-xs font-semibold text-gray-800 mb-2" data-path="step2.summary.components[${idx}].bottomLine.heading">Bottom Line${bottomLineHeading ? ': ' + bottomLineHeading : ''}</h4>
                                    <p class="paragraph text-[--box-gray]" data-path="step2.summary.components[${idx}].bottomLine.content">${bottomLineContent}</p>
                                </div>
                            </div>
                        `;
                        break;

                    case 'bullet-points':
                        html += `
                            <div class="mt-4">
                                <h4 class="heading mb-3">${component.heading || ''}</h4>
                                <div class="grid grid-cols-2 gap-6 paragraph">
                                    <div>
                                        <ul class="list-disc list-outside ml-5 space-y-1">
                                            ${(component.leftPoints || []).map(point => `<li class="text-[11px] text-[--box-gray]">${point}</li>`).join('')}
                                        </ul>
                                    </div>
                                    <div>
                                        <ul class="list-disc list-outside ml-5 space-y-1">
                                            ${(component.rightPoints || []).map(point => `<li class="text-[11px] text-[--box-gray]">${point}</li>`).join('')}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        `;
                        break;

                    case 'two-sided-bullets':
                        html += `
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <h4 class="text-xs font-semibold text-gray-800 mb-2">Left Side</h4>
                                    <ul class="paragraph space-y-1">
                                        ${(component.leftPoints || []).map(point => `<li>‚Ä¢ ${point}</li>`).join('')}
                                    </ul>
                                </div>
                                <div>
                                    <h4 class="text-xs font-semibold text-gray-800 mb-2">Right Side</h4>
                                    <ul class="paragraph space-y-1">
                                        ${(component.rightPoints || []).map(point => `<li>‚Ä¢ ${point}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                        `;
                        break;
                }
                
                div.innerHTML = html;
                container.appendChild(div);
            });
        }

        // Function to populate table data
        function populateTableData(tableData) {
            // Update subtitle and footnote
            document.getElementById('table4-header-1').textContent = tableData.headers?.assetClassHeader || 'Asset Class';
            document.getElementById('table4-header-2').textContent = tableData.headers?.cioViewHeader || 'CIO View';
            document.getElementById('table4-footnote').textContent = tableData.footnote || '';
            
            // Create table rows from JSON data
            const tbody = document.getElementById('table4-view-body');
            tbody.innerHTML = '';
            
            // Process assets in the original order from JSON data
            const assets = tableData.data || [];
            let altInvestmentAssets = [];
            let isInAltInvestmentGroup = false;
            
            assets.forEach((asset, index) => {
                // Skip header assets
                if (asset.isHeader) {
                    return;
                }
                
                // Handle alternative investments
                if (asset.isAlternativeInvestment) {
                    altInvestmentAssets.push({asset, index});
                    isInAltInvestmentGroup = true;
                }
                // Handle cash items
                else if (asset.isCash) {
                    // If we were in an alt investment group, render it first
                    if (isInAltInvestmentGroup && altInvestmentAssets.length > 0) {
                        renderAltInvestmentGroup(tbody, altInvestmentAssets);
                        altInvestmentAssets = [];
                        isInAltInvestmentGroup = false;
                    }
                    addCashRow(tbody, asset, index);
                }
                // Handle regular assets
                else {
                    // If we were in an alt investment group, render it first
                    if (isInAltInvestmentGroup && altInvestmentAssets.length > 0) {
                        renderAltInvestmentGroup(tbody, altInvestmentAssets);
                        altInvestmentAssets = [];
                        isInAltInvestmentGroup = false;
                    }
                    addAssetRow(tbody, asset, index);
                }
            });
            
            // Render any remaining alt investment group
            if (isInAltInvestmentGroup && altInvestmentAssets.length > 0) {
                renderAltInvestmentGroup(tbody, altInvestmentAssets);
            }
            
            // Add click event delegation for weight dots
            tbody.addEventListener('click', handleWeightDotClick);
            
            // Add double-click event delegation for trend editing
            tbody.addEventListener('dblclick', handleTable4RowDoubleClick);
        }
        
        // Handle double-click on table 4 rows to edit trend
        function handleTable4RowDoubleClick(e) {
            // Don't trigger if clicking on weight dots
            if (e.target.closest('.weight-dot') || e.target.closest('.weight-indicator')) {
                return;
            }
            
            const row = e.target.closest('tr');
            if (!row) return;
            
            const assetIndex = row.getAttribute('data-asset-index');
            if (assetIndex === null) return;
            
            const index = parseInt(assetIndex);
            if (isNaN(index)) return;
            
            const asset = DocumentData.step2?.tableData?.data?.[index];
            if (!asset) return;
            
            // Don't allow editing cash rows or alternative investments
            if (asset.isCash || asset.isAlternativeInvestment) return;
            
            showTable4TrendEditDialog(asset, index);
        }
        
        // Show trend edit dialog for table 4
        function showTable4TrendEditDialog(asset, assetIndex) {
            // Remove existing dialog if any
            const existingDialog = document.querySelector('.table4-trend-dialog');
            if (existingDialog) {
                existingDialog.remove();
            }
            
            // Create overlay
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            // Create dialog
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog table4-trend-dialog';
            dialog.style.cssText = `
                background: white;
                border-radius: 8px;
                padding: 24px;
                width: 90%;
                max-width: 500px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            const currentTrend = asset.trend !== undefined ? asset.trend : 0;
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Edit Asset: ${asset.name}</h3>
                
                <div style="margin-bottom: 16px;">
                    <label class="edit-dialog-label" for="table4Position">Position (Weight Value)</label>
                    <select 
                        id="table4Position" 
                        class="edit-dialog-input"
                        style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px;"
                    >
                        <option value="" ${!asset.position ? 'selected' : ''}>Hide (No position)</option>
                        <option value="1" ${asset.position === 1 ? 'selected' : ''}>1 (Underweight)</option>
                        <option value="2" ${asset.position === 2 ? 'selected' : ''}>2 (Underweight)</option>
                        <option value="3" ${asset.position === 3 ? 'selected' : ''}>3 (Neutral)</option>
                        <option value="4" ${asset.position === 4 ? 'selected' : ''}>4 (Overweight)</option>
                        <option value="5" ${asset.position === 5 ? 'selected' : ''}>5 (Overweight)</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="table4Trend">Trend</label>
                    <select 
                        id="table4Trend" 
                        class="edit-dialog-input"
                        style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px;"
                    >
                        <option value="0" ${currentTrend === 0 ? 'selected' : ''}>No Trend (0)</option>
                        <option value="1" ${currentTrend === 1 ? 'selected' : ''}>Upward Trend (1)</option>
                        <option value="-1" ${currentTrend === -1 ? 'selected' : ''}>Downward Trend (-1)</option>
                    </select>
                    <p style="font-size: 12px; color: #666; margin-top: 4px;">
                        Upward: Triangle below left dot | Downward: Triangle above right dot
                    </p>
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancelTable4Btn" class="edit-dialog-btn-secondary" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancel</button>
                    <button id="saveTable4Btn" class="edit-dialog-btn-primary" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Save</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            // Focus on first select
            const positionSelect = document.getElementById('table4Position');
            positionSelect.focus();
            
            // Handle save
            document.getElementById('saveTable4Btn').addEventListener('click', () => {
                const positionValue = document.getElementById('table4Position').value;
                const trendValue = parseInt(document.getElementById('table4Trend').value);
                
                // Update position (empty string means null/undefined)
                if (positionValue === '') {
                    DocumentData.step2.tableData.data[assetIndex].position = null;
                } else {
                    DocumentData.step2.tableData.data[assetIndex].position = parseInt(positionValue);
                }
                
                // Update trend
                DocumentData.step2.tableData.data[assetIndex].trend = trendValue;
                
                // Save to localStorage
                localStorage.setItem('documentData', JSON.stringify(DocumentData));
                
                // Re-render table
                populateTableData(DocumentData.step2.tableData);
                
                // Show success message
                showToast('‚úì Asset updated successfully!');
                
                // Close dialog
                document.body.removeChild(overlay);
            });
            
            // Handle cancel
            document.getElementById('cancelTable4Btn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            // Close on Escape
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.body.removeChild(overlay);
                }
            });
            
            // Close on overlay click
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                }
            });
        }
        
        // Handle weight dot clicks (both regular and alternative investments)
        function handleWeightDotClick(e) {
            // Check for regular weight dots
            const weightDot = e.target.closest('.weight-dot');
            if (weightDot) {
                const assetIndex = parseInt(weightDot.getAttribute('data-asset-index'));
                const newPosition = parseInt(weightDot.getAttribute('data-position'));
                
                if (isNaN(assetIndex) || isNaN(newPosition)) return;
                
                // Update DocumentData
                if (DocumentData.step2?.tableData?.data?.[assetIndex]) {
                    DocumentData.step2.tableData.data[assetIndex].position = newPosition;
                    
                    // Save to localStorage
                    localStorage.setItem('documentData', JSON.stringify(DocumentData));
                    
                    // Re-render the table
                    populateTableData(DocumentData.step2.tableData);
                    
                    showToast('‚úì CIO view position updated', 'success');
                }
                return;
            }
            
            // Check for alternative investment indicator clicks
            const altIndicator = e.target.closest('.alt-investment-indicator');
            if (altIndicator) {
                const assetIndicesStr = altIndicator.getAttribute('data-asset-indices');
                const currentPosition = parseInt(altIndicator.getAttribute('data-position')) || 3;
                
                if (!assetIndicesStr) return;
                
                // Cycle through positions 1-5
                const newPosition = (currentPosition % 5) + 1;
                
                // Parse the comma-separated asset indices
                const assetIndices = assetIndicesStr.split(',').map(idx => parseInt(idx));
                
                // Update all assets in the alternative investment group
                let updated = false;
                assetIndices.forEach(assetIndex => {
                    if (DocumentData.step2?.tableData?.data?.[assetIndex]) {
                        DocumentData.step2.tableData.data[assetIndex].position = newPosition;
                        updated = true;
                    }
                });
                
                if (updated) {
                    // Save to localStorage
                    localStorage.setItem('documentData', JSON.stringify(DocumentData));
                    
                    // Re-render the table
                    populateTableData(DocumentData.step2.tableData);
                    
                    const positionLabel = newPosition <= 2 ? 'Underweight' : (newPosition === 3 ? 'Neutral' : 'Overweight');
                    showToast(`‚úì Alternative investment moved to ${positionLabel} (${newPosition})`, 'success');
                }
                return;
            }
        }
        
        // Helper function to render alternative investment group with vertical line
        function renderAltInvestmentGroup(tbody, altAssets) {
            if (altAssets.length === 0) return;
            
            // Get the position from the first asset in the group (they should all share the same position)
            const position = altAssets[0]?.asset?.position || 3; // Default to neutral (position 3)
            
            // Store indices for all assets in this group
            const assetIndices = altAssets.map(item => item.index);
            
            // Create a single row that spans the full width
            const row = document.createElement('tr');
            row.innerHTML = `
                <td colspan="2" class="alt-investment-group">
                    <div class="alt-investment-container px-1 py-2">
                        <div class="alt-investment-labels text-[9px] space-y-1 font-thin">
                            ${altAssets.map(item => `
                                <div class="text-[9px] font-thin">${item.asset.name || ''}</div>
                            `).join('')}
                        </div>
                        <div class="alt-investment-indicator" data-asset-indices="${assetIndices.join(',')}" data-position="${position}">
                            <div class="alt-line-container position-${position}">
                                <div class="alt-dot"></div>
                                <div class="alt-line"></div>
                                <div class="alt-dot"></div>
                            </div>
                        </div>
                    </div>
                </td>
            `;
            tbody.appendChild(row);
        }

        
        
        // Helper function to add asset row
        function addAssetRow(tbody, asset, assetIndex) {
            const row = document.createElement('tr');
            row.setAttribute('data-asset-index', assetIndex);
            
            // Add trend classes if trend exists
            let rowClass = '';
            if (asset.separate === 1) {
                rowClass = 'separated-row';
            }
            
            // Add trend border class if there's a trend
            if (asset.trend === 1) {
                rowClass += (rowClass ? ' ' : '') + 'trend-row-up';
            } else if (asset.trend === -1) {
                rowClass += (rowClass ? ' ' : '') + 'trend-row-down';
            }
            
            if (rowClass) {
                row.className = rowClass.trim();
            }

            
            // Handle assets without position (hide dots completely)
            if (!asset.position || asset.position === null || asset.position === undefined) {
                row.innerHTML = `
                    <td class="text-[9px] font-thin px-1">${asset.name || ''}</td>
                    <td class="text-center"></td>
                `;
            } else {
                const category = getWeightCategory(asset.position);
                const weightIndicator = createWeightIndicator(asset.position, category, assetIndex, asset.trend);
                row.innerHTML = `
                    <td class="text-[9px] font-thin  px-1">${asset.name || ''}</td>
                    <td class="text-center">${weightIndicator}</td>
                `;
            }
            
            tbody.appendChild(row);
        }
        
    
        // Helper function to add cash row
        function addCashRow(tbody, asset, assetIndex) {
            const row = document.createElement('tr');
            row.setAttribute('data-asset-index', assetIndex);
            
            // Add top and bottom border if separate is 1
            if (asset.separate === 1) {
                row.className = 'separated-row';
            }
            
            row.innerHTML = `
                <td class="text-[11px] px-1">${asset.name || ''}</td>
                <td class="text-center"></td>
            `;
            tbody.appendChild(row);
        }
        
        // Helper function to determine weight category
        function getWeightCategory(position) {
            if (position <= 2) return 'underweight';
            if (position === 3) return 'neutral';
            if (position >= 4) return 'overweight';
            return 'neutral';
        }
        
        // Function to create weight indicator
        function createWeightIndicator(position, category, assetIndex, trend) {
            const totalDots = 5;
            let dotsHtml = '';
            
            for (let i = 1; i <= totalDots; i++) {
                let dotClass = 'weight-dot';
                let triangleHtml = '';
                
                // If position is null/undefined, show all empty dots
                if (position === null || position === undefined) {
                    dotClass += ' empty';
                } else if (i === position) {
                    if (category === 'underweight') {
                        dotClass += ' filled underweight';
                    } else if (category === 'neutral') {
                        dotClass += ' filled neutral';
                    } else if (category === 'overweight') {
                        dotClass += ' filled overweight';
                    } else {
                        dotClass += ' empty';
                    }
                } else {
                    dotClass += ' empty';
                }
                
                // Add trend triangle based on trend value and position
                if (trend !== undefined && trend !== 0 && position !== null && position !== undefined) {
                    if (trend === 1 && i === (position - 1) && i >= 1) {
                        // Show upward trend triangle on the dot to the LEFT of the selected position
                        triangleHtml = '<div class="trend-triangle left"></div>';
                    } else if (trend === -1 && i === (position + 1) && i <= 5) {
                        // Show downward trend triangle on the dot to the RIGHT of the selected position  
                        triangleHtml = '<div class="trend-triangle right"></div>';
                    }
                }
                
                dotsHtml += `<div class="${dotClass}" data-position="${i}" data-asset-index="${assetIndex}" title="Position ${i}">${triangleHtml}</div>`;
            }
            
            return `
                <div class="weight-indicator" data-asset-index="${assetIndex}">
                    ${dotsHtml}
                </div>
            `;
        }

        // ========================================
        // SECTION 2 EDITING FUNCTIONALITY
        // ========================================
        
        function makeSectionTwoEditable() {
            // Make title editable
            const titleEl = document.getElementById('s2Title');
            if (titleEl) {
                titleEl.style.cursor = 'pointer';
                titleEl.title = 'Double-click to edit';
                titleEl.addEventListener('dblclick', function(e) {
                    e.stopPropagation();
                    const currentText = this.textContent;
                    showEditDialog(this, currentText, 'step3.title', false);
                });
            }
            
            // Make description editable
            const descEl = document.getElementById('s2Description');
            if (descEl) {
                descEl.style.cursor = 'pointer';
                descEl.title = 'Double-click to edit';
                descEl.addEventListener('dblclick', function(e) {
                    e.stopPropagation();
                    const currentHTML = this.innerHTML;
                    const currentText = currentHTML.replace(/<br\s*\/?>\s*<br\s*\/?>/gi, '\n').replace(/<br\s*\/?>/gi, '\n').replace(/<[^>]+>/g, '');
                    showEditDialog(this, currentText, 'step3.description', true);
                });
            }
            
            // Make subtitle editable
            const subtitleEl = document.getElementById('s2Subtitle');
            if (subtitleEl) {
                subtitleEl.style.cursor = 'pointer';
                subtitleEl.title = 'Double-click to edit';
                subtitleEl.addEventListener('dblclick', function(e) {
                    e.stopPropagation();
                    const currentText = this.textContent;
                    showEditDialog(this, currentText, 'step3.tableData.subtitle', false);
                });
            }
            
            // Make footnote editable
            const footnoteEl = document.getElementById('s2Footnote');
            if (footnoteEl) {
                footnoteEl.style.cursor = 'pointer';
                footnoteEl.title = 'Double-click to edit';
                footnoteEl.addEventListener('dblclick', function(e) {
                    e.stopPropagation();
                    const currentText = this.textContent;
                    showEditDialog(this, currentText, 'step3.tableData.footnote', false);
                });
            }
            
            // Make table headers editable
            const headerFactor = document.getElementById('s2HeaderFactor');
            if (headerFactor) {
                headerFactor.style.cursor = 'pointer';
                headerFactor.title = 'Double-click to edit';
                headerFactor.addEventListener('dblclick', function(e) {
                    e.stopPropagation();
                    const currentText = this.textContent;
                    showEditDialog(this, currentText, 'step3.tableData.headers.factorHeader', false);
                });
            }
            
            const headerImplication = document.getElementById('s2HeaderImplication');
            if (headerImplication) {
                headerImplication.style.cursor = 'pointer';
                headerImplication.title = 'Double-click to edit';
                headerImplication.addEventListener('dblclick', function(e) {
                    e.stopPropagation();
                    const currentText = this.textContent;
                    showEditDialog(this, currentText, 'step3.tableData.headers.implicationHeader', false);
                });
            }
            
            const headerCioView = document.getElementById('s2HeaderCioView');
            if (headerCioView) {
                headerCioView.style.cursor = 'pointer';
                headerCioView.title = 'Double-click to edit';
                headerCioView.addEventListener('dblclick', function(e) {
                    e.stopPropagation();
                    const currentText = this.textContent;
                    showEditDialog(this, currentText, 'step3.tableData.headers.cioViewHeader', false);
                });
            }
            
            const headerNegative = document.getElementById('s2HeaderNegative');
            if (headerNegative) {
                headerNegative.style.cursor = 'pointer';
                headerNegative.title = 'Double-click to edit';
                headerNegative.addEventListener('dblclick', function(e) {
                    e.stopPropagation();
                    const currentText = this.textContent;
                    showEditDialog(this, currentText, 'step3.tableData.headers.negativeLabel', false);
                });
            }
            
            const headerNeutral = document.getElementById('s2HeaderNeutral');
            if (headerNeutral) {
                headerNeutral.style.cursor = 'pointer';
                headerNeutral.title = 'Double-click to edit';
                headerNeutral.addEventListener('dblclick', function(e) {
                    e.stopPropagation();
                    const currentText = this.textContent;
                    showEditDialog(this, currentText, 'step3.tableData.headers.neutralLabel', false);
                });
            }
            
            const headerPositive = document.getElementById('s2HeaderPositive');
            if (headerPositive) {
                headerPositive.style.cursor = 'pointer';
                headerPositive.title = 'Double-click to edit';
                headerPositive.addEventListener('dblclick', function(e) {
                    e.stopPropagation();
                    const currentText = this.textContent;
                    showEditDialog(this, currentText, 'step3.tableData.headers.positiveLabel', false);
                });
            }
            
            // Make table cells editable
            makeSectionTwoTableEditable();
        }
        
        function makeSectionTwoTableEditable() {
            const tbody = document.getElementById('factors-body');
            if (!tbody) return;
            
            // Event delegation for table rows
            tbody.addEventListener('dblclick', function(e) {
                const row = e.target.closest('tr');
                if (!row) return;
                
                const rowIndex = Array.from(tbody.children).indexOf(row);
                
                // Open dialog to edit the entire row
                showFactorEditDialog(rowIndex);
            });
            
            // Add hover effect to rows
            const style = document.createElement('style');
            style.id = 'section-two-edit-style';
            if (!document.getElementById('section-two-edit-style')) {
                style.textContent = `
                    #factors-body tr {
                        cursor: pointer;
                        transition: background-color 0.2s;
                    }
                    #factors-body tr:hover {
                        background-color: #f0f0f0;
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        function showFactorEditDialog(rowIndex) {
            // Get current factor data
            const factorData = DocumentData.step3?.tableData?.data?.[rowIndex];
            if (!factorData) return;
            
            // Remove existing dialog if any
            const existingDialog = document.querySelector('.edit-dialog-overlay');
            if (existingDialog) {
                existingDialog.remove();
            }
            
            // Create dialog overlay
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            
            // Create dialog
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            
            dialog.innerHTML = `
                <div class="edit-dialog-header">
                    <h3 class="edit-dialog-title">Edit Factor</h3>
                    <button class="edit-dialog-close" onclick="closeEditDialog()">&times;</button>
                </div>
                <div class="edit-dialog-body">
                    <div style="margin-bottom: 16px;">
                        <label class="edit-dialog-label" for="factorInput">Factor Name</label>
                        <input 
                            type="text" 
                            id="factorInput" 
                            class="edit-dialog-input" 
                            value="${factorData.factor || ''}"
                            placeholder="Enter factor name"
                        />
                    </div>
                    
                    <div style="margin-bottom: 16px;">
                        <label class="edit-dialog-label" for="trendSelect">Trend</label>
                        <select id="trendSelect" class="edit-dialog-input">
                            <option value="up" ${factorData.trend === 'up' ? 'selected' : ''}>Up ‚Üó</option>
                            <option value="neutral" ${factorData.trend === 'neutral' ? 'selected' : ''}>Neutral ‚Üí</option>
                            <option value="down" ${factorData.trend === 'down' ? 'selected' : ''}>Down ‚Üò</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 16px;">
                        <label class="edit-dialog-label" for="valueSelect">Value (0-100)</label>
                        <select id="valueSelect" class="edit-dialog-input">
                            <option value="0" ${factorData.value === 0 ? 'selected' : ''}>0 - Negative</option>
                            <option value="25" ${factorData.value === 25 ? 'selected' : ''}>25 - Slightly Negative</option>
                            <option value="50" ${factorData.value === 50 ? 'selected' : ''}>50 - Neutral</option>
                            <option value="75" ${factorData.value === 75 ? 'selected' : ''}>75 - Slightly Positive</option>
                            <option value="100" ${factorData.value === 100 ? 'selected' : ''}>100 - Positive</option>
                        </select>
                        <small class="edit-dialog-hint">Position on the scale: 0 = Negative, 50 = Neutral, 100 = Positive</small>
                    </div>
                    
                    <div style="margin-bottom: 16px;">
                        <label class="edit-dialog-label" for="cioViewTextarea">CIO View</label>
                        <textarea 
                            id="cioViewTextarea" 
                            class="edit-dialog-textarea" 
                            rows="6"
                            placeholder="Enter CIO view"
                        >${factorData.cioView || ''}</textarea>
                    </div>
                </div>
                <div class="edit-dialog-footer">
                    <button class="edit-dialog-btn edit-dialog-btn-cancel" onclick="closeEditDialog()">Cancel</button>
                    <button class="edit-dialog-btn edit-dialog-btn-save" id="saveFactorBtn">Save Changes</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            // Focus first input
            const factorInput = document.getElementById('factorInput');
            setTimeout(() => {
                factorInput.focus();
                factorInput.select();
            }, 100);
            
            // Save handler
            const saveBtn = document.getElementById('saveFactorBtn');
            saveBtn.onclick = () => {
                const newFactor = document.getElementById('factorInput').value.trim();
                const newTrend = document.getElementById('trendSelect').value;
                const newValue = parseInt(document.getElementById('valueSelect').value);
                const newCioView = document.getElementById('cioViewTextarea').value.trim();
                
                // Update DocumentData
                if (!DocumentData.step3) DocumentData.step3 = {};
                if (!DocumentData.step3.tableData) DocumentData.step3.tableData = {};
                if (!DocumentData.step3.tableData.data) DocumentData.step3.tableData.data = [];
                if (!DocumentData.step3.tableData.data[rowIndex]) DocumentData.step3.tableData.data[rowIndex] = {};
                
                DocumentData.step3.tableData.data[rowIndex].factor = newFactor;
                DocumentData.step3.tableData.data[rowIndex].trend = newTrend;
                DocumentData.step3.tableData.data[rowIndex].value = newValue;
                DocumentData.step3.tableData.data[rowIndex].cioView = newCioView;
                
                // Save to localStorage
                localStorage.setItem('documentData', JSON.stringify(DocumentData));
                
                // Re-render the table
                populateSectionTwo(DocumentData.step3);
                
                // Re-enable editing
                makeSectionTwoTableEditable();
                
                showToast('‚úì Factor updated successfully', 'success');
                closeEditDialog();
            };
            
            // Close on Escape key
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeEditDialog();
                }
            });
            
            // Close on overlay click
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    closeEditDialog();
                }
            });
            
            // Save on Ctrl+Enter in textarea
            const cioViewTextarea = document.getElementById('cioViewTextarea');
            cioViewTextarea.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'Enter') {
                    saveBtn.click();
                }
            });
        }

        // ========================================
        // SECTION 3 EDITING FUNCTIONALITY
        // ========================================
        
        function makeSectionThreeEditable() {
            // Make title editable
            const titleEl = document.getElementById('s3Title');
            if (titleEl) {
                titleEl.style.cursor = 'pointer';
                titleEl.title = 'Double-click to edit';
                titleEl.addEventListener('dblclick', function(e) {
                    e.stopPropagation();
                    const currentText = this.textContent;
                    showEditDialog(this, currentText, 'step4.title', false);
                });
            }
            
            // Make subsections editable
            makeSectionThreeSubsectionsEditable();
            
            // Make equity watch list items editable
            makeListEditable('s3EquityList', 'step4.rightContainer.equityWatchList');
            
            // Make risk considerations editable
            makeListEditable('s3RiskList', 'step4.rightContainer.riskConsiderations');
            
            // Make sector valuation title editable
            const sectorTitleEl = document.getElementById('s3SectorTitle');
            if (sectorTitleEl) {
                sectorTitleEl.style.cursor = 'pointer';
                sectorTitleEl.title = 'Double-click to edit';
                sectorTitleEl.addEventListener('dblclick', function(e) {
                    e.stopPropagation();
                    const currentText = this.textContent;
                    showEditDialog(this, currentText, 'step4.sectorValuation.title', false);
                });
            }
            
            // Make sector valuation subtitle editable
            const sectorSubtitle = document.querySelector('.s3SectorSubtitle');
            if (sectorSubtitle) {
                sectorSubtitle.style.cursor = 'pointer';
                sectorSubtitle.title = 'Double-click to edit';
                sectorSubtitle.addEventListener('dblclick', function(e) {
                    e.stopPropagation();
                    const currentText = this.textContent;
                    showEditDialog(this, currentText, 'step4.sectorValuation.subtitle', false);
                });
            }
            
            // Make x-axis editable
            const xAxisLabels = document.getElementById('s3XAxisLabels');
            if (xAxisLabels) {
                xAxisLabels.style.cursor = 'pointer';
                xAxisLabels.title = 'Double-click to edit axis range';
                xAxisLabels.addEventListener('dblclick', function(e) {
                    e.stopPropagation();
                    showXAxisEditDialog();
                });
            }
            
            // Make sector table rows editable
            makeSectorTableEditable();
        }
        
        function makeSectionThreeSubsectionsEditable() {
            const subsectionContainer = document.getElementById('s3Subsection');
            if (!subsectionContainer) return;
            
            // Event delegation for subsection items
            subsectionContainer.addEventListener('dblclick', function(e) {
                const subsectionDiv = e.target.closest('.mb-4');
                if (!subsectionDiv) return;
                
                const subsectionIndex = Array.from(subsectionContainer.children).indexOf(subsectionDiv);
                showSubsectionEditDialog(subsectionIndex);
            });
            
            // Add hover effect
            const style = document.createElement('style');
            style.id = 'section-three-subsection-style';
            if (!document.getElementById('section-three-subsection-style')) {
                style.textContent = `
                    #s3Subsection > .mb-4 {
                        cursor: pointer;
                        transition: background-color 0.2s;
                        padding: 8px;
                        border-radius: 4px;
                    }
                    #s3Subsection > .mb-4:hover {
                        background-color: #f3f4f6;
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        function showSubsectionEditDialog(subsectionIndex) {
            const subsectionData = DocumentData.step4.subsections[subsectionIndex];
            if (!subsectionData) return;
            
            // Create overlay
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            // Create dialog
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white;
                border-radius: 8px;
                padding: 24px;
                width: 90%;
                max-width: 600px;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Edit Subsection</h3>
                
                <div style="margin-bottom: 16px;">
                    <label class="edit-dialog-label" for="subsectionHeading">Heading</label>
                    <input 
                        type="text" 
                        id="subsectionHeading" 
                        class="edit-dialog-input" 
                        value="${subsectionData.heading || ''}"
                        placeholder="Enter heading"
                    />
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="subsectionContent">Content</label>
                    <textarea 
                        id="subsectionContent" 
                        class="edit-dialog-input" 
                        rows="8"
                        placeholder="Enter content"
                    >${subsectionData.content || ''}</textarea>
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancelSubsectionBtn" class="edit-dialog-btn-secondary">Cancel</button>
                    <button id="saveSubsectionBtn" class="edit-dialog-btn-primary">Save</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            // Focus on heading input
            const headingInput = document.getElementById('subsectionHeading');
            headingInput.focus();
            
            // Handle save
            document.getElementById('saveSubsectionBtn').addEventListener('click', () => {
                const newHeading = document.getElementById('subsectionHeading').value.trim();
                const newContent = document.getElementById('subsectionContent').value.trim();
                
                // Update data
                DocumentData.step4.subsections[subsectionIndex].heading = newHeading;
                DocumentData.step4.subsections[subsectionIndex].content = newContent;
                
                // Save to localStorage
                localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                
                // Re-render subsections
                populateSectionThree(DocumentData.step4);
                
                // Show success message
                showToast('Subsection updated successfully!');
                
                // Close dialog
                document.body.removeChild(overlay);
            });
            
            // Handle cancel
            document.getElementById('cancelSubsectionBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            // Close on Escape
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.body.removeChild(overlay);
                }
            });
            
            // Close on overlay click
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                }
            });
            
            // Save on Ctrl+Enter in textarea
            const contentTextarea = document.getElementById('subsectionContent');
            contentTextarea.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'Enter') {
                    document.getElementById('saveSubsectionBtn').click();
                }
            });
        }
        
        function makeListEditable(listId, dataPath) {
            const listEl = document.getElementById(listId);
            if (!listEl) return;
            
            // Event delegation for list items
            listEl.addEventListener('dblclick', function(e) {
                const listItem = e.target.closest('li');
                if (!listItem) return;
                
                const itemIndex = Array.from(listEl.children).indexOf(listItem);
                showListItemEditDialog(listId, dataPath, itemIndex);
            });
            
            // Add hover effect
            const styleId = `${listId}-edit-style`;
            if (!document.getElementById(styleId)) {
                const style = document.createElement('style');
                style.id = styleId;
                style.textContent = `
                    #${listId} li {
                        cursor: pointer;
                        transition: background-color 0.2s;
                        padding: 4px;
                        border-radius: 4px;
                    }
                    #${listId} li:hover {
                        background-color: #f3f4f6;
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        function showListItemEditDialog(listId, dataPath, itemIndex) {
            // Get data array from path
            const pathParts = dataPath.split('.');
            let dataArray = DocumentData;
            for (const part of pathParts) {
                dataArray = dataArray[part];
            }
            
            const currentText = dataArray[itemIndex];
            
            // Create overlay
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            // Create dialog
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white;
                border-radius: 8px;
                padding: 24px;
                width: 90%;
                max-width: 500px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Edit List Item</h3>
                
                <div style="margin-bottom: 20px;">
                    <textarea 
                        id="listItemText" 
                        class="edit-dialog-input" 
                        rows="4"
                        placeholder="Enter text"
                    >${currentText || ''}</textarea>
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancelListItemBtn" class="edit-dialog-btn-secondary">Cancel</button>
                    <button id="deleteListItemBtn" class="edit-dialog-btn-danger">Delete</button>
                    <button id="saveListItemBtn" class="edit-dialog-btn-primary">Save</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            // Focus on textarea
            const textarea = document.getElementById('listItemText');
            textarea.focus();
            textarea.setSelectionRange(textarea.value.length, textarea.value.length);
            
            // Handle save
            document.getElementById('saveListItemBtn').addEventListener('click', () => {
                const newText = document.getElementById('listItemText').value.trim();
                
                if (newText) {
                    // Update data
                    dataArray[itemIndex] = newText;
                    
                    // Save to localStorage
                    localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                    
                    // Re-render section
                    populateSectionThree(DocumentData.step4);
                    
                    // Show success message
                    showToast('List item updated successfully!');
                }
                
                // Close dialog
                document.body.removeChild(overlay);
            });
            
            // Handle delete
            document.getElementById('deleteListItemBtn').addEventListener('click', () => {
                if (confirm('Are you sure you want to delete this item?')) {
                    // Remove item
                    dataArray.splice(itemIndex, 1);
                    
                    // Save to localStorage
                    localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                    
                    // Re-render section
                    populateSectionThree(DocumentData.step4);
                    
                    // Show success message
                    showToast('List item deleted successfully!');
                    
                    // Close dialog
                    document.body.removeChild(overlay);
                }
            });
            
            // Handle cancel
            document.getElementById('cancelListItemBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            // Close on Escape
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.body.removeChild(overlay);
                }
            });
            
            // Close on overlay click
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                }
            });
            
            // Save on Ctrl+Enter
            textarea.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'Enter') {
                    document.getElementById('saveListItemBtn').click();
                }
            });
        }
        
        function makeSectorTableEditable() {
            const tbody = document.getElementById('s3SectorTable');
            if (!tbody) return;
            
            // Event delegation for table rows
            tbody.addEventListener('dblclick', function(e) {
                const row = e.target.closest('tr');
                if (!row) return;
                
                const rowIndex = Array.from(tbody.children).indexOf(row);
                showSectorEditDialog(rowIndex);
            });
            
            // Add hover effect
            const style = document.createElement('style');
            style.id = 'section-three-sector-style';
            if (!document.getElementById('section-three-sector-style')) {
                style.textContent = `
                    #s3SectorTable tr {
                        cursor: pointer;
                        transition: background-color 0.2s;
                    }
                    #s3SectorTable tr:hover {
                        background-color: #f9fafb !important;
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        function showSectorEditDialog(rowIndex) {
            const sectorData = DocumentData.step4.sectorValuation.data[rowIndex];
            if (!sectorData) return;
            
            // Create overlay
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            // Create dialog
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white;
                border-radius: 8px;
                padding: 24px;
                width: 90%;
                max-width: 500px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Edit Sector Valuation</h3>
                
                <div style="margin-bottom: 16px;">
                    <label class="edit-dialog-label" for="sectorName">Sector Name</label>
                    <input 
                        type="text" 
                        id="sectorName" 
                        class="edit-dialog-input" 
                        value="${sectorData.name || ''}"
                        placeholder="Enter sector name"
                    />
                </div>
                
                <div style="margin-bottom: 16px;">
                    <label class="edit-dialog-label" for="sectorCurrentPE">Current Forward P/E</label>
                    <input 
                        type="number" 
                        id="sectorCurrentPE" 
                        class="edit-dialog-input" 
                        value="${sectorData.currentPE || ''}"
                        step="0.1"
                        placeholder="Enter current P/E"
                    />
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="sectorAveragePE">15 Year Average P/E</label>
                    <input 
                        type="number" 
                        id="sectorAveragePE" 
                        class="edit-dialog-input" 
                        value="${sectorData.averagePE || ''}"
                        step="0.1"
                        placeholder="Enter average P/E"
                    />
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancelSectorBtn" class="edit-dialog-btn-secondary">Cancel</button>
                    <button id="saveSectorBtn" class="edit-dialog-btn-primary">Save</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            // Focus on name input
            const nameInput = document.getElementById('sectorName');
            nameInput.focus();
            
            // Handle save
            document.getElementById('saveSectorBtn').addEventListener('click', () => {
                const newName = document.getElementById('sectorName').value.trim();
                const newCurrentPE = parseFloat(document.getElementById('sectorCurrentPE').value);
                const newAveragePE = parseFloat(document.getElementById('sectorAveragePE').value);
                
                if (!newName || isNaN(newCurrentPE) || isNaN(newAveragePE)) {
                    alert('Please fill in all fields with valid values.');
                    return;
                }
                
                // Update data
                DocumentData.step4.sectorValuation.data[rowIndex].name = newName;
                DocumentData.step4.sectorValuation.data[rowIndex].currentPE = newCurrentPE;
                DocumentData.step4.sectorValuation.data[rowIndex].averagePE = newAveragePE;
                
                // Save to localStorage
                localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                
                // Re-render section
                populateSectionThree(DocumentData.step4);
                
                // Show success message
                showToast('Sector valuation updated successfully!');
                
                // Close dialog
                document.body.removeChild(overlay);
            });
            
            // Handle cancel
            document.getElementById('cancelSectorBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            // Close on Escape
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.body.removeChild(overlay);
                }
            });
            
            // Close on overlay click
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                }
            });
            
            // Save on Enter in inputs
            const inputs = dialog.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        document.getElementById('saveSectorBtn').click();
                    }
                });
            });
        }
        
        function showXAxisEditDialog() {
            const axisConfig = DocumentData.step4.sectorValuation.axisConfig || { start: 15, end: 35, interval: 5 };
            
            // Create overlay
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            // Create dialog
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white;
                border-radius: 8px;
                padding: 24px;
                width: 90%;
                max-width: 500px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Edit X-Axis Range</h3>
                
                <div style="margin-bottom: 16px;">
                    <label class="edit-dialog-label" for="axisStart">Start Value</label>
                    <input 
                        type="number" 
                        id="axisStart" 
                        class="edit-dialog-input" 
                        value="${axisConfig.start || 15}"
                        step="1"
                        placeholder="Enter start value"
                    />
                </div>
                
                <div style="margin-bottom: 16px;">
                    <label class="edit-dialog-label" for="axisEnd">End Value</label>
                    <input 
                        type="number" 
                        id="axisEnd" 
                        class="edit-dialog-input" 
                        value="${axisConfig.end || 35}"
                        step="1"
                        placeholder="Enter end value"
                    />
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="axisInterval">Interval</label>
                    <input 
                        type="number" 
                        id="axisInterval" 
                        class="edit-dialog-input" 
                        value="${axisConfig.interval || 5}"
                        step="1"
                        placeholder="Enter interval"
                    />
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancelAxisBtn" class="edit-dialog-btn-secondary">Cancel</button>
                    <button id="saveAxisBtn" class="edit-dialog-btn-primary">Save</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            // Focus on start input
            const startInput = document.getElementById('axisStart');
            startInput.focus();
            startInput.select();
            
            // Handle save
            document.getElementById('saveAxisBtn').addEventListener('click', () => {
                const newStart = parseInt(document.getElementById('axisStart').value);
                const newEnd = parseInt(document.getElementById('axisEnd').value);
                const newInterval = parseInt(document.getElementById('axisInterval').value);
                
                if (isNaN(newStart) || isNaN(newEnd) || isNaN(newInterval)) {
                    alert('Please enter valid numbers for all fields.');
                    return;
                }
                
                if (newStart >= newEnd) {
                    alert('Start value must be less than end value.');
                    return;
                }
                
                if (newInterval <= 0) {
                    alert('Interval must be greater than 0.');
                    return;
                }
                
                // Update data
                if (!DocumentData.step4.sectorValuation.axisConfig) {
                    DocumentData.step4.sectorValuation.axisConfig = {};
                }
                DocumentData.step4.sectorValuation.axisConfig.start = newStart;
                DocumentData.step4.sectorValuation.axisConfig.end = newEnd;
                DocumentData.step4.sectorValuation.axisConfig.interval = newInterval;
                
                // Save to localStorage
                localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                
                // Re-render section
                populateSectionThree(DocumentData.step4);
                
                // Show success message
                showToast('X-axis range updated successfully!');
                
                // Close dialog
                document.body.removeChild(overlay);
            });
            
            // Handle cancel
            document.getElementById('cancelAxisBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            // Close on Escape
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.body.removeChild(overlay);
                }
            });
            
            // Close on overlay click
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                }
            });
            
            // Save on Enter in inputs
            const inputs = dialog.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        document.getElementById('saveAxisBtn').click();
                    }
                });
            });
        }

        // ========================================
        // SECTION 4 EDITING FUNCTIONALITY
        // ========================================
        
        function makeSectionFourEditable() {
            // Make title editable
            const titleEl = document.getElementById('s4Title');
            if (titleEl) {
                titleEl.style.cursor = 'pointer';
                titleEl.title = 'Double-click to edit';
                titleEl.addEventListener('dblclick', function(e) {
                    e.stopPropagation();
                    const currentText = this.textContent;
                    showEditDialog(this, currentText, 'step5.title', false);
                });
            }
            
            // Make subsections editable
            makeSectionFourSubsectionsEditable();
            
            // Make fixed income watch list heading editable
            const incomeTitleEl = document.getElementById('s4IncomeTitle');
            if (incomeTitleEl) {
                incomeTitleEl.style.cursor = 'pointer';
                incomeTitleEl.title = 'Double-click to edit';
                incomeTitleEl.addEventListener('dblclick', function(e) {
                    e.stopPropagation();
                    const currentText = this.textContent;
                    showEditDialog(this, currentText, 'step5.rightContainer.fixedIncomeTitle', false);
                });
            }
            
            // Make fixed income watch list items editable
            makeListEditable('s4IncomeList', 'step5.rightContainer.fixedIncomeWatchList');
            
            // Make risk considerations heading editable
            const riskTitleEl = document.getElementById('s4RiskTitle');
            if (riskTitleEl) {
                riskTitleEl.style.cursor = 'pointer';
                riskTitleEl.title = 'Double-click to edit';
                riskTitleEl.addEventListener('dblclick', function(e) {
                    e.stopPropagation();
                    const currentText = this.textContent;
                    showEditDialog(this, currentText, 'step5.rightContainer.riskTitle', false);
                });
            }
            
            // Make risk considerations items editable
            makeListEditable('s4RiskList', 'step5.rightContainer.riskConsiderations');
        }
        
        function makeSectionFourSubsectionsEditable() {
            const subsectionContainer = document.getElementById('s4Subsection');
            if (!subsectionContainer) return;
            
            // Event delegation for subsection items
            subsectionContainer.addEventListener('dblclick', function(e) {
                const subsectionDiv = e.target.closest('.mb-4');
                if (!subsectionDiv) return;
                
                const subsectionIndex = Array.from(subsectionContainer.children).indexOf(subsectionDiv);
                showSectionFourSubsectionEditDialog(subsectionIndex);
            });
            
            // Add hover effect
            const style = document.createElement('style');
            style.id = 'section-four-subsection-style';
            if (!document.getElementById('section-four-subsection-style')) {
                style.textContent = `
                    #s4Subsection > .mb-4 {
                        cursor: pointer;
                        transition: background-color 0.2s;
                        padding: 8px;
                        border-radius: 4px;
                    }
                    #s4Subsection > .mb-4:hover {
                        background-color: #f3f4f6;
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        function showSectionFourSubsectionEditDialog(subsectionIndex) {
            const subsectionData = DocumentData.step5.subsections[subsectionIndex];
            if (!subsectionData) return;
            
            // Create overlay
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            // Create dialog
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white;
                border-radius: 8px;
                padding: 24px;
                width: 90%;
                max-width: 600px;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Edit Subsection</h3>
                
                <div style="margin-bottom: 16px;">
                    <label class="edit-dialog-label" for="s4SubsectionHeading">Heading</label>
                    <input 
                        type="text" 
                        id="s4SubsectionHeading" 
                        class="edit-dialog-input" 
                        value="${subsectionData.heading || ''}"
                        placeholder="Enter heading"
                    />
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="s4SubsectionContent">Content</label>
                    <textarea 
                        id="s4SubsectionContent" 
                        class="edit-dialog-input" 
                        rows="8"
                        placeholder="Enter content"
                    >${subsectionData.content || ''}</textarea>
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancelS4SubsectionBtn" class="edit-dialog-btn-secondary">Cancel</button>
                    <button id="saveS4SubsectionBtn" class="edit-dialog-btn-primary">Save</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            // Focus on heading input
            const headingInput = document.getElementById('s4SubsectionHeading');
            headingInput.focus();
            
            // Handle save
            document.getElementById('saveS4SubsectionBtn').addEventListener('click', () => {
                const newHeading = document.getElementById('s4SubsectionHeading').value.trim();
                const newContent = document.getElementById('s4SubsectionContent').value.trim();
                
                // Update data
                DocumentData.step5.subsections[subsectionIndex].heading = newHeading;
                DocumentData.step5.subsections[subsectionIndex].content = newContent;
                
                // Save to localStorage
                localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                
                // Re-render subsections
                populateSectionFour(DocumentData.step5);
                
                // Show success message
                showToast('Subsection updated successfully!');
                
                // Close dialog
                document.body.removeChild(overlay);
            });
            
            // Handle cancel
            document.getElementById('cancelS4SubsectionBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            // Close on Escape
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.body.removeChild(overlay);
                }
            });
            
            // Close on overlay click
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                }
            });
            
            // Save on Ctrl+Enter in textarea
            const contentTextarea = document.getElementById('s4SubsectionContent');
            contentTextarea.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'Enter') {
                    document.getElementById('saveS4SubsectionBtn').click();
                }
            });
        }

        // ========================================
        // SECTION 5 EDITING FUNCTIONALITY
        // ========================================
        
        function makeSectionFiveEditable() {
            // Make title editable
            const titleEl = document.getElementById('s5Title');
            if (titleEl && !titleEl.dataset.editable) {
                titleEl.dataset.editable = 'true';
                titleEl.style.cursor = 'pointer';
                titleEl.title = 'Double-click to edit';
                titleEl.addEventListener('dblclick', function(e) {
                    e.stopPropagation();
                    const currentText = this.textContent;
                    showEditDialog(this, currentText, 'step6.title', false);
                });
            }
            
            // Make container content editable
            makeAltBoxEditable();
            
            // Make subsections editable
            makeSectionFiveSubsectionsEditable();
            
            // Make strategy title editable
            const strategyTitleEl = document.getElementById('s5StrategyTitle');
            if (strategyTitleEl && !strategyTitleEl.dataset.editable) {
                strategyTitleEl.dataset.editable = 'true';
                strategyTitleEl.style.cursor = 'pointer';
                strategyTitleEl.title = 'Double-click to edit';
                strategyTitleEl.addEventListener('dblclick', function(e) {
                    e.stopPropagation();
                    const currentText = this.textContent;
                    showEditDialog(this, currentText, 'step6.strategy.title', false);
                });
            }
            
            // Make strategy list items editable
            makeListEditable('s5StrategyList', 'step6.strategy.data');
            
            // Make CIO Views on Alts Strategies editable
            makeCIOViewsEditable();
        }
        
        function makeCIOViewsEditable() {
            const cioViewsContainer = document.getElementById('s5CIOViews');
            if (!cioViewsContainer) return;
            
            // Check if already initialized to prevent duplicate listeners
            if (cioViewsContainer.dataset.editable === 'true') return;
            cioViewsContainer.dataset.editable = 'true';
            
            // Event delegation for strategy items
            cioViewsContainer.addEventListener('dblclick', function(e) {
                // Check if clicked on footnote - use a more reliable selector
                let target = e.target;
                let footnoteP = null;
                
                // Check if target or its parents have the footnote classes
                while (target && target !== cioViewsContainer) {
                    if (target.tagName === 'P' && 
                        target.classList.contains('pt-2') && 
                        target.classList.contains('text-gray-500') &&
                        target.classList.contains('border-t')) {
                        footnoteP = target;
                        break;
                    }
                    target = target.parentElement;
                }
                
                if (footnoteP) {
                    const strategyContainer = footnoteP.closest('.mt-4');
                    const allStrategies = cioViewsContainer.querySelectorAll('.mt-4');
                    const strategyIndex = Array.from(allStrategies).indexOf(strategyContainer);
                    
                    showCIOViewFootnoteEditDialog(strategyIndex);
                    return;
                }
                
                // Check if clicked on a strategy row (h2 element)
                const strategyRow = e.target.closest('h2');
                if (strategyRow) {
                    // Find the parent strategy container
                    const strategyContainer = strategyRow.closest('.mt-4');
                    const allStrategies = cioViewsContainer.querySelectorAll('.mt-4');
                    const strategyIndex = Array.from(allStrategies).indexOf(strategyContainer);
                    
                    // Find which data item within the strategy
                    const allRows = strategyContainer.querySelectorAll('h2');
                    const rowIndex = Array.from(allRows).indexOf(strategyRow);
                    
                    showCIOViewEditDialog(strategyIndex, rowIndex);
                    return;
                }
                
                // Check if clicked on bull case or bear case text
                const caseDiv = e.target.closest('.flex.gap-3');
                if (caseDiv) {
                    const strategyContainer = caseDiv.closest('.mt-4');
                    const allStrategies = cioViewsContainer.querySelectorAll('.mt-4');
                    const strategyIndex = Array.from(allStrategies).indexOf(strategyContainer);
                    
                    // Find the parent flex-col container
                    const flexCol = caseDiv.closest('.flex.flex-col');
                    const allFlexCols = strategyContainer.querySelectorAll('.flex.flex-col');
                    const rowIndex = Array.from(allFlexCols).indexOf(flexCol);
                    
                    showCIOViewEditDialog(strategyIndex, rowIndex);
                    return;
                }
            });
            
            // Add hover effect
            const styleId = 's5-cio-views-style';
            if (!document.getElementById(styleId)) {
                const style = document.createElement('style');
                style.id = styleId;
                style.textContent = `
                    #s5CIOViews h2 {
                        cursor: pointer;
                        transition: background-color 0.2s;
                        padding: 4px;
                    }
                    #s5CIOViews h2:hover {
                        background-color: #f3f4f6;
                    }
                    #s5CIOViews .flex.gap-3 {
                        cursor: pointer;
                        transition: background-color 0.2s;
                        padding: 4px;
                        border-radius: 4px;
                    }
                    #s5CIOViews .flex.gap-3:hover {
                        background-color: #f3f4f6;
                    }
                    #s5CIOViews p.pt-2.text-gray-500.border-t {
                        cursor: pointer;
                        transition: background-color 0.2s;
                        padding: 4px;
                        border-radius: 4px;
                    }
                    #s5CIOViews p.pt-2.text-gray-500.border-t:hover {
                        background-color: #fff3cd;
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        function showCIOViewEditDialog(strategyIndex, rowIndex) {
            const strategyData = DocumentData.step6.altStrategies[strategyIndex];
            const rowData = strategyData.data[rowIndex];
            if (!rowData) return;
            
            // Create overlay
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            // Create dialog
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white;
                border-radius: 8px;
                padding: 24px;
                width: 90%;
                max-width: 700px;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Edit CIO View - ${strategyData.title}</h3>
                
                <div style="margin-bottom: 16px;">
                    <label class="edit-dialog-label" for="cioViewHeading">Strategy Name</label>
                    <input 
                        type="text" 
                        id="cioViewHeading" 
                        class="edit-dialog-input" 
                        value="${rowData.heading || ''}"
                        placeholder="Enter strategy name"
                    />
                </div>
                
                <div style="margin-bottom: 16px;">
                    <label class="edit-dialog-label" for="cioViewSymbol">Symbol (+ or - or leave empty)</label>
                    <select 
                        id="cioViewSymbol" 
                        class="edit-dialog-input"
                        style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px;"
                    >
                        <option value="">None</option>
                        <option value="+" ${rowData.symbol === '+' ? 'selected' : ''}>+ (Positive)</option>
                        <option value="-" ${rowData.symbol === '-' ? 'selected' : ''}>- (Negative)</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 16px;">
                    <label class="edit-dialog-label" for="cioViewColor">Symbol Color</label>
                    <select 
                        id="cioViewColor" 
                        class="edit-dialog-input"
                        style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px;"
                    >
                        <option value="green" ${rowData.color === 'green' ? 'selected' : ''}>Green</option>
                        <option value="red" ${rowData.color === 'red' ? 'selected' : ''}>Red</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 16px;">
                    <label class="edit-dialog-label" for="cioViewBullCase">Bull Case</label>
                    <textarea 
                        id="cioViewBullCase" 
                        class="edit-dialog-input" 
                        rows="3"
                        placeholder="Enter bull case"
                    >${rowData.bullCase || ''}</textarea>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="cioViewBearCase">Bear Case</label>
                    <textarea 
                        id="cioViewBearCase" 
                        class="edit-dialog-input" 
                        rows="3"
                        placeholder="Enter bear case"
                    >${rowData.bearCase || ''}</textarea>
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancelCIOViewBtn" class="edit-dialog-btn-secondary">Cancel</button>
                    <button id="saveCIOViewBtn" class="edit-dialog-btn-primary">Save</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            // Focus on heading input
            const headingInput = document.getElementById('cioViewHeading');
            headingInput.focus();
            
            // Handle save
            document.getElementById('saveCIOViewBtn').addEventListener('click', () => {
                const newHeading = document.getElementById('cioViewHeading').value.trim();
                const newSymbol = document.getElementById('cioViewSymbol').value;
                const newColor = document.getElementById('cioViewColor').value;
                const newBullCase = document.getElementById('cioViewBullCase').value.trim();
                const newBearCase = document.getElementById('cioViewBearCase').value.trim();
                
                // Update data
                DocumentData.step6.altStrategies[strategyIndex].data[rowIndex].heading = newHeading;
                DocumentData.step6.altStrategies[strategyIndex].data[rowIndex].symbol = newSymbol;
                DocumentData.step6.altStrategies[strategyIndex].data[rowIndex].color = newColor;
                DocumentData.step6.altStrategies[strategyIndex].data[rowIndex].bullCase = newBullCase;
                DocumentData.step6.altStrategies[strategyIndex].data[rowIndex].bearCase = newBearCase;
                
                // Save to localStorage
                localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                
                // Re-render section
                populateSectionFive(DocumentData.step6);
                
                // Show success message
                showToast('CIO View updated successfully!');
                
                // Close dialog
                document.body.removeChild(overlay);
            });
            
            // Handle cancel
            document.getElementById('cancelCIOViewBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            // Close on Escape
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.body.removeChild(overlay);
                }
            });
            
            // Close on overlay click
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                }
            });
            
            // Save on Ctrl+Enter in textareas
            const textareas = dialog.querySelectorAll('textarea');
            textareas.forEach(textarea => {
                textarea.addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.key === 'Enter') {
                        document.getElementById('saveCIOViewBtn').click();
                    }
                });
            });
        }
        
        function showCIOViewFootnoteEditDialog(strategyIndex) {
            const strategyData = DocumentData.step6.altStrategies[strategyIndex];
            if (!strategyData) return;
            
            // Create overlay
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            // Create dialog
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white;
                border-radius: 8px;
                padding: 24px;
                width: 90%;
                max-width: 700px;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Edit Footnote - ${strategyData.title}</h3>
                
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="cioViewFootnote">Footnote Text</label>
                    <textarea 
                        id="cioViewFootnote" 
                        class="edit-dialog-input" 
                        rows="6"
                        placeholder="Enter footnote text"
                    >${strategyData.footnote || ''}</textarea>
                    <p style="margin-top: 8px; font-size: 12px; color: #666;">
                        Note: "Bull case" and "Bear case" will be automatically bolded when displayed.
                    </p>
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancelFootnoteBtn" class="edit-dialog-btn-secondary">Cancel</button>
                    <button id="saveFootnoteBtn" class="edit-dialog-btn-primary">Save</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            // Focus on textarea
            const textarea = document.getElementById('cioViewFootnote');
            textarea.focus();
            textarea.setSelectionRange(textarea.value.length, textarea.value.length);
            
            // Handle save
            document.getElementById('saveFootnoteBtn').addEventListener('click', () => {
                const newFootnote = document.getElementById('cioViewFootnote').value.trim();
                
                // Update data
                DocumentData.step6.altStrategies[strategyIndex].footnote = newFootnote;
                
                // Save to localStorage
                localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                
                // Re-render section
                populateSectionFive(DocumentData.step6);
                
                // Show success message
                showToast('Footnote updated successfully!');
                
                // Close dialog
                document.body.removeChild(overlay);
            });
            
            // Handle cancel
            document.getElementById('cancelFootnoteBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            // Close on Escape
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.body.removeChild(overlay);
                }
            });
            
            // Close on overlay click
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                }
            });
            
            // Save on Ctrl+Enter
            textarea.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'Enter') {
                    document.getElementById('saveFootnoteBtn').click();
                }
            });
        }
        
        function makeAltBoxEditable() {
            const altBoxContainer = document.getElementById('s5AltBox');
            if (!altBoxContainer) return;
            
            // Check if already initialized to prevent duplicate listeners
            if (altBoxContainer.dataset.editable === 'true') return;
            altBoxContainer.dataset.editable = 'true';
            
            altBoxContainer.style.cursor = 'pointer';
            altBoxContainer.title = 'Double-click to edit';
            
            altBoxContainer.addEventListener('dblclick', function(e) {
                e.stopPropagation();
                showAltBoxEditDialog();
            });
        }
        
        function showAltBoxEditDialog() {
            const containerData = DocumentData.step6.container;
            
            // Create overlay
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            // Create dialog
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white;
                border-radius: 8px;
                padding: 24px;
                width: 90%;
                max-width: 700px;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Edit Alternative Investments Content</h3>
                
                <div style="margin-bottom: 16px;">
                    <label class="edit-dialog-label" for="altContent">Main Content</label>
                    <textarea 
                        id="altContent" 
                        class="edit-dialog-input" 
                        rows="4"
                        placeholder="Enter main content"
                    >${containerData.content || ''}</textarea>
                </div>
                
                <div style="margin-bottom: 16px;">
                    <label class="edit-dialog-label" for="altPrinciple1">Principle 1: Think strategically and long-term</label>
                    <textarea 
                        id="altPrinciple1" 
                        class="edit-dialog-input" 
                        rows="2"
                        placeholder="Enter principle 1"
                    >${containerData.data[0] || ''}</textarea>
                </div>
                
                <div style="margin-bottom: 16px;">
                    <label class="edit-dialog-label" for="altPrinciple2">Principle 2: Invest methodically, including in downturns</label>
                    <textarea 
                        id="altPrinciple2" 
                        class="edit-dialog-input" 
                        rows="2"
                        placeholder="Enter principle 2"
                    >${containerData.data[1] || ''}</textarea>
                </div>
                
                <div style="margin-bottom: 16px;">
                    <label class="edit-dialog-label" for="altPrinciple3">Principle 3: Diversify</label>
                    <textarea 
                        id="altPrinciple3" 
                        class="edit-dialog-input" 
                        rows="2"
                        placeholder="Enter principle 3"
                    >${containerData.data[2] || ''}</textarea>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="altPrinciple4">Principle 4: Prioritize high-conviction managers</label>
                    <textarea 
                        id="altPrinciple4" 
                        class="edit-dialog-input" 
                        rows="2"
                        placeholder="Enter principle 4"
                    >${containerData.data[3] || ''}</textarea>
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancelAltBoxBtn" class="edit-dialog-btn-secondary">Cancel</button>
                    <button id="saveAltBoxBtn" class="edit-dialog-btn-primary">Save</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            // Focus on first textarea
            const contentTextarea = document.getElementById('altContent');
            contentTextarea.focus();
            
            // Handle save
            document.getElementById('saveAltBoxBtn').addEventListener('click', () => {
                const newContent = document.getElementById('altContent').value.trim();
                const newPrinciple1 = document.getElementById('altPrinciple1').value.trim();
                const newPrinciple2 = document.getElementById('altPrinciple2').value.trim();
                const newPrinciple3 = document.getElementById('altPrinciple3').value.trim();
                const newPrinciple4 = document.getElementById('altPrinciple4').value.trim();
                
                // Update data
                DocumentData.step6.container.content = newContent;
                DocumentData.step6.container.data[0] = newPrinciple1;
                DocumentData.step6.container.data[1] = newPrinciple2;
                DocumentData.step6.container.data[2] = newPrinciple3;
                DocumentData.step6.container.data[3] = newPrinciple4;
                
                // Save to localStorage
                localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                
                // Re-render section
                populateSectionFive(DocumentData.step6);
                
                // Show success message
                showToast('Alternative Investments content updated successfully!');
                
                // Close dialog
                document.body.removeChild(overlay);
            });
            
            // Handle cancel
            document.getElementById('cancelAltBoxBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            // Close on Escape
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.body.removeChild(overlay);
                }
            });
            
            // Close on overlay click
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                }
            });
            
            // Save on Ctrl+Enter in any textarea
            const textareas = dialog.querySelectorAll('textarea');
            textareas.forEach(textarea => {
                textarea.addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.key === 'Enter') {
                        document.getElementById('saveAltBoxBtn').click();
                    }
                });
            });
        }
        
        function makeSectionFiveSubsectionsEditable() {
            const subsectionContainer = document.getElementById('s5Subsection');
            if (!subsectionContainer) return;
            
            // Check if already initialized to prevent duplicate listeners
            if (subsectionContainer.dataset.editable === 'true') return;
            subsectionContainer.dataset.editable = 'true';
            
            // Event delegation for subsection items
            subsectionContainer.addEventListener('dblclick', function(e) {
                const subsectionDiv = e.target.closest('.mb-4');
                if (!subsectionDiv) return;
                
                const subsectionIndex = Array.from(subsectionContainer.children).indexOf(subsectionDiv);
                showSectionFiveSubsectionEditDialog(subsectionIndex);
            });
            
            // Add hover effect
            const style = document.createElement('style');
            style.id = 'section-five-subsection-style';
            if (!document.getElementById('section-five-subsection-style')) {
                style.textContent = `
                    #s5Subsection > .mb-4 {
                        cursor: pointer;
                        transition: background-color 0.2s;
                        padding: 8px;
                        border-radius: 4px;
                    }
                    #s5Subsection > .mb-4:hover {
                        background-color: #f3f4f6;
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        function showSectionFiveSubsectionEditDialog(subsectionIndex) {
            const subsectionData = DocumentData.step6.subsection[subsectionIndex];
            if (!subsectionData) return;
            
            // Create overlay
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            // Create dialog
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white;
                border-radius: 8px;
                padding: 24px;
                width: 90%;
                max-width: 600px;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Edit Subsection</h3>
                
                <div style="margin-bottom: 16px;">
                    <label class="edit-dialog-label" for="s5SubsectionHeading">Heading</label>
                    <input 
                        type="text" 
                        id="s5SubsectionHeading" 
                        class="edit-dialog-input" 
                        value="${subsectionData.heading || ''}"
                        placeholder="Enter heading"
                    />
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="s5SubsectionContent">Content</label>
                    <textarea 
                        id="s5SubsectionContent" 
                        class="edit-dialog-input" 
                        rows="8"
                        placeholder="Enter content"
                    >${subsectionData.content || ''}</textarea>
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancelS5SubsectionBtn" class="edit-dialog-btn-secondary">Cancel</button>
                    <button id="saveS5SubsectionBtn" class="edit-dialog-btn-primary">Save</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            // Focus on heading input
            const headingInput = document.getElementById('s5SubsectionHeading');
            headingInput.focus();
            
            // Handle save
            document.getElementById('saveS5SubsectionBtn').addEventListener('click', () => {
                const newHeading = document.getElementById('s5SubsectionHeading').value.trim();
                const newContent = document.getElementById('s5SubsectionContent').value.trim();
                
                // Update data
                DocumentData.step6.subsection[subsectionIndex].heading = newHeading;
                DocumentData.step6.subsection[subsectionIndex].content = newContent;
                
                // Save to localStorage
                localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                
                // Re-render subsections
                populateSectionFive(DocumentData.step6);
                
                // Show success message
                showToast('Subsection updated successfully!');
                
                // Close dialog
                document.body.removeChild(overlay);
            });
            
            // Handle cancel
            document.getElementById('cancelS5SubsectionBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            // Close on Escape
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.body.removeChild(overlay);
                }
            });
            
            // Close on overlay click
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                }
            });
            
            // Save on Ctrl+Enter in textarea
            const contentTextarea = document.getElementById('s5SubsectionContent');
            contentTextarea.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'Enter') {
                    document.getElementById('saveS5SubsectionBtn').click();
                }
            });
        }

        // ========================================
        // SECTION 6 EDITING FUNCTIONALITY
        // ========================================
        
        function makeSectionSixEditable() {
            // Make title editable
            const titleEl = document.getElementById('s6Title');
            if (titleEl && !titleEl.dataset.editable) {
                titleEl.dataset.editable = 'true';
                titleEl.style.cursor = 'pointer';
                titleEl.title = 'Double-click to edit';
                titleEl.addEventListener('dblclick', function(e) {
                    e.stopPropagation();
                    const currentText = this.textContent;
                    showEditDialog(this, currentText, 'step7.title', false);
                });
            }
            
            // Make main table editable
            makeTable1Editable();
            
            // Make sidebar title and content editable
            makeSidebarEditable();
            
            // Make second table editable
            makeTable2Editable();
        }
        
        function makeTable1Editable() {
            const table1Body = document.getElementById('s6T1Body');
            if (!table1Body) return;
            
            // Check if already initialized
            if (table1Body.dataset.editable === 'true') return;
            table1Body.dataset.editable = 'true';
            
            // Event delegation for table cells
            table1Body.addEventListener('dblclick', function(e) {
                const cell = e.target.closest('td');
                if (!cell) return;
                
                const row = cell.closest('tr');
                const rowIndex = Array.from(table1Body.children).indexOf(row);
                const cellIndex = Array.from(row.children).indexOf(cell);
                
                showTable1CellEditDialog(rowIndex, cellIndex);
            });
            
            // Make table headers editable
            const table1Header = document.getElementById('s6T1Header');
            if (table1Header && !table1Header.dataset.editable) {
                table1Header.dataset.editable = 'true';
                
                table1Header.addEventListener('dblclick', function(e) {
                    const th = e.target.closest('th');
                    if (!th) return;
                    
                    const headerIndex = Array.from(table1Header.querySelectorAll('th')).indexOf(th);
                    showTable1HeaderEditDialog(headerIndex);
                });
            }
            
            // Make table footnote editable
            const footnoteEl = document.getElementById('s6T1Footnote');
            if (footnoteEl && !footnoteEl.dataset.editable) {
                footnoteEl.dataset.editable = 'true';
                footnoteEl.style.cursor = 'pointer';
                footnoteEl.title = 'Double-click to edit';
                footnoteEl.addEventListener('dblclick', function(e) {
                    e.stopPropagation();
                    const currentText = this.textContent;
                    showEditDialog(this, currentText, 'step7.tableData.footnote', true);
                });
            }
            
            // Add hover styles
            const styleId = 's6-table1-style';
            if (!document.getElementById(styleId)) {
                const style = document.createElement('style');
                style.id = styleId;
                style.textContent = `
                    #s6T1Body td {
                        cursor: pointer;
                        transition: background-color 0.2s;
                    }
                    #s6T1Body td:hover {
                        background-color: #e3f2fd !important;
                    }
                    #s6T1Header th {
                        cursor: pointer;
                        transition: background-color 0.2s;
                    }
                    #s6T1Header th:hover {
                        background-color: #fff3cd;
                    }
                    #s6T1Footnote:hover {
                        background-color: #fff3cd;
                        border-radius: 4px;
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        function showTable1HeaderEditDialog(headerIndex) {
            const currentValue = DocumentData.step7.tableData.header[headerIndex];
            
            // Create overlay
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            // Create dialog
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white;
                border-radius: 8px;
                padding: 24px;
                width: 90%;
                max-width: 500px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Edit Table Header</h3>
                
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="table1Header">Header Text</label>
                    <input 
                        type="text" 
                        id="table1Header" 
                        class="edit-dialog-input" 
                        value="${currentValue || ''}"
                        placeholder="Enter header text"
                    />
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancelTable1HeaderBtn" class="edit-dialog-btn-secondary">Cancel</button>
                    <button id="saveTable1HeaderBtn" class="edit-dialog-btn-primary">Save</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            // Focus on input
            const input = document.getElementById('table1Header');
            input.focus();
            input.select();
            
            // Handle save
            document.getElementById('saveTable1HeaderBtn').addEventListener('click', () => {
                const newValue = document.getElementById('table1Header').value.trim();
                
                // Update data
                DocumentData.step7.tableData.header[headerIndex] = newValue;
                
                // Save to localStorage
                localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                
                // Re-render section
                populateSectionSix(DocumentData.step7);
                
                // Show success message
                showToast('Table header updated successfully!');
                
                // Close dialog
                document.body.removeChild(overlay);
            });
            
            // Handle cancel
            document.getElementById('cancelTable1HeaderBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            // Close on Escape
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.body.removeChild(overlay);
                }
            });
            
            // Close on overlay click
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                }
            });
            
            // Save on Enter
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    document.getElementById('saveTable1HeaderBtn').click();
                }
            });
        }
        
        function showTable1CellEditDialog(rowIndex, cellIndex) {
            const rowData = DocumentData.step7.tableData.data[rowIndex];
            if (!rowData) return;
            
            const currentValue = rowData[cellIndex];
            const isFirstColumn = cellIndex === 0;
            
            // Create overlay
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            // Create dialog
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white;
                border-radius: 8px;
                padding: 24px;
                width: 90%;
                max-width: 500px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            const columnName = DocumentData.step7.tableData.header[cellIndex - 1] || 'Label';
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Edit Cell - ${isFirstColumn ? 'Row Label' : columnName}</h3>
                
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="table1Cell">Value</label>
                    ${isFirstColumn ? 
                        `<textarea 
                            id="table1Cell" 
                            class="edit-dialog-input" 
                            rows="3"
                            placeholder="Enter value"
                        >${currentValue || ''}</textarea>` :
                        `<input 
                            type="text" 
                            id="table1Cell" 
                            class="edit-dialog-input" 
                            value="${currentValue || ''}"
                            placeholder="Enter value"
                        />`
                    }
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancelTable1CellBtn" class="edit-dialog-btn-secondary">Cancel</button>
                    <button id="saveTable1CellBtn" class="edit-dialog-btn-primary">Save</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            // Focus on input
            const input = document.getElementById('table1Cell');
            input.focus();
            if (input.tagName === 'INPUT') {
                input.select();
            } else {
                input.setSelectionRange(input.value.length, input.value.length);
            }
            
            // Handle save
            document.getElementById('saveTable1CellBtn').addEventListener('click', () => {
                const newValue = document.getElementById('table1Cell').value.trim();
                
                // Update data
                DocumentData.step7.tableData.data[rowIndex][cellIndex] = newValue;
                
                // Save to localStorage
                localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                
                // Re-render section
                populateSectionSix(DocumentData.step7);
                
                // Show success message
                showToast('Table cell updated successfully!');
                
                // Close dialog
                document.body.removeChild(overlay);
            });
            
            // Handle cancel
            document.getElementById('cancelTable1CellBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            // Close on Escape
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.body.removeChild(overlay);
                }
            });
            
            // Close on overlay click
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                }
            });
            
            // Save on Ctrl+Enter or Enter
            input.addEventListener('keydown', (e) => {
                if ((e.ctrlKey && e.key === 'Enter') || (e.key === 'Enter' && input.tagName === 'INPUT')) {
                    e.preventDefault();
                    document.getElementById('saveTable1CellBtn').click();
                }
            });
        }
        
        function makeSidebarEditable() {
            // Make sidebar title editable
            const sidebarTitleEl = document.getElementById('s6SidebarTitle');
            if (sidebarTitleEl && !sidebarTitleEl.dataset.editable) {
                sidebarTitleEl.dataset.editable = 'true';
                sidebarTitleEl.style.cursor = 'pointer';
                sidebarTitleEl.title = 'Double-click to edit';
                sidebarTitleEl.addEventListener('dblclick', function(e) {
                    e.stopPropagation();
                    const currentText = this.textContent;
                    showEditDialog(this, currentText, 'step7.rightContainer.title', false);
                });
            }
            
            // Make sidebar content editable
            const sidebarContentEl = document.getElementById('s6SidebarContent');
            if (sidebarContentEl && !sidebarContentEl.dataset.editable) {
                sidebarContentEl.dataset.editable = 'true';
                sidebarContentEl.style.cursor = 'pointer';
                sidebarContentEl.title = 'Double-click to edit';
                sidebarContentEl.addEventListener('dblclick', function(e) {
                    e.stopPropagation();
                    const currentText = this.innerHTML.replace(/<br\s*\/?>/gi, '\n').replace(/<[^>]*>/g, '');
                    showEditDialog(this, currentText, 'step7.rightContainer.content', true);
                });
            }
            
            // Add hover styles
            const styleId = 's6-sidebar-style';
            if (!document.getElementById(styleId)) {
                const style = document.createElement('style');
                style.id = styleId;
                style.textContent = `
                    #s6SidebarTitle:hover,
                    #s6SidebarContent:hover {
                        background-color: #f3f4f6;
                        border-radius: 4px;
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        function makeTable2Editable() {
            const table2Body = document.getElementById('s6T2Body');
            if (!table2Body) return;
            
            // Check if already initialized
            if (table2Body.dataset.editable === 'true') return;
            table2Body.dataset.editable = 'true';
            
            // Event delegation for table cells
            table2Body.addEventListener('dblclick', function(e) {
                const cell = e.target.closest('td');
                if (!cell) return;
                
                const row = cell.closest('tr');
                const rowIndex = Array.from(table2Body.children).indexOf(row);
                const cellIndex = Array.from(row.children).indexOf(cell);
                
                showTable2CellEditDialog(rowIndex, cellIndex);
            });
            
            // Make table headers editable
            const table2Header = document.getElementById('s6T2Header');
            if (table2Header && !table2Header.dataset.editable) {
                table2Header.dataset.editable = 'true';
                
                table2Header.addEventListener('dblclick', function(e) {
                    const th = e.target.closest('th');
                    if (!th) return;
                    
                    const allHeaders = Array.from(table2Header.querySelectorAll('th'));
                    const headerIndex = allHeaders.indexOf(th);
                    
                    // Determine if it's main header or subheader
                    const firstRowHeaders = Array.from(table2Header.querySelectorAll('tr:first-child th'));
                    const isMainHeader = firstRowHeaders.includes(th);
                    
                    if (isMainHeader) {
                        const mainHeaderIndex = firstRowHeaders.indexOf(th);
                        showTable2MainHeaderEditDialog(mainHeaderIndex);
                    } else {
                        // It's a subheader
                        const subheaderIndex = headerIndex - firstRowHeaders.length;
                        showTable2SubheaderEditDialog(subheaderIndex);
                    }
                });
            }
            
            // Make table footnote editable
            const footnoteEl = document.getElementById('s6T2Footnote');
            if (footnoteEl && !footnoteEl.dataset.editable) {
                footnoteEl.dataset.editable = 'true';
                footnoteEl.style.cursor = 'pointer';
                footnoteEl.title = 'Double-click to edit';
                footnoteEl.addEventListener('dblclick', function(e) {
                    e.stopPropagation();
                    const currentText = this.textContent;
                    showEditDialog(this, currentText, 'step7.rightContainer.tableData.footnote', true);
                });
            }
            
            // Add hover styles
            const styleId = 's6-table2-style';
            if (!document.getElementById(styleId)) {
                const style = document.createElement('style');
                style.id = styleId;
                style.textContent = `
                    #s6T2Body td {
                        cursor: pointer;
                        transition: background-color 0.2s;
                    }
                    #s6T2Body td:hover {
                        background-color: #e3f2fd !important;
                    }
                    #s6T2Header th {
                        cursor: pointer;
                        transition: background-color 0.2s;
                    }
                    #s6T2Header th:hover {
                        background-color: #fff3cd;
                    }
                    #s6T2Footnote:hover {
                        background-color: #fff3cd;
                        border-radius: 4px;
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        function showTable2MainHeaderEditDialog(headerIndex) {
            const currentValue = DocumentData.step7.rightContainer.tableData.header[headerIndex];
            
            // Create overlay
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            // Create dialog
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white;
                border-radius: 8px;
                padding: 24px;
                width: 90%;
                max-width: 500px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Edit Main Header</h3>
                
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="table2MainHeader">Header Text</label>
                    <input 
                        type="text" 
                        id="table2MainHeader" 
                        class="edit-dialog-input" 
                        value="${currentValue || ''}"
                        placeholder="Enter header text"
                    />
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancelTable2MainHeaderBtn" class="edit-dialog-btn-secondary">Cancel</button>
                    <button id="saveTable2MainHeaderBtn" class="edit-dialog-btn-primary">Save</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            // Focus on input
            const input = document.getElementById('table2MainHeader');
            input.focus();
            input.select();
            
            // Handle save
            document.getElementById('saveTable2MainHeaderBtn').addEventListener('click', () => {
                const newValue = document.getElementById('table2MainHeader').value.trim();
                
                // Update data
                DocumentData.step7.rightContainer.tableData.header[headerIndex] = newValue;
                
                // Save to localStorage
                localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                
                // Re-render section
                populateSectionSix(DocumentData.step7);
                
                // Show success message
                showToast('Main header updated successfully!');
                
                // Close dialog
                document.body.removeChild(overlay);
            });
            
            // Handle cancel
            document.getElementById('cancelTable2MainHeaderBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            // Close on Escape
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.body.removeChild(overlay);
                }
            });
            
            // Close on overlay click
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                }
            });
            
            // Save on Enter
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    document.getElementById('saveTable2MainHeaderBtn').click();
                }
            });
        }
        
        function showTable2SubheaderEditDialog(subheaderIndex) {
            const currentValue = DocumentData.step7.rightContainer.tableData.subheader[subheaderIndex];
            
            // Create overlay
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            // Create dialog
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white;
                border-radius: 8px;
                padding: 24px;
                width: 90%;
                max-width: 500px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Edit Subheader</h3>
                
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="table2Subheader">Subheader Text</label>
                    <input 
                        type="text" 
                        id="table2Subheader" 
                        class="edit-dialog-input" 
                        value="${currentValue || ''}"
                        placeholder="Enter subheader text"
                    />
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancelTable2SubheaderBtn" class="edit-dialog-btn-secondary">Cancel</button>
                    <button id="saveTable2SubheaderBtn" class="edit-dialog-btn-primary">Save</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            // Focus on input
            const input = document.getElementById('table2Subheader');
            input.focus();
            input.select();
            
            // Handle save
            document.getElementById('saveTable2SubheaderBtn').addEventListener('click', () => {
                const newValue = document.getElementById('table2Subheader').value.trim();
                
                // Update data
                DocumentData.step7.rightContainer.tableData.subheader[subheaderIndex] = newValue;
                
                // Save to localStorage
                localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                
                // Re-render section
                populateSectionSix(DocumentData.step7);
                
                // Show success message
                showToast('Subheader updated successfully!');
                
                // Close dialog
                document.body.removeChild(overlay);
            });
            
            // Handle cancel
            document.getElementById('cancelTable2SubheaderBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            // Close on Escape
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.body.removeChild(overlay);
                }
            });
            
            // Close on overlay click
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                }
            });
            
            // Save on Enter
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    document.getElementById('saveTable2SubheaderBtn').click();
                }
            });
        }
        
        function showTable2CellEditDialog(rowIndex, cellIndex) {
            const rowData = DocumentData.step7.rightContainer.tableData.data[rowIndex];
            if (!rowData) return;
            
            const currentValue = rowData[cellIndex];
            const isFirstColumn = cellIndex === 0;
            
            // Create overlay
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            // Create dialog
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white;
                border-radius: 8px;
                padding: 24px;
                width: 90%;
                max-width: 500px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            const columnName = isFirstColumn ? 'EPS Label' : DocumentData.step7.rightContainer.tableData.subheader[cellIndex - 1];
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Edit Cell - ${columnName}</h3>
                
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="table2Cell">Value</label>
                    <input 
                        type="text" 
                        id="table2Cell" 
                        class="edit-dialog-input" 
                        value="${currentValue || ''}"
                        placeholder="Enter value"
                    />
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancelTable2CellBtn" class="edit-dialog-btn-secondary">Cancel</button>
                    <button id="saveTable2CellBtn" class="edit-dialog-btn-primary">Save</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            // Focus on input
            const input = document.getElementById('table2Cell');
            input.focus();
            input.select();
            
            // Handle save
            document.getElementById('saveTable2CellBtn').addEventListener('click', () => {
                const newValue = document.getElementById('table2Cell').value.trim();
                
                // Update data
                DocumentData.step7.rightContainer.tableData.data[rowIndex][cellIndex] = newValue;
                
                // Save to localStorage
                localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                
                // Re-render section
                populateSectionSix(DocumentData.step7);
                
                // Show success message
                showToast('Table cell updated successfully!');
                
                // Close dialog
                document.body.removeChild(overlay);
            });
            
            // Handle cancel
            document.getElementById('cancelTable2CellBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            // Close on Escape
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.body.removeChild(overlay);
                }
            });
            
            // Close on overlay click
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                }
            });
            
            // Save on Enter
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    document.getElementById('saveTable2CellBtn').click();
                }
            });
        }

        // ========================================
        // SECTION 7 EDITING FUNCTIONALITY
        // ========================================
        
        function makeSectionSevenEditable() {
            // Make title editable
            const titleEl = document.getElementById('s7Title');
            if (titleEl && !titleEl.dataset.editable) {
                titleEl.dataset.editable = 'true';
                titleEl.style.cursor = 'pointer';
                titleEl.title = 'Double-click to edit';
                titleEl.addEventListener('dblclick', function(e) {
                    e.stopPropagation();
                    const currentText = this.textContent;
                    showEditDialog(this, currentText, 'step8.title', false);
                });
            }
            
            // Make footnote editable
            const footnoteEl = document.getElementById('s7Footnote');
            if (footnoteEl && !footnoteEl.dataset.editable) {
                footnoteEl.dataset.editable = 'true';
                footnoteEl.style.cursor = 'pointer';
                footnoteEl.title = 'Double-click to edit';
                footnoteEl.addEventListener('dblclick', function(e) {
                    e.stopPropagation();
                    const currentText = this.textContent;
                    showEditDialog(this, currentText, 'step8.footnote', true);
                });
            }
            
            // Make table rows editable
            makeSection7TableEditable();
            
            // Add hover styles
            const styleId = 's7-edit-style';
            if (!document.getElementById(styleId)) {
                const style = document.createElement('style');
                style.id = styleId;
                style.textContent = `
                    #s7Title:hover,
                    #s7Footnote:hover {
                        background-color: #f3f4f6;
                        border-radius: 4px;
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        function makeSection7TableEditable() {
            const tableBody = document.getElementById('s7TableBody');
            if (!tableBody) return;
            
            // Check if already initialized
            if (tableBody.dataset.editable === 'true') return;
            tableBody.dataset.editable = 'true';
            
            // Event delegation for entire rows
            tableBody.addEventListener('dblclick', function(e) {
                // Check if clicked on weight indicator dots - if so, don't open row editor
                if (e.target.closest('.weight-dot')) return;
                
                const row = e.target.closest('tr');
                if (!row) return;
                
                const rowIndex = Array.from(tableBody.children).indexOf(row);
                showSection7RowEditDialog(rowIndex);
            });
            
            // Add hover styles
            const styleId = 's7-table-style';
            if (!document.getElementById(styleId)) {
                const style = document.createElement('style');
                style.id = styleId;
                style.textContent = `
                    #s7TableBody tr {
                        cursor: pointer;
                        transition: background-color 0.2s;
                    }
                    #s7TableBody tr:hover {
                        background-color: #f9fafb;
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        function showSection7RowEditDialog(rowIndex) {
            const rowData = DocumentData.step8.data[rowIndex];
            if (!rowData) return;
            
            // Create overlay
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            // Create dialog
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white;
                border-radius: 8px;
                padding: 24px;
                width: 90%;
                max-width: 700px;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Edit Asset Class Row</h3>
                
                <div style="margin-bottom: 16px;">
                    <label class="edit-dialog-label" for="s7AssetClass">Asset Class</label>
                    <input 
                        type="text" 
                        id="s7AssetClass" 
                        class="edit-dialog-input" 
                        value="${rowData.assetClass || ''}"
                        placeholder="Enter asset class name"
                    />
                </div>
                
                <div style="margin-bottom: 16px;">
                    <label class="edit-dialog-label" for="s7Position">Position (Weight Value)</label>
                    <select 
                        id="s7Position" 
                        class="edit-dialog-input"
                        style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px;"
                    >
                        <option value="-1" ${rowData.position === -1 ? 'selected' : ''}>Hide (value -1)</option>
                        <option value="1" ${rowData.position === 1 ? 'selected' : ''}>1 (Underweight)</option>
                        <option value="2" ${rowData.position === 2 ? 'selected' : ''}>2 (Underweight)</option>
                        <option value="3" ${rowData.position === 3 ? 'selected' : ''}>3 (Neutral)</option>
                        <option value="4" ${rowData.position === 4 ? 'selected' : ''}>4 (Overweight)</option>
                        <option value="5" ${rowData.position === 5 ? 'selected' : ''}>5 (Overweight)</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 16px;">
                    <label class="edit-dialog-label" for="s7Trend">Trend</label>
                    <select 
                        id="s7Trend" 
                        class="edit-dialog-input"
                        style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px;"
                    >
                        <option value="0" ${(rowData.trend === undefined || rowData.trend === 0) ? 'selected' : ''}>No Trend (0)</option>
                        <option value="1" ${rowData.trend === 1 ? 'selected' : ''}>Upward Trend (1)</option>
                        <option value="-1" ${rowData.trend === -1 ? 'selected' : ''}>Downward Trend (-1)</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 16px;">
                    <label class="edit-dialog-label" for="s7Comments">Comments</label>
                    <textarea 
                        id="s7Comments" 
                        class="edit-dialog-input" 
                        rows="4"
                        placeholder="Enter comments"
                    >${rowData.comments || ''}</textarea>
                </div>
                
                <div style="margin-bottom: 16px;">
                    <label class="edit-dialog-label" for="s7Separate">Separate (Show border above this row)</label>
                    <select 
                        id="s7Separate" 
                        class="edit-dialog-input"
                        style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px;"
                    >
                        <option value="0" ${rowData.separate === 0 ? 'selected' : ''}>No (0)</option>
                        <option value="1" ${rowData.separate === 1 ? 'selected' : ''}>Yes (1)</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="s7Merge">Merge (0 or 1)</label>
                    <select 
                        id="s7Merge" 
                        class="edit-dialog-input"
                        style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px;"
                    >
                        <option value="0" ${rowData.merge === 0 ? 'selected' : ''}>0</option>
                        <option value="1" ${rowData.merge === 1 ? 'selected' : ''}>1</option>
                    </select>
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancelS7RowBtn" class="edit-dialog-btn-secondary">Cancel</button>
                    <button id="saveS7RowBtn" class="edit-dialog-btn-primary">Save</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            // Focus on first input
            const input = document.getElementById('s7AssetClass');
            input.focus();
            input.select();
            
            // Handle save
            document.getElementById('saveS7RowBtn').addEventListener('click', () => {
                const newAssetClass = document.getElementById('s7AssetClass').value.trim();
                const newPosition = parseInt(document.getElementById('s7Position').value);
                const newTrend = parseInt(document.getElementById('s7Trend').value);
                const newComments = document.getElementById('s7Comments').value.trim();
                const newSeparate = parseInt(document.getElementById('s7Separate').value);
                const newMerge = parseInt(document.getElementById('s7Merge').value);
                
                // Update weight based on position
                let newWeight = 'neutral';
                if (newPosition === -1) {
                    newWeight = 'none';
                } else if (newPosition <= 2) {
                    newWeight = 'underweight';
                } else if (newPosition === 3) {
                    newWeight = 'neutral';
                } else {
                    newWeight = 'overweight';
                }
                
                // Update data
                DocumentData.step8.data[rowIndex].assetClass = newAssetClass;
                DocumentData.step8.data[rowIndex].position = newPosition;
                DocumentData.step8.data[rowIndex].trend = newTrend;
                DocumentData.step8.data[rowIndex].weight = newWeight;
                DocumentData.step8.data[rowIndex].comments = newComments;
                DocumentData.step8.data[rowIndex].separate = newSeparate;
                DocumentData.step8.data[rowIndex].merge = newMerge;
                
                // Save to localStorage
                localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                
                // Re-render section
                populateSectionSeven(DocumentData.step8);
                
                // Show success message
                showToast('Asset class row updated successfully!');
                
                // Close dialog
                document.body.removeChild(overlay);
            });
            
            // Handle cancel
            document.getElementById('cancelS7RowBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            // Close on Escape
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.body.removeChild(overlay);
                }
            });
            
            // Close on overlay click
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                }
            });
            
            // Save on Ctrl+Enter in textarea
            const textarea = document.getElementById('s7Comments');
            textarea.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'Enter') {
                    document.getElementById('saveS7RowBtn').click();
                }
            });
        }

        // ============================================
        // Section 8: CIO EQUITY SECTOR VIEWS Editing
        // ============================================
        
        function makeSectionEightEditable() {
            // Make title editable
            const titleEl = document.getElementById('s8Title');
            if (titleEl && !titleEl.dataset.editable) {
                titleEl.dataset.editable = 'true';
                titleEl.style.cursor = 'pointer';
                titleEl.title = 'Double-click to edit';
                
                titleEl.addEventListener('dblclick', function() {
                    showSection8TitleEditDialog();
                });
            }
            
            // Make content editable
            const contentEl = document.getElementById('s8Content');
            if (contentEl && !contentEl.dataset.editable) {
                contentEl.dataset.editable = 'true';
                contentEl.style.cursor = 'pointer';
                contentEl.title = 'Double-click to edit';
                
                contentEl.addEventListener('dblclick', function() {
                    showSection8ContentEditDialog();
                });
            }
            
            // Make footnote editable
            const footnoteEl = document.getElementById('s8Footnote');
            if (footnoteEl && !footnoteEl.dataset.editable) {
                footnoteEl.dataset.editable = 'true';
                footnoteEl.style.cursor = 'pointer';
                footnoteEl.title = 'Double-click to edit';
                
                footnoteEl.addEventListener('dblclick', function() {
                    showSection8FootnoteEditDialog();
                });
            }
            
            // Make table rows editable
            makeSection8TableEditable();
        }
        
        function showSection8TitleEditDialog() {
            const currentValue = DocumentData.step9.title;
            
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0, 0, 0, 0.5); display: flex;
                align-items: center; justify-content: center; z-index: 10000;
            `;
            
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white; border-radius: 8px; padding: 24px;
                width: 90%; max-width: 600px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Edit Section Title</h3>
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="s8TitleInput">Title</label>
                    <input type="text" id="s8TitleInput" class="edit-dialog-input" 
                           value="${currentValue || ''}" placeholder="Enter section title" />
                </div>
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancelS8TitleBtn" class="edit-dialog-btn-secondary">Cancel</button>
                    <button id="saveS8TitleBtn" class="edit-dialog-btn-primary">Save</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            const input = document.getElementById('s8TitleInput');
            input.focus();
            input.select();
            
            document.getElementById('saveS8TitleBtn').addEventListener('click', () => {
                DocumentData.step9.title = input.value.trim();
                localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                populateSectionEight(DocumentData.step9);
                makeSectionEightEditable();
                showToast('Section title updated successfully!');
                document.body.removeChild(overlay);
            });
            
            document.getElementById('cancelS8TitleBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') document.body.removeChild(overlay);
                if (e.key === 'Enter') document.getElementById('saveS8TitleBtn').click();
            });
            
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) document.body.removeChild(overlay);
            });
        }
        
        function showSection8ContentEditDialog() {
            const currentValue = DocumentData.step9.content;
            
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0, 0, 0, 0.5); display: flex;
                align-items: center; justify-content: center; z-index: 10000;
            `;
            
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white; border-radius: 8px; padding: 24px;
                width: 90%; max-width: 700px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Edit Content</h3>
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="s8ContentInput">Content</label>
                    <textarea id="s8ContentInput" class="edit-dialog-input" rows="8" 
                              placeholder="Enter section content">${currentValue || ''}</textarea>
                </div>
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancelS8ContentBtn" class="edit-dialog-btn-secondary">Cancel</button>
                    <button id="saveS8ContentBtn" class="edit-dialog-btn-primary">Save</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            const textarea = document.getElementById('s8ContentInput');
            textarea.focus();
            textarea.setSelectionRange(textarea.value.length, textarea.value.length);
            
            document.getElementById('saveS8ContentBtn').addEventListener('click', () => {
                DocumentData.step9.content = textarea.value.trim();
                localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                populateSectionEight(DocumentData.step9);
                makeSectionEightEditable();
                showToast('Content updated successfully!');
                document.body.removeChild(overlay);
            });
            
            document.getElementById('cancelS8ContentBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') document.body.removeChild(overlay);
                if (e.ctrlKey && e.key === 'Enter') document.getElementById('saveS8ContentBtn').click();
            });
            
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) document.body.removeChild(overlay);
            });
        }
        
        function showSection8FootnoteEditDialog() {
            const currentValue = DocumentData.step9.footnote;
            
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0, 0, 0, 0.5); display: flex;
                align-items: center; justify-content: center; z-index: 10000;
            `;
            
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white; border-radius: 8px; padding: 24px;
                width: 90%; max-width: 600px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Edit Footnote</h3>
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="s8FootnoteInput">Footnote</label>
                    <textarea id="s8FootnoteInput" class="edit-dialog-input" rows="4" 
                              placeholder="Enter footnote text">${currentValue || ''}</textarea>
                </div>
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancelS8FootnoteBtn" class="edit-dialog-btn-secondary">Cancel</button>
                    <button id="saveS8FootnoteBtn" class="edit-dialog-btn-primary">Save</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            const textarea = document.getElementById('s8FootnoteInput');
            textarea.focus();
            textarea.setSelectionRange(textarea.value.length, textarea.value.length);
            
            document.getElementById('saveS8FootnoteBtn').addEventListener('click', () => {
                DocumentData.step9.footnote = textarea.value.trim();
                localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                populateSectionEight(DocumentData.step9);
                makeSectionEightEditable();
                showToast('Footnote updated successfully!');
                document.body.removeChild(overlay);
            });
            
            document.getElementById('cancelS8FootnoteBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') document.body.removeChild(overlay);
                if (e.ctrlKey && e.key === 'Enter') document.getElementById('saveS8FootnoteBtn').click();
            });
            
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) document.body.removeChild(overlay);
            });
        }
        
        function makeSection8TableEditable() {
            const tableBody = document.getElementById('s8TableBody');
            if (!tableBody) return;
            
            if (tableBody.dataset.editable === 'true') return;
            tableBody.dataset.editable = 'true';
            
            // Event delegation for entire rows
            tableBody.addEventListener('dblclick', function(e) {
                // Skip if clicked on weight indicator dots or triangles
                if (e.target.closest('.weight-dot') || e.target.closest('.trend-triangle')) return;
                
                const row = e.target.closest('tr');
                if (!row) return;
                
                const rowIndex = Array.from(tableBody.children).indexOf(row);
                showSection8RowEditDialog(rowIndex);
            });
            
            // Add hover styles
            const styleId = 's8-table-style';
            if (!document.getElementById(styleId)) {
                const style = document.createElement('style');
                style.id = styleId;
                style.textContent = `
                    #s8TableBody tr {
                        cursor: pointer;
                        transition: background-color 0.2s;
                    }
                    #s8TableBody tr:hover {
                        background-color: #f9fafb;
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        function showSection8RowEditDialog(rowIndex) {
            const rowData = DocumentData.step9.tableData.data[rowIndex];
            if (!rowData) return;
            
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0, 0, 0, 0.5); display: flex;
                align-items: center; justify-content: center; z-index: 10000;
            `;
            
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white; border-radius: 8px; padding: 24px;
                width: 90%; max-width: 700px; max-height: 80vh;
                overflow-y: auto; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Edit Sector Row</h3>
                
                <div style="margin-bottom: 16px;">
                    <label class="edit-dialog-label" for="s8Sector">Sector</label>
                    <input type="text" id="s8Sector" class="edit-dialog-input" 
                           value="${rowData.sector || ''}" placeholder="Enter sector name" />
                </div>
                
                <div style="margin-bottom: 16px;">
                    <label class="edit-dialog-label" for="s8Position">Position (Weight Value)</label>
                    <select id="s8Position" class="edit-dialog-input"
                            style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px;">
                        <option value="-1" ${rowData.position === -1 ? 'selected' : ''}>Hide (value -1)</option>
                        <option value="1" ${rowData.position === 1 ? 'selected' : ''}>1 (Underweight)</option>
                        <option value="2" ${rowData.position === 2 ? 'selected' : ''}>2 (Underweight)</option>
                        <option value="3" ${rowData.position === 3 ? 'selected' : ''}>3 (Neutral)</option>
                        <option value="4" ${rowData.position === 4 ? 'selected' : ''}>4 (Overweight)</option>
                        <option value="5" ${rowData.position === 5 ? 'selected' : ''}>5 (Overweight)</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 16px;">
                    <label class="edit-dialog-label" for="s8Trend">Trend (Triangle Indicator)</label>
                    <select id="s8Trend" class="edit-dialog-input"
                            style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px;">
                        <option value="0" ${rowData.trend === 0 ? 'selected' : ''}>No Trend (0)</option>
                        <option value="1" ${rowData.trend === 1 ? 'selected' : ''}>Upward Trend (1)</option>
                        <option value="-1" ${rowData.trend === -1 ? 'selected' : ''}>Downward Trend (-1)</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 16px;">
                    <label class="edit-dialog-label" for="s8Comments">Comments</label>
                    <textarea id="s8Comments" class="edit-dialog-input" rows="4" 
                              placeholder="Enter comments">${rowData.comments || ''}</textarea>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="s8Separate">Separate (Show border above this row)</label>
                    <select id="s8Separate" class="edit-dialog-input"
                            style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px;">
                        <option value="0" ${rowData.separate === 0 ? 'selected' : ''}>No (0)</option>
                        <option value="1" ${rowData.separate === 1 ? 'selected' : ''}>Yes (1)</option>
                    </select>
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancelS8RowBtn" class="edit-dialog-btn-secondary">Cancel</button>
                    <button id="saveS8RowBtn" class="edit-dialog-btn-primary">Save</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            const input = document.getElementById('s8Sector');
            input.focus();
            input.select();
            
            document.getElementById('saveS8RowBtn').addEventListener('click', () => {
                const newSector = document.getElementById('s8Sector').value.trim();
                const newPosition = parseInt(document.getElementById('s8Position').value);
                const newTrend = parseInt(document.getElementById('s8Trend').value);
                const newComments = document.getElementById('s8Comments').value.trim();
                const newSeparate = parseInt(document.getElementById('s8Separate').value);
                
                // Update weight based on position
                let newWeight = 'neutral';
                if (newPosition === -1) {
                    newWeight = 'none';
                } else if (newPosition <= 2) {
                    newWeight = 'underweight';
                } else if (newPosition === 3) {
                    newWeight = 'neutral';
                } else {
                    newWeight = 'overweight';
                }
                
                // Update data
                DocumentData.step9.tableData.data[rowIndex].sector = newSector;
                DocumentData.step9.tableData.data[rowIndex].position = newPosition;
                DocumentData.step9.tableData.data[rowIndex].weight = newWeight;
                DocumentData.step9.tableData.data[rowIndex].trend = newTrend;
                DocumentData.step9.tableData.data[rowIndex].comments = newComments;
                DocumentData.step9.tableData.data[rowIndex].separate = newSeparate;
                
                localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                populateSectionEight(DocumentData.step9);
                makeSectionEightEditable();
                showToast('Sector row updated successfully!');
                document.body.removeChild(overlay);
            });
            
            document.getElementById('cancelS8RowBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') document.body.removeChild(overlay);
            });
            
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) document.body.removeChild(overlay);
            });
            
            const textarea = document.getElementById('s8Comments');
            textarea.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'Enter') {
                    document.getElementById('saveS8RowBtn').click();
                }
            });
        }

        // ============================================
        // Section 9: CIO THEMATIC INVESTING Editing
        // ============================================
        
        function makeSectionNineEditable() {
            // Make title editable
            const titleEl = document.getElementById('s9Title');
            if (titleEl && !titleEl.dataset.editable) {
                titleEl.dataset.editable = 'true';
                titleEl.style.cursor = 'pointer';
                titleEl.title = 'Double-click to edit';
                
                titleEl.addEventListener('dblclick', function() {
                    showSection9TitleEditDialog();
                });
            }
            
            // Make content editable
            const contentEl = document.getElementById('s9Content');
            if (contentEl && !contentEl.dataset.editable) {
                contentEl.dataset.editable = 'true';
                contentEl.style.cursor = 'pointer';
                contentEl.title = 'Double-click to edit';
                
                contentEl.addEventListener('dblclick', function() {
                    showSection9ContentEditDialog();
                });
            }
            
            // Make table headers editable
            makeSection9HeadersEditable();
            
            // Make table rows editable
            makeSection9TableEditable();
        }
        
        function showSection9TitleEditDialog() {
            const currentValue = DocumentData.step10.title;
            
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0, 0, 0, 0.5); display: flex;
                align-items: center; justify-content: center; z-index: 10000;
            `;
            
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white; border-radius: 8px; padding: 24px;
                width: 90%; max-width: 600px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Edit Section Title</h3>
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="s9TitleInput">Title</label>
                    <input type="text" id="s9TitleInput" class="edit-dialog-input" 
                           value="${currentValue || ''}" placeholder="Enter section title" />
                </div>
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancelS9TitleBtn" class="edit-dialog-btn-secondary">Cancel</button>
                    <button id="saveS9TitleBtn" class="edit-dialog-btn-primary">Save</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            const input = document.getElementById('s9TitleInput');
            input.focus();
            input.select();
            
            document.getElementById('saveS9TitleBtn').addEventListener('click', () => {
                DocumentData.step10.title = input.value.trim();
                localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                populateSectionNine(DocumentData.step10);
                makeSectionNineEditable();
                showToast('Section title updated successfully!');
                document.body.removeChild(overlay);
            });
            
            document.getElementById('cancelS9TitleBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') document.body.removeChild(overlay);
                if (e.key === 'Enter') document.getElementById('saveS9TitleBtn').click();
            });
            
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) document.body.removeChild(overlay);
            });
        }
        
        function showSection9ContentEditDialog() {
            const currentValue = DocumentData.step10.content;
            
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0, 0, 0, 0.5); display: flex;
                align-items: center; justify-content: center; z-index: 10000;
            `;
            
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white; border-radius: 8px; padding: 24px;
                width: 90%; max-width: 700px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Edit Content</h3>
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="s9ContentInput">Content</label>
                    <textarea id="s9ContentInput" class="edit-dialog-input" rows="8" 
                              placeholder="Enter section content">${currentValue || ''}</textarea>
                </div>
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancelS9ContentBtn" class="edit-dialog-btn-secondary">Cancel</button>
                    <button id="saveS9ContentBtn" class="edit-dialog-btn-primary">Save</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            const textarea = document.getElementById('s9ContentInput');
            textarea.focus();
            textarea.setSelectionRange(textarea.value.length, textarea.value.length);
            
            document.getElementById('saveS9ContentBtn').addEventListener('click', () => {
                DocumentData.step10.content = textarea.value.trim();
                localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                populateSectionNine(DocumentData.step10);
                makeSectionNineEditable();
                showToast('Content updated successfully!');
                document.body.removeChild(overlay);
            });
            
            document.getElementById('cancelS9ContentBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') document.body.removeChild(overlay);
                if (e.ctrlKey && e.key === 'Enter') document.getElementById('saveS9ContentBtn').click();
            });
            
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) document.body.removeChild(overlay);
            });
        }
        
        function makeSection9HeadersEditable() {
            const headerCells = document.querySelectorAll('#s9Header th');
            if (!headerCells.length) return;
            
            headerCells.forEach((th, index) => {
                if (th.dataset.editable === 'true') return;
                th.dataset.editable = 'true';
                th.style.cursor = 'pointer';
                th.title = 'Double-click to edit';
                
                th.addEventListener('dblclick', function(e) {
                    e.stopPropagation();
                    showSection9HeaderEditDialog(index);
                });
            });
        }
        
        function showSection9HeaderEditDialog(headerIndex) {
            const currentValue = DocumentData.step10.tableData.header[headerIndex];
            
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0, 0, 0, 0.5); display: flex;
                align-items: center; justify-content: center; z-index: 10000;
            `;
            
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white; border-radius: 8px; padding: 24px;
                width: 90%; max-width: 500px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Edit Table Header</h3>
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="s9HeaderInput">Header ${headerIndex + 1}</label>
                    <input type="text" id="s9HeaderInput" class="edit-dialog-input" 
                           value="${currentValue || ''}" placeholder="Enter header text" />
                </div>
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancelS9HeaderBtn" class="edit-dialog-btn-secondary">Cancel</button>
                    <button id="saveS9HeaderBtn" class="edit-dialog-btn-primary">Save</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            const input = document.getElementById('s9HeaderInput');
            input.focus();
            input.select();
            
            document.getElementById('saveS9HeaderBtn').addEventListener('click', () => {
                DocumentData.step10.tableData.header[headerIndex] = input.value.trim();
                localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                populateSectionNine(DocumentData.step10);
                makeSectionNineEditable();
                showToast('Table header updated successfully!');
                document.body.removeChild(overlay);
            });
            
            document.getElementById('cancelS9HeaderBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') document.body.removeChild(overlay);
                if (e.key === 'Enter') document.getElementById('saveS9HeaderBtn').click();
            });
            
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) document.body.removeChild(overlay);
            });
        }
        
        function makeSection9TableEditable() {
            const tableBody = document.getElementById('s9TableBody');
            if (!tableBody) return;
            
            if (tableBody.dataset.editable === 'true') return;
            tableBody.dataset.editable = 'true';
            
            // Event delegation for entire rows
            tableBody.addEventListener('dblclick', function(e) {
                const row = e.target.closest('tr');
                if (!row) return;
                
                const rowIndex = Array.from(tableBody.children).indexOf(row);
                showSection9RowEditDialog(rowIndex);
            });
            
            // Add hover styles
            const styleId = 's9-table-style';
            if (!document.getElementById(styleId)) {
                const style = document.createElement('style');
                style.id = styleId;
                style.textContent = `
                    #s9TableBody tr {
                        cursor: pointer;
                        transition: background-color 0.2s;
                    }
                    #s9TableBody tr:hover {
                        background-color: #f9fafb;
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        function showSection9RowEditDialog(rowIndex) {
            const rowData = DocumentData.step10.tableData.data[rowIndex];
            if (!rowData) return;
            
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0, 0, 0, 0.5); display: flex;
                align-items: center; justify-content: center; z-index: 10000;
            `;
            
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white; border-radius: 8px; padding: 24px;
                width: 90%; max-width: 800px; max-height: 85vh;
                overflow-y: auto; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            // Build left data items HTML
            const leftDataHTML = rowData.leftData.map((item, idx) => `
                <div style="display: flex; gap: 8px; align-items: center; margin-bottom: 8px;">
                    <input type="text" class="edit-dialog-input s9-left-item" 
                           value="${item}" placeholder="Enter item" 
                           style="flex: 1;" data-index="${idx}" />
                    <button class="s9-remove-left-btn edit-dialog-btn-danger" 
                            data-index="${idx}" style="padding: 6px 12px;">Remove</button>
                </div>
            `).join('');
            
            // Build right data items HTML
            const rightDataHTML = rowData.rightData.map((item, idx) => `
                <div style="border: 1px solid #e5e7eb; padding: 12px; border-radius: 4px; margin-bottom: 12px;">
                    <div style="margin-bottom: 8px;">
                        <label class="edit-dialog-label">Header</label>
                        <input type="text" class="edit-dialog-input s9-right-header" 
                               value="${item.header}" placeholder="Enter header" data-index="${idx}" />
                    </div>
                    <div style="margin-bottom: 8px;">
                        <label class="edit-dialog-label">Description</label>
                        <textarea class="edit-dialog-input s9-right-desc" rows="2" 
                                  placeholder="Enter description" data-index="${idx}">${item.description}</textarea>
                    </div>
                    <button class="s9-remove-right-btn edit-dialog-btn-danger" 
                            data-index="${idx}" style="padding: 6px 12px; width: 100%;">Remove Detail</button>
                </div>
            `).join('');
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Edit Thematic Row</h3>
                
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="s9Category">Category</label>
                    <input type="text" id="s9Category" class="edit-dialog-input" 
                           value="${rowData.category || ''}" placeholder="Enter category name" />
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <label class="edit-dialog-label">Level 1 Items</label>
                        <div id="s9LeftDataContainer">
                            ${leftDataHTML}
                        </div>
                        <button id="s9AddLeftBtn" class="edit-dialog-btn-secondary" 
                                style="width: 100%; margin-top: 8px;">+ Add Level 1 Item</button>
                    </div>
                    
                    <div>
                        <label class="edit-dialog-label">Level 2 Details</label>
                        <div id="s9RightDataContainer">
                            ${rightDataHTML}
                        </div>
                        <button id="s9AddRightBtn" class="edit-dialog-btn-secondary" 
                                style="width: 100%; margin-top: 8px;">+ Add Level 2 Detail</button>
                    </div>
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end; border-top: 1px solid #e5e7eb; padding-top: 16px;">
                    <button id="cancelS9RowBtn" class="edit-dialog-btn-secondary">Cancel</button>
                    <button id="saveS9RowBtn" class="edit-dialog-btn-primary">Save</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            const input = document.getElementById('s9Category');
            input.focus();
            input.select();
            
            // Add left item button
            document.getElementById('s9AddLeftBtn').addEventListener('click', () => {
                const container = document.getElementById('s9LeftDataContainer');
                const newIndex = container.children.length;
                const newItem = document.createElement('div');
                newItem.style.cssText = 'display: flex; gap: 8px; align-items: center; margin-bottom: 8px;';
                newItem.innerHTML = `
                    <input type="text" class="edit-dialog-input s9-left-item" 
                           value="" placeholder="Enter item" 
                           style="flex: 1;" data-index="${newIndex}" />
                    <button class="s9-remove-left-btn edit-dialog-btn-danger" 
                            data-index="${newIndex}" style="padding: 6px 12px;">Remove</button>
                `;
                container.appendChild(newItem);
                attachRemoveListeners();
            });
            
            // Add right detail button
            document.getElementById('s9AddRightBtn').addEventListener('click', () => {
                const container = document.getElementById('s9RightDataContainer');
                const newIndex = container.children.length;
                const newItem = document.createElement('div');
                newItem.style.cssText = 'border: 1px solid #e5e7eb; padding: 12px; border-radius: 4px; margin-bottom: 12px;';
                newItem.innerHTML = `
                    <div style="margin-bottom: 8px;">
                        <label class="edit-dialog-label">Header</label>
                        <input type="text" class="edit-dialog-input s9-right-header" 
                               value="" placeholder="Enter header" data-index="${newIndex}" />
                    </div>
                    <div style="margin-bottom: 8px;">
                        <label class="edit-dialog-label">Description</label>
                        <textarea class="edit-dialog-input s9-right-desc" rows="2" 
                                  placeholder="Enter description" data-index="${newIndex}"></textarea>
                    </div>
                    <button class="s9-remove-right-btn edit-dialog-btn-danger" 
                            data-index="${newIndex}" style="padding: 6px 12px; width: 100%;">Remove Detail</button>
                `;
                container.appendChild(newItem);
                attachRemoveListeners();
            });
            
            // Attach remove button listeners
            function attachRemoveListeners() {
                document.querySelectorAll('.s9-remove-left-btn').forEach(btn => {
                    btn.onclick = function() {
                        this.parentElement.remove();
                    };
                });
                
                document.querySelectorAll('.s9-remove-right-btn').forEach(btn => {
                    btn.onclick = function() {
                        this.parentElement.remove();
                    };
                });
            }
            attachRemoveListeners();
            
            // Handle save
            document.getElementById('saveS9RowBtn').addEventListener('click', () => {
                const newCategory = document.getElementById('s9Category').value.trim();
                
                // Collect left data
                const newLeftData = Array.from(document.querySelectorAll('.s9-left-item'))
                    .map(input => input.value.trim())
                    .filter(val => val !== '');
                
                // Collect right data
                const newRightData = [];
                const rightHeaders = document.querySelectorAll('.s9-right-header');
                const rightDescs = document.querySelectorAll('.s9-right-desc');
                
                for (let i = 0; i < rightHeaders.length; i++) {
                    const header = rightHeaders[i].value.trim();
                    const description = rightDescs[i].value.trim();
                    if (header || description) {
                        newRightData.push({ header, description });
                    }
                }
                
                // Update data
                DocumentData.step10.tableData.data[rowIndex].category = newCategory;
                DocumentData.step10.tableData.data[rowIndex].leftData = newLeftData;
                DocumentData.step10.tableData.data[rowIndex].rightData = newRightData;
                
                localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                populateSectionNine(DocumentData.step10);
                makeSectionNineEditable();
                showToast('Thematic row updated successfully!');
                document.body.removeChild(overlay);
            });
            
            // Handle cancel
            document.getElementById('cancelS9RowBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            // Close on Escape
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') document.body.removeChild(overlay);
            });
            
            // Close on overlay click
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) document.body.removeChild(overlay);
            });
        }

        // ============================================
        // Section 10: Index Definitions Editing
        // ============================================
        
        function makeSectionTenEditable() {
            // Make title editable
            const titleEl = document.getElementById('s10Title');
            if (titleEl && !titleEl.dataset.editable) {
                titleEl.dataset.editable = 'true';
                titleEl.style.cursor = 'pointer';
                titleEl.title = 'Double-click to edit';
                
                titleEl.addEventListener('dblclick', function() {
                    showSection10TitleEditDialog();
                });
            }
            
            // Make disclaimer editable
            const disclaimerEl = document.getElementById('s10Disclaimer');
            if (disclaimerEl && !disclaimerEl.dataset.editable) {
                disclaimerEl.dataset.editable = 'true';
                disclaimerEl.style.cursor = 'pointer';
                disclaimerEl.title = 'Double-click to edit';
                
                disclaimerEl.addEventListener('dblclick', function() {
                    showSection10DisclaimerEditDialog();
                });
            }
            
            // Make definition items editable
            makeSection10DefinitionsEditable();
        }
        
        function showSection10TitleEditDialog() {
            const currentValue = DocumentData.step11.title;
            
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0, 0, 0, 0.5); display: flex;
                align-items: center; justify-content: center; z-index: 10000;
            `;
            
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white; border-radius: 8px; padding: 24px;
                width: 90%; max-width: 600px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Edit Section Title</h3>
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="s10TitleInput">Title</label>
                    <input type="text" id="s10TitleInput" class="edit-dialog-input" 
                           value="${currentValue || ''}" placeholder="Enter section title" />
                </div>
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancelS10TitleBtn" class="edit-dialog-btn-secondary">Cancel</button>
                    <button id="saveS10TitleBtn" class="edit-dialog-btn-primary">Save</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            const input = document.getElementById('s10TitleInput');
            input.focus();
            input.select();
            
            document.getElementById('saveS10TitleBtn').addEventListener('click', () => {
                DocumentData.step11.title = input.value.trim();
                localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                populateSectionTen(DocumentData.step11);
                makeSectionTenEditable();
                showToast('Section title updated successfully!');
                document.body.removeChild(overlay);
            });
            
            document.getElementById('cancelS10TitleBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') document.body.removeChild(overlay);
                if (e.key === 'Enter') document.getElementById('saveS10TitleBtn').click();
            });
            
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) document.body.removeChild(overlay);
            });
        }
        
        function showSection10DisclaimerEditDialog() {
            const currentValue = DocumentData.step11.disclaimer;
            
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0, 0, 0, 0.5); display: flex;
                align-items: center; justify-content: center; z-index: 10000;
            `;
            
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white; border-radius: 8px; padding: 24px;
                width: 90%; max-width: 700px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Edit Disclaimer</h3>
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="s10DisclaimerInput">Disclaimer</label>
                    <textarea id="s10DisclaimerInput" class="edit-dialog-input" rows="6" 
                              placeholder="Enter disclaimer text">${currentValue || ''}</textarea>
                </div>
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancelS10DisclaimerBtn" class="edit-dialog-btn-secondary">Cancel</button>
                    <button id="saveS10DisclaimerBtn" class="edit-dialog-btn-primary">Save</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            const textarea = document.getElementById('s10DisclaimerInput');
            textarea.focus();
            textarea.setSelectionRange(textarea.value.length, textarea.value.length);
            
            document.getElementById('saveS10DisclaimerBtn').addEventListener('click', () => {
                DocumentData.step11.disclaimer = textarea.value.trim();
                localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                populateSectionTen(DocumentData.step11);
                makeSectionTenEditable();
                showToast('Disclaimer updated successfully!');
                document.body.removeChild(overlay);
            });
            
            document.getElementById('cancelS10DisclaimerBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') document.body.removeChild(overlay);
                if (e.ctrlKey && e.key === 'Enter') document.getElementById('saveS10DisclaimerBtn').click();
            });
            
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) document.body.removeChild(overlay);
            });
        }
        
        function makeSection10DefinitionsEditable() {
            const subsectionContainer = document.getElementById('s10Subsection');
            if (!subsectionContainer) return;
            
            if (subsectionContainer.dataset.editable === 'true') return;
            subsectionContainer.dataset.editable = 'true';
            
            // Event delegation for definition items
            subsectionContainer.addEventListener('dblclick', function(e) {
                const definitionEl = e.target.closest('h1');
                if (!definitionEl) return;
                
                const allDefinitions = Array.from(subsectionContainer.querySelectorAll('h1'));
                const itemIndex = allDefinitions.indexOf(definitionEl);
                
                if (itemIndex >= 0) {
                    showSection10DefinitionEditDialog(itemIndex);
                }
            });
            
            // Add hover styles
            const styleId = 's10-definitions-style';
            if (!document.getElementById(styleId)) {
                const style = document.createElement('style');
                style.id = styleId;
                style.textContent = `
                    #s10Subsection h1 {
                        cursor: pointer;
                        transition: background-color 0.2s;
                        padding: 8px;
                        border-radius: 4px;
                    }
                    #s10Subsection h1:hover {
                        background-color: #f9fafb;
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        function showSection10DefinitionEditDialog(itemIndex) {
            const itemData = DocumentData.step11.data[itemIndex];
            if (!itemData) return;
            
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0, 0, 0, 0.5); display: flex;
                align-items: center; justify-content: center; z-index: 10000;
            `;
            
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white; border-radius: 8px; padding: 24px;
                width: 90%; max-width: 700px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Edit Index Definition</h3>
                
                <div style="margin-bottom: 16px;">
                    <label class="edit-dialog-label" for="s10DefHeader">Index Name</label>
                    <input type="text" id="s10DefHeader" class="edit-dialog-input" 
                           value="${itemData.header || ''}" placeholder="Enter index name" />
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="s10DefContent">Definition</label>
                    <textarea id="s10DefContent" class="edit-dialog-input" rows="6" 
                              placeholder="Enter definition">${itemData.content || ''}</textarea>
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: space-between;">
                    <button id="deleteS10DefBtn" class="edit-dialog-btn-danger">Delete Definition</button>
                    <div style="display: flex; gap: 12px;">
                        <button id="cancelS10DefBtn" class="edit-dialog-btn-secondary">Cancel</button>
                        <button id="saveS10DefBtn" class="edit-dialog-btn-primary">Save</button>
                    </div>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            const input = document.getElementById('s10DefHeader');
            input.focus();
            input.select();
            
            // Handle save
            document.getElementById('saveS10DefBtn').addEventListener('click', () => {
                const newHeader = document.getElementById('s10DefHeader').value.trim();
                const newContent = document.getElementById('s10DefContent').value.trim();
                
                DocumentData.step11.data[itemIndex].header = newHeader;
                DocumentData.step11.data[itemIndex].content = newContent;
                
                localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                populateSectionTen(DocumentData.step11);
                makeSectionTenEditable();
                showToast('Definition updated successfully!');
                document.body.removeChild(overlay);
            });
            
            // Handle delete
            document.getElementById('deleteS10DefBtn').addEventListener('click', () => {
                if (confirm('Are you sure you want to delete this definition?')) {
                    DocumentData.step11.data.splice(itemIndex, 1);
                    localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                    populateSectionTen(DocumentData.step11);
                    makeSectionTenEditable();
                    showToast('Definition deleted successfully!');
                    document.body.removeChild(overlay);
                }
            });
            
            // Handle cancel
            document.getElementById('cancelS10DefBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            // Close on Escape
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') document.body.removeChild(overlay);
            });
            
            // Close on overlay click
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) document.body.removeChild(overlay);
            });
            
            // Save on Ctrl+Enter in textarea
            const textarea = document.getElementById('s10DefContent');
            textarea.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'Enter') {
                    document.getElementById('saveS10DefBtn').click();
                }
            });
        }
        
        function showSection10AddDefinitionDialog() {
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0, 0, 0, 0.5); display: flex;
                align-items: center; justify-content: center; z-index: 10000;
            `;
            
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white; border-radius: 8px; padding: 24px;
                width: 90%; max-width: 700px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Add New Index Definition</h3>
                
                <div style="margin-bottom: 16px;">
                    <label class="edit-dialog-label" for="s10NewDefHeader">Index Name</label>
                    <input type="text" id="s10NewDefHeader" class="edit-dialog-input" 
                           value="" placeholder="Enter index name" />
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="s10NewDefContent">Definition</label>
                    <textarea id="s10NewDefContent" class="edit-dialog-input" rows="6" 
                              placeholder="Enter definition"></textarea>
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancelS10NewDefBtn" class="edit-dialog-btn-secondary">Cancel</button>
                    <button id="saveS10NewDefBtn" class="edit-dialog-btn-primary">Add Definition</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            const input = document.getElementById('s10NewDefHeader');
            input.focus();
            
            // Handle save
            document.getElementById('saveS10NewDefBtn').addEventListener('click', () => {
                const newHeader = document.getElementById('s10NewDefHeader').value.trim();
                const newContent = document.getElementById('s10NewDefContent').value.trim();
                
                if (!newHeader && !newContent) {
                    alert('Please enter at least a header or content.');
                    return;
                }
                
                DocumentData.step11.data.push({
                    header: newHeader,
                    content: newContent
                });
                
                localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                populateSectionTen(DocumentData.step11);
                makeSectionTenEditable();
                showToast('Definition added successfully!');
                document.body.removeChild(overlay);
            });
            
            // Handle cancel
            document.getElementById('cancelS10NewDefBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            // Close on Escape
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') document.body.removeChild(overlay);
            });
            
            // Close on overlay click
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) document.body.removeChild(overlay);
            });
            
            // Save on Ctrl+Enter in textarea
            const textarea = document.getElementById('s10NewDefContent');
            textarea.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'Enter') {
                    document.getElementById('saveS10NewDefBtn').click();
                }
            });
        }

        // ============================================
        // Section 11: Important Disclosures Editing
        // ============================================
        
        function makeSectionElevenEditable() {
            // Make title editable
            const titleEl = document.getElementById('s11Title');
            if (titleEl && !titleEl.dataset.editable) {
                titleEl.dataset.editable = 'true';
                titleEl.style.cursor = 'pointer';
                titleEl.title = 'Double-click to edit';
                
                titleEl.addEventListener('dblclick', function() {
                    showSection11TitleEditDialog();
                });
            }
            
            // Make copyright editable
            const copyrightEl = document.getElementById('s11Copyright');
            if (copyrightEl && !copyrightEl.dataset.editable) {
                copyrightEl.dataset.editable = 'true';
                copyrightEl.style.cursor = 'pointer';
                copyrightEl.title = 'Double-click to edit';
                
                copyrightEl.addEventListener('dblclick', function() {
                    showSection11CopyrightEditDialog();
                });
            }
            
            // Make disclosure items editable
            makeSection11DisclosuresEditable();
        }
        
        function showSection11TitleEditDialog() {
            const currentValue = DocumentData.step12.title;
            
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0, 0, 0, 0.5); display: flex;
                align-items: center; justify-content: center; z-index: 10000;
            `;
            
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white; border-radius: 8px; padding: 24px;
                width: 90%; max-width: 600px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Edit Section Title</h3>
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="s11TitleInput">Title</label>
                    <input type="text" id="s11TitleInput" class="edit-dialog-input" 
                           value="${currentValue || ''}" placeholder="Enter section title" />
                </div>
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancelS11TitleBtn" class="edit-dialog-btn-secondary">Cancel</button>
                    <button id="saveS11TitleBtn" class="edit-dialog-btn-primary">Save</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            const input = document.getElementById('s11TitleInput');
            input.focus();
            input.select();
            
            document.getElementById('saveS11TitleBtn').addEventListener('click', () => {
                DocumentData.step12.title = input.value.trim();
                localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                populateSectionEleven(DocumentData.step12);
                makeSectionElevenEditable();
                showToast('Section title updated successfully!');
                document.body.removeChild(overlay);
            });
            
            document.getElementById('cancelS11TitleBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') document.body.removeChild(overlay);
                if (e.key === 'Enter') document.getElementById('saveS11TitleBtn').click();
            });
            
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) document.body.removeChild(overlay);
            });
        }
        
        function showSection11CopyrightEditDialog() {
            const currentValue = DocumentData.step12.copyright;
            
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0, 0, 0, 0.5); display: flex;
                align-items: center; justify-content: center; z-index: 10000;
            `;
            
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white; border-radius: 8px; padding: 24px;
                width: 90%; max-width: 600px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Edit Copyright</h3>
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="s11CopyrightInput">Copyright</label>
                    <input type="text" id="s11CopyrightInput" class="edit-dialog-input" 
                           value="${currentValue || ''}" placeholder="Enter copyright text" />
                </div>
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancelS11CopyrightBtn" class="edit-dialog-btn-secondary">Cancel</button>
                    <button id="saveS11CopyrightBtn" class="edit-dialog-btn-primary">Save</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            const input = document.getElementById('s11CopyrightInput');
            input.focus();
            input.select();
            
            document.getElementById('saveS11CopyrightBtn').addEventListener('click', () => {
                DocumentData.step12.copyright = input.value.trim();
                localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                populateSectionEleven(DocumentData.step12);
                makeSectionElevenEditable();
                showToast('Copyright updated successfully!');
                document.body.removeChild(overlay);
            });
            
            document.getElementById('cancelS11CopyrightBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') document.body.removeChild(overlay);
                if (e.key === 'Enter') document.getElementById('saveS11CopyrightBtn').click();
            });
            
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) document.body.removeChild(overlay);
            });
        }
        
        function makeSection11DisclosuresEditable() {
            const subsectionContainer = document.getElementById('s11Subsection');
            if (!subsectionContainer) return;
            
            if (subsectionContainer.dataset.editable === 'true') return;
            subsectionContainer.dataset.editable = 'true';
            
            // Event delegation for disclosure items
            subsectionContainer.addEventListener('dblclick', function(e) {
                const disclosureDiv = e.target.closest('div.flex.flex-col');
                if (!disclosureDiv) return;
                
                const allDisclosures = Array.from(subsectionContainer.querySelectorAll('div.flex.flex-col'));
                const itemIndex = allDisclosures.indexOf(disclosureDiv);
                
                if (itemIndex >= 0) {
                    showSection11DisclosureEditDialog(itemIndex);
                }
            });
            
            // Add hover styles
            const styleId = 's11-disclosures-style';
            if (!document.getElementById(styleId)) {
                const style = document.createElement('style');
                style.id = styleId;
                style.textContent = `
                    #s11Subsection > div.flex.flex-col {
                        cursor: pointer;
                        transition: background-color 0.2s;
                        padding: 12px;
                        border-radius: 4px;
                        margin-bottom: 8px;
                    }
                    #s11Subsection > div.flex.flex-col:hover {
                        background-color: #f9fafb;
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        function showSection11DisclosureEditDialog(itemIndex) {
            const itemData = DocumentData.step12.data[itemIndex];
            if (!itemData) return;
            
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0, 0, 0, 0.5); display: flex;
                align-items: center; justify-content: center; z-index: 10000;
            `;
            
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white; border-radius: 8px; padding: 24px;
                width: 90%; max-width: 800px; max-height: 85vh;
                overflow-y: auto; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Edit Disclosure</h3>
                
                <div style="margin-bottom: 16px;">
                    <label class="edit-dialog-label" for="s11DiscHeader">Header</label>
                    <textarea id="s11DiscHeader" class="edit-dialog-input" rows="2" 
                              placeholder="Enter disclosure header">${itemData.header || ''}</textarea>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="s11DiscContent">Content</label>
                    <textarea id="s11DiscContent" class="edit-dialog-input" rows="12" 
                              placeholder="Enter disclosure content">${itemData.content || ''}</textarea>
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: space-between;">
                    <button id="deleteS11DiscBtn" class="edit-dialog-btn-danger">Delete Disclosure</button>
                    <div style="display: flex; gap: 12px;">
                        <button id="cancelS11DiscBtn" class="edit-dialog-btn-secondary">Cancel</button>
                        <button id="saveS11DiscBtn" class="edit-dialog-btn-primary">Save</button>
                    </div>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            const headerInput = document.getElementById('s11DiscHeader');
            headerInput.focus();
            headerInput.setSelectionRange(headerInput.value.length, headerInput.value.length);
            
            // Handle save
            document.getElementById('saveS11DiscBtn').addEventListener('click', () => {
                const newHeader = document.getElementById('s11DiscHeader').value.trim();
                const newContent = document.getElementById('s11DiscContent').value.trim();
                
                DocumentData.step12.data[itemIndex].header = newHeader;
                DocumentData.step12.data[itemIndex].content = newContent;
                
                localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                populateSectionEleven(DocumentData.step12);
                makeSectionElevenEditable();
                showToast('Disclosure updated successfully!');
                document.body.removeChild(overlay);
            });
            
            // Handle delete
            document.getElementById('deleteS11DiscBtn').addEventListener('click', () => {
                if (confirm('Are you sure you want to delete this disclosure?')) {
                    DocumentData.step12.data.splice(itemIndex, 1);
                    localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                    populateSectionEleven(DocumentData.step12);
                    makeSectionElevenEditable();
                    showToast('Disclosure deleted successfully!');
                    document.body.removeChild(overlay);
                }
            });
            
            // Handle cancel
            document.getElementById('cancelS11DiscBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            // Close on Escape
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') document.body.removeChild(overlay);
            });
            
            // Close on overlay click
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) document.body.removeChild(overlay);
            });
            
            // Save on Ctrl+Enter in content textarea
            const contentTextarea = document.getElementById('s11DiscContent');
            contentTextarea.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'Enter') {
                    document.getElementById('saveS11DiscBtn').click();
                }
            });
        }
        
        function showSection11AddDisclosureDialog() {
            const overlay = document.createElement('div');
            overlay.className = 'edit-dialog-overlay';
            overlay.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0, 0, 0, 0.5); display: flex;
                align-items: center; justify-content: center; z-index: 10000;
            `;
            
            const dialog = document.createElement('div');
            dialog.className = 'edit-dialog';
            dialog.style.cssText = `
                background: white; border-radius: 8px; padding: 24px;
                width: 90%; max-width: 800px; max-height: 85vh;
                overflow-y: auto; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            `;
            
            dialog.innerHTML = `
                <h3 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Add New Disclosure</h3>
                
                <div style="margin-bottom: 16px;">
                    <label class="edit-dialog-label" for="s11NewDiscHeader">Header</label>
                    <textarea id="s11NewDiscHeader" class="edit-dialog-input" rows="2" 
                              placeholder="Enter disclosure header"></textarea>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label class="edit-dialog-label" for="s11NewDiscContent">Content</label>
                    <textarea id="s11NewDiscContent" class="edit-dialog-input" rows="12" 
                              placeholder="Enter disclosure content"></textarea>
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button id="cancelS11NewDiscBtn" class="edit-dialog-btn-secondary">Cancel</button>
                    <button id="saveS11NewDiscBtn" class="edit-dialog-btn-primary">Add Disclosure</button>
                </div>
            `;
            
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            const headerInput = document.getElementById('s11NewDiscHeader');
            headerInput.focus();
            
            // Handle save
            document.getElementById('saveS11NewDiscBtn').addEventListener('click', () => {
                const newHeader = document.getElementById('s11NewDiscHeader').value.trim();
                const newContent = document.getElementById('s11NewDiscContent').value.trim();
                
                if (!newHeader && !newContent) {
                    alert('Please enter at least a header or content.');
                    return;
                }
                
                DocumentData.step12.data.push({
                    header: newHeader,
                    content: newContent
                });
                
                localStorage.setItem('DocumentData', JSON.stringify(DocumentData));
                populateSectionEleven(DocumentData.step12);
                makeSectionElevenEditable();
                showToast('Disclosure added successfully!');
                document.body.removeChild(overlay);
            });
            
            // Handle cancel
            document.getElementById('cancelS11NewDiscBtn').addEventListener('click', () => {
                document.body.removeChild(overlay);
            });
            
            // Close on Escape
            overlay.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') document.body.removeChild(overlay);
            });
            
            // Close on overlay click
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) document.body.removeChild(overlay);
            });
            
            // Save on Ctrl+Enter in content textarea
            const contentTextarea = document.getElementById('s11NewDiscContent');
            contentTextarea.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'Enter') {
                    document.getElementById('saveS11NewDiscBtn').click();
                }
            });
        }

        // Function to Load section 2 ( Step 3)
        function populateSectionTwo(sectionTwoData){
            console.log("Populating Section 2");
            const titleContainer = document.getElementById("s2Title");
            titleContainer.innerHTML = sectionTwoData.title || "CIO INVESTMENT DASHBOARD";

            const paraContainer = document.getElementById("s2Description");
            paraContainer.innerHTML = sectionTwoData.description || "Description";
            
            const subtitleContainer = document.getElementById("s2Subtitle");
            subtitleContainer.textContent = sectionTwoData.tableData.subtitle || "Current readings on the key drivers of Equities for investors to consider, with arrows representing the recent trend:";
            
            const footnoteContainer = document.getElementById("s2Footnote");
            footnoteContainer.textContent = sectionTwoData.tableData.footnote || "Source: Chief Investment Office.";
            
            // Populate table headers
            const headers = sectionTwoData.tableData.headers;
            document.getElementById("s2HeaderFactor").textContent = headers.factorHeader || "Factor";
            document.getElementById("s2HeaderImplication").textContent = headers.implicationHeader || "Implication for Equities";
            document.getElementById("s2HeaderCioView").textContent = headers.cioViewHeader || "CIO View";
            document.getElementById("s2HeaderNegative").textContent = headers.negativeLabel || "Negative";
            document.getElementById("s2HeaderNeutral").textContent = headers.neutralLabel || "Neutral";
            document.getElementById("s2HeaderPositive").textContent = headers.positiveLabel || "Positive";
            
            // Generate first table with factors data
            const tbody = document.getElementById("factors-body");
            tbody.innerHTML = sectionTwoData.tableData.data.map(window.createFactorRow).join("");
            console.log('Factors table populated');

        }

        function populateSectionThree(sectionThreeData){
            console.log("Populating Section 3");
            const titleContainer = document.getElementById("s3Title");
            titleContainer.innerHTML = sectionThreeData.title || "EQUITIES";

            const subSectionContainer = document.getElementById("s3Subsection");
            subSectionContainer.innerHTML = sectionThreeData.subsections.map(subsec => `
                <div class="mb-4">
                    <h2 class="text-xs font-bold mb-2">${subsec.heading || ''}: <span class="paragraph">${subsec.content.replace(/\n/g, '<br><br>') || ''}</span></h2>
                </div>
            `).join("") || "Subsections";

            const rightEquityContainer = document.getElementById("s3EquityList");
            rightEquityContainer.innerHTML = sectionThreeData.rightContainer.equityWatchList.map(item => `<li class="paragraph text-[--box-gray] mb-1">${item}</li>`).join("") || "1";
            const rightRiskContainer = document.getElementById("s3RiskList");
            rightRiskContainer.innerHTML = sectionThreeData.rightContainer.riskConsiderations.map(item => `<li class="paragraph text-[--box-gray] mb-1">${item}</li>`).join("");

            // Populate sector title
            const sectorTitleEl = document.getElementById("s3SectorTitle");
            if(sectorTitleEl) sectorTitleEl.textContent = sectionThreeData.sectorValuation.title || "Sector Valuations";

            const sectorTableBody = document.getElementById("s3SectorTable");
            if(sectorTableBody) sectorTableBody.innerHTML = sectionThreeData.sectorValuation.data.map((sector, index) => createSectorTableRow(sector, index)).join('');
            else {
                const sectorImg = document.getElementById("s3SectorImg");
                console.log("Setting sector image src to:", sectionThreeData.sectorValuation.imgSrc);
                console.log("img src", sectorImg);
                sectorImg.src = sectionThreeData.sectorValuation.imgSrc || "";
            }
            if(!sectorTableBody) document.getElementById("sectorFoot").style.display = "none";
            
            const sectorSubtitle = document.querySelector(".s3SectorSubtitle");
            if(sectorSubtitle) sectorSubtitle.innerHTML = sectionThreeData.sectorValuation.subtitle || "Forward Price-to-Earnings (P/E) for S&P 500 Sectors";

            renderTable9XAxisLabels(sectionThreeData.sectorValuation.axisConfig || { start: 15, end: 35, interval: 5 });
        }

        function populateSectionFour(sectionFourData){
            console.log("Populating Section 4");
            const titleContainer = document.getElementById("s4Title");
            titleContainer.innerHTML = sectionFourData.title || "FIXED INCOME";

            const subSectionContainer = document.getElementById("s4Subsection");
            subSectionContainer.innerHTML = sectionFourData.subsections.map((subsec,index) => {
                if(index !== 0) return `
                    <div class="mb-4">
                        <h2 class="text-xs font-bold mb-2"><span class="paragraph">In multi-asset class portfolios,</span> ${subsec.heading || ''}: <span class="paragraph">${subsec.content.replace(/\n/g, '<br><br>') || ''}</span></h2>
                    </div>
                `;
                return `
                    <div class="mb-4">
                        <h2 class="text-xs font-bold mb-2">${subsec.heading || ''}: <span class="paragraph">${subsec.content.replace(/\n/g, '<br><br>') || ''}</span></h2>
                    </div>
                `;
            }).join("") || "Subsections";

            // Populate headings
            const incomeTitleEl = document.getElementById("s4IncomeTitle");
            if(incomeTitleEl) incomeTitleEl.textContent = sectionFourData.rightContainer.fixedIncomeTitle || "Fixed Income Watch List";
            
            const riskTitleEl = document.getElementById("s4RiskTitle");
            if(riskTitleEl) riskTitleEl.textContent = sectionFourData.rightContainer.riskTitle || "RISK CONSIDERATIONS";

            const rightEquityContainer = document.getElementById("s4IncomeList");
            rightEquityContainer.innerHTML = sectionFourData.rightContainer.fixedIncomeWatchList.map(item => `<li class="paragraph text-[--box-gray] mb-1">${item}</li>`).join("") || "1";
            const rightRiskContainer = document.getElementById("s4RiskList");
            rightRiskContainer.innerHTML = sectionFourData.rightContainer.riskConsiderations.map(item => `<li class="paragraph text-[--box-gray] mb-1">${item}</li>`).join("");

            // Further population logic for Section 4 can be added here
        }

        function populateSectionFive(sectionFiveData){
            console.log("Populating Section 5");
            const titleContainer = document.getElementById("s5Title");
            titleContainer.innerHTML = sectionFiveData.title || "CIO VIEWS ON ALTS STRATEGIES";

            const altBoxContainer = document.getElementById("s5AltBox");
            altBoxContainer.innerHTML = `
            <p class="paragraph">${sectionFiveData.container.content.replace(/\n/g, '<br><br>')}</p>
            </br>
            <p class="paragraph">Some key CIO principles for qualified investors to consider when investing in Alts include:</p>
            <ul class="list-disc pl-5 mt-2">
                <li class="paragraph"><span class="font-bold text-xs">Invest methodically, including in downturns: </span>${sectionFiveData.container.data[1].replace(/\n/g, '<br><br>') || ''}</li>
                <li class="paragraph"><span class="font-bold text-xs">Think strategically and long-term: </span>${sectionFiveData.container.data[0].replace(/\n/g, '<br><br>') || ''}</li>
                <li class="paragraph"><span class="font-bold text-xs">Diversify: </span>${sectionFiveData.container.data[2].replace(/\n/g, '<br><br>') || ''}</li>
                <li class="paragraph"><span class="font-bold text-xs">Prioritize high-conviction managers: </span>${sectionFiveData.container.data[3].replace(/\n/g, '<br><br>') || ''}</li>
            </ul>
            `;
            const subheading = "border-t border-b border-black py-1 text-xs font-bold";
            const cioViewsContainer = document.getElementById("s5CIOViews");
            cioViewsContainer.innerHTML = sectionFiveData.altStrategies.map(strategy => `
                <div class="mt-4">
                    <h1 class="heading">${strategy.title || "CIO Views"}</h1>
                    ${strategy.data.map(s => `
                        <h2 class="${subheading}">${s.heading || "CIO Subheading"} <span class="text-md font-bold ${s.color === 'green' ? 'text-green-500' : 'text-red-500'}">${s.symbol || ''}</span></h2>
                        <div class="flex flex-col text-[11px]">
                            <div class="flex gap-3">
                                <h3 class="">Bull case</h3>
                                <p class="">${s.bullCase || ''}</p>
                            </div>
                            <div class="flex gap-3 bg-gray-100">
                                <h3 class="">Bear case</h3>
                                <p class="">${s.bearCase || ''}</p>
                            </div>
                        </div>
                    `).join("")}
                    <p class="text-[9px] pt-2 text-gray-500 border-t border-black">${strategy.footnote.replace('Bull case', '<b class="text-black text-[11px] font-black">Bull case</b>').replace('Bear case', '<b class="text-black text-[11px] font-black">Bear case</b>') || ''}</p>
                </div>
            `).join("") || ``;


            const subSectionContainer = document.getElementById("s5Subsection");
            subSectionContainer.innerHTML = sectionFiveData.subsection.map(subsec => `
                <div class="mb-4">
                    <h2 class="text-xs font-bold mb-2">${subsec.heading || ''}: <span class="paragraph">${subsec.content.replace(/\n/g, '<br><br>') || ''}</span></h2>
                </div>
            `).join("") || "Subsections";

            const s5StrategyTitleContainer = document.getElementById("s5StrategyTitle");
            s5StrategyTitleContainer.innerHTML = sectionFiveData.strategy.title || "MICRO STRATEGY";

            const s5MicroStrategyContainer = document.getElementById("s5StrategyList");
            s5MicroStrategyContainer.innerHTML = sectionFiveData.strategy.data.map(item => `<li class="paragraph text-[--box-gray] mb-1">${item}</li>`).join("") || "1";
        }
        
        function populateSectionSix(sectionSixData){
            console.log("Populating Section 6");
            const s6TitleContainer = document.getElementById("s6Title");
            s6TitleContainer.innerHTML = sectionSixData.title || "ECONOMIC FORECASTS";

            const s6TableOneHeader = document.getElementById("s6T1Header");
            s6TableOneHeader.innerHTML += sectionSixData.tableData.header.map(h => `<th class="text-[9px] font-light text-gray-500">${h}</th>`).join("") || "";

            console.log("Section 6 Table Data:", sectionSixData.tableData.data);
            const s6TableOneBody = document.getElementById("s6T1Body");
            s6TableOneBody.innerHTML = sectionSixData.tableData.data.map(row => `
            <tr> 
                ${row.map((cell,index) => {
                    if(index === 0) return `<td style="text-align: left;" class="text-[9px] font-bold">${cell}</td>`;
                    return `<td class="text-center text-[9px] py-1">${cell}</td>`;
                }).join('') }
            </tr>
            `).join('') || "";

            const s6TableOneFootnote = document.getElementById("s6T1Footnote");
            s6TableOneFootnote.innerHTML = sectionSixData.tableData.footnote || "";

            const s6SideBarTitleContainer = document.getElementById("s6SidebarTitle");
            s6SideBarTitleContainer.innerHTML = sectionSixData.rightContainer.title || "Economic Forecasts";

            const s6SideBarContentContainer = document.getElementById("s6SidebarContent");
            s6SideBarContentContainer.innerHTML = sectionSixData.rightContainer.content.replace(/\n/g, '<br><br>') || "";

            const s6TableTwoHeader = document.getElementById("s6T2Header");
            s6TableTwoHeader.innerHTML += `<tr>${sectionSixData.rightContainer.tableData.header.map((h,index) => `<th ${index === 0 ? 'rowspan="2"' : 'colspan="5"'}>${h}</th>`).join("") || ""}</tr>`;
            s6TableTwoHeader.innerHTML += `<tr>${sectionSixData.rightContainer.tableData.subheader.map(h => `<th>${h}</th>`).join("") || ""}</tr>`;

            const s6TableTwoBody = document.getElementById("s6T2Body");
            s6TableTwoBody.innerHTML = sectionSixData.rightContainer.tableData.data.map(row => `<tr>
                    ${row.map(cell => `<td class="text-center text-[8px] ">${cell}</td>`).join('')}
                </tr>
            `).join('') || "";
            
            const s6TableTwoFootnote = document.getElementById("s6T2Footnote");
            s6TableTwoFootnote.innerHTML = sectionSixData.rightContainer.tableData.footnote || "";
        }

        function populateSectionSeven(sectionSevenData){
            console.log("Populating Section 7");
            const s7TitleContainer = document.getElementById("s7Title");
            s7TitleContainer.innerHTML = sectionSevenData.title || "CIO ASSET CLASS VIEWS AS OF SEPTEMBER 2, 2025";

            const s7TableHeader = document.getElementById("s7Header");
            s7TableHeader.innerHTML = `<tr>${sectionSevenData.header.map((h,index) => `<th ${index === 1 ? 'class="border-b border-black"' : 'rowspan="2"'} class="align-middle">${h}</th>`).join("") || ""}</tr>`;
            s7TableHeader.innerHTML += `<tr><th class="text-xs"><div class="flex justify-between px-4">${sectionSevenData.subheader.map(h => `<span>${h}</span>`).join("")}</div></th></tr>`;

            const s7TableContainer = document.getElementById("s7TableBody");
            s7TableContainer.innerHTML = sectionSevenData.data.map((row,index) => createAssetClassRow(row, index, sectionSevenData.data)).join('') || "";

            const s7FootnoteContainer = document.getElementById("s7Footnote");
            s7FootnoteContainer.innerHTML = sectionSevenData.footnote || "";    
        }
        
        function populateSectionEight(sectionEightData){
            console.log("Populating Section 8");
            const s8TitleContainer = document.getElementById("s8Title");
            s8TitleContainer.innerHTML = sectionEightData.title || "CIO EQUITY SECTOR VIEWS AS OF SEPTEMBER 2, 2025";

            const s8ContentContainer = document.getElementById("s8Content");
            s8ContentContainer.innerHTML = sectionEightData.content.replace(/\n/g, '<br><br>') || "";

            const s8TableHeader = document.getElementById("s8Header");
            s8TableHeader.innerHTML = `<tr>${sectionEightData.tableData.header.map((h,index) => `<th ${index === 1 ? 'class="border-b border-black"' : 'rowspan="2"'} class="align-middle">${h}</th>`).join("") || ""}</tr>`;
            s8TableHeader.innerHTML += `<tr><th class="text-xs"><div class="flex justify-between px-4">${sectionEightData.tableData.subheader.map(h => `<span>${h}</span>`).join("")}</div></th></tr>`;

            const s8TableContainer = document.getElementById("s8TableBody");
            s8TableContainer.innerHTML = sectionEightData.tableData.data.map((row,index) => createSectorRow(row, index, sectionEightData.tableData.data)).join('') || "";

            const s8FootnoteContainer = document.getElementById("s8Footnote");
            s8FootnoteContainer.innerHTML = sectionEightData.footnote || "";    
        }
        
        function populateSectionNine(sectionNineData){
            console.log("Populating Section 9");
            const s9TitleContainer = document.getElementById("s9Title");
            s9TitleContainer.innerHTML = sectionNineData.title || "CIO THEMATIC INVESTING AS OF SEPTEMBER 2, 2025";

            const s9ContentContainer = document.getElementById("s9Content");
            s9ContentContainer.innerHTML = sectionNineData.content.replace(/\n/g, '<br><br>') || "";

            const s9TableHeader = document.getElementById("s9Header");
            s9TableHeader.innerHTML = `
            <tr>${sectionNineData.tableData.header.map(h =>
                `<th class="py-2 text-[12px]">${h}</th>`
            ).join("")}</tr>`;

            const s9TableContainer = document.getElementById("s9TableBody");
            s9TableContainer.innerHTML = sectionNineData.tableData.data.map((row,index) => createSectionNineRow(row, index)).join('') || "";
        }
        
        function populateSectionTen(sectionTenData){
            console.log("Populating Section 10");
            const s10TitleContainer = document.getElementById("s10Title");
            s10TitleContainer.innerHTML = sectionTenData.title || "Index Definitions";

            const s10ContentContainer = document.getElementById("s10Disclaimer");
            s10ContentContainer.innerHTML = sectionTenData.disclaimer.replace(/\n/g, '<br><br>') || "";

            const s10SubsectionContainer = document.getElementById("s10Subsection");
            s10SubsectionContainer.innerHTML = sectionTenData.data.map(item => `<h1 class="font-bold text-[11px]">${item.header} <span class="text-[9px] text-gray-500">${item.content.replace(/\n/g, '<br><br>')}</span></h1>`).join('') || "";
        }
        
        function populateSectionEleven(sectionElevenData){
            console.log("Populating Section 11");
            const s11TitleContainer = document.getElementById("s11Title");
            s11TitleContainer.innerHTML = sectionElevenData.title || "Important Disclosures";

            const s11SubsectionContainer = document.getElementById("s11Subsection");
            s11SubsectionContainer.innerHTML = sectionElevenData.data.map(item => `
            <div class="flex flex-col gap-1">
            <h1 class="font-bold text-[11px]">${item.header}</h1>
            <span class="text-[9px] text-gray-500">${item.content.replace(/\n/g, '<br>')}</span>
            </div>
            `).join('') || "";

            const s11CopyrightContainer = document.getElementById("s11Copyright");
            s11CopyrightContainer.innerHTML = sectionElevenData.copyright.replace(/\n/g, '<br>') || "";
        }
        </script>
        <!-- Your content goes here -->
    </div>
</body>
</html>