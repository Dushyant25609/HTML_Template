<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CIO Viewpoint Dashboard</title>

  <!-- ✅ Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>
    /* Global styles shared across all tables */
    body {
      font-family: Arial, sans-serif;
    }

    table td {
      vertical-align: top;
    }

    .factors-table {
      border-collapse: collapse;
      font-family: Arial, sans-serif;
      border-bottom: 2px solid #333;
      margin-bottom: 8px;
    }

    .factors-table th,
    .factors-table td {
      border: none;
      padding: 8px 12px;
    }

    .factors-table thead th {
      background-color: #f8f9fa;
      font-weight: bold;
      text-align: center;
      border-top: 2px solid #333;
      border-bottom: 2px solid #333;
    }

    .factors-table tbody td:first-child {
      font-weight: 600;
      width: 200px;
    }

    .factors-table tbody tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    .factors-table tbody tr:nth-child(odd) {
      background-color: white;
    }

    .factors-table tbody td:last-child {
      text-align: justify;
      line-height: 1.4;
      font-size: 14px;
    }

    /* Separated rows - add top and bottom border */
    .separated-row {
      border-top: 2px solid #333 !important;
      border-bottom: 2px solid #333 !important;
    }

    /* Input field styling when editing */
    .factors-table input {
      font-family: inherit;
      color: inherit;
      outline: none;
    }

    .factors-table input:focus {
      background-color: #fff3cd;
      border: 1px solid #ffc107;
      border-radius: 2px;
      padding: 2px 4px;
    }

    /* Cursor pointer for interactive table elements */
    tbody td:first-child,
    tbody td:last-child,
    th:not(.text-xs) {
      cursor: pointer;
    }

    /* Hover effects for editable cells */
    tbody td:first-child:hover,
    tbody td:last-child:hover,
    th:not(.text-xs):hover {
      background-color: #f8f9fa;
      transition: background-color 0.2s ease;
    }

    /* Table row hover effect */
    tbody tr:hover {
      background-color: #f8f9fa;
    }



    /* Preview Mode Button */
    .preview-btn {
      background: #007bff;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 600;
      font-size: 14px;
      box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .preview-btn:hover {
      background: #0056b3;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 123, 255, 0.4);
      color: white;
      text-decoration: none;
    }

    .preview-btn:active {
      transform: translateY(0);
    }

    /* Action Buttons */
    .action-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      border-radius: 8px;
      font-weight: 500;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      border: none;
      min-width: 120px;
      justify-content: flex-start;
    }
    
    .preview-btn-new {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      color: white;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
    }
    
    .preview-btn-new:hover {
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    }
    
    .json-btn {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
    }
    
    .json-btn:hover {
      background: linear-gradient(135deg, #059669, #047857);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
    }
    
    .copy-btn {
      background: linear-gradient(135deg, #8b5cf6, #7c3aed);
      color: white;
      box-shadow: 0 2px 8px rgba(139, 92, 246, 0.3);
    }
    
    .copy-btn:hover {
      background: linear-gradient(135deg, #7c3aed, #6d28d9);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
    }
    
    .action-btn:active {
      transform: translateY(0);
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">

  <!-- Header -->
  <header class="bg-blue-900 text-white py-6 text-center shadow">
    <h1 id="header-title" class="text-3xl font-bold">CIO Viewpoint Dashboard</h1>
    <p id="header-subtitle" class="text-sm text-blue-200">Key Drivers of Equities | Updated <span id="header-date">October 2025</span></p>
    <p class="text-xs text-blue-300 mt-2">💡 Double-click headers and text cells to edit | Double-click comments for advanced editing with merge notes | Click weight dots in Table 2 for quick position changes | Double-click Table 3 rows or weight dots/triangles for detailed editing | Double-click empty weight area in Table 2 to hide dots | Double-click range handles to adjust values</p>
  </header>

  <!-- Action Buttons -->
  <div class="fixed top-4 right-4 z-50 flex flex-row gap-3 p-2 bg-white/90 backdrop-blur-sm rounded-lg shadow-lg border border-gray-200">
    <button onclick="previewJSON()" class="action-btn json-btn">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
      </svg>
      View JSON
    </button>
    <button onclick="copyCurrentJSON()" class="action-btn copy-btn">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
      </svg>
      Copy JSON
    </button>
  </div>

  <!-- Global JavaScript Functions -->
  <script>
    // Global variables
    window.headerData = {
      factorHeader: "Factor",
      implicationHeader: "Implication for Equities", 
      cioViewHeader: "CIO View"
    };

    // Set current date in header
    const headerDateElement = document.getElementById("header-date");
    if (headerDateElement) {
      headerDateElement.textContent = new Date().toLocaleDateString();
    }

    // Global editable functionality for headers and text cells
    function makeHeadersEditable() {
      const editableHeaders = document.querySelectorAll('th:not(.text-xs)');
      editableHeaders.forEach((cell, index) => {
        cell.addEventListener('dblclick', function() {
          if (this.querySelector('input')) return; // Already editing
          
          const originalText = this.textContent.trim();
          const input = document.createElement('input');
          input.type = 'text';
          input.value = originalText;
          input.style.width = '100%';
          input.style.border = 'none';
          input.style.background = 'transparent';
          input.style.fontSize = 'inherit';
          input.style.fontWeight = 'inherit';
          input.style.textAlign = 'inherit';
          input.style.padding = '4px';
          
          this.innerHTML = '';
          this.appendChild(input);
          input.focus();
          input.select();
          
          const saveEdit = () => {
            const newValue = input.value || originalText;
            this.textContent = newValue;
            
            // Update header data based on column position
            if (index === 0) {
              window.headerData.factorHeader = newValue;
            } else if (index === 1) {
              window.headerData.implicationHeader = newValue;
            } else if (index === 2) {
              window.headerData.cioViewHeader = newValue;
            }
            
            saveDataToStorage();
          };
          
          input.addEventListener('blur', saveEdit);
          input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') saveEdit();
            if (e.key === 'Escape') this.textContent = originalText;
          });
        });
      });
    }

    // Global function to make text cells editable
    function makeTextCellsEditable() {
      const dataCells = document.querySelectorAll('tbody td:first-child:not(#table5-body td), tbody td:last-child:not(#table5-body td)');
      dataCells.forEach((cell, index) => {
        // Additional check to ensure we're not in Table 5
        if (cell.closest('#table5-body')) {
          return; // Skip Table 5 cells
        }
        
        cell.addEventListener('dblclick', function() {
          // Check if this is a comments cell (last column)
          const row = this.parentElement;
          const isCommentsCell = this === row.lastElementChild;
          
          if (isCommentsCell) {
            // Check if this comment cell is hidden - if so, prevent editing
            if (this.style.display === 'none') {
              return; // Do nothing for hidden comment cells
            }
            
            // Show comments popover for comments cells
            const tbody = row.parentElement;
            const rowIndex = Array.from(tbody.children).indexOf(row);
            
            let data = null;
            let tableType = '';
            
            if (tbody.id === 'factors-body') {
              data = window.factorsData[rowIndex];
              tableType = 'factors';
            } else if (tbody.id === 'cio-view-body') {
              data = window.cioViewData[rowIndex];
              tableType = 'cio-view';
            } else if (tbody.id === 'table3-view-body') {
              // Disable comment popover for Table 3
              return;
            }
            
            if (data) {
              showCommentsEditPopover(this, data, rowIndex, tableType);
            }
            return;
          }
          
          // Handle regular text editing for non-comments cells
          if (this.querySelector('input')) return; // Already editing
          
          const originalText = this.textContent.trim();
          const input = document.createElement('input');
          input.type = 'text';
          input.value = originalText;
          input.style.width = '100%';
          input.style.border = 'none';
          input.style.background = 'transparent';
          input.style.fontSize = 'inherit';
          input.style.fontWeight = 'inherit';
          input.style.textAlign = 'inherit';
          input.style.padding = '4px';
          
          this.innerHTML = '';
          this.appendChild(input);
          input.focus();
          input.select();
          
          const saveEdit = () => {
            const newValue = input.value || originalText;
            this.textContent = newValue;
            
            // Update the data array based on which table this cell belongs to
            const row = this.parentElement;
            const tbody = row.parentElement;
            const rowIndex = Array.from(tbody.children).indexOf(row);
            
            // Check which table and update appropriate data
            if (tbody.id === 'factors-body') {
              if (this === row.firstElementChild) {
                window.factorsData[rowIndex].factor = newValue;
              } else if (this === row.lastElementChild) {
                window.factorsData[rowIndex].cioView = newValue;
              }
            } else if (tbody.id === 'cio-view-body') {
              if (this === row.firstElementChild) {
                if (window.cioViewData && window.cioViewData[rowIndex]) {
                  window.cioViewData[rowIndex].assetClass = newValue;
                }
              }
            } else if (tbody.id === 'table3-view-body') {
              if (this === row.firstElementChild) {
                if (window.table3ViewData && window.table3ViewData[rowIndex]) {
                  window.table3ViewData[rowIndex].assetClass = newValue;
                }
              }
            }
            
            saveDataToStorage();
          };
          
          input.addEventListener('blur', saveEdit);
          input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') saveEdit();
            if (e.key === 'Escape') this.textContent = originalText;
          });
        });
      });
    }
  </script>

  <!-- Table 1: Equity Factors with Range Sliders -->
  <main class="max-w-7xl mx-auto mt-8 px-4">
    <!-- Table 1 Specific Styles -->
    <style>
      /* Range Slider Styles for Table 1 */
      .factors-table tbody td:nth-child(2) {
        text-align: center;
        vertical-align: middle;
        width: 300px;
        padding: 8px;
      }

      .range-slider {
        position: relative;
        width: 280px;
        height: 30px;
        margin: 0 auto;
        display: flex;
        align-items: center;
      }

      .range-track {
        width: 100%;
        height: 8px;
        background-color: #ccc;
        border-radius: 4px;
        position: relative;
        margin: 0 10px;
      }

      .range-thumb {
        position: absolute;
        top: 50%;
        transform: translate(-50%, -50%);
        display: flex;
        align-items: center;
        gap: 4px;
        z-index: 2;
      }

      .range-handle {
        width: 20px;
        height: 20px;
        background-color: white;
        border: 3px solid #333;
        border-radius: 50%;
        cursor: pointer !important;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      }

      /* Handle colors based on implication */
      .range-handle.positive { background-color: #22c55e; }
      .range-handle.neutral { background-color: #facc15; }
      .range-handle.negative { background-color: #ef4444; }

      /* SVG Arrow Styles */
      .svg-arrow {
        display: inline-flex;
        align-items: center;
        color: #333;
        width: 28px;
        height: 21px;
      }

      .svg-arrow.left { transform: rotate(180deg); }
      .svg-arrow.right { transform: rotate(0deg); }
      .svg-arrow svg { width: 100%; height: 100%; }

      /* Range edit popover styles */
      .range-edit-popover {
        animation: popoverFadeIn 0.2s ease-out;
      }

      @keyframes popoverFadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
      }

      .range-edit-popover input[type="range"] {
        -webkit-appearance: none;
        appearance: none;
        height: 6px;
        background: #ddd;
        border-radius: 3px;
        outline: none;
      }

      .range-edit-popover input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 18px;
        height: 18px;
        background: #007bff;
        border-radius: 50%;
        cursor: pointer;
      }

      .range-edit-popover input[type="range"]::-moz-range-thumb {
        width: 18px;
        height: 18px;
        background: #007bff;
        border-radius: 50%;
        cursor: pointer;
        border: none;
      }

      /* Additional hover feedback for range sliders */
      .range-slider:hover .range-track {
        opacity: 0.8;
      }
    </style>

    <!-- Table 1 Specific JavaScript Functions -->
    <script>
      // Table 1: Create factor row with range slider
      window.createFactorRow = function(item, index, allItems) {
        // Create SVG arrow based on trend
        let trendArrow = '';
        const svgArrow = `<svg width="28" height="21" viewBox="0 0 122.88 108.06" xmlns="http://www.w3.org/2000/svg">
          <path d="M58.94,24.28a14.27,14.27,0,0,1,20.35-20l39.49,40.16a14.28,14.28,0,0,1,0,20L80.09,103.79a14.27,14.27,0,1,1-20.35-20L74.82,68.41l-60.67-.29a14.27,14.27,0,0,1,.24-28.54l59.85.28L58.94,24.28Z" fill="currentColor"/>
        </svg>`;
        
        switch(item.trend) {
          case 'up':
            trendArrow = `<span class="svg-arrow right">${svgArrow}</span>`;
            break;
          case 'down':
            trendArrow = `<span class="svg-arrow left">${svgArrow}</span>`;
            break;
          case 'neutral':
          default:
            trendArrow = '';
            break;
        }

        // Determine handle color class based on implication (safe: handle missing/undefined)
        let handleColorClass = '';
        const implication = (item && item.implication) ? String(item.implication).toLowerCase() : 'neutral';
        switch(implication) {
          case 'positive': handleColorClass = 'positive'; break;
          case 'neutral': handleColorClass = 'neutral'; break;
          case 'negative': handleColorClass = 'negative'; break;
        }

        // Calculate position based on value (0-100) as percentage
        const rawPosition = Math.min(Math.max(item.value, 0), 100);
        const constrainedPosition = Math.min(Math.max(rawPosition, 3), 97);
        
        // Create the range slider visualization
        const rangeSlider = `
          <div class="range-slider">
            <div class="range-track">
              <div class="range-thumb" style="left: ${constrainedPosition}%;">
                ${trendArrow}
                <div class="range-handle ${handleColorClass}"></div>
              </div>
            </div>
          </div>
        `;

        const classAttr = '';

        // Handle hidden comment cells
        const commentStyle = item.commentHidden ? ' style="display: none;"' : '';
        const commentContent = item.commentHidden ? '' : (item.comments || '');

        return `
          <tr${classAttr}>
            <td>${item.factor}</td>
            <td>${rangeSlider}</td>
            <td>${item.cioView}</td>
            <td${commentStyle}>${commentContent}</td>
          </tr>
        `;
      };

      // Table 1: Range handle editing functionality
      function addRangeHandleEditing() {
        const rangeHandles = document.querySelectorAll('.range-handle');
        console.log('Found range handles:', rangeHandles.length);
        rangeHandles.forEach((handle, index) => {
          handle.addEventListener('dblclick', function(e) {
            e.stopPropagation();
            console.log('Range handle double-clicked!', index);
            
            const row = this.closest('tr');
            const rowIndex = Array.from(row.parentElement.children).indexOf(row);
            const factorData = window.factorsData[rowIndex];
            console.log('Factor data for popover:', factorData);
            
            showRangeEditPopover(this, factorData, rowIndex);
          });
          
          handle.style.cursor = 'pointer';
        });
      }

      // Table 1: Show range edit popover
      function showRangeEditPopover(handle, factorData, rowIndex) {
        // Remove existing popover if any
        const existingPopover = document.querySelector('.range-edit-popover');
        if (existingPopover) {
          existingPopover.remove();
        }

        // Create popover
        const popover = document.createElement('div');
        popover.className = 'range-edit-popover';
        popover.style.cssText = `
          position: absolute;
          background: white;
          border: 1px solid #ddd;
          border-radius: 8px;
          padding: 20px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
          z-index: 1000;
          min-width: 250px;
          font-size: 14px;
        `;

        // Get handle position
        const handleRect = handle.getBoundingClientRect();
        popover.style.left = (handleRect.left + window.scrollX - 125) + 'px';
        popover.style.top = (handleRect.bottom + window.scrollY + 10) + 'px';

        // Create form content
        popover.innerHTML = `
          <h3 style="margin: 0 0 15px 0; font-size: 16px; font-weight: bold;">Go Edit Range Settings</h3>
          
          
          <div style="margin-bottom: 15px;">
            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Trend:</label>
            <select id="popover-trend" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
              <option value="up" ${(factorData.trend || '') === 'up' ? 'selected' : ''}>Up</option>
              <option value="neutral" ${(factorData.trend || '') === 'neutral' ? 'selected' : ''}>Neutral</option>
              <option value="down" ${(factorData.trend || '') === 'down' ? 'selected' : ''}>Down</option>
            </select>
          </div>
          
          <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Value:</label>
            <select id="popover-value" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
              <option value="0" ${factorData.value === 0 ? 'selected' : ''}>0</option>
              <option value="25" ${factorData.value === 25 ? 'selected' : ''}>25</option>
              <option value="50" ${factorData.value === 50 ? 'selected' : ''}>50</option>
              <option value="75" ${factorData.value === 75 ? 'selected' : ''}>75</option>
              <option value="100" ${factorData.value === 100 ? 'selected' : ''}>100</option>
            </select>
          </div>
          
          <div style="display: flex; gap: 10px; justify-content: flex-end;">
            <button onclick="closeRangePopover()" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancel</button>
            <button onclick="saveRangeChanges(${rowIndex})" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Save</button>
          </div>
        `;

        document.body.appendChild(popover);
        window.currentRangePopover = popover;

        // Close popover when clicking outside
        setTimeout(() => {
          document.addEventListener('click', closePopoverOnOutsideClick);
        }, 100);
      }

      // Table 1: Range popover utility functions
      function closePopoverOnOutsideClick(e) {
        const popover = document.querySelector('.range-edit-popover');
        if (popover && !popover.contains(e.target)) {
          closeRangePopover();
        }
      }

      window.closeRangePopover = function() {
        const popover = document.querySelector('.range-edit-popover');
        if (popover) {
          popover.remove();
          document.removeEventListener('click', closePopoverOnOutsideClick);
        }
      };

      window.saveRangeChanges = function(rowIndex) {
        const trend = document.getElementById('popover-trend').value;
        const value = parseInt(document.getElementById('popover-value').value);

        // Auto-set implication based on value
        let implication;
        if (value === 0) {
          implication = 'Negative';
        } else if (value === 25 || value === 50) {
          implication = 'Neutral';
        } else {
          implication = 'Positive';
        }

        // Update the data
        window.factorsData[rowIndex].implication = implication;
        window.factorsData[rowIndex].trend = trend;
        window.factorsData[rowIndex].value = value;

        // Regenerate the table to reflect changes
        const tbody = document.getElementById("factors-body");
        tbody.innerHTML = window.factorsData.map((item, index) => window.createFactorRow(item, index, window.factorsData)).join("");
        
        // Re-initialize editable functionality
        makeHeadersEditable();
        makeTextCellsEditable();
        addRangeHandleEditing();

        // Save changes and close popover
        saveDataToStorage();
        closeRangePopover();
        showRangeUpdateNotification();
      };

      // Table 1: Show notification for range updates
      function showRangeUpdateNotification() {
        const notification = document.createElement('div');
        notification.textContent = 'Range settings updated successfully!';
        notification.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          background: #28a745;
          color: white;
          padding: 10px 15px;
          border-radius: 4px;
          z-index: 1001;
          font-size: 14px;
          box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 3000);
      }
    </script>

    <section class="bg-white shadow-md rounded-lg p-8">
      <h2 class="text-sm font-normal mb-6 pb-2 border-b border-gray-300">Current readings on the key drivers of Equities for investors to consider, with arrows representing the recent trend:</h2>
      <div class="overflow-x-auto">
        <table class="w-full factors-table">
          <thead>
            <tr>
              <th rowspan="2" class="align-middle">Factor</th>
              <th class="align-middle">Implication for Equities</th>
              <th rowspan="2" class="align-middle">CIO View</th>
            </tr>
            <tr>
              <th class="text-xs">
                <div class="flex justify-between px-4">
                  <span>Negative</span>
                  <span>Neutral</span>
                  <span>Positive</span>
                </div>
              </th>
            </tr>
          </thead>
          <tbody id="factors-body"></tbody>
        </table>
      </div>
      <div class="mt-4 text-xs text-gray-600">
        <p>2 of 12 August 2025 – CIO Viewpoint</p>
      </div>
    </section>
  </main>

  <!-- Table 2: CIO Asset Class Views with Weight Indicators -->
  <main class="max-w-7xl mx-auto mt-8 px-4">
    <!-- Table 2 Specific Styles -->
    <style>
      /* Weight indicator styles for Table 2 */
      .weight-indicator {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 20px;
        padding-top: 25px;
        padding-bottom: 10px;
        cursor: pointer;
      }

      .weight-dot {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        border: 2px solid #666;
        cursor: pointer;
        position: relative;
      }

      .weight-dot.filled {
        border-color: #333;
      }

      .weight-dot.empty {
        background-color: #d3d3d3;
        border-color: #d3d3d3;
        width: 12px;
        height: 12px;
      }

      /* Weight dot colors based on position */
      .weight-dot.filled.overweight { background-color: #4CAF50; } /* Green */
      .weight-dot.filled.neutral { background-color: #FFC107; } /* Yellow */
      .weight-dot.filled.underweight { background-color: #ef4444; } /* Red */

      /* Hover effects for weight dots */
      .weight-dot:hover {
        transform: scale(1.1);
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        transition: all 0.2s ease;
      }

      .weight-dot.empty:hover { border-color: #666; }
      .weight-dot.filled.overweight:hover { border-color: #2E7D32; }
      .weight-dot.filled.neutral:hover { border-color: #F57F17; }
      .weight-dot.filled.underweight:hover { border-color: #E65100; }

      /* Hidden weight indicators (when position is -1) */
      .weight-indicator.hidden {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 20px;
        padding-top: 25px;
        padding-bottom: 10px;
        cursor: pointer;
        min-height: 40px;
        background-color: rgba(211, 211, 211, 0.1);
        border-radius: 4px;
        transition: background-color 0.2s ease;
      }

      .weight-indicator.hidden:hover {
        background-color: rgba(211, 211, 211, 0.2);
      }
    </style>

    <!-- Table 2 Specific JavaScript Functions -->
    <script>
      // Table 2: Create asset class row with weight indicators
      window.createAssetClassRow = function(item, index, allItems) {
        // Determine if row should have separation borders
        const rowClass = item.separate === 1 ? ' class="separated-row"' : '';
        const classAttr = rowClass;
        
        // If position is -1, hide all dots
        if (item.position === -1) {
          const weightIndicator = `
            <div class="weight-indicator hidden" title="Double-click to set weight position">
              <span style="color: #999; font-size: 12px; font-style: italic;"></span>
            </div>
          `;

          return `
            <tr${classAttr}>
              <td>${item.assetClass}</td>
              <td>${weightIndicator}</td>
              <td>${item.comments}</td>
            </tr>
          `;
        }

        // Create weight indicator dots for normal positions
        const totalDots = 5;
        let dotsHtml = '';
        
        for (let i = 1; i <= totalDots; i++) {
          let dotClass = 'weight-dot';
          
          if (i === item.position) {
            // Only the selected position gets color
            if (i <= 2) {
              dotClass += ' filled underweight'; // Red for positions 1-2
            } else if (i === 3) {
              dotClass += ' filled neutral'; // Yellow for position 3
            } else {
              dotClass += ' filled overweight'; // Green for positions 4-5
            }
          } else {
            dotClass += ' empty'; // All other dots are empty/gray
          }
          
          dotsHtml += `<div class="${dotClass}" data-position="${i}"></div>`;
        }

        const weightIndicator = `
          <div class="weight-indicator">
            ${dotsHtml}
          </div>
        `;

        // Handle hidden comment cells
        const commentStyle = item.commentHidden ? ' style="display: none;"' : '';
        const commentContent = item.commentHidden ? '' : (item.comments || '');

        return `
          <tr${classAttr}>
            <td>${item.assetClass}</td>
            <td>${weightIndicator}</td>
            <td${commentStyle}>${commentContent}</td>
          </tr>
        `;
      };

      // Table 2: Weight indicator editing functionality
      function addTable2WeightIndicatorEditing() {
        const weightIndicators = document.querySelectorAll('#cio-view-body .weight-indicator');
        weightIndicators.forEach((indicator, index) => {
          // Handle hidden weight indicators (when position is -1)
          if (indicator.classList.contains('hidden')) {
            indicator.addEventListener('dblclick', function(e) {
              e.preventDefault();
              e.stopPropagation();
              
              const row = this.closest('tr');
              if (!row) return;
              const tbody = row.parentElement;
              if (!tbody) return;
              const rowIndex = Array.from(tbody.children).indexOf(row);
              
              if (window.cioViewData && window.cioViewData[rowIndex]) {
                showWeightEditPopover(this, window.cioViewData[rowIndex], rowIndex, 'cio-view');
              }
            });
            return; // Skip regular functionality for hidden indicators
          }

          // Single click for position selection (Table 2 only)
          indicator.addEventListener('click', function(e) {
            const dots = this.querySelectorAll('.weight-dot');
            const clickedDot = e.target.closest('.weight-dot');
            
            if (!clickedDot) return;
            
            const dotIndex = parseInt(clickedDot.getAttribute('data-position'));
            
            // Update the visual state - only the clicked dot gets color
            dots.forEach((dot, i) => {
              const dotPosition = parseInt(dot.getAttribute('data-position'));
              
              if (dotPosition === dotIndex) {
                // Only the selected position gets color
                if (dotIndex <= 2) {
                  dot.className = 'weight-dot filled underweight';
                } else if (dotIndex === 3) {
                  dot.className = 'weight-dot filled neutral';
                } else {
                  dot.className = 'weight-dot filled overweight';
                }
              } else {
                dot.className = 'weight-dot empty';
              }
            });
            
            // Update the data
            const row = this.closest('tr');
            if (!row) return;
            const tbody = row.parentElement;
            if (!tbody) return;
            const rowIndex = Array.from(tbody.children).indexOf(row);
            
            if (window.cioViewData && window.cioViewData[rowIndex]) {
              window.cioViewData[rowIndex].position = dotIndex;
              
              // Update weight based on position
              if (dotIndex <= 2) {
                window.cioViewData[rowIndex].weight = 'underweight';
              } else if (dotIndex === 3) {
                window.cioViewData[rowIndex].weight = 'neutral';
              } else {
                window.cioViewData[rowIndex].weight = 'overweight';
              }
              
              // Ensure fields exist
              if (window.cioViewData[rowIndex].separate === undefined) {
                window.cioViewData[rowIndex].separate = 0;
              }
              if (window.cioViewData[rowIndex].trend === undefined) {
                window.cioViewData[rowIndex].trend = 0;
              }
              
              saveDataToStorage();
              showWeightUpdateNotification();
            }
          });

          // Double click for weight editing or hiding dots
          indicator.addEventListener('dblclick', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const clickedDot = e.target.closest('.weight-dot');
            const row = this.closest('tr');
            if (!row) return;
            const tbody = row.parentElement;
            if (!tbody) return;
            const rowIndex = Array.from(tbody.children).indexOf(row);
            
            if (clickedDot && clickedDot.classList.contains('filled')) {
              // Open weight edit popover for filled dots
              if (window.cioViewData && window.cioViewData[rowIndex]) {
                showWeightEditPopover(clickedDot, window.cioViewData[rowIndex], rowIndex, 'cio-view');
              }
            } else {
              // Double-click on empty area - hide all dots (set position to -1)
              if (window.cioViewData && window.cioViewData[rowIndex]) {
                window.cioViewData[rowIndex].position = -1;
                window.cioViewData[rowIndex].weight = 'none';
                
                // Ensure fields exist
                if (window.cioViewData[rowIndex].separate === undefined) {
                  window.cioViewData[rowIndex].separate = 0;
                }
                if (window.cioViewData[rowIndex].trend === undefined) {
                  window.cioViewData[rowIndex].trend = 0;
                }
                
                // Regenerate Table 2
                const cioTbody = document.getElementById("cio-view-body");
                cioTbody.innerHTML = window.cioViewData.map((item, index) => window.createAssetClassRow(item, index, window.cioViewData)).join("");
                
                // Re-initialize functionality
                makeHeadersEditable();
                makeTextCellsEditable();
                addTable2WeightIndicatorEditing();
                
                saveDataToStorage();
                showWeightUpdateNotification();
              }
            }
          });
        });
      }

      // Table 2: Show weight update notification
      function showWeightUpdateNotification() {
        const notification = document.createElement('div');
        notification.textContent = 'Weight updated successfully!';
        notification.style.cssText = `
          position: fixed;
          top: 80px;
          right: 20px;
          background: #28a745;
          color: white;
          padding: 10px 15px;
          border-radius: 4px;
          z-index: 1001;
          font-size: 14px;
          box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 3000);
      }
    </script>

    <section class="bg-white shadow-md rounded-lg p-8">
      <h2 class="text-sm font-normal mb-6 pb-2 border-b border-gray-300">Current CIO views on asset classes with weight recommendations:</h2>
      <div class="overflow-x-auto">
        <table class="w-full factors-table">
          <thead>
            <tr>
              <th rowspan="2" class="align-middle">Asset Class</th>
              <th class="align-middle">CIO View</th>
              <th rowspan="2" class="align-middle">Comments</th>
            </tr>
            <tr>
              <th class="text-xs">
                <div class="flex justify-between px-4">
                  <span>Underweight</span>
                  <span>Neutral</span>
                  <span>Overweight</span>
                </div>
              </th>
            </tr>
          </thead>
          <tbody id="cio-view-body"></tbody>
        </table>
      </div>
      <div class="mt-4 text-xs text-gray-600">
        <p>*Asia Pac ex-Japan refers to the geographic area surrounding the Pacific Ocean.</p>
      </div>
    </section>
  </main>

  <!-- Table 3: Additional CIO Views with Weight Indicators and Trend Triangles -->
  <main class="max-w-7xl mx-auto mt-8 px-4">
    <!-- Table 3 Specific Styles -->
    <style>
      /* Trend triangles for Table 3 weight indicators */
      .trend-triangle {
        position: absolute;
        width: 0;
        height: 0;
        z-index: 10;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .trend-triangle:hover {
        transform: translateX(-50%) scale(1.1);
        filter: brightness(1.2);
      }

      .trend-triangle.left {
        border-left: 20px solid #ef4444;
        border-top: 10px solid transparent;
        border-bottom: 10px solid transparent;
        left: 100%;
        top: -6px;
        transform: translateX(-50%);
      }

      .trend-triangle.right {
        border-right: 20px solid #ef4444;
        border-top: 10px solid transparent;
        border-bottom: 10px solid transparent;
        top: -6px;
        transform: translateX(-50%);
      }

      /* Table 3 trend row highlights */
      .trend-row-up td:first-child,
      .trend-row-up td:nth-child(2) {
        border-top: 2px solid #ef2121 !important;
        border-bottom: 2px solid #ef2121 !important;
      }
      
      .trend-row-up td:first-child {
        border-left: 2px solid #ef2121 !important;
      }
      
      .trend-row-up td:nth-child(2) {
        border-right: 2px solid #ef2121 !important;
      }

      .trend-row-down td:first-child,
      .trend-row-down td:nth-child(2) {
        border-top: 2px solid #ef2121 !important;
        border-bottom: 2px solid #ef2121 !important;
      }
      
      .trend-row-down td:first-child {
        border-left: 2px solid #ef2121 !important;
      }
      
      .trend-row-down td:nth-child(2) {
        border-right: 2px solid #ef2121 !important;
      }

    

      /* Table 3 rows are clickable */
      #table3-view-body tr {
        cursor: pointer;
      }

      #table3-view-body tr:hover {
        background-color: #f8f9fa !important;
      }
    </style>

    <!-- Table 3 Specific JavaScript Functions -->
    <script>
      // Table 3: Enhanced createAssetClassRow with trend triangles
      window.createTable3sectorRow = function(item, index, allItems) {
        // Determine if row should have separation borders
        let rowClass = item.separate === 1 ? 'separated-row' : '';
        
        // Add trend border class if there's a trend
        if (item.trend === 1) {
          rowClass += ' trend-row-up';
        } else if (item.trend === -1) {
          rowClass += ' trend-row-down';
        }
        

        
        // Add class attribute if there are any classes
        const classAttr = rowClass ? ` class="${rowClass.trim()}"` : '';
        
        // If position is -1, hide all dots
        if (item.position === -1) {
          const weightIndicator = `
            <div class="weight-indicator hidden">
              <!-- No dots displayed when position is -1 -->
            </div>
          `;

          return `
            <tr${classAttr}>
              <td>${item.sector}</td>
              <td>${weightIndicator}</td>
              <td>${item.comments}</td>
            </tr>
          `;
        }

        // Create weight indicator dots for normal positions
        const totalDots = 5;
        let dotsHtml = '';
        
        for (let i = 1; i <= totalDots; i++) {
          let dotClass = 'weight-dot';
          let triangleHtml = '';
          
          if (i === item.position) {
            // Only the selected position gets color
            if (i <= 2) {
              dotClass += ' filled underweight'; // Red for positions 1-2
            } else if (i === 3) {
              dotClass += ' filled neutral'; // Yellow for position 3
            } else {
              dotClass += ' filled overweight'; // Green for positions 4-5
            }
          } else {
            dotClass += ' empty'; // All other dots are empty/gray
          }
          
          // Add trend triangle based on trend value and position
          if (item.trend !== undefined && item.trend !== 0 && item.position !== -1) {
            if (item.trend === 1 && i === (item.position - 1) && i >= 1) {
              // Show upward trend triangle on the dot to the LEFT of the selected position
              triangleHtml = '<div class="trend-triangle left"></div>';
            } else if (item.trend === -1 && i === (item.position + 1) && i <= 5) {
              // Show downward trend triangle on the dot to the RIGHT of the selected position  
              triangleHtml = '<div class="trend-triangle right"></div>';
            }
          }
          
          dotsHtml += `<div class="${dotClass}" data-position="${i}">${triangleHtml}</div>`;
        }

        const weightIndicator = `
          <div class="weight-indicator">
            ${dotsHtml}
          </div>
        `;

        // Handle hidden comment cells
        const commentStyle = item.commentHidden ? ' style="display: none;"' : '';
        const commentContent = item.commentHidden ? '' : (item.comments || '');

        return `
          <tr${classAttr}>
            <td>${item.sector}</td>
            <td>${weightIndicator}</td>
            <td${commentStyle}>${commentContent}</td>
          </tr>
        `;
      };

      // Table 3: Weight indicator editing functionality (double-click only)
      function addTable3WeightIndicatorEditing() {
        const weightIndicators = document.querySelectorAll('#table3-view-body .weight-indicator');
        weightIndicators.forEach((indicator, index) => {
          // Double click for editing
          indicator.addEventListener('dblclick', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const clickedTriangle = e.target.closest('.trend-triangle');
            const clickedDot = e.target.closest('.weight-dot');
            
            const row = this.closest('tr');
            const tbody = row.parentElement;
            const rowIndex = Array.from(tbody.children).indexOf(row);
            
            if (clickedTriangle) {
              // Handle trend triangle double-click
              showTrendEditPopover(clickedTriangle, window.table3ViewData[rowIndex], rowIndex, 'table3');
              return;
            } else if (clickedDot && clickedDot.classList.contains('filled')) {
              // Handle weight dot double-click for filled dots
              if (window.table3ViewData && window.table3ViewData[rowIndex]) {
                showWeightEditPopover(clickedDot, window.table3ViewData[rowIndex], rowIndex, 'table3');
              }
              return;
            } else {
              // Double-click on empty area - open popover
              if (window.table3ViewData && window.table3ViewData[rowIndex]) {
                showWeightEditPopover(this, window.table3ViewData[rowIndex], rowIndex, 'table3');
              }
            }
          });
        });
      }

      // Table 3: Row double-click functionality
      function addTable3RowEditing() {
        const table3Rows = document.querySelectorAll('#table3-view-body tr');
        table3Rows.forEach((row, index) => {
          row.addEventListener('dblclick', function(e) {
            // Prevent if already editing text or if clicking on an input
            if (e.target.tagName === 'INPUT' || e.target.closest('input')) {
              return;
            }
            
            e.preventDefault();
            e.stopPropagation();
            
            const tbody = this.parentElement;
            const rowIndex = Array.from(tbody.children).indexOf(this);
            
            if (window.table3ViewData && window.table3ViewData[rowIndex]) {
              // Open weight edit popover for this row
              const weightIndicator = this.querySelector('.weight-indicator');
              if (weightIndicator) {
                showWeightEditPopover(weightIndicator, window.table3ViewData[rowIndex], rowIndex, 'table3');
              } else {
                console.error('Weight indicator not found for Table 3 row:', rowIndex);
              }
            } else {
              console.error('Table 3 data not found for row:', rowIndex, 'Data:', window.table3ViewData);
            }
          });
          
          // Add visual feedback
          row.style.cursor = 'pointer';
          row.title = 'Double-click to edit weight settings';
        });
      }

      // Table 3: Show trend edit popover
      function showTrendEditPopover(triangle, data, rowIndex, tableType) {
        // Remove existing popover if any
        const existingPopover = document.querySelector('.trend-edit-popover');
        if (existingPopover) {
          existingPopover.remove();
        }

        // Create popover
        const popover = document.createElement('div');
        popover.className = 'trend-edit-popover';
        popover.style.cssText = `
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: white;
          border: 1px solid #ddd;
          border-radius: 8px;
          padding: 20px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
          z-index: 1000;
          min-width: 220px;
          font-size: 14px;
        `;

        // Create form content
        popover.innerHTML = `
          <h3 style="margin: 0 0 15px 0; font-size: 16px; font-weight: bold;">Edit Trend Direction</h3>
          
          <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Trend Direction:</label>
            <select id="popover-trend-direction" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
              <option value="0" ${data.trend === 0 ? 'selected' : ''}>No Trend</option>
              <option value="1" ${data.trend === 1 ? 'selected' : ''}>Upward Trend (→)</option>
              <option value="-1" ${data.trend === -1 ? 'selected' : ''}>Downward Trend (←)</option>
            </select>
            <div style="font-size: 12px; color: #666; margin-top: 5px;">
              Trend triangles show direction of movement relative to current position
            </div>
          </div>
          
          <div style="display: flex; gap: 10px; justify-content: flex-end;">
            <button onclick="closeTrendPopover()" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancel</button>
            <button onclick="saveTrendChanges(${rowIndex}, '${tableType}')" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Save</button>
          </div>
        `;

        document.body.appendChild(popover);
        window.currentTrendPopover = popover;

        // Close popover when clicking outside
        setTimeout(() => {
          document.addEventListener('click', closeTrendPopoverOnOutsideClick);
        }, 100);
      }

      // Table 3: Trend popover utility functions
      function closeTrendPopoverOnOutsideClick(e) {
        const popover = document.querySelector('.trend-edit-popover');
        if (popover && !popover.contains(e.target)) {
          closeTrendPopover();
        }
      }

      window.closeTrendPopover = function() {
        const popover = document.querySelector('.trend-edit-popover');
        if (popover) {
          popover.remove();
          document.removeEventListener('click', closeTrendPopoverOnOutsideClick);
        }
      };

      window.saveTrendChanges = function(rowIndex, tableType) {
        const trendValue = parseInt(document.getElementById('popover-trend-direction').value);

        // Update the data
        if (tableType === 'table3' && window.table3ViewData && window.table3ViewData[rowIndex]) {
          window.table3ViewData[rowIndex].trend = trendValue;
          
          // Regenerate Table 3 to reflect changes
          const table3Tbody = document.getElementById("table3-view-body");
          table3Tbody.innerHTML = window.table3ViewData.map(window.createTable3sectorRow).join("");
          
          // Re-initialize editable functionality
          makeHeadersEditable();
          makeTextCellsEditable();
          addTable3WeightIndicatorEditing();
          addTable3RowEditing();
          
          console.log(`Updated trend for Table 3 row ${rowIndex} to ${trendValue}`);
        }

        // Save changes
        saveDataToStorage();
        closeTrendPopover();
        showTrendUpdateNotification();
      };

      // Table 3: Show trend update notification
      function showTrendUpdateNotification() {
        const notification = document.createElement('div');
        notification.textContent = 'Trend direction updated successfully!';
        notification.style.cssText = `
          position: fixed;
          top: 80px;
          right: 20px;
          background: #28a745;
          color: white;
          padding: 10px 15px;
          border-radius: 4px;
          z-index: 1001;
          font-size: 14px;
          box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 3000);
      }
    </script>

    <section class="bg-white shadow-md rounded-lg p-8">
      <h2 class="text-sm font-normal mb-6 pb-2 border-b border-gray-300">Additional CIO views on asset classes with weight recommendations:</h2>
      <div class="overflow-x-auto">
        <table class="w-full factors-table">
          <thead>
            <tr>
              <th rowspan="2" class="align-middle">Sector</th>
              <th class="align-middle">CIO View</th>
              <th rowspan="2" class="align-middle">Comments</th>
            </tr>
            <tr>
              <th class="text-xs">
                <div class="flex justify-between px-4">
                  <span>Underweight</span>
                  <span>Neutral</span>
                  <span>Overweight</span>
                </div>
              </th>
            </tr>
          </thead>
          <tbody id="table3-view-body"></tbody>
        </table>
      </div>
      <div class="mt-4 text-xs text-gray-600">
        <p>*This table represents additional asset class considerations for portfolio construction.</p>
      </div>
    </section>
  </main>

  <!-- Table 4: New Table with Weight Indicators -->
  <main class="max-w-7xl mx-auto mt-8 px-4">
    <!-- Table 4 Specific Styles -->
    <style>
      /* Table 4 specific weight indicator styles */
      .table4-weight-indicator {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 8px;
        padding: 8px 0;
        min-width: 200px;
      }

      .table4-weight-dot {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        border: 2px solid #ddd;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .table4-weight-dot.filled {
        border-color: transparent;
      }

      .table4-weight-dot.empty {
        background-color: #f9f9f9;
        border-color: #ccc;
      }

      /* Weight dot colors based on position */
      .table4-weight-dot.filled.overweight { background-color: #4CAF50; } /* Green */
      .table4-weight-dot.filled.neutral { background-color: #FFC107; } /* Yellow */
      .table4-weight-dot.filled.underweight { background-color: #ef4444; } /* Red */

      /* Hover effects for weight dots */
      .table4-weight-dot:hover {
        transform: scale(1.2);
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      }

      .table4-weight-dot.empty:hover { border-color: #666; }
      .table4-weight-dot.filled.overweight:hover { border-color: #2E7D32; }
      .table4-weight-dot.filled.neutral:hover { border-color: #F57F17; }
      .table4-weight-dot.filled.underweight:hover { border-color: #E65100; }

      /* Vertical range indicator for Alternative Investments */
      .table4-vertical-range {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 8px 0;
        min-width: 200px;
        position: relative;
      }

      .table4-range-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0;
        position: relative;
      }

      .table4-range-dot {
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background-color: #999;
        border: 2px solid #999;
        z-index: 2;
        position: relative;
      }

      .table4-range-line {
        width: 4px;
        height: 35px;
        background-color: #999;
        position: relative;
        z-index: 1;
      }

      /* Table 4 rows styling */
      #table4-view-body tr {
        cursor: default;
      }

      #table4-view-body tr:hover {
        background-color: #f8f9fa !important;
      }

      /* Flexbox layout for Alternative Investments section */
      .alt-investments-section {
        border-bottom: 2px solid #333;
        background-color: white;
      }

      .alt-investments-header {
        font-weight: normal;
        padding: 12px;
        border-bottom: 2px solid #333;
      }

      .alt-investments-content {
        display: flex;
        align-items: stretch;
        min-height: 150px;
      }

      .alt-investments-labels {
        flex: 0 0 250px;
        display: flex;
        flex-direction: column;
        justify-content: space-around;
        padding: 20px 12px;
      }

      .alt-investment-label {
        padding: 8px 0;
        font-weight: normal;
      }

      .alt-investments-indicator {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
      }

      /* Cash row with flexbox */
      .cash-row-flex {
        display: flex;
        border-bottom: 2px solid #333;
        background-color: white;
        padding: 12px;
      }

      .cash-label {
        flex: 0 0 250px;
        font-weight: normal;
      }

      .cash-indicator {
        flex: 1;
      }

      /* Override global bold font for Table 4 first column */
      #table4-view-body td:first-child {
        font-weight: normal;
      }

      /* Override bold font for Table 4 headers */
      .factors-table thead th.align-middle {
        font-weight: normal;
      }

      /* Ensure Table 4 headers specifically are not bold */
      #table4-view-body ~ table thead th,
      table.factors-table:has(#table4-view-body) thead th {
        font-weight: normal !important;
      }
    </style>

    <!-- Table 4 Specific JavaScript Functions -->
    <script>
      // Table 4: Create table row with weight indicators (matching the image structure)
      window.createTable4Row = function(item, index, allItems) {
        
        // Handle Alternative Investments header - return empty, will be handled separately
        if (item.isHeader) {
          return '';
        }

        // Handle Alternative Investments items - return empty, will be handled separately
        if (item.isAltInvestment) {
          return '';
        }

        // Handle Cash row - return empty, will be handled separately
        if (item.isCash) {
          return '';
        }

        // Determine if row should have separation borders
        const rowClass = item.separate === 1 ? ' class="separated-row"' : '';

        // Create weight indicator dots for normal positions using the same markup as Table 2
        const totalDots = 5;
        let dotsHtml = '';

        for (let i = 1; i <= totalDots; i++) {
          let dotClass = 'weight-dot';

          // Fill logic - only the selected position shows filled color
          if (i === item.position) {
            if (i <= 2) {
              dotClass += ' filled underweight';
            } else if (i === 3) {
              dotClass += ' filled neutral';
            } else {
              dotClass += ' filled overweight';
            }
          } else {
            dotClass += ' empty';
          }

          dotsHtml += `<div class="${dotClass}" data-position="${i}" title="Position ${i}"></div>`;
        }

        const weightIndicator = `
          <div class="weight-indicator">
            ${dotsHtml}
          </div>
        `;

        return `
          <tr${rowClass} data-row-index="${index}">
            <td>${item.name}</td>
            <td>${weightIndicator}</td>
          </tr>
        `;
      };

      // Table 4: Weight indicator editing functionality (mirror Table 2 behavior)
      function addTable4WeightIndicatorEditing() {
        const weightIndicators = document.querySelectorAll('#table4-view-body .weight-indicator');
        weightIndicators.forEach((indicator, index) => {
          // Handle hidden weight indicators (when position is -1)
          if (indicator.classList.contains('hidden')) {
            indicator.addEventListener('dblclick', function(e) {
              e.preventDefault();
              e.stopPropagation();

              const row = this.closest('tr');
              if (!row) return;
              const tbody = row.parentElement;
              if (!tbody) return;
              const rowIndex = Array.from(tbody.children).indexOf(row);

              if (window.table4ViewData && window.table4ViewData[rowIndex]) {
                showWeightEditPopover(this, window.table4ViewData[rowIndex], rowIndex, 'table4');
              }
            });
            return; // Skip regular functionality for hidden indicators
          }

          // Single click for quick position selection
          indicator.addEventListener('click', function(e) {
            const dots = this.querySelectorAll('.weight-dot');
            const clickedDot = e.target.closest('.weight-dot');
            if (!clickedDot) return;

            const dotIndex = parseInt(clickedDot.getAttribute('data-position'));

            // Update visual state
            dots.forEach((dot) => {
              const dotPosition = parseInt(dot.getAttribute('data-position'));
              if (dotPosition === dotIndex) {
                if (dotIndex <= 2) dot.className = 'weight-dot filled underweight';
                else if (dotIndex === 3) dot.className = 'weight-dot filled neutral';
                else dot.className = 'weight-dot filled overweight';
              } else {
                dot.className = 'weight-dot empty';
              }
            });

            // Update data model
            const row = this.closest('tr');
            if (!row) return;
            const tbody = row.parentElement;
            if (!tbody) return;
            const rowIndex = Array.from(tbody.children).indexOf(row);

            if (window.table4ViewData && window.table4ViewData[rowIndex]) {
              window.table4ViewData[rowIndex].position = dotIndex;
              if (dotIndex <= 2) window.table4ViewData[rowIndex].weight = 'underweight';
              else if (dotIndex === 3) window.table4ViewData[rowIndex].weight = 'neutral';
              else window.table4ViewData[rowIndex].weight = 'overweight';

              if (window.table4ViewData[rowIndex].separate === undefined) window.table4ViewData[rowIndex].separate = 0;
              if (window.table4ViewData[rowIndex].trend === undefined) window.table4ViewData[rowIndex].trend = 0;

              saveDataToStorage();
              showWeightUpdateNotification();
            }
          });

          // Double click behavior (open popover on filled dot, hide on empty area)
          indicator.addEventListener('dblclick', function(e) {
            e.preventDefault();
            e.stopPropagation();

            const clickedDot = e.target.closest('.weight-dot');
            const row = this.closest('tr');
            if (!row) return;
            const tbody = row.parentElement;
            if (!tbody) return;
            const rowIndex = Array.from(tbody.children).indexOf(row);

            if (clickedDot && clickedDot.classList.contains('filled')) {
              if (window.table4ViewData && window.table4ViewData[rowIndex]) {
                showWeightEditPopover(clickedDot, window.table4ViewData[rowIndex], rowIndex, 'table4');
              }
            } else {
              if (window.table4ViewData && window.table4ViewData[rowIndex]) {
                window.table4ViewData[rowIndex].position = -1;
                window.table4ViewData[rowIndex].weight = 'none';

                if (window.table4ViewData[rowIndex].separate === undefined) window.table4ViewData[rowIndex].separate = 0;
                if (window.table4ViewData[rowIndex].trend === undefined) window.table4ViewData[rowIndex].trend = 0;

                const tbodyElem = document.getElementById('table4-view-body');
                tbodyElem.innerHTML = window.table4ViewData.map(window.createTable4Row).join('');

                makeHeadersEditable();
                makeTextCellsEditable();
                addTable4WeightIndicatorEditing();

                saveDataToStorage();
                showWeightUpdateNotification();
              }
            }
          });
        });
      }

      // Table 4: Render Alternative Investments and Cash with Flexbox
      function renderTable4SpecialSections() {
        if (!window.table4ViewData || !Array.isArray(window.table4ViewData)) return;
        
        // Find Alternative Investments items
        const altInvestments = window.table4ViewData.filter(item => item.isAltInvestment);
        const cashItem = window.table4ViewData.find(item => item.isCash);
        
        // Render Alternative Investments Section
        if (altInvestments.length > 0) {
          const altInvestmentsHtml = `
            <div class="alt-investments-section">
              <div class="alt-investments-header">Alternative Investments*</div>
              <div class="alt-investments-content">
                <div class="alt-investments-labels">
                  ${altInvestments.map(item => `
                    <div class="alt-investment-label">${item.name}</div>
                  `).join('')}
                </div>
                <div class="alt-investments-indicator">
                  <div class="table4-vertical-range">
                    <div class="table4-range-container">
                      <div class="table4-range-dot"></div>
                      <div class="table4-range-line"></div>
                      <div class="table4-range-dot"></div>
                      <div class="table4-range-line"></div>
                      <div class="table4-range-dot"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          `;
          
          document.getElementById('alt-investments-container').innerHTML = altInvestmentsHtml;
        }
        
        // Render Cash Row
        if (cashItem) {
          const cashHtml = `
            <div class="cash-row-flex">
              <div class="cash-label">${cashItem.name}</div>
              <div class="cash-indicator"></div>
            </div>
          `;
          
          document.getElementById('cash-row-container').innerHTML = cashHtml;
        }
      }

      // Table 4: Row double-click functionality (mirror Table 3/Table2 behavior)
      function addTable4RowEditing() {
        // Render special sections first
        renderTable4SpecialSections();
        
        // Add double-click to rows for weight editing
        const table4Rows = document.querySelectorAll('#table4-view-body tr');
        table4Rows.forEach((row, index) => {
          row.addEventListener('dblclick', (e) => {
            // Only trigger if not clicking on weight indicator or editable cells
            if (e.target.closest('.weight-indicator') || e.target.closest('td:first-child') || e.target.closest('td:last-child')) return;
            
            const rowIndex = parseInt(row.dataset.rowIndex);
            const data = window.table4ViewData[rowIndex];
            
            if (data) {
              const weightIndicator = row.querySelector('.weight-indicator');
              showWeightEditPopover(weightIndicator, data, rowIndex, 'table4');
            }
          });
          
          row.title = 'Double-click to edit weight settings';
        });

        // Add double-click to first column (Asset Class name) for text editing
        const table4FirstCells = document.querySelectorAll('#table4-view-body td:first-child');
        table4FirstCells.forEach((cell, index) => {
          cell.addEventListener('dblclick', function() {
            const currentText = cell.textContent;
            const input = document.createElement('input');
            input.type = 'text';
            input.value = currentText;
            input.style.width = '100%';
            input.style.fontFamily = 'inherit';
            input.style.fontSize = 'inherit';
            input.style.fontWeight = 'inherit';
            
            cell.textContent = '';
            cell.appendChild(input);
            input.focus();
            input.select();
            
            const saveEdit = () => {
              const newText = input.value.trim();
              if (newText && newText !== currentText) {
                cell.textContent = newText;
                
                // Update the data
                const row = cell.closest('tr');
                const rowIndex = parseInt(row.dataset.rowIndex);
                if (window.table4ViewData[rowIndex]) {
                  window.table4ViewData[rowIndex].name = newText;
                  saveDataToStorage();
                  showUpdateNotification('Asset class name updated successfully!');
                }
              } else {
                cell.textContent = currentText;
              }
            };
            
            input.addEventListener('blur', saveEdit);
            input.addEventListener('keydown', function(e) {
              if (e.key === 'Enter') {
                e.preventDefault();
                saveEdit();
              } else if (e.key === 'Escape') {
                cell.textContent = currentText;
              }
            });
          });
          
          cell.style.cursor = 'pointer';
          cell.title = 'Double-click to edit asset class name';
        });

        // Add double-click to last column (Comments) for advanced editing with merge - NOT APPLICABLE for Table 4
        // Table 4 has only 2 columns, so we skip this section
      }
    </script>

    <section class="bg-white shadow-md rounded-lg p-8">
      <h2 id="table4-subtitle" class="text-sm font-normal mb-6 pb-2 border-b border-gray-300">Current CIO views on asset classes with weight recommendations:</h2>
      <div class="overflow-x-auto">
        <table class="w-full factors-table">
          <thead>
            <tr>
              <th rowspan="2" class="align-middle">Asset Class</th>
              <th class="align-middle">CIO View</th>
            </tr>
            <tr>
              <th class="text-xs">
                <div class="flex justify-between px-4">
                  <span>Underweight</span>
                  <span>Neutral</span>
                  <span>Overweight</span>
                </div>
              </th>
            </tr>
          </thead>
          <tbody id="table4-view-body">
            <!-- Table 4 rows will be inserted here by JavaScript -->
          </tbody>
        </table>
        
        <!-- Alternative Investments Section with Flexbox -->
        <div id="alt-investments-container"></div>
        
        <!-- Cash Row with Flexbox -->
        <div id="cash-row-container"></div>
      </div>
      <div class="text-xs text-gray-600">
        <p class="font-bold" id="table4-footnote">*Alternative Investments include Hedge Strategies, Private Equity & Credit, and Real Assets.</p>
      </div>
    </section>
  </main>

  <!-- Table 5: Thematic Investment Opportunities -->
  <main class="max-w-7xl mx-auto mt-8 px-4">
    <!-- Table 5 Specific Styles -->
    <style>
      /* Table 5 specific styles */
      .table5-container {
        border-collapse: separate;
        border-spacing: 30px 8px;
        width: 100%;
        font-family: Arial, sans-serif;
      }

      .table5-container th {
        background-color: #f8f9fa;
        font-weight: bold;
        text-align: left;
        padding: 12px;
        border-top: 2px solid #333;
        border-bottom: 2px solid #333;
        font-size: 16px;
      }

      .table5-container td {
        padding: 18px 12px;
        vertical-align: top;
        border: none;
      }

      /* Level 1 column styling */
      .table5-level1 {
        width: 35%;
        padding-right: 20px;
        position: relative;
      }

      .table5-level1-title {
        color: #0066cc;
        font-weight: bold;
        font-size: 16px;
        margin-bottom: 8px;
      }

      .table5-level1-list {
        list-style: none;
        padding-left: 0;
        margin: 0;
      }

      .table5-level1-list li {
        padding-left: 18px;
        margin-bottom: 5px;
        position: relative;
        font-size: 14px;
        line-height: 1.5;
      }

      .table5-level1-list li:before {
        content: "●";
        position: absolute;
        left: 0;
        color: #0066cc;
        font-size: 8px;
        top: 6px;
      }

      /* Red arrow indicator - auto adjusts to row height */
      .table5-arrow {
        position: absolute;
        right: -22px;
        top: 0;
        bottom: 0;
        width: 45px;
        background: linear-gradient(to right, transparent 0%, transparent 50%, #ef4444 50%, #ef4444 100%);
        clip-path: polygon(0 0, 50% 0, 100% 50%, 50% 100%, 0 100%);
        z-index: 1;
      }

      /* Level 2 column styling */
      .table5-level2 {
        width: 65%;
        padding-left: 40px;
        font-size: 14px;
        line-height: 1.6;
      }

      .table5-level2-item {
        margin-bottom: 8px;
      }

      .table5-level2-header {
        font-weight: bold;
        display: inline;
        color: #000;
      }

      .table5-level2-description {
        display: inline;
        color: #333;
      }

      /* Make cells editable on double-click */
      .table5-level1-title:hover,
      .table5-level1-list li:hover,
      .table5-level2:hover {
        background-color: #f8f9fa;
        cursor: pointer;
      }

      /* Same gray color for all rows */
      .table5-row:nth-child(even),
      .table5-row:nth-child(odd) {
        background-color: #f3f4f6;
      }
    </style>

    <!-- Table 5 Specific JavaScript Functions -->
    <script>
      // Table 5: Create thematic investment row
      window.createTable5Row = function(item, index) {
        
        // Generate Level 1 list items
        const level1Items = item.level1Items.map(subItem => 
          `<li>${subItem}</li>`
        ).join('');

        // Generate Level 2 description items
        const level2Items = item.level2Items.map(desc => 
          `<div class="table5-level2-item">
            <span class="table5-level2-header">${desc.header}:</span> 
            <span class="table5-level2-description">${desc.description}</span>
          </div>`
        ).join('');

        return `
          <tr class="table5-row" data-row-index="${index}">
            <td class="table5-level1">
              <div class="table5-level1-title">${item.category}</div>
              <ul class="table5-level1-list">
                ${level1Items}
              </ul>
              <div class="table5-arrow"></div>
            </td>
            <td class="table5-level2">
              ${level2Items}
            </td>
          </tr>
        `;
      };

      // Table 5: Comprehensive editing functionality
      function addTable5Editing() {
        // Make table headers editable
        const table5Headers = document.querySelectorAll('#table5-container th');
        table5Headers.forEach((header, index) => {
          header.addEventListener('dblclick', (e) => {
            e.stopPropagation();
            makeElementEditable(header, () => {
              console.log('Header updated:', header.textContent);
            });
          });
        });

        const table5Rows = document.querySelectorAll('#table5-body tr');
        
        table5Rows.forEach((row, rowIndex) => {
          // Disable any row-level editing - remove all event listeners on the row itself
          row.style.cursor = 'default';
          row.onclick = null;
          row.ondblclick = null;
          
          // Disable any row-level click events for Level 1 column
          const level1Column = row.querySelector('td:first-child');
          if (level1Column) {
            level1Column.style.cursor = 'default';
            level1Column.onclick = null;
            level1Column.ondblclick = null;
            level1Column.addEventListener('click', (e) => {
              e.stopPropagation();
              // Prevent any row-level editing
            });
            level1Column.addEventListener('dblclick', (e) => {
              e.stopPropagation();
              // Prevent any row-level editing
            });
          }

          // Make category title editable (double-click only)
          const title = row.querySelector('.table5-level1-title');
          if (title) {
            title.style.cursor = 'pointer';
            title.addEventListener('dblclick', (e) => {
              e.stopPropagation();
              makeElementEditable(title, () => {
                if (window.table5ViewData && window.table5ViewData.assetClasses && window.table5ViewData.assetClasses[rowIndex]) {
                  window.table5ViewData.assetClasses[rowIndex].category = title.textContent;
                  saveDataToStorage();
                }
              }, {
                fontSize: '16px',
                fontWeight: 'bold',
                color: '#0066cc'
              });
            });
          }

          // Make bullet points editable (double-click only)
          const listItems = row.querySelectorAll('.table5-level1-list li');
          listItems.forEach((li, liIndex) => {
            li.style.cursor = 'pointer';
            li.addEventListener('dblclick', (e) => {
              e.stopPropagation();
              makeElementEditable(li, () => {
                if (window.table5ViewData && window.table5ViewData.assetClasses && window.table5ViewData.assetClasses[rowIndex]) {
                  window.table5ViewData.assetClasses[rowIndex].items[liIndex] = li.textContent;
                  saveDataToStorage();
                }
              });
            });
          });

          // Make Level 2 items editable
          const level2Items = row.querySelectorAll('.table5-level2-item');
          level2Items.forEach((item, itemIndex) => {
            const header = item.querySelector('.table5-level2-header');
            const description = item.querySelector('.table5-level2-description');
            
            // Edit header
            if (header) {
              header.addEventListener('dblclick', (e) => {
                e.stopPropagation();
                const headerText = header.textContent.replace(':', '').trim();
                makeElementEditable(header, () => {
                  if (window.table5ViewData && window.table5ViewData.assetClasses && window.table5ViewData.assetClasses[rowIndex]) {
                    window.table5ViewData.assetClasses[rowIndex].descriptions[itemIndex].title = header.textContent.replace(':', '').trim();
                    header.textContent = header.textContent.replace(':', '').trim() + ':';
                    saveDataToStorage();
                  }
                }, { fontWeight: 'bold' });
              });
            }

            // Edit description
            if (description) {
              description.addEventListener('dblclick', (e) => {
                e.stopPropagation();
                makeElementEditable(description, () => {
                  if (window.table5ViewData && window.table5ViewData.assetClasses && window.table5ViewData.assetClasses[rowIndex]) {
                    window.table5ViewData.assetClasses[rowIndex].descriptions[itemIndex].description = description.textContent.trim();
                    saveDataToStorage();
                  }
                });
              });
            }
          });
        });
      }

      // Helper function to make any element editable
      function makeElementEditable(element, onSave, customStyles = {}) {
        const originalText = element.textContent;
        const input = document.createElement('input');
        input.value = originalText;
        
        const defaultStyles = {
          width: '100%',
          fontSize: 'inherit',
          fontWeight: 'inherit',
          color: 'inherit',
          fontFamily: 'inherit',
          background: '#fff3cd',
          border: '1px solid #ffc107',
          borderRadius: '2px',
          padding: '2px 4px',
          outline: 'none'
        };
        
        const styles = { ...defaultStyles, ...customStyles };
        Object.assign(input.style, styles);
        
        element.innerHTML = '';
        element.appendChild(input);
        input.focus();
        input.select();
        
        const saveEdit = () => {
          const newValue = input.value.trim();
          element.textContent = newValue || originalText;
          if (onSave) onSave();
        };
        
        const cancelEdit = () => {
          element.textContent = originalText;
        };
        
        input.addEventListener('blur', saveEdit);
        input.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') saveEdit();
          if (e.key === 'Escape') cancelEdit();
        });
      }
    </script>

    <section class="bg-white shadow-md rounded-lg p-8">
      <h2 id="table5-subtitle" class="text-sm font-normal mb-6 pb-2 border-b border-gray-300">Thematic Investment Opportunities Across Multiple Horizons</h2>
      <div class="overflow-x-auto">
        <table class="table5-container">
          <thead>
            <tr>
              <th>Level 1</th>
              <th>Level 2</th>
            </tr>
          </thead>
          <tbody id="table5-body">
            <!-- Table 5 rows will be inserted here by JavaScript -->
          </tbody>
        </table>
      </div>
      <div class="mt-4 text-xs text-gray-600">
        💡 Double-click any text to edit categories, items, or descriptions.
      </div>
    </section>
  </main>

  <!-- Table 6: Economic Forecasts -->
  <main class="max-w-7xl mx-auto mt-8 px-4">
    <!-- Table 6 Specific Styles -->
    <style>
      /* Table 6 Economic Forecasts specific styles */
      .table6-container {
        border-collapse: collapse;
        width: 100%;
        font-family: Arial, sans-serif;
        font-size: 15px;
        border-top: 3px solid #000;
      }

      .table6-container th {
        background-color: white;
        color: #000;
        padding: 10px 12px;
        text-align: center;
        font-weight: bold;
        border-bottom: 2px solid #000;
        font-size: 14px;
      }

      .table6-container th:first-child {
        text-align: left;
        border-right: none;
      }

      .table6-container td {
        padding: 12px 12px;
        text-align: center;
        border: none;
        font-size: 15px;
      }

      .table6-container tbody td:first-child {
        text-align: left;
        font-weight: bold;
        width: 250px;
        padding-left: 12px;
        line-height: 1.4;
      }

      /* Alternating row colors - even rows (2nd, 4th, 6th) are gray */
      .table6-container tbody tr:nth-child(even) td {
        background-color: #e8e8e8;
      }

      /* Odd rows (1st, 3rd, 5th) are white */
      .table6-container tbody tr:nth-child(odd) td {
        background-color: white;
      }

      .table6-container tbody tr:last-child td {
        border-bottom: 2px solid #000;
      }

      /* Header styling */
      .table6-header {
        color: #1e5ba8;
        padding: 10px 12px;
        font-size: 18px;
        text-align: left;
        margin-bottom: 0;
        letter-spacing: 0.5px;
      }

      .table6-date {
        color: #1e5ba8;
        font-size: 18px;
      }

      /* Editable header elements */
      #table6-title:hover,
      #table6-date-text:hover,
      #table6-footnote:hover {
        background-color: #f0f0f0;
        border-radius: 3px;
        padding: 2px 4px;
        transition: background-color 0.2s ease;
        cursor: pointer;
      }

      /* Editable table column headers */
      .table6-container thead th:hover {
        background-color: #f0f0f0;
        cursor: pointer;
        transition: background-color 0.2s ease;
      }

      /* Remove subtitle styling */
      #table6-subtitle {
        display: none;
      }

      /* Editable cell styling */
      .table6-container td:hover {
        background-color: #e3f2fd;
        cursor: pointer;
      }

      .table6-container td input {
        border: none;
        background: transparent;
        width: 100%;
        text-align: center;
        font-family: inherit;
        font-size: inherit;
      }

      .table6-container td:first-child input {
        text-align: left;
      }

      .table6-container td input:focus {
        outline: 2px solid #2196f3;
        background-color: #fff;
        border-radius: 2px;
      }
    </style>

    <!-- Table 6 Specific JavaScript Functions -->
    <script>
      // Table 6: Create economic forecast row
      window.createTable6Row = function(item, index) {
        // Economic indicator name
        let html = '<tr class="table6-row">';
        html += `<td data-field="indicator">${item.indicator || ''}</td>`;
        
        // Quarterly data columns
        const quarters = ['q1_2025a', 'q2_2025a', 'q3_2025e', 'q4_2025e', '2025e', '2026e'];
        quarters.forEach(quarter => {
          html += `<td data-field="${quarter}">${item[quarter] || '-'}</td>`;
        });
        
        html += '</tr>';
        return html;
      };

      // Table 6: Add editing functionality
      function addTable6Editing() {
        console.log('Initializing Table 6 editing...');
        
        const table6Body = document.getElementById('table6-body');
        if (!table6Body) {
          console.warn('Table 6 body not found!');
          return;
        }

        // Make all cells editable on double-click
        table6Body.addEventListener('dblclick', function(e) {
          const cell = e.target.closest('td');
          if (!cell) return;

          const field = cell.getAttribute('data-field');
          const rowIndex = Array.from(table6Body.children).indexOf(cell.closest('tr'));
          
          makeTable6CellEditable(cell, field, rowIndex);
        });

        // Make header title editable
        const table6Title = document.getElementById('table6-title');
        console.log('Table 6 title element:', table6Title);
        if (table6Title) {
          table6Title.addEventListener('dblclick', function(e) {
            console.log('Title double-clicked!');
            e.stopPropagation();
            makeTable6HeaderEditable(table6Title, 'title');
          });
          console.log('Title event listener added');
        } else {
          console.warn('Table 6 title element not found!');
        }

        // Make header date editable
        const table6Date = document.getElementById('table6-date-text');
        console.log('Table 6 date element:', table6Date);
        if (table6Date) {
          table6Date.addEventListener('dblclick', function(e) {
            console.log('Date double-clicked!');
            e.stopPropagation();
            makeTable6HeaderEditable(table6Date, 'date');
          });
          console.log('Date event listener added');
        } else {
          console.warn('Table 6 date element not found!');
        }

        // Make footnote editable
        const table6Footnote = document.getElementById('table6-footnote');
        console.log('Table 6 footnote element:', table6Footnote);
        if (table6Footnote) {
          table6Footnote.addEventListener('dblclick', function(e) {
            console.log('Footnote double-clicked!');
            e.stopPropagation();
            makeTable6FootnoteEditable(table6Footnote);
          });
          console.log('Footnote event listener added');
        } else {
          console.warn('Table 6 footnote element not found!');
        }

        // Make table column headers editable
        const table6Headers = document.querySelectorAll('.table6-container thead th');
        console.log('Found', table6Headers.length, 'column headers');
        table6Headers.forEach((header, index) => {
          header.addEventListener('dblclick', function(e) {
            console.log('Column header', index, 'double-clicked!');
            e.stopPropagation();
            makeTable6ColumnHeaderEditable(header, index);
          });
        });
        
        console.log('Table 6 editing initialization complete');
      }

      // Table 6: Make header editable
      function makeTable6HeaderEditable(element, field) {
        if (element.querySelector('input')) return; // Already editing

        const originalText = element.textContent;
        const input = document.createElement('input');
        input.type = 'text';
        input.value = originalText;
        input.style.cssText = `
          background: #fff3cd;
          border: 1px solid #ffc107;
          border-radius: 2px;
          padding: 2px 6px;
          font-size: inherit;
          font-weight: inherit;
          color: inherit;
          outline: none;
        `;
        
        // Clear element and add input
        element.innerHTML = '';
        element.appendChild(input);
        input.focus();
        input.select();

        // Save on Enter or blur
        function saveEdit() {
          const newValue = input.value.trim();
          element.textContent = newValue || originalText;
          
          // Update metadata
          if (window.table6MetaData) {
            if (field === 'title') {
              window.table6MetaData.title = newValue;
            } else if (field === 'date') {
              if (!window.table6MetaData.headers) {
                window.table6MetaData.headers = {};
              }
              window.table6MetaData.headers.dateHeader = newValue;
            }
            saveDataToStorage();
            showTable6UpdateNotification();
          }
        }

        input.addEventListener('blur', saveEdit);
        input.addEventListener('keydown', function(e) {
          if (e.key === 'Enter') {
            e.preventDefault();
            saveEdit();
          } else if (e.key === 'Escape') {
            element.textContent = originalText;
          }
        });
      }

      // Table 6: Make footnote editable
      function makeTable6FootnoteEditable(element) {
        if (element.querySelector('textarea')) return; // Already editing

        const originalText = element.textContent.trim();
        const textarea = document.createElement('textarea');
        textarea.value = originalText;
        textarea.style.cssText = `
          background: #fff3cd;
          border: 1px solid #ffc107;
          border-radius: 4px;
          padding: 8px;
          font-size: inherit;
          font-family: inherit;
          color: inherit;
          outline: none;
          width: 100%;
          min-height: 120px;
          resize: vertical;
        `;
        
        // Clear element and add textarea
        element.innerHTML = '';
        element.appendChild(textarea);
        textarea.focus();
        textarea.select();

        // Save on blur
        function saveEdit() {
          const newValue = textarea.value.trim();
          element.textContent = newValue || originalText;
          
          // Update metadata
          if (window.table6MetaData) {
            window.table6MetaData.footnote = newValue;
            saveDataToStorage();
            showTable6UpdateNotification();
          }
        }

        textarea.addEventListener('blur', saveEdit);
        textarea.addEventListener('keydown', function(e) {
          // Save on Ctrl+Enter or Cmd+Enter
          if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
            e.preventDefault();
            saveEdit();
          } else if (e.key === 'Escape') {
            element.textContent = originalText;
          }
        });
      }

      // Table 6: Make column header editable
      function makeTable6ColumnHeaderEditable(header, index) {
        if (header.querySelector('input')) return; // Already editing

        const originalText = header.textContent.trim();
        const input = document.createElement('input');
        input.type = 'text';
        input.value = originalText;
        input.style.cssText = `
          background: #fff3cd;
          border: 1px solid #ffc107;
          border-radius: 2px;
          padding: 4px 8px;
          font-size: inherit;
          font-weight: inherit;
          text-align: center;
          color: inherit;
          outline: none;
          width: 100%;
        `;
        
        // Clear header and add input
        header.innerHTML = '';
        header.appendChild(input);
        input.focus();
        input.select();

        // Save on Enter or blur
        function saveEdit() {
          const newValue = input.value.trim();
          header.textContent = newValue || originalText;
          
          // Update metadata
          if (window.table6MetaData) {
            if (!window.table6MetaData.headers) {
              window.table6MetaData.headers = {};
            }
            
            // Map index to column names
            const columnNames = ['empty', 'Q1 2025A', 'Q2 2025A', 'Q3 2025E', 'Q4 2025E', '2025E', '2026E'];
            const columnKey = `column${index}`;
            
            if (index === 0) {
              window.table6MetaData.headers.firstColumn = newValue;
            } else {
              window.table6MetaData.headers[columnKey] = newValue;
            }
            
            saveDataToStorage();
            showTable6UpdateNotification();
          }
        }

        input.addEventListener('blur', saveEdit);
        input.addEventListener('keydown', function(e) {
          if (e.key === 'Enter') {
            e.preventDefault();
            saveEdit();
          } else if (e.key === 'Escape') {
            header.textContent = originalText;
          }
        });
      }

      // Table 6: Make cell editable
      function makeTable6CellEditable(cell, field, rowIndex) {
        if (cell.querySelector('input')) return; // Already editing

        const originalText = cell.textContent;
        const input = document.createElement('input');
        input.type = 'text';
        input.value = originalText;
        input.style.width = '100%';
        
        // Clear cell and add input
        cell.innerHTML = '';
        cell.appendChild(input);
        input.focus();
        input.select();

        // Save on Enter or blur
        function saveEdit() {
          const newValue = input.value.trim();
          cell.textContent = newValue;
          
          // Update data
          if (window.table6ViewData && window.table6ViewData[rowIndex]) {
            window.table6ViewData[rowIndex][field] = newValue;
            saveDataToStorage();
            showTable6UpdateNotification();
          }
        }

        input.addEventListener('blur', saveEdit);
        input.addEventListener('keydown', function(e) {
          if (e.key === 'Enter') {
            e.preventDefault();
            saveEdit();
          } else if (e.key === 'Escape') {
            cell.textContent = originalText;
          }
        });
      }

      // Table 6: Show update notification
      function showTable6UpdateNotification() {
        showUpdateNotification('Economic forecasts updated successfully!');
      }
    </script>

    <section class="bg-white shadow-md rounded-lg p-8">
      <div class="table6-header">
        <span id="table6-title" style="cursor: pointer;">ECONOMIC FORECASTS</span> <span id="table6-date-text" class="table6-date" style="cursor: pointer;">(AS OF 8/1/2025)</span>
      </div>
      <h2 id="table6-subtitle" class="text-sm font-normal mt-4 mb-4">Quarterly and annual economic forecasts for key macroeconomic indicators</h2>
      <div class="overflow-x-auto">
        <table class="table6-container">
          <thead>
            <tr>
              <th style="text-align: left; width: 250px;"></th>
              <th>Q1 2025A</th>
              <th>Q2 2025A</th>
              <th>Q3 2025E</th>
              <th>Q4 2025E</th>
              <th>2025E</th>
              <th>2026E</th>
            </tr>
          </thead>
          <tbody id="table6-body">
            <!-- Table 6 rows will be populated by JavaScript -->
          </tbody>
        </table>
      </div>
      <div id="table6-footnote" class="mt-4 text-xs text-gray-600">
The forecasts in the table are the baseline view from BofA Global Research. The Global Wealth & Investment Management (GWIM) Investment Strategy Committee (ISC) may make adjustments to this view over the course of ne year and can express upside/downside to these forecasts. There can be no assurance that the forecasts will be achieved. Economic or financial forecasts are inherently limited and should not be relied on as indicators of future
investment performance. A = Actual. E/= Estimate. Sources: BofA Global Research; GWIM ISC as of August 5, 2025.
Forecasts are subject to change. When assessing your portfolio in light of our current guidance, consider the tactical positioning arouna asset allocation in reterence to your own indıvidual risk tolerance, time norizon, objectives ana liquidity needs. Certain investments may not be appropriate, given your specitic circumstances and investment plan.
Certain security types, like hedged strategies and private equity investments, are subject to eligibility and suitability criteria. Your advisor can help you customize your portfolio in light of your specific circumstances.      </div>
    </section>
  </main>

  <!-- Table 7: S&P 500 Scenarios -->
  <main class="max-w-7xl mx-auto mt-8 px-4">
    <!-- Table 7 Specific Styles -->
    <style>
      /* Table 7 S&P 500 Scenarios specific styles */
      .table7-header-box {
        padding: 20px;
        margin-bottom: 16px;
        border-radius: 4px;
      }

      .table7-title {
        color: #1e5ba8;
        font-size: 24px;
        margin-bottom: 8px;
        text-transform: uppercase;
      }

      /* Hover effect for editable title */
      #table7-title:hover {
        background-color: #e8f0f8;
        border-radius: 3px;
        padding: 4px 8px;
        transition: background-color 0.2s ease;
      }

      .table7-description {
        color: #333;
        font-size: 14px;
        line-height: 1.6;
        font-weight: lighter;
      }

      /* Hover effect for editable description */
      #table7-description:hover {
        background-color: #f5f5f5;
        border-radius: 3px;
        padding: 8px;
        transition: background-color 0.2s ease;
      }

      .table7-container {
        border-collapse: collapse;
        width: 100%;
        font-family: Arial, sans-serif;
        font-size: 12px;
        border: 1px solid #333;
        font-weight: lighter;
      }

      .table7-container th {
        background-color: white;
        color: #000;
        padding: 12px 10px;
        text-align: center;
        border: 1px solid #333;
        font-size: 12px;
      }

      .table7-container th:first-child {
        text-align: center;
        background-color: white;
      }

      .table7-container thead tr:first-child th {
        border-bottom: 1px solid #333;
      }

      .table7-container td {
        padding: 10px;
        text-align: center;
        border: 1px solid #333;
        background-color: white;
        font-size: 14px;
      }

      .table7-container tbody td:first-child {
        text-align: center;
        font-weight: bold;
        background-color: #f5f5f5;
      }
      /* Editable cell styling */
      .table7-container td:hover {
        cursor: pointer;
      }

      .table7-container td input {
        border: none;
        background: transparent;
        width: 100%;
        text-align: center;
        font-family: inherit;
        font-size: inherit;
      }

      .table7-container td input:focus {
        outline: 2px solid #2196f3;
        background-color: #fff;
        border-radius: 2px;
      }

      /* Footnote styling */
      .table7-footnote {
        margin-top: 12px;
        font-size: 12px;
        color: #666;
        line-height: 1.5;
      }
    </style>

    <!-- Table 7 Specific JavaScript Functions -->
    <script>
      // Table 7: Create S&P 500 scenario row
      window.createTable7Row = function(item, index) {
        let html = '<tr class="table7-row">';
        html += `<td data-field="eps2025">${item.eps2025 || ''}</td>`;
        
        // P/E ratio columns
        const peRatios = ['pe_19x', 'pe_20x', 'pe_21x', 'pe_22x', 'pe_23x'];
        peRatios.forEach(pe => {
          html += `<td data-field="${pe}">${item[pe] || ''}</td>`;
        });
        
        html += '</tr>';
        return html;
      };

      // Table 7: Add editing functionality
      function addTable7Editing() {
        const table7Body = document.getElementById('table7-body');
        if (!table7Body) return;

        // Make all cells editable on double-click
        table7Body.addEventListener('dblclick', function(e) {
          const cell = e.target.closest('td');
          if (!cell) return;

          const field = cell.getAttribute('data-field');
          const rowIndex = Array.from(table7Body.children).indexOf(cell.closest('tr'));
          
          makeTable7CellEditable(cell, field, rowIndex);
        });

        // Make header title editable
        const table7Title = document.getElementById('table7-title');
        if (table7Title) {
          table7Title.addEventListener('dblclick', function() {
            makeTable7HeaderEditable(table7Title, 'title');
          });
        }

        // Make header description editable
        const table7Description = document.getElementById('table7-description');
        if (table7Description) {
          table7Description.addEventListener('dblclick', function() {
            makeTable7HeaderEditable(table7Description, 'description');
          });
        }
      }

      // Table 7: Make header editable
      function makeTable7HeaderEditable(element, field) {
        if (element.querySelector('textarea') || element.querySelector('input')) return; // Already editing

        const originalText = element.textContent;
        
        // Use textarea for description (multi-line) and input for title
        const editElement = field === 'description' ? document.createElement('textarea') : document.createElement('input');
        
        if (field === 'description') {
          editElement.value = originalText;
          editElement.style.cssText = `
            width: 100%;
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 2px;
            padding: 8px;
            font-size: inherit;
            font-family: inherit;
            color: inherit;
            outline: none;
            line-height: 1.6;
            min-height: 100px;
            resize: vertical;
          `;
        } else {
          editElement.type = 'text';
          editElement.value = originalText;
          editElement.style.cssText = `
            width: 100%;
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 2px;
            padding: 4px 8px;
            font-size: inherit;
            font-weight: inherit;
            color: inherit;
            outline: none;
          `;
        }
        
        // Clear element and add input/textarea
        element.innerHTML = '';
        element.appendChild(editElement);
        editElement.focus();
        editElement.select();

        // Save on blur
        function saveEdit() {
          const newValue = editElement.value.trim();
          element.textContent = newValue || originalText;
          
          // Update metadata
          if (window.table7MetaData) {
            if (field === 'title') {
              window.table7MetaData.title = newValue;
            } else if (field === 'description') {
              window.table7MetaData.description = newValue;
            }
            saveDataToStorage();
            showTable7UpdateNotification();
          }
        }

        editElement.addEventListener('blur', saveEdit);
        editElement.addEventListener('keydown', function(e) {
          if (e.key === 'Enter' && field !== 'description') {
            e.preventDefault();
            saveEdit();
          } else if (e.key === 'Escape') {
            element.textContent = originalText;
          }
        });
      }

      // Table 7: Make cell editable
      function makeTable7CellEditable(cell, field, rowIndex) {
        if (cell.querySelector('input')) return; // Already editing

        const originalText = cell.textContent;
        const input = document.createElement('input');
        input.type = 'text';
        input.value = originalText;
        input.style.width = '100%';
        
        // Clear cell and add input
        cell.innerHTML = '';
        cell.appendChild(input);
        input.focus();
        input.select();

        // Save on Enter or blur
        function saveEdit() {
          const newValue = input.value.trim();
          cell.textContent = newValue;
          
          // Update data
          if (window.table7ViewData && window.table7ViewData[rowIndex]) {
            window.table7ViewData[rowIndex][field] = newValue;
            saveDataToStorage();
            showTable7UpdateNotification();
          }
        }

        input.addEventListener('blur', saveEdit);
        input.addEventListener('keydown', function(e) {
          if (e.key === 'Enter') {
            e.preventDefault();
            saveEdit();
          } else if (e.key === 'Escape') {
            cell.textContent = originalText;
          }
        });
      }

      // Table 7: Show update notification
      function showTable7UpdateNotification() {
        showUpdateNotification('S&P 500 scenarios updated successfully!');
      }
    </script>

    <section class="bg-zinc-200 shadow-md rounded-lg p-8">
      <div class="table7-header-box">
        <div id="table7-title" class="table7-title" style="cursor: pointer;">S&P 500 Scenarios Based on Forward P/E and 2025 Earnings Per Share (EPS)</div>
        <div id="table7-description" class="table7-description" style="cursor: pointer;">
          The table below provides a rough indication of where the S&P 500 Index's central tendency could be, given various scenarios for EPS in 2025 and P/E ratio multiples. These scenarios are not official price targets and are not meant to signal levels where portfolio actions may always be needed. However, during times of market volatility, it's useful to keep this basic framework in mind when considering whether to incrementally add to or trim risk from portfolios while staying invested in one's strategic asset allocation framework.
        </div>
      </div>
      
      <div class="overflow-x-auto">
        <table class="table7-container">
          <thead>
            <tr>
              <th rowspan="2">2025 EPS</th>
              <th colspan="5">EPS Forward P/E (Next 12 months)</th>
            </tr>
            <tr>
              <th>19.0x</th>
              <th>20.0x</th>
              <th>21.0x</th>
              <th>22.0x</th>
              <th>23.0x</th>
            </tr>
          </thead>
          <tbody id="table7-body">
            <!-- Table 7 rows will be populated by JavaScript -->
          </tbody>
        </table>
      </div>
      
      <div class="table7-footnote">
        For illustrative purposes only. Source: Chief Investment Office as of August 5, 2025.
      </div>
    </section>
  </main>

  <!-- Table 8: CIO Views on Alts Strategies -->
  <main class="max-w-7xl mx-auto mt-8 px-4">
    <!-- Table 8 Specific Styles -->
    <style>
      /* Table 8 CIO Views on Alts Strategies specific styles */
      .table8-container {
        border-collapse: collapse;
        width: 100%;
        font-family: Arial, sans-serif;
        font-size: 11px;
        background-color: white;
        border: none;
      }

      .table8-header {
        background-color: white;
        padding: 0;
        margin-bottom: 4px;
      }

      .table8-title {
        font-size: 14px;
        font-weight: bold;
        color: #000;
        margin-bottom: 4px;
        padding: 0;
      }

      .table8-subtitle {
        font-size: 14px;
        font-weight: bold;
        color: #1e5ba8;
        margin-bottom: 0;
        padding: 4px 0;
        border-top: 2px solid #000;
        border-bottom: 2px solid #000;
        margin-top: 2px;
      }

      /* Section headers styling - PRIVATE EQUITY & CREDIT */
      .table8-container .section-header {
        background-color: white;
        padding: 4px 0;
        font-weight: bolder;
        color: #1e5ba8;
        font-size: 14px;
        text-align: left;
        border-top: 2px solid #000;
        border-bottom: 2px solid #000;
        margin-top: 8px;
      }

      /* Strategy category headers with green + */
      .table8-container .strategy-header {
        background-color: white;
        padding: 6px 0;
        font-weight: bold !important;
        color: #000;
        font-size: 50px;
        text-align: left;
        border-bottom: 1px solid #000;
        border-top: 0;
      }

      /* Cell styling */
      .table8-container td {
        padding: 4px 0;
        vertical-align: top;
        border-bottom: 1px solid #000;
        line-height: 1.3;
      }

      .table8-container td:first-child {
        font-weight: normal;
        width: 50px;
        color: #000;
        font-size: 11px;
        padding-right: 8px;
      }

      .table8-container td:last-child {
        color: #000;
        text-align: left;
        font-size: 11px;
        padding-left: 8px;
      }

      /* Alternating row colors for data rows */
      .table8-container .table8-data-row:nth-of-type(odd) {
        background-color: white;
      }

      .table8-container .table8-data-row:nth-of-type(even) {
        background-color: #f5f5f5;
      }

      /* Remove bottom border from last row before section header */
      .table8-container tr:last-child td {
        border-bottom: none;
      }

      /* Green plus indicators */
      .table8-plus {
        color: #22c55e;
        font-weight: bold;
        font-size: 16px;
        margin-left: 4px;
      }

      /* Footnote styling */
      .table8-footnote {
        font-size: 9px;
        line-height: 1.35;
        color: #000;
        margin-top: 8px;
        padding: 0;
      }

      /* Editable elements hover */
      #table8-title:hover,
      #table8-subtitle:hover {
        background-color: #f0f0f0;
        cursor: pointer;
        transition: background-color 0.2s ease;
      }
      
      .table8-container .table8-data-row:hover {
        background-color: #e8e8e8 !important;
        cursor: pointer;
        transition: background-color 0.2s ease;
      }
      
      .table8-container .strategy-header:hover,
      .table8-container .section-header:hover {
        background-color: #f0f0f0;
        cursor: pointer;
        transition: background-color 0.2s ease;
      }
    </style>

    <!-- Table 8 Specific JavaScript Functions -->
    <script>
      // Table 8: Create strategy row
      window.createTable8Row = function(item, index) {
        // If it's a section header
        if (item.isSection) {
          return `
            <tr data-row-index="${index}">
              <td colspan="2" class="section-header">${item.sectionName}</td>
            </tr>
          `;
        }

        // If it's a strategy header
        if (item.isStrategyHeader) {
          // Check if strategy name has a "+" and format it
          let strategyDisplay = item.strategyName;
          if (item.strategyName.includes('+')) {
            // Replace the + with a green styled +
            strategyDisplay = item.strategyName.replace('+', '<span class="table8-plus">+</span>');
          }
          
          return `
            <tr data-row-index="${index}">
              <td colspan="2" class="strategy-header">${strategyDisplay}</td>
            </tr>
          `;
        }

        // Regular bull/bear case row
        return `
          <tr data-row-index="${index}" class="table8-data-row">
            <td data-field="caseType">${item.caseType}</td>
            <td data-field="description">${item.description}</td>
          </tr>
        `;
      };

      // Table 8: Add editing functionality
      function addTable8Editing() {
        console.log('Initializing Table 8 editing...');

        // Make title editable
        const table8Title = document.getElementById('table8-title');
        if (table8Title) {
          table8Title.addEventListener('dblclick', function(e) {
            e.stopPropagation();
            makeTable8TextEditable(table8Title, 'title');
          });
        }

        // Make subtitle editable
        const table8Subtitle = document.getElementById('table8-subtitle');
        if (table8Subtitle) {
          table8Subtitle.addEventListener('dblclick', function(e) {
            e.stopPropagation();
            makeTable8TextEditable(table8Subtitle, 'subtitle');
          });
        }

        // Make all table cells editable
        const table8Body = document.getElementById('table8-body');
        if (table8Body) {
          table8Body.addEventListener('dblclick', function(e) {
            const cell = e.target.closest('td');
            if (!cell) return;
            
            const row = cell.closest('tr');
            const rowIndex = parseInt(row.getAttribute('data-row-index'));
            
            // Handle section headers
            if (cell.classList.contains('section-header')) {
              makeTable8SectionHeaderEditable(cell, rowIndex);
              return;
            }
            
            // Handle strategy headers
            if (cell.classList.contains('strategy-header')) {
              makeTable8StrategyHeaderEditable(cell, rowIndex);
              return;
            }

            const field = cell.getAttribute('data-field');
            makeTable8CellEditable(cell, field, rowIndex);
          });
        }

        // Make footnote editable
        const table8Footnote = document.getElementById('table8-footnote');
        if (table8Footnote) {
          console.log('Found table 8 footnote element');
          table8Footnote.addEventListener('dblclick', function(e) {
            e.stopPropagation();
            console.log('Table 8 footnote double-clicked');
            makeTable8FootnoteEditable(table8Footnote);
          });
        } else {
          console.warn('Table 8 footnote element not found');
        }

        console.log('Table 8 editing initialization complete');
      }

      // Table 8: Make text editable (for title/subtitle)
      function makeTable8TextEditable(element, field) {
        if (element.querySelector('input')) return;

        const originalText = element.textContent.trim();
        const input = document.createElement('input');
        input.type = 'text';
        input.value = originalText;
        input.style.cssText = `
          background: #fff3cd;
          border: 1px solid #ffc107;
          border-radius: 2px;
          padding: 4px 8px;
          font-size: inherit;
          font-weight: inherit;
          color: inherit;
          width: 100%;
          outline: none;
        `;

        element.innerHTML = '';
        element.appendChild(input);
        input.focus();
        input.select();

        function saveEdit() {
          const newValue = input.value.trim();
          element.textContent = newValue || originalText;
          
          if (window.table8MetaData) {
            window.table8MetaData[field] = newValue;
            saveDataToStorage();
            showTable8UpdateNotification();
          }
        }

        input.addEventListener('blur', saveEdit);
        input.addEventListener('keydown', function(e) {
          if (e.key === 'Enter') {
            e.preventDefault();
            saveEdit();
          } else if (e.key === 'Escape') {
            element.textContent = originalText;
          }
        });
      }

      // Table 8: Make section header editable
      function makeTable8SectionHeaderEditable(cell, rowIndex) {
        if (cell.querySelector('input')) return;

        const originalText = cell.textContent.trim();
        const input = document.createElement('input');
        input.type = 'text';
        input.value = originalText;
        input.style.cssText = `
          background: #fff3cd;
          border: 1px solid #ffc107;
          border-radius: 2px;
          padding: 8px;
          font-size: inherit;
          font-weight: inherit;
          color: inherit;
          width: 100%;
          outline: none;
        `;

        cell.innerHTML = '';
        cell.appendChild(input);
        input.focus();
        input.select();

        function saveEdit() {
          const newValue = input.value.trim();
          cell.textContent = newValue || originalText;
          
          if (window.table8ViewData && window.table8ViewData[rowIndex]) {
            window.table8ViewData[rowIndex].sectionName = newValue;
            saveDataToStorage();
            showTable8UpdateNotification();
          }
        }

        input.addEventListener('blur', saveEdit);
        input.addEventListener('keydown', function(e) {
          if (e.key === 'Enter') {
            e.preventDefault();
            saveEdit();
          } else if (e.key === 'Escape') {
            cell.textContent = originalText;
          }
        });
      }

      // Table 8: Make strategy header editable
      function makeTable8StrategyHeaderEditable(cell, rowIndex) {
        if (cell.querySelector('input')) return;

        // Get text without HTML (strip the + symbol span)
        const originalText = cell.textContent.trim();
        const input = document.createElement('input');
        input.type = 'text';
        input.value = originalText;
        input.style.cssText = `
          background: #fff3cd;
          border: 1px solid #ffc107;
          border-radius: 2px;
          padding: 8px;
          font-size: inherit;
          font-weight: inherit;
          color: inherit;
          width: 100%;
          outline: none;
        `;

        cell.innerHTML = '';
        cell.appendChild(input);
        input.focus();
        input.select();

        function saveEdit() {
          const newValue = input.value.trim();
          
          console.log('Saving strategy header:', {rowIndex, newValue, hasData: !!window.table8ViewData});
          
          if (window.table8ViewData && window.table8ViewData[rowIndex]) {
            console.log('Found data at index:', rowIndex, window.table8ViewData[rowIndex]);
            window.table8ViewData[rowIndex].strategyName = newValue;
            
            // Re-render with the green + symbol if present
            const strategyDisplay = newValue.replace('+', '<span class="table8-plus">+</span>');
            cell.innerHTML = strategyDisplay;
            
            saveDataToStorage();
            showTable8UpdateNotification();
          } else {
            console.error('Could not find data at index:', rowIndex);
            console.log('table8ViewData:', window.table8ViewData);
            // Restore original if save fails
            const strategyDisplay = originalText.replace('+', '<span class="table8-plus">+</span>');
            cell.innerHTML = strategyDisplay;
          }
        }

        input.addEventListener('blur', saveEdit);
        input.addEventListener('keydown', function(e) {
          if (e.key === 'Enter') {
            e.preventDefault();
            saveEdit();
          } else if (e.key === 'Escape') {
            const strategyDisplay = originalText.replace('+', '<span class="table8-plus">+</span>');
            cell.innerHTML = strategyDisplay;
          }
        });
      }

      // Table 8: Make footnote editable
      function makeTable8FootnoteEditable(footnoteElement) {
        if (footnoteElement.querySelector('textarea')) return;

        const originalText = footnoteElement.textContent.trim();
        const textarea = document.createElement('textarea');
        textarea.value = originalText;
        textarea.style.cssText = `
          background: #fff3cd;
          border: 1px solid #ffc107;
          border-radius: 2px;
          padding: 8px;
          font-size: inherit;
          font-family: inherit;
          color: inherit;
          width: 100%;
          min-height: 80px;
          resize: vertical;
          outline: none;
        `;

        footnoteElement.innerHTML = '';
        footnoteElement.appendChild(textarea);
        textarea.focus();
        textarea.select();

        function saveEdit() {
          const newValue = textarea.value.trim();
          footnoteElement.textContent = newValue || originalText;
          
          if (window.table8MetaData) {
            window.table8MetaData.footnote = newValue;
            saveDataToStorage();
            showTable8UpdateNotification();
          }
        }

        textarea.addEventListener('blur', saveEdit);
        textarea.addEventListener('keydown', function(e) {
          if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
            e.preventDefault();
            saveEdit();
          } else if (e.key === 'Escape') {
            footnoteElement.textContent = originalText;
          }
        });
      }

      // Table 8: Make cell editable
      function makeTable8CellEditable(cell, field, rowIndex) {
        if (cell.querySelector('textarea') || cell.querySelector('input')) return;

        const originalText = cell.textContent.trim();
        
        // Use textarea for description field, input for case type
        const isDescription = field === 'description';
        const editElement = isDescription ? document.createElement('textarea') : document.createElement('input');
        
        if (!isDescription) {
          editElement.type = 'text';
        }
        
        editElement.value = originalText;
        editElement.style.cssText = `
          background: #fff3cd;
          border: 1px solid #ffc107;
          border-radius: 2px;
          padding: 6px;
          font-size: inherit;
          font-family: inherit;
          color: inherit;
          width: 100%;
          outline: none;
          ${isDescription ? 'min-height: 60px; resize: vertical;' : ''}
        `;

        cell.innerHTML = '';
        cell.appendChild(editElement);
        editElement.focus();
        editElement.select();

        function saveEdit() {
          const newValue = editElement.value.trim();
          cell.textContent = newValue || originalText;
          
          if (window.table8ViewData && window.table8ViewData[rowIndex]) {
            window.table8ViewData[rowIndex][field] = newValue;
            saveDataToStorage();
            showTable8UpdateNotification();
          }
        }

        editElement.addEventListener('blur', saveEdit);
        editElement.addEventListener('keydown', function(e) {
          if (e.key === 'Enter' && (!isDescription || (e.ctrlKey || e.metaKey))) {
            e.preventDefault();
            saveEdit();
          } else if (e.key === 'Escape') {
            cell.textContent = originalText;
          }
        });
      }

      // Table 8: Show update notification
      function showTable8UpdateNotification() {
        showUpdateNotification('CIO Views on Alts updated successfully!');
      }
    </script>

    <section class="bg-white shadow-md rounded-lg p-8">
      <div class="table8-header">
        <div id="table8-title" class="table8-title">CIO Views on Alts Strategies</div>
        <div id="table8-subtitle" class="table8-subtitle">HEDGE STRATEGIES</div>
      </div>
      
      <div class="overflow-x-auto">
        <table class="table8-container">
          <tbody id="table8-body">
            <!-- Table 8 rows will be populated by JavaScript -->
          </tbody>
        </table>
      </div>
      
      <div id="table8-footnote" class="table8-footnote">
        *Alpha is a measure of how well an investment performs relative to a benchmark index at what's expected based on its risk level. Bull case is an environment or set of factors that could represent tailwinds for the strategy. Bear case is an environment or set of factors that could represent headwinds for the strategy. + symbol indicates the strategy CIO views as having a relative opportunity for new investment within the Alts asset class.
      </div>
    </section>

    <!-- Table 9: Sector Valuations -->
    <style>
      /* Table 9 Specific Styles */
      .table9-container {
        width: 100%;
        max-width: 800px;
        margin: 0 auto;
      }

      .table9-title {
        font-size: 24px;
        font-weight: bold;
        color: #000;
        margin-bottom: 20px;
        text-align: left;
      }

      .table9-legend {
        display: flex;
        justify-content: center;
        gap: 40px;
        margin-bottom: 20px;
        font-size: 14px;
      }

      .table9-legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .table9-legend-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
      }

      .table9-legend-dot.current {
        background-color: #1e3a8a;
      }

      .table9-legend-dot.average {
        background-color: #dc2626;
      }

      .table9-chart {
        border-collapse: collapse;
        width: 100%;
        border-top: 2px solid #000;
      }

      .table9-chart tbody tr {
        border-bottom: 1px solid #d1d5db;
      }

      .table9-chart tbody tr:last-child {
        border-bottom: 2px solid #000;
      }

      .table9-sector-label {
        text-align: right;
        padding: 12px 16px;
        font-size: 14px;
        font-weight: normal;
        width: 180px;
        border-right: 1px solid #d1d5db;
      }

      .table9-chart-area {
        position: relative;
        padding: 12px 0;
        background-image: 
          linear-gradient(to right, #d1d5db 1px, transparent 1px),
          linear-gradient(to right, #e5e7eb 1px, transparent 1px);
        background-size: 20% 100%, 10% 100%;
        background-position: 0 0, 0 0;
      }

      .table9-chart-container {
        position: relative;
        height: 20px;
        margin: 0 10px;
      }

      .table9-dot {
        position: absolute;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        top: 50%;
        transform: translateY(-50%);
      }

      .table9-dot.current {
        background-color: #1e3a8a;
        z-index: 2;
      }

      .table9-dot.average {
        background-color: #dc2626;
        z-index: 1;
      }

      .table9-x-axis {
        text-align: center;
        padding: 8px 0;
        font-size: 12px;
        color: #666;
        border-right: 1px solid #d1d5db;
        border-top: 0;
      }

      .table9-x-axis-labels {
        display: flex;
        justify-content: space-between;
        padding: 8px 10px;
        font-size: 12px;
        color: #666;
        font-weight: 500;
      }

      .table9-x-axis-labels span {
        flex: 0 0 auto;
        text-align: center;
      }

      .table9-subtitle {
        text-align: center;
        font-size: 12px;
        color: #666;
        margin-top: 8px;
        font-weight: 500;
      }

      /* Hover effects */
      .table9-title:hover {
        background-color: #f0f0f0;
        cursor: pointer;
        transition: background-color 0.2s ease;
      }

      .table9-sector-label:hover {
        background-color: #f9fafb;
        cursor: pointer;
        transition: background-color 0.2s ease;
      }

      .table9-chart-area:hover {
        background-color: rgba(249, 250, 251, 0.5);
        cursor: pointer;
        transition: background-color 0.2s ease;
      }

      .table9-chart tbody tr:hover {
        background-color: #f9fafb;
      }

      .table9-x-axis-labels:hover {
        background-color: #f0f0f0;
        transition: background-color 0.2s ease;
      }

      .table9-dot {
        cursor: pointer;
        transition: transform 0.2s ease;
      }

      .table9-dot:hover {
        transform: translateY(-50%) scale(1.3);
      }
    </style>

    <script>
      // Table 9: Create sector row
      window.createTable9Row = function(sector, index) {
        const config = window.table9XAxisConfig || { start: 10, end: 35 };
        const minValue = config.start;
        const maxValue = config.end;
        const range = maxValue - minValue;

        // Calculate positions as percentages
        const currentPos = ((sector.currentPE - minValue) / range) * 100;
        const averagePos = ((sector.averagePE - minValue) / range) * 100;

        return `
          <tr data-row-index="${index}">
            <td class="table9-sector-label">${sector.name}</td>
            <td class="table9-chart-area">
              <div class="table9-chart-container">
                <div class="table9-dot average" style="left: ${averagePos}%;"></div>
                <div class="table9-dot current" style="left: ${currentPos}%;"></div>
              </div>
            </td>
          </tr>
        `;
      };

      // Table 9: Initialize
      function initializeTable9() {
        console.log('Initializing Table 9...');
        
        // Initialize x-axis configuration
        if (!window.table9XAxisConfig) {
          window.table9XAxisConfig = {
            start: 10,
            end: 35,
            interval: 5
          };
        }
        
        if (!window.table9ViewData) {
          // Default data matching the image
          window.table9ViewData = [
            { name: "S&P 500", currentPE: 23.5, averagePE: 17.5 },
            { name: "Information Technology", currentPE: 29.5, averagePE: 18.5 },
            { name: "Consumer Discretionary", currentPE: 25.0, averagePE: 20.5 },
            { name: "Healthcare", currentPE: 19.0, averagePE: 16.5 },
            { name: "Financials", currentPE: 17.5, averagePE: 14.5 },
            { name: "Communication Services", currentPE: 19.5, averagePE: 17.0 },
            { name: "Industrials", currentPE: 23.0, averagePE: 18.0 },
            { name: "Consumer Staples", currentPE: 21.0, averagePE: 19.0 },
            { name: "Energy", currentPE: 13.0, averagePE: 34.0 },
            { name: "Real Estate", currentPE: 20.5, averagePE: 20.5 },
            { name: "Materials", currentPE: 21.0, averagePE: 16.5 },
            { name: "Utilities", currentPE: 19.0, averagePE: 16.5 }
          ];
        }

        const table9Body = document.getElementById('table9-body');
        if (table9Body && window.table9ViewData) {
          table9Body.innerHTML = window.table9ViewData
            .map((sector, index) => createTable9Row(sector, index))
            .join('');
        }

        // Render x-axis labels
        renderTable9XAxisLabels();

        // Add editing functionality
        addTable9Editing();

        console.log('Table 9 initialized');
      }

      // Table 9: Add editing functionality
      function addTable9Editing() {
        console.log('Initializing Table 9 editing...');

        // Make title editable
        const table9Title = document.querySelector('.table9-title');
        if (table9Title) {
          table9Title.addEventListener('dblclick', function(e) {
            e.stopPropagation();
            makeTable9TitleEditable(table9Title);
          });
        }

        // Make sector labels editable
        const table9Body = document.getElementById('table9-body');
        if (table9Body) {
          table9Body.addEventListener('dblclick', function(e) {
            const label = e.target.closest('.table9-sector-label');
            if (label) {
              const row = label.closest('tr');
              const rowIndex = Array.from(table9Body.children).indexOf(row);
              makeTable9SectorLabelEditable(label, rowIndex);
              return;
            }

            // Check if clicked on chart area or dots
            const chartArea = e.target.closest('.table9-chart-area');
            if (chartArea) {
              const row = chartArea.closest('tr');
              const rowIndex = Array.from(table9Body.children).indexOf(row);
              showTable9EditPopover(rowIndex);
            }
          });
        }

        // Make x-axis editable (single click on x-axis labels)
        const xAxisLabels = document.querySelector('.table9-x-axis-labels');
        if (xAxisLabels) {
          xAxisLabels.addEventListener('click', function(e) {
            e.stopPropagation();
            showTable9XAxisEditPopover();
          });
          xAxisLabels.style.cursor = 'pointer';
        }

        console.log('Table 9 editing initialization complete');
      }

      // Table 9: Make title editable
      function makeTable9TitleEditable(element) {
        if (element.querySelector('input')) return;

        const originalText = element.textContent.trim();
        const input = document.createElement('input');
        input.type = 'text';
        input.value = originalText;
        input.style.cssText = `
          background: #fff3cd;
          border: 1px solid #ffc107;
          border-radius: 2px;
          padding: 4px 8px;
          font-size: inherit;
          font-weight: inherit;
          color: inherit;
          width: 100%;
          outline: none;
        `;

        element.innerHTML = '';
        element.appendChild(input);
        input.focus();
        input.select();

        function saveEdit() {
          const newValue = input.value.trim();
          element.textContent = newValue || originalText;
          saveDataToStorage();
          showTable9UpdateNotification();
        }

        input.addEventListener('blur', saveEdit);
        input.addEventListener('keydown', function(e) {
          if (e.key === 'Enter') {
            e.preventDefault();
            saveEdit();
          } else if (e.key === 'Escape') {
            element.textContent = originalText;
          }
        });
      }

      // Table 9: Make sector label editable
      function makeTable9SectorLabelEditable(label, rowIndex) {
        if (label.querySelector('input')) return;

        const originalText = label.textContent.trim();
        const input = document.createElement('input');
        input.type = 'text';
        input.value = originalText;
        input.style.cssText = `
          background: #fff3cd;
          border: 1px solid #ffc107;
          border-radius: 2px;
          padding: 4px 8px;
          font-size: inherit;
          color: inherit;
          width: 100%;
          outline: none;
        `;

        label.innerHTML = '';
        label.appendChild(input);
        input.focus();
        input.select();

        function saveEdit() {
          const newValue = input.value.trim();
          label.textContent = newValue || originalText;
          
          if (window.table9ViewData && window.table9ViewData[rowIndex]) {
            window.table9ViewData[rowIndex].name = newValue;
            saveDataToStorage();
            showTable9UpdateNotification();
          }
        }

        input.addEventListener('blur', saveEdit);
        input.addEventListener('keydown', function(e) {
          if (e.key === 'Enter') {
            e.preventDefault();
            saveEdit();
          } else if (e.key === 'Escape') {
            label.textContent = originalText;
          }
        });
      }

      // Table 9: Show edit popover for P/E values
      function showTable9EditPopover(rowIndex) {
        // Remove existing popover if any
        const existingPopover = document.querySelector('.table9-edit-popover');
        if (existingPopover) {
          existingPopover.remove();
        }

        const sector = window.table9ViewData[rowIndex];
        if (!sector) return;

        // Create popover
        const popover = document.createElement('div');
        popover.className = 'table9-edit-popover';
        popover.style.cssText = `
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: white;
          border: 2px solid #1e3a8a;
          border-radius: 8px;
          padding: 24px;
          box-shadow: 0 4px 20px rgba(0,0,0,0.2);
          z-index: 1000;
          min-width: 350px;
          font-size: 14px;
        `;

        popover.innerHTML = `
          <div style="margin-bottom: 16px; font-weight: bold; font-size: 16px; color: #1e3a8a;">
            Edit P/E Values - ${sector.name}
          </div>
          <div style="margin-bottom: 16px;">
            <label style="display: block; margin-bottom: 6px; font-weight: 500;">
              Current Fwd P/E (10-35):
            </label>
            <input type="number" id="table9-current-pe" value="${sector.currentPE}" 
              min="10" max="35" step="0.5"
              style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px;">
          </div>
          <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 6px; font-weight: 500;">
              15 Year Average P/E (10-35):
            </label>
            <input type="number" id="table9-average-pe" value="${sector.averagePE}" 
              min="10" max="35" step="0.5"
              style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px;">
          </div>
          <div style="display: flex; gap: 10px; justify-content: flex-end;">
            <button id="table9-cancel-btn" style="padding: 8px 16px; border: 1px solid #d1d5db; background: white; border-radius: 4px; cursor: pointer; font-size: 14px;">
              Cancel
            </button>
            <button id="table9-save-btn" style="padding: 8px 16px; border: none; background: #1e3a8a; color: white; border-radius: 4px; cursor: pointer; font-weight: 500; font-size: 14px;">
              Save
            </button>
          </div>
        `;

        // Create backdrop
        const backdrop = document.createElement('div');
        backdrop.className = 'table9-popover-backdrop';
        backdrop.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0,0,0,0.3);
          z-index: 999;
        `;

        document.body.appendChild(backdrop);
        document.body.appendChild(popover);

        // Handle save
        document.getElementById('table9-save-btn').addEventListener('click', function() {
          const currentPE = parseFloat(document.getElementById('table9-current-pe').value);
          const averagePE = parseFloat(document.getElementById('table9-average-pe').value);

          // Validate
          if (currentPE < 10 || currentPE > 35 || averagePE < 10 || averagePE > 35) {
            alert('P/E values must be between 10 and 35');
            return;
          }

          // Update data
          window.table9ViewData[rowIndex].currentPE = currentPE;
          window.table9ViewData[rowIndex].averagePE = averagePE;

          // Re-render the row
          const table9Body = document.getElementById('table9-body');
          const rows = table9Body.querySelectorAll('tr');
          if (rows[rowIndex]) {
            rows[rowIndex].outerHTML = createTable9Row(window.table9ViewData[rowIndex], rowIndex);
          }

          // Save and close
          saveDataToStorage();
          showTable9UpdateNotification();
          backdrop.remove();
          popover.remove();
        });

        // Handle cancel
        function closePopover() {
          backdrop.remove();
          popover.remove();
        }

        document.getElementById('table9-cancel-btn').addEventListener('click', closePopover);
        backdrop.addEventListener('click', closePopover);

        // Handle Escape key
        function handleEscape(e) {
          if (e.key === 'Escape') {
            closePopover();
            document.removeEventListener('keydown', handleEscape);
          }
        }
        document.addEventListener('keydown', handleEscape);
      }

      // Table 9: Show update notification
      function showTable9UpdateNotification() {
        showUpdateNotification('Sector Valuations updated successfully!');
      }

      // Table 9: Generate x-axis labels
      function generateTable9XAxisLabels() {
        const config = window.table9XAxisConfig || { start: 10, end: 35, interval: 5 };
        const labels = [];
        for (let value = config.start; value <= config.end; value += config.interval) {
          labels.push(value);
        }
        return labels;
      }

      // Table 9: Render x-axis labels
      function renderTable9XAxisLabels() {
        const labelsContainer = document.querySelector('.table9-x-axis-labels');
        if (labelsContainer) {
          const labels = generateTable9XAxisLabels();
          labelsContainer.innerHTML = labels.map(label => `<span>${label}</span>`).join('');
        }
      }

      // Table 9: Show x-axis edit popover
      function showTable9XAxisEditPopover() {
        // Remove existing popover if any
        const existingPopover = document.querySelector('.table9-xaxis-popover');
        if (existingPopover) {
          existingPopover.remove();
        }

        const config = window.table9XAxisConfig || { start: 10, end: 35, interval: 5 };

        // Create popover
        const popover = document.createElement('div');
        popover.className = 'table9-xaxis-popover';
        popover.style.cssText = `
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: white;
          border: 2px solid #1e3a8a;
          border-radius: 8px;
          padding: 24px;
          box-shadow: 0 4px 20px rgba(0,0,0,0.2);
          z-index: 1000;
          min-width: 350px;
          font-size: 14px;
        `;

        popover.innerHTML = `
          <div style="margin-bottom: 16px; font-weight: bold; font-size: 16px; color: #1e3a8a;">
            Edit X-Axis Configuration
          </div>
          <div style="margin-bottom: 16px;">
            <label style="display: block; margin-bottom: 6px; font-weight: 500;">
              Start Value:
            </label>
            <input type="number" id="table9-xaxis-start" value="${config.start}" 
              step="1"
              style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px;">
          </div>
          <div style="margin-bottom: 16px;">
            <label style="display: block; margin-bottom: 6px; font-weight: 500;">
              End Value:
            </label>
            <input type="number" id="table9-xaxis-end" value="${config.end}" 
              step="1"
              style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px;">
          </div>
          <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 6px; font-weight: 500;">
              Interval:
            </label>
            <input type="number" id="table9-xaxis-interval" value="${config.interval}" 
              min="1" step="1"
              style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px;">
          </div>
          <div style="display: flex; gap: 10px; justify-content: flex-end;">
            <button id="table9-xaxis-cancel-btn" style="padding: 8px 16px; border: 1px solid #d1d5db; background: white; border-radius: 4px; cursor: pointer; font-size: 14px;">
              Cancel
            </button>
            <button id="table9-xaxis-save-btn" style="padding: 8px 16px; border: none; background: #1e3a8a; color: white; border-radius: 4px; cursor: pointer; font-weight: 500; font-size: 14px;">
              Save
            </button>
          </div>
        `;

        // Create backdrop
        const backdrop = document.createElement('div');
        backdrop.className = 'table9-xaxis-backdrop';
        backdrop.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0,0,0,0.3);
          z-index: 999;
        `;

        document.body.appendChild(backdrop);
        document.body.appendChild(popover);

        // Handle save
        document.getElementById('table9-xaxis-save-btn').addEventListener('click', function() {
          const start = parseFloat(document.getElementById('table9-xaxis-start').value);
          const end = parseFloat(document.getElementById('table9-xaxis-end').value);
          const interval = parseFloat(document.getElementById('table9-xaxis-interval').value);

          // Validate
          if (isNaN(start) || isNaN(end) || isNaN(interval)) {
            alert('Please enter valid numbers');
            return;
          }
          if (start >= end) {
            alert('Start value must be less than end value');
            return;
          }
          if (interval <= 0) {
            alert('Interval must be greater than 0');
            return;
          }

          // Update config
          window.table9XAxisConfig = { start, end, interval };

          // Re-render x-axis labels
          renderTable9XAxisLabels();

          // Re-render all rows with new scale
          const table9Body = document.getElementById('table9-body');
          if (table9Body && window.table9ViewData) {
            table9Body.innerHTML = window.table9ViewData
              .map((sector, index) => createTable9Row(sector, index))
              .join('');
          }

          // Save and close
          saveDataToStorage();
          showTable9UpdateNotification();
          backdrop.remove();
          popover.remove();
        });

        // Handle cancel
        function closePopover() {
          backdrop.remove();
          popover.remove();
        }

        document.getElementById('table9-xaxis-cancel-btn').addEventListener('click', closePopover);
        backdrop.addEventListener('click', closePopover);

        // Handle Escape key
        function handleEscape(e) {
          if (e.key === 'Escape') {
            closePopover();
            document.removeEventListener('keydown', handleEscape);
          }
        }
        document.addEventListener('keydown', handleEscape);
      }
    </script>

    <section class="bg-white shadow-md rounded-lg p-8">
      <div class="table9-container">
        <div class="table9-title border-b-2 border-black font-bold">Sector Valuations</div>
        
        <div class="table9-legend">
          <div class="table9-legend-item">
            <div class="table9-legend-dot current"></div>
            <span>Current Fwd P/E</span>
          </div>
          <div class="table9-legend-item">
            <div class="table9-legend-dot average"></div>
            <span>15 Year Average</span>
          </div>
        </div>

        <table class="table9-chart">
          <tbody id="table9-body">
            <!-- Rows will be populated by JavaScript -->
          </tbody>
          <tfoot>
            <tr>
              <td class="table9-x-axis"></td>
              <td class="table9-chart-area">
                <div class="table9-x-axis-labels">
                  <span>10</span>
                  <span>15</span>
                  <span>20</span>
                  <span>25</span>
                  <span>30</span>
                  <span>35</span>
                </div>
              </td>
            </tr>
          </tfoot>
        </table>

        <div class="table9-subtitle">
          Forward Price-to-Earnings (P/E) for S&P 500 Sectors
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="text-center text-gray-500 text-sm py-4 mt-10 border-t">
    Source: Chief Investment Office | CIO Viewpoint © 2025
  </footer>

  <!-- Shared Weight Edit Popover JavaScript -->
  <script>
    // Shared weight edit popover function used by Table 2 and Table 3
    function showWeightEditPopover(element, data, rowIndex, tableType) {
      // Validate data before proceeding
      if (!data) {
        console.error('No data provided to showWeightEditPopover for row:', rowIndex);
        return;
      }

      // Remove existing popover if any
      const existingPopover = document.querySelector('.weight-edit-popover');
      if (existingPopover) {
        existingPopover.remove();
      }

      // Create popover
      const popover = document.createElement('div');
      popover.className = 'weight-edit-popover';
      popover.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 1000;
        min-width: 250px;
        font-size: 14px;
      `;

      // Ensure data properties exist with defaults
      const position = data.position !== undefined ? data.position : 3;
      const separate = data.separate !== undefined ? data.separate : 0;
      const trend = data.trend !== undefined ? data.trend : 0;

      // Create form content
      popover.innerHTML = `
        <h3 style="margin: 0 0 15px 0; font-size: 16px; font-weight: bold;">Edit Weight Position</h3>
        
        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 5px; font-weight: 600;">Position:</label>
          <select id="popover-weight-position" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            ${tableType !== 'table4' ? `<option value="-1" ${position === -1 ? 'selected' : ''}>Hidden (No Dots)</option>` : ''}
            <option value="1" ${position === 1 ? 'selected' : ''}>Position 1 (Strong Underweight)</option>
            <option value="2" ${position === 2 ? 'selected' : ''}>Position 2 (Underweight)</option>
            <option value="3" ${position === 3 ? 'selected' : ''}>Position 3 (Neutral)</option>
            <option value="4" ${position === 4 ? 'selected' : ''}>Position 4 (Overweight)</option>
            <option value="5" ${position === 5 ? 'selected' : ''}>Position 5 (Strong Overweight)</option>
          </select>
        </div>
        
        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 5px; font-weight: 600;">Separate Row:</label>
          <select id="popover-separate-row" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            <option value="0" ${separate === 0 ? 'selected' : ''}>Normal Row</option>
            <option value="1" ${separate === 1 ? 'selected' : ''}>Separated Row (with borders)</option>
          </select>
        </div>
        
        ${tableType === 'table3' ? `
        <div style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 5px; font-weight: 600;">Trend Direction:</label>
          <select id="popover-trend-direction" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            <option value="0" ${trend === 0 ? 'selected' : ''}>No Trend</option>
            <option value="1" ${trend === 1 ? 'selected' : ''}>Upward Trend (→)</option>
            <option value="-1" ${trend === -1 ? 'selected' : ''}>Downward Trend (←)</option>
          </select>
        </div>
        ` : ''}
        
        <div style="display: flex; gap: 10px; justify-content: flex-end;">
          <button onclick="closeWeightPopover()" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancel</button>
          <button onclick="saveWeightChanges(${rowIndex}, '${tableType}')" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Save</button>
        </div>
      `;

      document.body.appendChild(popover);
      window.currentWeightPopover = popover;

      // Close popover when clicking outside
      setTimeout(() => {
        document.addEventListener('click', closeWeightPopoverOnOutsideClick);
      }, 100);
    }

    // Shared weight popover utility functions
    function closeWeightPopoverOnOutsideClick(e) {
      const popover = document.querySelector('.weight-edit-popover');
      if (popover && !popover.contains(e.target)) {
        closeWeightPopover();
      }
    }

    window.closeWeightPopover = function() {
      const popover = document.querySelector('.weight-edit-popover');
      if (popover) {
        popover.remove();
        document.removeEventListener('click', closeWeightPopoverOnOutsideClick);
      }
    };

    window.saveWeightChanges = function(rowIndex, tableType) {
      const position = parseInt(document.getElementById('popover-weight-position').value);
      const separate = parseInt(document.getElementById('popover-separate-row').value);
      
      let trend = 0;
      if (tableType === 'table3') {
        trend = parseInt(document.getElementById('popover-trend-direction').value);
      }

      // Update the data based on table type
      let targetData = null;
      let targetTbodyId = null;
      
      if (tableType === 'cio-view') {
        targetData = window.cioViewData;
        targetTbodyId = 'cio-view-body';
      } else if (tableType === 'table3') {
        targetData = window.table3ViewData;
        targetTbodyId = 'table3-view-body';
      } else if (tableType === 'table4') {
        targetData = window.table4ViewData;
        targetTbodyId = 'table4-view-body';
      }
      
      if (targetData && targetData[rowIndex]) {
        targetData[rowIndex].position = position;
        targetData[rowIndex].separate = separate;
        
        if (tableType === 'table3') {
          targetData[rowIndex].trend = trend;
        }
        
        // Update weight based on position
        if (position === -1) {
          targetData[rowIndex].weight = 'none';
        } else if (position <= 2) {
          targetData[rowIndex].weight = 'underweight';
        } else if (position === 3) {
          targetData[rowIndex].weight = 'neutral';
        } else {
          targetData[rowIndex].weight = 'overweight';
        }
        
        // Regenerate the appropriate table
        if (targetTbodyId === 'cio-view-body') {
          const cioTbody = document.getElementById("cio-view-body");
          cioTbody.innerHTML = window.cioViewData.map(window.createsectorRow).join("");
          // Re-initialize Table 2 functionality
          makeHeadersEditable();
          makeTextCellsEditable();
          addTable2WeightIndicatorEditing();
        } else if (targetTbodyId === 'table3-view-body') {
          const table3Tbody = document.getElementById("table3-view-body");
          table3Tbody.innerHTML = window.table3ViewData.map(window.createTable3sectorRow).join("");
          // Re-initialize Table 3 functionality
          makeHeadersEditable();
          makeTextCellsEditable();
          addTable3WeightIndicatorEditing();
          addTable3RowEditing();
        } else if (targetTbodyId === 'table4-view-body') {
          const table4Tbody = document.getElementById("table4-view-body");
          table4Tbody.innerHTML = window.table4ViewData.map(window.createTable4Row).join("");
          // Render special sections
          renderTable4SpecialSections();
          // Re-initialize Table 4 functionality
          makeHeadersEditable();
          makeTextCellsEditable();
          addTable4WeightIndicatorEditing();
          addTable4RowEditing();
        }
        
        console.log(`Updated weight settings for ${tableType} row ${rowIndex}`);
      }

      // Save changes
      saveDataToStorage();
      closeWeightPopover();
      showWeightUpdateNotification();
    };

    // Helper functions for merge preview
    function getNextRowComment(rowIndex, tableType) {
      let targetData = null;
      if (tableType === 'factors') targetData = window.factorsData;
      else if (tableType === 'cio-view') targetData = window.cioViewData;
      else if (tableType === 'table3') targetData = window.table3ViewData;
      else if (tableType === 'table4') targetData = window.table4ViewData;
      
      if (targetData && rowIndex < targetData.length - 1) {
        return targetData[rowIndex + 1].comments || 'Empty';
      }
      return 'No next row';
    }

    function getMergePreview(currentComments, rowIndex, tableType) {
      const nextComment = getNextRowComment(rowIndex, tableType);
      if (nextComment === 'No next row' || nextComment === 'Empty') {
        return currentComments || 'Empty';
      }
      const current = currentComments || '';
      const next = nextComment === 'Empty' ? '' : nextComment;
      return current + (current && next ? ' | ' : '') + next;
    }

    // Helper function to regenerate tables with proper parameters
    function regenerateTable(tableType) {
      if (tableType === 'factors') {
        const tbody = document.getElementById('factors-body');
        if (tbody && window.factorsData) {
          tbody.innerHTML = window.factorsData.map((item, index) => window.createFactorRow(item, index, window.factorsData)).join("");
        }
      } else if (tableType === 'cio-view') {
        const tbody = document.getElementById('cio-view-body');
        if (tbody && window.cioViewData) {
          tbody.innerHTML = window.cioViewData.map((item, index) => window.createAssetClassRow(item, index, window.cioViewData)).join("");
        }
      } else if (tableType === 'table3') {
        const tbody = document.getElementById('table3-view-body');
        if (tbody && window.table3ViewData) {
          tbody.innerHTML = window.table3ViewData.map((item, index) => window.createTable3sectorRow(item, index, window.table3ViewData)).join("");
        }
      }
    }

    // Comments Edit Popover Functionality
    function showCommentsEditPopover(element, data, rowIndex, tableType) {
      // Validate data before proceeding
      if (!data) {
        console.error('No data provided to showCommentsEditPopover for row:', rowIndex);
        return;
      }

      // Remove existing popover if any
      const existingPopover = document.querySelector('.comments-edit-popover');
      if (existingPopover) {
        existingPopover.remove();
      }

      // Create popover
      const popover = document.createElement('div');
      popover.className = 'comments-edit-popover';
      popover.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 1000;
        min-width: 350px;
        max-width: 500px;
        font-size: 14px;
        animation: popoverFadeIn 0.2s ease-out;
      `;

      // Ensure data properties exist with defaults
      const comments = data.comments || '';
      const merge = data.merge || '';

      // Create form content
      popover.innerHTML = `
        <h3 style="margin: 0 0 15px 0; font-size: 16px; font-weight: bold;">Edit Comments</h3>
        
        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 5px; font-weight: 600;">Comments:</label>
          <textarea id="popover-comments" 
                   style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; min-height: 80px; resize: vertical; font-family: inherit;"
                   placeholder="Enter comments here...">${comments}</textarea>
        </div>
        
        <div style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 5px; font-weight: 600;">Merge with Next Row:</label>
          <select id="popover-merge" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            <option value="0" ${merge === 0 || merge === '0' || !merge ? 'selected' : ''}>No (0)</option>
            <option value="1" ${merge === 1 || merge === '1' ? 'selected' : ''}>Yes (1)</option>
          </select>
          <div style="font-size: 12px; color: #666; margin-top: 5px;">
            When set to "Yes (1)", this row's comment will be combined with the next row's comment. The next row's comment will be cleared.
          </div>
        </div>
        
        <div style="display: flex; gap: 10px; justify-content: flex-end;">
          <button onclick="closeCommentsPopover()" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancel</button>
          <button onclick="saveCommentsChanges(${rowIndex}, '${tableType}')" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Save</button>
        </div>
      `;

      document.body.appendChild(popover);
      window.currentCommentsPopover = popover;

      // Focus on the first textarea
      setTimeout(() => {
        const commentsTextarea = document.getElementById('popover-comments');
        if (commentsTextarea) {
          commentsTextarea.focus();
          commentsTextarea.select();
        }
      }, 100);

      // Close popover when clicking outside
      setTimeout(() => {
        document.addEventListener('click', closeCommentsPopoverOnOutsideClick);
      }, 100);
    }

    // Comments popover utility functions
    function closeCommentsPopoverOnOutsideClick(e) {
      const popover = document.querySelector('.comments-edit-popover');
      if (popover && !popover.contains(e.target)) {
        closeCommentsPopover();
      }
    }

    window.closeCommentsPopover = function() {
      const popover = document.querySelector('.comments-edit-popover');
      if (popover) {
        popover.remove();
        document.removeEventListener('click', closeCommentsPopoverOnOutsideClick);
      }
    };

    window.saveCommentsChanges = function(rowIndex, tableType) {
      const comments = document.getElementById('popover-comments').value;
      const mergeValue = parseInt(document.getElementById('popover-merge').value);

      // Update the data based on table type
      let targetData = null;
      let targetTbodyId = null;
      
      if (tableType === 'factors') {
        targetData = window.factorsData;
        targetTbodyId = 'factors-body';
      } else if (tableType === 'cio-view') {
        targetData = window.cioViewData;
        targetTbodyId = 'cio-view-body';
      } else if (tableType === 'table3') {
        targetData = window.table3ViewData;
        targetTbodyId = 'table3-view-body';
      } else if (tableType === 'table4') {
        targetData = window.table4ViewData;
        targetTbodyId = 'table4-view-body';
      }
      
      if (targetData && targetData[rowIndex]) {
        targetData[rowIndex].comments = comments;
        targetData[rowIndex].merge = mergeValue;
        
        // Handle merge functionality
        if (mergeValue === 1 && rowIndex < targetData.length - 1) {
          // Merge current row's comment with next row's comment
          const nextRowIndex = rowIndex + 1;
          const currentComments = comments || '';
          const nextRowComments = targetData[nextRowIndex].comments || '';
          
          // Combine comments (current + next)
          const mergedComments = currentComments + (currentComments && nextRowComments ? ' | ' : '') + nextRowComments;
          
          // Update current row with merged comments
          targetData[rowIndex].comments = mergedComments;
          
          // Hide the next row's comment cell instead of clearing it
          targetData[nextRowIndex].commentHidden = true;
          
          // Reset merge flag for next row to avoid conflicts
          targetData[nextRowIndex].merge = 0;
        } else {
          // If merge is disabled, ensure next row's comment is visible
          if (rowIndex < targetData.length - 1) {
            targetData[rowIndex + 1].commentHidden = false;
          }
        }
        
        // Regenerate the table to reflect changes
        regenerateTable(tableType);
        
        // Re-initialize functionality based on table type
        makeHeadersEditable();
        makeTextCellsEditable();
        
        if (tableType === 'factors') {
          addRangeHandleEditing();
        } else if (tableType === 'cio-view') {
          addTable2WeightIndicatorEditing();
        } else if (tableType === 'table3') {
          addTable3WeightIndicatorEditing();
          addTable3RowEditing();
        }
        
        console.log(`Updated comments and merge for ${tableType} row ${rowIndex}, merge: ${mergeValue}`);
      }

      // Save changes
      saveDataToStorage();
      closeCommentsPopover();
      showCommentsUpdateNotification();
    };

    // Show comments update notification
    function showCommentsUpdateNotification() {
      const notification = document.createElement('div');
      notification.textContent = 'Comments updated successfully!';
      notification.style.cssText = `
        position: fixed;
        top: 140px;
        right: 20px;
        background: #28a745;
        color: white;
        padding: 10px 15px;
        border-radius: 4px;
        z-index: 1001;
        font-size: 14px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        if (notification.parentNode) {
          notification.parentNode.removeChild(notification);
        }
      }, 3000);
    }
  </script>

  <!-- JS Modules -->
  <script>
    // Component.js functionality
    window.createFactorRow = function(item) {
      // Create SVG arrow based on trend
      let trendArrow = '';
      const svgArrow = `<svg width="28" height="21" viewBox="0 0 122.88 108.06" xmlns="http://www.w3.org/2000/svg">
        <path d="M58.94,24.28a14.27,14.27,0,0,1,20.35-20l39.49,40.16a14.28,14.28,0,0,1,0,20L80.09,103.79a14.27,14.27,0,1,1-20.35-20L74.82,68.41l-60.67-.29a14.27,14.27,0,0,1,.24-28.54l59.85.28L58.94,24.28Z" fill="currentColor"/>
      </svg>`;
      
      switch(item.trend) {
        case 'up':
          trendArrow = `<span class="svg-arrow right">${svgArrow}</span>`;
          break;
        case 'down':
          trendArrow = `<span class="svg-arrow left">${svgArrow}</span>`;
          break;
        case 'neutral':
        default:
          trendArrow = '';
          break;
      }

      // Determine handle color class based on implication (safe: handle missing/undefined)
      let handleColorClass = '';
      const implication = (item && item.implication) ? String(item.implication).toLowerCase() : 'neutral';
      switch(implication) {
        case 'positive':
          handleColorClass = 'positive';
          break;
        case 'neutral':
          handleColorClass = 'neutral';
          break;
        case 'negative':
          handleColorClass = 'negative';
          break;
      }

      // Calculate position based on value (0-100) as percentage
      // Constrain position to prevent handle overflow (10px handle radius)
      const rawPosition = Math.min(Math.max(item.value, 0), 100);
      const constrainedPosition = Math.min(Math.max(rawPosition, 3), 97);
      
      // Create the range slider visualization
      const rangeSlider = `
        <div class="range-slider">
          <div class="range-track">
            <div class="range-thumb" style="left: ${constrainedPosition}%;">
              ${trendArrow}
              <div class="range-handle ${handleColorClass}"></div>
            </div>
          </div>
        </div>
      `;

      return `
        <tr>
          <td>${item.factor}</td>
          <td>${rangeSlider}</td>
          <td>${item.cioView}</td>
        </tr>
      `;
    };

    // CIO View table functionality
    window.createsectorRow = function(item) {
      // Determine if row should have separation borders
      const rowClass = item.separate === 1 ? ' class="separated-row"' : '';
      
      // If position is -1, hide all dots
      if (item.position === -1) {
        const weightIndicator = `
          <div class="weight-indicator hidden">
            <!-- No dots displayed when position is -1 -->
          </div>
        `;

        return `
          <tr${rowClass}>
            <td>${item.sector}</td>
            <td>${weightIndicator}</td>
            <td>${item.comments}</td>
          </tr>
        `;
      }

      // Create weight indicator dots for normal positions
      const totalDots = 5;
      let dotsHtml = '';
      
      for (let i = 1; i <= totalDots; i++) {
        let dotClass = 'weight-dot';
        let triangleHtml = '';
        
        if (i === item.position) {
          // Only the selected position gets color
          if (i <= 2) {
            dotClass += ' filled underweight'; // Red for positions 1-2
          } else if (i === 3) {
            dotClass += ' filled neutral'; // Yellow for position 3
          } else {
            dotClass += ' filled overweight'; // Green for positions 4-5
          }
        } else {
          dotClass += ' empty'; // All other dots are empty/gray
        }
        
        // Add trend triangle based on trend value and position
        if (item.trend !== undefined && item.trend !== 0 && item.position !== -1) {
          if (item.trend === 1 && i === (item.position - 1) && i >= 1) {
            // Show upward trend triangle on the dot to the LEFT of the selected position
            triangleHtml = '<div class="trend-triangle left"></div>';
          } else if (item.trend === -1 && i === (item.position + 1) && i <= 5) {
            // Show downward trend triangle on the dot to the RIGHT of the selected position  
            triangleHtml = '<div class="trend-triangle right"></div>';
          }
        }
        
        dotsHtml += `<div class="${dotClass}" data-position="${i}">${triangleHtml}</div>`;
      }

      const weightIndicator = `
        <div class="weight-indicator">
          ${dotsHtml}
        </div>
      `;

      return `
        <tr${rowClass}>
          <td>${item.sector}</td>
          <td>${weightIndicator}</td>
          <td>${item.comments}</td>
        </tr>
      `;
    };

    // Load data from combined JSON file
    async function loadDataFromJSON() {
      try {
        // Load combined dashboard data
        const response = await fetch('./js/combined_dashboard_data.json');
        const data = await response.json();
        
        console.log('Combined data loaded:', data);
        
        // Set the global data from combined source
        window.headerData = data.equityFactors.headers;
        window.factorsData = data.equityFactors.factors;
        window.cioViewData = data.sectorViews.sectores;
        window.table3ViewData = data.table3Views.sectores;
        window.dashboardInfo = data.dashboardInfo;
        
        // Ensure all data items have merge field initialized
        if (window.factorsData) {
          window.factorsData.forEach(item => {
            if (item.merge === undefined) item.merge = 0;
          });
        }
        if (window.cioViewData) {
          window.cioViewData.forEach(item => {
            if (item.merge === undefined) item.merge = 0;
          });
        }
        if (window.table3ViewData) {
          window.table3ViewData.forEach(item => {
            if (item.merge === undefined) item.merge = 0;
          });
        }
        
        console.log('CIO View Data:', window.cioViewData);
        console.log('CIO View Data length:', window.cioViewData.length);
        console.log('Table 3 View Data:', window.table3ViewData);
        console.log('Table 3 View Data length:', window.table3ViewData.length);
        
        // Update page title and header
        document.title = data.dashboardInfo.title;
        document.querySelector('h1').textContent = data.dashboardInfo.title;
        
        // Update headers in the DOM for first table
        const headers = document.querySelectorAll('th:not(.text-xs)');
        if (headers[0]) headers[0].textContent = window.headerData.factorHeader;
        if (headers[1]) headers[1].textContent = window.headerData.implicationHeader;
        if (headers[2]) headers[2].textContent = window.headerData.cioViewHeader;
        
        // Update table subtitles
        const tableSubtitles = document.querySelectorAll('h2');
        if (tableSubtitles[0]) tableSubtitles[0].textContent = data.equityFactors.subtitle;
        if (tableSubtitles[1]) tableSubtitles[1].textContent = data.sectorViews.subtitle;
        if (tableSubtitles[2]) tableSubtitles[2].textContent = data.table3Views.subtitle;
        
        // Update footnotes
        const footnoteElements = document.querySelectorAll('.mt-4.text-xs.text-gray-600 p');
        if (footnoteElements[1] && data.sectorViews.footnote) {
          footnoteElements[1].textContent = data.sectorViews.footnote;
        }
        if (footnoteElements[2] && data.table3Views.footnote) {
          footnoteElements[2].textContent = data.table3Views.footnote;
        }
        
        // Generate first table with factors data
        const tbody = document.getElementById("factors-body");
        tbody.innerHTML = window.factorsData.map(window.createFactorRow).join("");
        console.log('Factors table populated');
        
        // Generate second table with CIO View data
        const cioTbody = document.getElementById("cio-view-body");
        if (window.cioViewData && window.cioViewData.length > 0) {
          console.log('Populating CIO View table with', window.cioViewData.length, 'items');
          cioTbody.innerHTML = window.cioViewData.map(window.createAssetClassRow).join("");
          console.log('CIO View table populated');
        } else {
          console.error('No CIO View data available');
        }

        // Generate third table with Table 3 View data
        const table3Tbody = document.getElementById("table3-view-body");
        if (window.table3ViewData && window.table3ViewData.length > 0) {
          console.log('Populating Table 3 View table with', window.table3ViewData.length, 'items');
          table3Tbody.innerHTML = window.table3ViewData.map(window.createTable3sectorRow).join("");
          console.log('Table 3 View table populated');
        } else {
          console.error('No Table 3 View data available');
        }

        // Generate fourth table with Table 4 View data
        console.log('Checking for table4ViewData:', data.table4ViewData);
        if (data.table4ViewData && data.table4ViewData.assetClasses) {
          console.log('Table 4 data found:', data.table4ViewData.assetClasses);
          window.table4ViewData = data.table4ViewData.assetClasses;
          
          // Update Table 4 headers
          const table4Header1 = document.getElementById('table4-header-1');
          const table4Header2 = document.getElementById('table4-header-2');
          if (table4Header1 && data.table4ViewData.headers.assetClassHeader) {
            table4Header1.childNodes[0].textContent = data.table4ViewData.headers.assetClassHeader;
          }
          if (table4Header2 && data.table4ViewData.headers.cioViewHeader) {
            const headerText = table4Header2.childNodes[0];
            if (headerText) headerText.textContent = data.table4ViewData.headers.cioViewHeader + ' ';
          }
          
          // Update Table 4 subtitle
          const table4Subtitle = document.getElementById('table4-subtitle');
          if (table4Subtitle && data.table4ViewData.subtitle) {
            table4Subtitle.textContent = data.table4ViewData.subtitle;
          }
          
          // Update Table 4 footnote
          const table4Footnote = document.getElementById('table4-footnote');
          if (table4Footnote && data.table4ViewData.footnote) {
            table4Footnote.textContent = data.table4ViewData.footnote;
          }
          
          const table4Tbody = document.getElementById("table4-view-body");
          if (window.table4ViewData && window.table4ViewData.length > 0) {
            console.log('Populating Table 4 View table with', window.table4ViewData.length, 'items');
            table4Tbody.innerHTML = window.table4ViewData.map(window.createTable4Row).join("");
            renderTable4SpecialSections();
            console.log('Table 4 View table populated');
          } else {
            console.error('No Table 4 View data available');
          }
        } else {
          console.error('Table 4 ViewData not found in JSON or missing assetClasses property');
          console.log('Data keys:', Object.keys(data));
        }

        // Initialize Table 5
        console.log('Checking for table5ViewData:', data.table5ViewData);
        if (data.table5ViewData && Array.isArray(data.table5ViewData)) {
          window.table5ViewData = data.table5ViewData;
          const table5Tbody = document.getElementById('table5-body');
          if (table5Tbody) {
            table5Tbody.innerHTML = window.table5ViewData.map(window.createTable5Row).join('');
            console.log('Table 5 initialized with', window.table5ViewData.length, 'items');
          }
        } else {
          console.log('table5ViewData not found in combined JSON, initializing with fallback');
        }
        
        console.log('Combined dashboard data loaded successfully');
      } catch (error) {
        console.error('Error loading combined JSON data:', error);
        // Fallback to individual file loading
        await loadDataFromSeparateFiles();
      }
        
      // Initialize editable functionality for both tables
      makeEditable();
    }

    // Fallback function to load from separate files
    async function loadDataFromSeparateFiles() {
      try {
        // Load factors data
        const response = await fetch('./js/equity_dashboard_data.json');
        const data = await response.json();
        
        window.headerData = data.headers;
        window.factorsData = data.factors;
        
        // Initialize merge fields
        if (window.factorsData) {
          window.factorsData.forEach(item => {
            if (item.merge === undefined) item.merge = 0;
          });
        }
        
        const headers = document.querySelectorAll('th:not(.text-xs)');
        if (headers[0]) headers[0].textContent = window.headerData.factorHeader;
        if (headers[1]) headers[1].textContent = window.headerData.implicationHeader;
        if (headers[2]) headers[2].textContent = window.headerData.cioViewHeader;
        
        const tbody = document.getElementById("factors-body");
        tbody.innerHTML = window.factorsData.map((item, index) => window.createFactorRow(item, index, window.factorsData)).join("");
        
        console.log('Factors data loaded from separate file');
      } catch (error) {
        console.error('Error loading factors JSON data:', error);
        initializeWithFallbackData();
      }

      try {
        // Load CIO View data
        const cioResponse = await fetch('./js/cio_view_data.json');
        const cioData = await cioResponse.json();
        
        window.cioViewData = cioData.sectores;
        
        // Initialize merge fields
        if (window.cioViewData) {
          window.cioViewData.forEach(item => {
            if (item.merge === undefined) item.merge = 0;
          });
        }
        
        const cioTbody = document.getElementById("cio-view-body");
        cioTbody.innerHTML = window.cioViewData.map((item, index) => window.createAssetClassRow(item, index, window.cioViewData)).join("");
        
        console.log('CIO View data loaded from separate file');
      } catch (error) {
        console.error('Error loading CIO View JSON data:', error);
        initializeCIOViewFallback();
      }

      // Initialize Table 3 with fallback data
      try {
        initializeTable3ViewFallback();
      } catch (error) {
        console.error('Error initializing Table 3 View data:', error);
      }
    }

    // Fallback initialization
    function initializeWithFallbackData() {
      // Initialize with default header data
      window.headerData = {
        factorHeader: "Factor",
        implicationHeader: "Implication for Equities", 
        cioViewHeader: "CIO View"
      };
      
      // Initialize with minimal fallback data if factorsData doesn't exist
      if (!window.factorsData) {
        window.factorsData = [
          {
            factor: "Sample Factor",
            implication: "Neutral",
            trend: "neutral",
            value: 50,
            cioView: "Please load data from JSON file or import your data."
          }
        ];
      }
      
      // Generate table with existing data
      const tbody = document.getElementById("factors-body");
      tbody.innerHTML = window.factorsData.map(window.createFactorRow).join("");
      
      // Initialize editable functionality
      makeEditable();
    }

    // CIO View fallback initialization
    function initializeCIOViewFallback() {
      window.cioViewData = [
        {
          sector: "Sample Asset Class",
          weight: "neutral",
          position: 3,
          separate: 0,
          comments: "Please ensure CIO View data file is available."
        }
      ];
      
      const cioTbody = document.getElementById("cio-view-body");
      cioTbody.innerHTML = window.cioViewData.map(window.createAssetClassRow).join("");
    }

    // Table 3 View fallback initialization
    function initializeTable3ViewFallback() {
      window.table3ViewData = [
        {
          sector: "Sample Additional Asset Class",
          weight: "neutral",
          position: 3,
          separate: 0,
          trend: 0,
          comments: "Please ensure Table 3 View data is available."
        }
      ];
      
      const table3Tbody = document.getElementById("table3-view-body");
      table3Tbody.innerHTML = window.table3ViewData.map(window.createTable3sectorRow).join("");
    }

    // Store original header values for reference
    window.headerData = {
      factorHeader: "Factor",
      implicationHeader: "Implication for Equities", 
      cioViewHeader: "CIO View"
    };

    // Add editable functionality to all headers and data cells
    function makeEditable() {
      // Make specific header cells editable (excluding the sub-header with alignment labels)
      const editableHeaders = document.querySelectorAll('th:not(.text-xs)');
      editableHeaders.forEach((cell, index) => {
        cell.addEventListener('dblclick', function() {
          if (this.querySelector('input')) return; // Already editing
          
          const originalText = this.textContent.trim();
          const input = document.createElement('input');
          input.type = 'text';
          input.value = originalText;
          input.style.width = '100%';
          input.style.border = 'none';
          input.style.background = 'transparent';
          input.style.fontSize = 'inherit';
          input.style.fontWeight = 'inherit';
          input.style.textAlign = 'inherit';
          input.style.padding = '4px';
          
          this.innerHTML = '';
          this.appendChild(input);
          input.focus();
          input.select();
          
          const saveEdit = () => {
            const newValue = input.value || originalText;
            this.textContent = newValue;
            
            // Update header data based on column position
            if (index === 0) {
              window.headerData.factorHeader = newValue;
            } else if (index === 1) {
              window.headerData.implicationHeader = newValue;
            } else if (index === 2) {
              window.headerData.cioViewHeader = newValue;
            }
            
            // Save to localStorage
            saveDataToStorage();
          };
          
          input.addEventListener('blur', saveEdit);
          input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
              saveEdit();
            }
            if (e.key === 'Escape') {
              this.textContent = originalText;
            }
          });
        });
      });
      
      // Make data cells editable (excluding range slider column and weight indicator column)
      const dataCells = document.querySelectorAll('tbody td:first-child:not(#table5-body td), tbody td:last-child:not(#table5-body td)');
      dataCells.forEach((cell, index) => {
        // Additional check to ensure we're not in Table 5
        if (cell.closest('#table5-body')) {
          return; // Skip Table 5 cells
        }
        
        cell.addEventListener('dblclick', function() {
          if (this.querySelector('input')) return; // Already editing
          
          const originalText = this.textContent.trim();
          const input = document.createElement('input');
          input.type = 'text';
          input.value = originalText;
          input.style.width = '100%';
          input.style.border = 'none';
          input.style.background = 'transparent';
          input.style.fontSize = 'inherit';
          input.style.fontWeight = 'inherit';
          input.style.textAlign = 'inherit';
          input.style.padding = '4px';
          
          this.innerHTML = '';
          this.appendChild(input);
          input.focus();
          input.select();
          
          const saveEdit = () => {
            const newValue = input.value || originalText;
            this.textContent = newValue;
            
            // Update the data array based on which table this cell belongs to
            const row = this.parentElement;
            const tbody = row.parentElement;
            const rowIndex = Array.from(tbody.children).indexOf(row);
            
            // Check if this is the factors table or CIO view table
            if (tbody.id === 'factors-body') {
              if (this === row.firstElementChild) {
                // Factor column
                window.factorsData[rowIndex].factor = newValue;
              } else if (this === row.lastElementChild) {
                // CIO View column for factors table
                window.factorsData[rowIndex].cioView = newValue;
              }
            } else if (tbody.id === 'cio-view-body') {
              if (this === row.firstElementChild) {
                // Asset Class column
                if (window.cioViewData && window.cioViewData[rowIndex]) {
                  window.cioViewData[rowIndex].sector = newValue;
                }
              } else if (this === row.lastElementChild) {
                // Comments column
                if (window.cioViewData && window.cioViewData[rowIndex]) {
                  window.cioViewData[rowIndex].comments = newValue;
                }
              }
            } else if (tbody.id === 'table3-view-body') {
              if (this === row.firstElementChild) {
                // Asset Class column for Table 3
                if (window.table3ViewData && window.table3ViewData[rowIndex]) {
                  window.table3ViewData[rowIndex].sector = newValue;
                }
              } else if (this === row.lastElementChild) {
                // Comments column for Table 3
                if (window.table3ViewData && window.table3ViewData[rowIndex]) {
                  window.table3ViewData[rowIndex].comments = newValue;
                }
              }
            }
            
            // Save to localStorage
            saveDataToStorage();
          };
          
          input.addEventListener('blur', saveEdit);
          input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
              saveEdit();
            }
            if (e.key === 'Escape') {
              this.textContent = originalText;
            }
          });
        });
      });
      
      // Add double-click functionality to Table 3 rows for weight editing
      const table3Rows = document.querySelectorAll('#table3-view-body tr');
      table3Rows.forEach((row, index) => {
        row.addEventListener('dblclick', function(e) {
          // Prevent if already editing text or if clicking on an input
          if (e.target.tagName === 'INPUT' || e.target.closest('input')) {
            return;
          }
          
          e.preventDefault();
          e.stopPropagation();
          
          const tbody = this.parentElement;
          const rowIndex = Array.from(tbody.children).indexOf(this);
          
          if (window.table3ViewData && window.table3ViewData[rowIndex]) {
            // Open weight edit popover for this row
            const weightIndicator = this.querySelector('.weight-indicator');
            if (weightIndicator) {
              // Use the center of the weight indicator area for popover positioning
              showWeightEditPopover(weightIndicator, window.table3ViewData[rowIndex], rowIndex, 'table3');
            } else {
              console.error('Weight indicator not found for Table 3 row:', rowIndex);
            }
          } else {
            console.error('Table 3 data not found for row:', rowIndex, 'Data:', window.table3ViewData);
          }
        });
        
        // Add visual feedback for Table 3 rows to indicate they're clickable
        row.style.cursor = 'pointer';
        row.title = 'Double-click to edit weight settings';
      });
      
      // Add double-click functionality to range handles
      addRangeHandleEditing();

      // Add click functionality to weight indicators  
      addWeightIndicatorEditing();
    }

    // Function to add weight indicator editing
    function addWeightIndicatorEditing() {
      const weightIndicators = document.querySelectorAll('.weight-indicator');
      weightIndicators.forEach((indicator, index) => {
        // Handle hidden weight indicators (when position is -1)
        if (indicator.classList.contains('hidden')) {
          indicator.addEventListener('dblclick', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const row = this.closest('tr');
            if (!row) return;
            const tbody = row.parentElement;
            if (!tbody) return;
            const rowIndex = Array.from(tbody.children).indexOf(row);
            
            // Determine which table this is from
            let targetData = null;
            let tableType = '';
            
            if (tbody.id === 'cio-view-body') {
              targetData = window.cioViewData;
              tableType = 'cio-view';
            } else if (tbody.id === 'table3-view-body') {
              targetData = window.table3ViewData;
              tableType = 'table3';
            }
            
            if (targetData && targetData[rowIndex]) {
              showWeightEditPopover(this, targetData[rowIndex], rowIndex, tableType);
            }
          });
          return; // Skip regular functionality for hidden indicators
        }

        // Single click for position selection (only for Table 2 - CIO view)
        indicator.addEventListener('click', function(e) {
          const row = this.closest('tr');
          if (!row) return;
          const tbody = row.parentElement;
          if (!tbody) return;
          
          // Only allow single-click editing for Table 2 (cio-view-body), not Table 3
          if (tbody.id !== 'cio-view-body') {
            return;
          }
          
          const dots = this.querySelectorAll('.weight-dot');
          const clickedDot = e.target.closest('.weight-dot');
          
          if (!clickedDot) return;
          
          const dotIndex = parseInt(clickedDot.getAttribute('data-position'));
          
          // Update the visual state - only the clicked dot gets color
          dots.forEach((dot, i) => {
            const dotPosition = parseInt(dot.getAttribute('data-position'));
            
            if (dotPosition === dotIndex) {
              // Only the selected position gets color
              if (dotIndex <= 2) {
                dot.className = 'weight-dot filled underweight'; // Red for positions 1-2
              } else if (dotIndex === 3) {
                dot.className = 'weight-dot filled neutral'; // Yellow for position 3
              } else {
                dot.className = 'weight-dot filled overweight'; // Green for positions 4-5
              }
            } else {
              dot.className = 'weight-dot empty'; // All other dots are empty
            }
          });
          
          // Update the data
          const rowIndex = Array.from(tbody.children).indexOf(row);
          
          let targetData = null;
          if (tbody.id === 'cio-view-body') {
            targetData = window.cioViewData;
          }
          
          if (targetData && targetData[rowIndex]) {
            targetData[rowIndex].position = dotIndex;
            
            // Update weight based on position
            if (dotIndex <= 2) {
              targetData[rowIndex].weight = 'underweight';
            } else if (dotIndex === 3) {
              targetData[rowIndex].weight = 'neutral';
            } else {
              targetData[rowIndex].weight = 'overweight';
            }
            
            // Ensure separate field exists (default to 0 if not present)
            if (targetData[rowIndex].separate === undefined) {
              targetData[rowIndex].separate = 0;
            }
            
            // Ensure trend field exists (default to 0 if not present)
            if (targetData[rowIndex].trend === undefined) {
              targetData[rowIndex].trend = 0;
            }
            
            saveDataToStorage();
            showWeightUpdateNotification();
          }
        });

        // Double click for trend editing on triangles and weight editing on dots
        indicator.addEventListener('dblclick', function(e) {
          e.preventDefault();
          e.stopPropagation();
          
          const clickedTriangle = e.target.closest('.trend-triangle');
          const clickedDot = e.target.closest('.weight-dot');
          
          const row = this.closest('tr');
          if (!row) return;
          const tbody = row.parentElement;
          if (!tbody) return;
          const rowIndex = Array.from(tbody.children).indexOf(row);
          
          if (clickedTriangle) {
            // Handle trend triangle double-click for Table 3
            if (tbody.id === 'table3-view-body') {
              showTrendEditPopover(clickedTriangle, window.table3ViewData[rowIndex], rowIndex, 'table3');
              return;
            }
          } else if (clickedDot && clickedDot.classList.contains('filled')) {
            // Handle weight dot double-click for position/weight editing popover (only for filled dots)
            let targetData = null;
            let tableType = '';
            
            if (tbody.id === 'cio-view-body') {
              targetData = window.cioViewData;
              tableType = 'cio-view';
            } else if (tbody.id === 'table3-view-body') {
              targetData = window.table3ViewData;
              tableType = 'table3';
            }
            
            if (targetData && targetData[rowIndex]) {
              showWeightEditPopover(clickedDot, targetData[rowIndex], rowIndex, tableType);
            }
            return;
          } else {
            // Double-click on weight indicator area (not on specific dot or triangle)
            let targetData = null;
            let tableType = '';
            
            if (tbody.id === 'cio-view-body') {
              targetData = window.cioViewData;
              tableType = 'cio-view';
              
              // For Table 2 (CIO View), hide all dots (set position to -1)
              if (targetData && targetData[rowIndex]) {
                targetData[rowIndex].position = -1;
                targetData[rowIndex].weight = 'none';
                
                // Ensure separate field exists (default to 0 if not present)
                if (targetData[rowIndex].separate === undefined) {
                  targetData[rowIndex].separate = 0;
                }
                
                // Ensure trend field exists (default to 0 if not present)
                if (targetData[rowIndex].trend === undefined) {
                  targetData[rowIndex].trend = 0;
                }
                
                // Regenerate Table 2
                const cioTbody = document.getElementById("cio-view-body");
                cioTbody.innerHTML = window.cioViewData.map(window.createAssetClassRow).join("");
                
                // Re-initialize editable functionality
                makeEditable();
                
                saveDataToStorage();
                showWeightUpdateNotification();
              }
            } else if (tbody.id === 'table3-view-body') {
              targetData = window.table3ViewData;
              tableType = 'table3';
              
              // For Table 3, open the popover instead of hiding dots
              if (targetData && targetData[rowIndex]) {
                showWeightEditPopover(this, targetData[rowIndex], rowIndex, tableType);
              }
            }
          }
        });

        // Add double-click functionality to hide all dots (set position to -1)
        indicator.addEventListener('dblclick', function(e) {
          e.preventDefault();
          
          const row = this.closest('tr');
          if (!row) return;
          const tbody = row.parentElement;
          if (!tbody) return;
          const rowIndex = Array.from(tbody.children).indexOf(row);
          
          let targetData = null;
          let targetTbodyId = null;
          if (tbody.id === 'cio-view-body') {
            targetData = window.cioViewData;
            targetTbodyId = 'cio-view-body';
          } else if (tbody.id === 'table3-view-body') {
            targetData = window.table3ViewData;
            targetTbodyId = 'table3-view-body';
          }
          
          if (targetData && targetData[rowIndex]) {
            // Set position to -1 to hide all dots
            targetData[rowIndex].position = -1;
            targetData[rowIndex].weight = 'none';
            
            // Ensure separate field exists (default to 0 if not present)
            if (targetData[rowIndex].separate === undefined) {
              targetData[rowIndex].separate = 0;
            }
            
            // Ensure trend field exists (default to 0 if not present)
            if (targetData[rowIndex].trend === undefined) {
              targetData[rowIndex].trend = 0;
            }
            
            // Regenerate the appropriate table
            if (targetTbodyId === 'cio-view-body') {
              const cioTbody = document.getElementById("cio-view-body");
              cioTbody.innerHTML = window.cioViewData.map(window.createAssetClassRow).join("");
            } else if (targetTbodyId === 'table3-view-body') {
              const table3Tbody = document.getElementById("table3-view-body");
              table3Tbody.innerHTML = window.table3ViewData.map(window.createTable3sectorRow).join("");
            }
            
            // Re-initialize editable functionality
            makeEditable();
            
            saveDataToStorage();
            showWeightUpdateNotification();
          }
        });
      });
    }

    // Show weight update notification
    function showWeightUpdateNotification() {
      const notification = document.createElement('div');
      notification.textContent = 'Weight updated successfully!';
      notification.style.cssText = `
        position: fixed;
        top: 80px;
        right: 20px;
        background: #28a745;
        color: white;
        padding: 10px 15px;
        border-radius: 4px;
        z-index: 1001;
        font-size: 14px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        if (notification.parentNode) {
          notification.parentNode.removeChild(notification);
        }
      }, 3000);
    }

    // Function to add range handle editing functionality
    function addRangeHandleEditing() {
      const rangeHandles = document.querySelectorAll('.range-handle');
      rangeHandles.forEach((handle, index) => {
        handle.addEventListener('dblclick', function(e) {
          e.stopPropagation(); // Prevent event bubbling
          
          const row = this.closest('tr');
          const rowIndex = Array.from(row.parentElement.children).indexOf(row);
          const factorData = window.factorsData[rowIndex];
          
          showRangeEditPopover(this, factorData, rowIndex);
        });
        
        // Add cursor pointer to indicate it's clickable
        handle.style.cursor = 'pointer';
      });
    }

    // Function to show range edit popover
    function showRangeEditPopover(handle, factorData, rowIndex) {
      // Remove existing popover if any
      const existingPopover = document.querySelector('.range-edit-popover');
      if (existingPopover) {
        existingPopover.remove();
      }

      // Create popover
      const popover = document.createElement('div');
      popover.className = 'range-edit-popover';
      popover.style.cssText = `
        position: absolute;
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 1000;
        min-width: 250px;
        font-size: 14px;
      `;

      // Get handle position
      const handleRect = handle.getBoundingClientRect();
      popover.style.left = (handleRect.left + window.scrollX - 125) + 'px';
      popover.style.top = (handleRect.bottom + window.scrollY + 10) + 'px';

      // Create form content
      popover.innerHTML = `
        <h3 style="margin: 0 0 15px 0; font-size: 16px; font-weight: bold;">Edit Range Settings</h3>
        
        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 5px; font-weight: 600;">Trend:</label>
          <select id="popover-trend" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            <option value="up" ${factorData.trend === 'up' ? 'selected' : ''}>Up</option>
            <option value="neutral" ${factorData.trend === 'neutral' ? 'selected' : ''}>Neutral</option>
            <option value="down" ${factorData.trend === 'down' ? 'selected' : ''}>Down</option>
          </select>
        </div>
        
        <div style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 5px; font-weight: 600;">Value:</label>
          <select id="popover-value" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            <option value="0" ${factorData.value === 0 ? 'selected' : ''}>0</option>
            <option value="25" ${factorData.value === 25 ? 'selected' : ''}>25</option>
            <option value="50" ${factorData.value === 50 ? 'selected' : ''}>50</option>
            <option value="75" ${factorData.value === 75 ? 'selected' : ''}>75</option>
            <option value="100" ${factorData.value === 100 ? 'selected' : ''}>100</option>
          </select>
        </div>
        
        <div style="display: flex; gap: 10px; justify-content: flex-end;">
          <button onclick="closeRangePopover()" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancel</button>
          <button onclick="saveRangeChanges(${rowIndex})" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Save</button>
        </div>
      `;

      document.body.appendChild(popover);
      window.currentRangePopover = popover;

      // Close popover when clicking outside
      setTimeout(() => {
        document.addEventListener('click', closePopoverOnOutsideClick);
      }, 100);
    }

    // Function to show weight edit popover
    function showWeightEditPopover(element, data, rowIndex, tableType) {
      // Validate data before proceeding
      if (!data) {
        console.error('No data provided to showWeightEditPopover for row:', rowIndex);
        return;
      }

      // Remove existing popover if any
      const existingPopover = document.querySelector('.weight-edit-popover');
      if (existingPopover) {
        existingPopover.remove();
      }

      // Create popover
      const popover = document.createElement('div');
      popover.className = 'weight-edit-popover';
      popover.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 1000;
        min-width: 250px;
        font-size: 14px;
      `;

      // Ensure data properties exist with defaults
      const position = data.position !== undefined ? data.position : 3;
      const separate = data.separate !== undefined ? data.separate : 0;
      const trend = data.trend !== undefined ? data.trend : 0;

      // Create form content
      popover.innerHTML = `
        <h3 style="margin: 0 0 15px 0; font-size: 16px; font-weight: bold;">Edit Weight Position</h3>
        
        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 5px; font-weight: 600;">Position:</label>
          <select id="popover-weight-position" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            ${tableType !== 'table4' ? `<option value="-1" ${position === -1 ? 'selected' : ''}>Hidden (No Dots)</option>` : ''}
            <option value="1" ${position === 1 ? 'selected' : ''}>Position 1 (Strong Underweight)</option>
            <option value="2" ${position === 2 ? 'selected' : ''}>Position 2 (Underweight)</option>
            <option value="3" ${position === 3 ? 'selected' : ''}>Position 3 (Neutral)</option>
            <option value="4" ${position === 4 ? 'selected' : ''}>Position 4 (Overweight)</option>
            <option value="5" ${position === 5 ? 'selected' : ''}>Position 5 (Strong Overweight)</option>
          </select>
        </div>
        
        <div style="margin-bottom: 15px;">
          <label style="display: block; margin-bottom: 5px; font-weight: 600;">Separate Row:</label>
          <select id="popover-separate-row" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            <option value="0" ${separate === 0 ? 'selected' : ''}>Normal Row</option>
            <option value="1" ${separate === 1 ? 'selected' : ''}>Separated Row (with borders)</option>
          </select>
        </div>
        
        ${tableType === 'table3' ? `
        <div style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 5px; font-weight: 600;">Trend Direction:</label>
          <select id="popover-trend-direction" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            <option value="0" ${trend === 0 ? 'selected' : ''}>No Trend</option>
            <option value="1" ${trend === 1 ? 'selected' : ''}>Upward Trend (→)</option>
            <option value="-1" ${trend === -1 ? 'selected' : ''}>Downward Trend (←)</option>
          </select>
        </div>
        ` : ''}
        
        <div style="display: flex; gap: 10px; justify-content: flex-end;">
          <button onclick="closeWeightPopover()" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancel</button>
          <button onclick="saveWeightChanges(${rowIndex}, '${tableType}')" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Save</button>
        </div>
      `;

      document.body.appendChild(popover);
      window.currentWeightPopover = popover;

      // Close popover when clicking outside
      setTimeout(() => {
        document.addEventListener('click', closeWeightPopoverOnOutsideClick);
      }, 100);
    }

    // Function to close weight popover when clicking outside
    function closeWeightPopoverOnOutsideClick(e) {
      const popover = document.querySelector('.weight-edit-popover');
      if (popover && !popover.contains(e.target)) {
        closeWeightPopover();
      }
    }

    // Function to close weight popover
    window.closeWeightPopover = function() {
      const popover = document.querySelector('.weight-edit-popover');
      if (popover) {
        popover.remove();
        document.removeEventListener('click', closeWeightPopoverOnOutsideClick);
      }
    };

    // Function to save weight changes
    window.saveWeightChanges = function(rowIndex, tableType) {
      const position = parseInt(document.getElementById('popover-weight-position').value);
      const separate = parseInt(document.getElementById('popover-separate-row').value);
      
      let trend = 0;
      if (tableType === 'table3') {
        trend = parseInt(document.getElementById('popover-trend-direction').value);
      }

      // Update the data based on table type
      let targetData = null;
      let targetTbodyId = null;
      
      if (tableType === 'cio-view') {
        targetData = window.cioViewData;
        targetTbodyId = 'cio-view-body';
      } else if (tableType === 'table3') {
        targetData = window.table3ViewData;
        targetTbodyId = 'table3-view-body';
      } else if (tableType === 'table4') {
        targetData = window.table4ViewData;
        targetTbodyId = 'table4-view-body';
      }
      
      if (targetData && targetData[rowIndex]) {
        targetData[rowIndex].position = position;
        targetData[rowIndex].separate = separate;
        
        if (tableType === 'table3') {
          targetData[rowIndex].trend = trend;
        }
        
        // Update weight based on position
        if (position === -1) {
          targetData[rowIndex].weight = 'none';
        } else if (position <= 2) {
          targetData[rowIndex].weight = 'underweight';
        } else if (position === 3) {
          targetData[rowIndex].weight = 'neutral';
        } else {
          targetData[rowIndex].weight = 'overweight';
        }
        
        // Regenerate the appropriate table
        if (targetTbodyId === 'cio-view-body') {
          const cioTbody = document.getElementById("cio-view-body");
          cioTbody.innerHTML = window.cioViewData.map(window.createAssetClassRow).join("");
        } else if (targetTbodyId === 'table3-view-body') {
          const table3Tbody = document.getElementById("table3-view-body");
          table3Tbody.innerHTML = window.table3ViewData.map(window.createTable3sectorRow).join("");
        } else if (targetTbodyId === 'table4-view-body') {
          const table4Tbody = document.getElementById("table4-view-body");
          table4Tbody.innerHTML = window.table4ViewData.map(window.createTable4Row).join("");
          renderTable4SpecialSections();
        }
        
        // Re-initialize editable functionality
        makeEditable();
        
        console.log(`Updated weight settings for ${tableType} row ${rowIndex}`);
      }

      // Save changes
      saveDataToStorage();

      // Close popover
      closeWeightPopover();

      // Show success notification
      showWeightUpdateNotification();
    };

    // Function to show trend edit popover
    function showTrendEditPopover(triangle, data, rowIndex, tableType) {
      // Remove existing popover if any
      const existingPopover = document.querySelector('.trend-edit-popover');
      if (existingPopover) {
        existingPopover.remove();
      }

      // Create popover
      const popover = document.createElement('div');
      popover.className = 'trend-edit-popover';
      popover.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 1000;
        min-width: 220px;
        font-size: 14px;
      `;

      // Create form content
      popover.innerHTML = `
        <h3 style="margin: 0 0 15px 0; font-size: 16px; font-weight: bold;">Edit Trend Direction</h3>
        
        <div style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 5px; font-weight: 600;">Trend Direction:</label>
          <select id="popover-trend-direction" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            <option value="0" ${data.trend === 0 ? 'selected' : ''}>No Trend</option>
            <option value="1" ${data.trend === 1 ? 'selected' : ''}>Upward Trend (→)</option>
            <option value="-1" ${data.trend === -1 ? 'selected' : ''}>Downward Trend (←)</option>
          </select>
          <div style="font-size: 12px; color: #666; margin-top: 5px;">
            Trend triangles show direction of movement relative to current position
          </div>
        </div>
        
        <div style="display: flex; gap: 10px; justify-content: flex-end;">
          <button onclick="closeTrendPopover()" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">Cancel</button>
          <button onclick="saveTrendChanges(${rowIndex}, '${tableType}')" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Save</button>
        </div>
      `;

      document.body.appendChild(popover);
      window.currentTrendPopover = popover;

      // Close popover when clicking outside
      setTimeout(() => {
        document.addEventListener('click', closeTrendPopoverOnOutsideClick);
      }, 100);
    }

    // Function to close trend popover when clicking outside
    function closeTrendPopoverOnOutsideClick(e) {
      const popover = document.querySelector('.trend-edit-popover');
      if (popover && !popover.contains(e.target)) {
        closeTrendPopover();
      }
    }

    // Function to close trend popover
    window.closeTrendPopover = function() {
      const popover = document.querySelector('.trend-edit-popover');
      if (popover) {
        popover.remove();
        document.removeEventListener('click', closeTrendPopoverOnOutsideClick);
      }
    };

    // Function to save trend changes
    window.saveTrendChanges = function(rowIndex, tableType) {
      const trendValue = parseInt(document.getElementById('popover-trend-direction').value);

      // Update the data based on table type
      if (tableType === 'table3' && window.table3ViewData && window.table3ViewData[rowIndex]) {
        window.table3ViewData[rowIndex].trend = trendValue;
        
        // Regenerate Table 3 to reflect changes
        const table3Tbody = document.getElementById("table3-view-body");
        table3Tbody.innerHTML = window.table3ViewData.map(window.createTable3sectorRow).join("");
        
        // Re-initialize editable functionality
        makeEditable();
        
        console.log(`Updated trend for Table 3 row ${rowIndex} to ${trendValue}`);
      }

      // Save changes
      saveDataToStorage();

      // Close popover
      closeTrendPopover();

      // Show success notification
      showTrendUpdateNotification();
    };

    // Function to show trend update notification
    function showTrendUpdateNotification() {
      const notification = document.createElement('div');
      notification.textContent = 'Trend direction updated successfully!';
      notification.style.cssText = `
        position: fixed;
        top: 80px;
        right: 20px;
        background: #28a745;
        color: white;
        padding: 10px 15px;
        border-radius: 4px;
        z-index: 1001;
        font-size: 14px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        if (notification.parentNode) {
          notification.parentNode.removeChild(notification);
        }
      }, 3000);
    }

    // Function to close range popover when clicking outside
    function closePopoverOnOutsideClick(e) {
      const popover = document.querySelector('.range-edit-popover');
      if (popover && !popover.contains(e.target)) {
        closeRangePopover();
      }
    }

    // Function to close range popover
    window.closeRangePopover = function() {
      const popover = document.querySelector('.range-edit-popover');
      if (popover) {
        popover.remove();
        document.removeEventListener('click', closePopoverOnOutsideClick);
      }
    };

    // Function to save range changes
    window.saveRangeChanges = function(rowIndex) {
      const trend = document.getElementById('popover-trend').value;
      const value = parseInt(document.getElementById('popover-value').value);

      // Auto-set implication based on value
      let implication;
      if (value === 0) {
        implication = 'Negative';
      } else if (value === 25 || value === 50) {
        implication = 'Neutral';
      } else {
        implication = 'Positive';
      }

      // Update the data
      window.factorsData[rowIndex].implication = implication;
      window.factorsData[rowIndex].trend = trend;
      window.factorsData[rowIndex].value = value;

      // Regenerate the table to reflect changes
      const tbody = document.getElementById("factors-body");
      tbody.innerHTML = window.factorsData.map(window.createFactorRow).join("");
      
      // Re-initialize editable functionality
      makeEditable();

      // Save changes
      saveDataToStorage();

      // Close popover
      closeRangePopover();

      // Show success notification
      showRangeUpdateNotification();
    };

    // Function to show range update notification
    function showRangeUpdateNotification() {
      const notification = document.createElement('div');
      notification.textContent = 'Range settings updated successfully!';
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #28a745;
        color: white;
        padding: 10px 15px;
        border-radius: 4px;
        z-index: 1001;
        font-size: 14px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      `;
      
      document.body.appendChild(notification);
      
      // Remove notification after 3 seconds
      setTimeout(() => {
        if (notification.parentNode) {
          notification.parentNode.removeChild(notification);
        }
      }, 3000);
    }

    // Initialize editable functionality
    makeEditable();

    // Functions to save and load data
    async function saveDataToJSON() {
      const combinedData = {
        dashboardInfo: window.dashboardInfo || {
          title: "CIO Viewpoint Dashboard",
          subtitle: "Comprehensive Investment Outlook",
          lastUpdated: new Date().toISOString(),
          version: "1.0"
        },
        equityFactors: {
          headers: window.headerData,
          subtitle: "Current readings on the key drivers of Equities for investors to consider, with arrows representing the recent trend:",
          factors: window.factorsData
        },
        assetClassViews: {
          headers: {
            assetClassHeader: "Asset Class",
            cioViewHeader: "CIO View",
            commentsHeader: "Comments"
          },
          subtitle: "Current CIO views on asset classes with weight recommendations:",
          footnote: "*Asia Pac ex-Japan refers to the geographic area surrounding the Pacific Ocean. The Asia Pac ex-Japan covers the western shores of North America and South America and the shores of Australia, eastern Asia and the islands of the Pacific.",
          assetClasses: window.cioViewData || []
        },
        table3Views: {
          headers: {
            assetClassHeader: "Asset Class",
            cioViewHeader: "CIO View",
            commentsHeader: "Comments"
          },
          subtitle: "Additional CIO views on asset classes with weight recommendations:",
          footnote: "*This table represents additional asset class considerations for portfolio construction.",
          assetClasses: window.table3ViewData || []
        },
        table4ViewData: {
          headers: {
            assetClassHeader: "Asset Class",
            cioViewHeader: "CIO View"
          },
          subtitle: "Current CIO views on asset classes with weight recommendations:",
          footnote: "*Alternative Investments include Hedge Strategies, Private Equity & Credit, and Real Assets.",
          assetClasses: window.table4ViewData || []
        }
      };
      
      // Update last modified timestamp
      combinedData.dashboardInfo.lastUpdated = new Date().toISOString();
      
      // Save to localStorage as backup
      localStorage.setItem('combinedDashboardData', JSON.stringify(combinedData, null, 2));
      
      // Also save individual sections for backward compatibility
      localStorage.setItem('equityDashboardData', JSON.stringify({
        headers: window.headerData,
        factors: window.factorsData,
        lastModified: new Date().toISOString()
      }, null, 2));
      
      localStorage.setItem('cioViewDashboardData', JSON.stringify({
        headers: combinedData.assetClassViews.headers,
        assetClasses: window.cioViewData || [],
        lastModified: new Date().toISOString()
      }, null, 2));
      
      localStorage.setItem('table3ViewDashboardData', JSON.stringify({
        headers: combinedData.table3Views.headers,
        assetClasses: window.table3ViewData || [],
        lastModified: new Date().toISOString()
      }, null, 2));
      
      // Automatically update the JSON file content and show notification
      console.log('Combined data updated in memory and localStorage');
      await updateCombinedJSONFileContent(combinedData);
      showSaveNotification();
    }

    async function updateCombinedJSONFileContent(data) {
      // Generate the updated JSON content for combined data
      const jsonContent = JSON.stringify(data, null, 2);
      
      console.log('Updated JSON content for combined_dashboard_data.json:');
      console.log(jsonContent);
      
      // Store the updated content for potential file replacement
      window.updatedCombinedJSONContent = jsonContent;
    }

    async function updateJSONFileContent(data) {
      // Generate the updated JSON content
      const jsonContent = JSON.stringify(data, null, 2);
      
      // Try to show the updated content in console for development
      console.log('Updated JSON content for equity_dashboard_data.json:');
      console.log(jsonContent);
      
      // Store the updated content for potential file replacement
      window.updatedJSONContent = jsonContent;
    }

    async function updateCIOViewJSONFileContent(data) {
      // Generate the updated JSON content for CIO View
      const jsonContent = JSON.stringify(data, null, 2);
      
      console.log('Updated JSON content for cio_view_data.json:');
      console.log(jsonContent);
      
      // Store the updated content for potential file replacement
      window.updatedCIOViewJSONContent = jsonContent;
    }

    function showSaveNotification() {
      // Create notification element
      const notification = document.createElement('div');
      notification.innerHTML = `
        <div>Data automatically updated!</div>
        <button onclick="showUpdatedJSON()" style="margin-top: 5px; padding: 2px 6px; background: white; color: #28a745; border: 1px solid white; border-radius: 2px; cursor: pointer; font-size: 12px;">View JSON</button>
      `;
      notification.style.cssText = `
        position: fixed;
        top: 60px;
        right: 10px;
        background: #28a745;
        color: white;
        padding: 10px 15px;
        border-radius: 4px;
        z-index: 1001;
        font-size: 14px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      `;
      
      document.body.appendChild(notification);
      
      // Remove notification after 5 seconds
      setTimeout(() => {
        if (notification.parentNode) {
          notification.parentNode.removeChild(notification);
        }
      }, 5000);
    }

    // Function to show updated JSON content
    window.showUpdatedJSON = function() {
      // Check for combined JSON content first (current approach)
      let jsonContent = window.updatedCombinedJSONContent;
      let fileName = 'combined_dashboard_data.json';
      
      // Fallback to individual JSON content if combined not available
      if (!jsonContent && window.updatedJSONContent) {
        jsonContent = window.updatedJSONContent;
        fileName = 'equity_dashboard_data.json';
      }
      
      if (jsonContent) {
        // Create modal to show JSON content
        const modal = document.createElement('div');
        modal.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0,0,0,0.8);
          z-index: 2000;
          display: flex;
          align-items: center;
          justify-content: center;
        `;
        
        const content = document.createElement('div');
        content.style.cssText = `
          background: white;
          padding: 20px;
          border-radius: 8px;
          max-width: 80%;
          max-height: 80%;
          overflow: auto;
        `;
        
        content.innerHTML = `
          <h3 style="margin-top: 0;">Updated JSON Content</h3>
          <p style="font-size: 14px; color: #666;">Copy this content and replace the content in js/${fileName}</p>
          <textarea readonly style="width: 100%; height: 400px; font-family: monospace; font-size: 12px; border: 1px solid #ddd; padding: 10px;">${jsonContent}</textarea>
          <div style="margin-top: 10px;">
            <button onclick="copyJSONContent()" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px;">Copy to Clipboard</button>
            <button onclick="closeJSONModal()" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">Close</button>
          </div>
        `;
        
        modal.appendChild(content);
        document.body.appendChild(modal);
        window.currentJSONModal = modal;
        
        // Store the current JSON content for copying
        window.currentJSONContent = jsonContent;
      } else {
        alert('No JSON data available to display. Please make some changes first.');
      }
    };

    // Function to copy JSON content to clipboard
    window.copyJSONContent = function() {
      // Use the current JSON content that was displayed
      const jsonContent = window.currentJSONContent || window.updatedCombinedJSONContent || window.updatedJSONContent;
      console.log('Copying JSON content to clipboard:', jsonContent);
      
      if (jsonContent) {
        navigator.clipboard.writeText(jsonContent).then(() => {
          alert('JSON content copied to clipboard!');
        }).catch(() => {
          // Fallback for older browsers
          const textarea = document.querySelector('textarea');
          if (textarea) {
            textarea.select();
            document.execCommand('copy');
            alert('JSON content copied to clipboard!');
          } else {
            alert('Unable to copy to clipboard. Please manually select and copy the content.');
          }
        });
      } else {
        alert('No JSON content available to copy.');
      }
    };

    // Function to close JSON modal
    window.closeJSONModal = function() {
      if (window.currentJSONModal) {
        document.body.removeChild(window.currentJSONModal);
        window.currentJSONModal = null;
      }
    };

    function saveDataToStorage() {
      saveDataToJSON();
    }

    function loadDataFromStorage() {
      // First try to load from localStorage (for session persistence)
      const savedData = localStorage.getItem('equityDashboardData');
      if (savedData) {
        try {
          const parsedData = JSON.parse(savedData);
          if (parsedData.headers) {
            window.headerData = parsedData.headers;
            // Update headers in the DOM
            const headers = document.querySelectorAll('th:not(.text-xs)');
            if (headers[0]) headers[0].textContent = window.headerData.factorHeader;
            if (headers[1]) headers[1].textContent = window.headerData.implicationHeader;
            if (headers[2]) headers[2].textContent = window.headerData.cioViewHeader;
          }
          if (parsedData.factors) {
            window.factorsData = parsedData.factors;
            // Regenerate table with updated data
            const tbody = document.getElementById("factors-body");
            tbody.innerHTML = window.factorsData.map(window.createFactorRow).join("");
          }
          console.log('Factors data loaded from localStorage');
        } catch (e) {
          console.error('Error loading factors data from localStorage:', e);
        }
      }

      // Load CIO View data from localStorage
      const savedCIOViewData = localStorage.getItem('cioViewDashboardData');
      if (savedCIOViewData) {
        try {
          const parsedCIOViewData = JSON.parse(savedCIOViewData);
          if (parsedCIOViewData.assetClasses) {
            window.cioViewData = parsedCIOViewData.assetClasses;
            // Regenerate CIO View table with updated data
            const cioTbody = document.getElementById("cio-view-body");
            cioTbody.innerHTML = window.cioViewData.map(window.createAssetClassRow).join("");
          }
          console.log('CIO View data loaded from localStorage');
        } catch (e) {
          console.error('Error loading CIO View data from localStorage:', e);
        }
      }

      // Load Table 3 View data from localStorage
      const savedTable3ViewData = localStorage.getItem('table3ViewDashboardData');
      if (savedTable3ViewData) {
        try {
          const parsedTable3ViewData = JSON.parse(savedTable3ViewData);
          if (parsedTable3ViewData.assetClasses) {
            window.table3ViewData = parsedTable3ViewData.assetClasses;
            // Regenerate Table 3 View table with updated data
            const table3Tbody = document.getElementById("table3-view-body");
            table3Tbody.innerHTML = window.table3ViewData.map(window.createTable3sectorRow).join("");
          }
          console.log('Table 3 View data loaded from localStorage');
        } catch (e) {
          console.error('Error loading Table 3 View data from localStorage:', e);
        }
      }

      // Re-initialize editable functionality for new elements
      makeEditable();
      
      return savedData || savedCIOViewData || savedTable3ViewData;
    }

    function importDataFromJSON(file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const importedData = JSON.parse(e.target.result);
          if (importedData.headers && importedData.factors) {
            window.headerData = importedData.headers;
            window.factorsData = importedData.factors;
            
            // Update the display
            loadDataFromStorage();
            saveDataToStorage();
            
            console.log('Data imported successfully');
            alert('Data imported successfully!');
          } else {
            throw new Error('Invalid data format');
          }
        } catch (error) {
          console.error('Error importing data:', error);
          alert('Error importing data. Please check the file format.');
        }
      };
      reader.readAsText(file);
    }

    // Global application variables
    let currentData = null;
    let currentHeaderData = null;
    window.cioViewData = [];
    window.table3ViewData = [];
    window.table4ViewData = [];
    window.table5ViewData = [];
    window.table6ViewData = [];
    window.table7ViewData = [];
    window.table8ViewData = [];
    window.table9ViewData = [];

    // Data management functions
    function saveDataToStorage() {
      if (currentData) {
        // Update the current data structure with the latest values
        currentData.assetClassViews = window.cioViewData;
        currentData.table3Views = window.table3ViewData;
        if (currentData.table4ViewData) {
          currentData.table4ViewData.assetClasses = window.table4ViewData;
        }
        if (currentData.table5ViewData) {
          currentData.table5ViewData = window.table5ViewData;
        }
        if (currentData.table6ViewData) {
          // Save structured data with metadata
          currentData.table6ViewData = {
            ...window.table6MetaData,
            economicIndicators: window.table6ViewData
          };
        }
        if (currentData.table7ViewData) {
          // Save structured data with metadata
          currentData.table7ViewData = {
            ...window.table7MetaData,
            scenarios: window.table7ViewData
          };
        }
        if (currentData.table8ViewData) {
          // Save structured data with metadata
          currentData.table8ViewData = {
            ...window.table8MetaData,
            strategies: window.table8ViewData
          };
        }
        
        localStorage.setItem('dashboard_data', JSON.stringify(currentData));
        console.log('Data saved to localStorage');
      }
    }

    function loadDataFromStorage() {
      const savedData = localStorage.getItem('dashboard_data');
      if (savedData) {
        try {
          currentData = JSON.parse(savedData);
          console.log('Data loaded from localStorage');
          return currentData;
        } catch (error) {
          console.error('Error parsing saved data:', error);
        }
      }
      return null;
    }

    // Utility function to show update notifications
    function showUpdateNotification(message = "Updates saved successfully!") {
      // Remove existing notification if any
      const existingNotif = document.querySelector('.update-notification');
      if (existingNotif) {
        existingNotif.remove();
      }

      // Create and show notification
      const notification = document.createElement('div');
      notification.className = 'update-notification';
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #28a745;
        color: white;
        padding: 12px 20px;
        border-radius: 6px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 1001;
        font-size: 14px;
        font-weight: 500;
        opacity: 0;
        transition: opacity 0.3s ease;
      `;
      notification.textContent = message;
      document.body.appendChild(notification);

      // Fade in
      setTimeout(() => {
        notification.style.opacity = '1';
      }, 100);

      // Fade out and remove
      setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 300);
      }, 2000);
    }

    // Weight update specific notification
    function showWeightUpdateNotification() {
      showUpdateNotification("Weight settings updated successfully!");
    }

    // Initialize the application
    async function initializeApp() {
      console.log('Initializing CIO Viewpoint Dashboard...');
      
      try {
        // Try to load from localStorage first
        let data = loadDataFromStorage();
        
        // If no saved data, load from JSON file
        if (!data) {
          const response = await fetch('./combined_dashboard_data.json');
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          data = await response.json();
          console.log('Data loaded from JSON file');
        }
        
        currentData = data;
        console.log('Current Data:', currentData);
        currentHeaderData = data.dashboardInfo || {};
        
        // Store data in global variables for table-specific functions
        // Handle both flat array and nested object structures
        window.cioViewData = currentData.assetClassViews?.assetClasses || currentData.assetClassViews || [];
        window.table3ViewData = currentData.table3Views?.sectores || currentData.table3Views?.assetClasses || currentData.table3Views || [];
        window.factorsData = currentData.equityFactors?.factors || currentData.equityFactors || [];
        window.table4ViewData = currentData.table4ViewData?.assetClasses || currentData.table4ViewData || [];
        window.table5ViewData = currentData.table5ViewData || [];
        window.table6ViewData = currentData.table6ViewData?.economicIndicators || currentData.table6ViewData || [];
        window.table6MetaData = currentData.table6ViewData || {};
        window.table7ViewData = currentData.table7ViewData?.scenarios || currentData.table7ViewData || [];
        window.table7MetaData = currentData.table7ViewData || {};
        window.table8ViewData = currentData.table8ViewData?.strategies || currentData.table8ViewData || [];
        window.table8MetaData = currentData.table8ViewData || {};
        window.table9ViewData = currentData.table9ViewData || [];
        window.table9XAxisConfig = currentData.table9XAxisConfig || { start: 10, end: 35, interval: 5 };
        
        console.log('CIO View Data:', window.cioViewData);
        console.log('Table 3 View Data:', window.table3ViewData);
        console.log('Factors Data:', window.factorsData);
        console.log('Table 4 View Data:', window.table4ViewData);
        console.log('Table 5 View Data:', window.table5ViewData);
        console.log('Table 6 View Data:', window.table6ViewData);
        console.log('Table 6 Meta Data:', window.table6MetaData);
        console.log('Table 7 View Data:', window.table7ViewData);
        console.log('Table 7 Meta Data:', window.table7MetaData);
        console.log('Table 8 View Data:', window.table8ViewData);
        console.log('Table 8 Meta Data:', window.table8MetaData);
        console.log('Table 9 View Data:', window.table9ViewData);
        console.log('Table 9 X-Axis Config:', window.table9XAxisConfig);
        console.log('Table 9 View Data:', window.table9ViewData);
        
        // Populate headers
        if (currentHeaderData.title) {
          const titleElement = document.getElementById('header-title');
          if (titleElement) {
            titleElement.textContent = currentHeaderData.title;
          }
        }
        
        // Handle date from either 'date' or 'lastUpdated' field
        const dateValue = currentHeaderData.date || currentHeaderData.lastUpdated;
        if (dateValue) {
          const dateElement = document.getElementById('header-date');
          if (dateElement) {
            // If it's an ISO date string, format it nicely
            if (dateValue.includes('T')) {
              const date = new Date(dateValue);
              dateElement.textContent = date.toLocaleDateString();
            } else {
              dateElement.textContent = dateValue;
            }
          }
        }
        // Note: subtitle is more complex HTML, so we don't overwrite it entirely
        
        // Populate Table 1 (Equity Factors)
        if (window.factorsData.length > 0) {
          const tbody = document.getElementById("factors-body");
          tbody.innerHTML = window.factorsData.map(window.createFactorRow).join("");
          console.log('Table 1 populated with', window.factorsData.length, 'items');
        } else {
          console.log('Table 1: No data found');
        }
        
        // Populate Table 2 (CIO View)
        if (window.cioViewData.length > 0) {
          const cioTbody = document.getElementById("cio-view-body");
          cioTbody.innerHTML = window.cioViewData.map(window.createAssetClassRow).join("");
          console.log('Table 2 populated with', window.cioViewData.length, 'items');
        } else {
          console.log('Table 2: No data found');
        }
        
        // Populate Table 3
        if (window.table3ViewData.length > 0) {
          const table3Tbody = document.getElementById("table3-view-body");
          table3Tbody.innerHTML = window.table3ViewData.map(window.createTable3sectorRow).join("");
          console.log('Table 3 populated with', window.table3ViewData.length, 'items');
        } else {
          console.log('Table 3: No data found');
        }
        // Populate Table 4
        if (window.table4ViewData.length > 0) {
          const table4Tbody = document.getElementById("table4-view-body");
          table4Tbody.innerHTML = window.table4ViewData.map(window.createTable4Row).join("");
          console.log('Table 4 populated with', window.table4ViewData.length, 'items');
          
          // Render special flexbox sections (Alternative Investments & Cash)
          renderTable4SpecialSections();
        } else {
          console.log('Table 4: No data found');
        }

        // Populate Table 5
        if (window.table5ViewData.length > 0) {
          const table5Tbody = document.getElementById("table5-body");
          if (table5Tbody) {
            table5Tbody.innerHTML = window.table5ViewData.map(window.createTable5Row).join("");
            console.log('Table 5 populated with', window.table5ViewData.length, 'items');
          } else {
            console.error('Table 5 tbody element not found');
          }
        } else {
          console.log('Table 5: No data found');
        }

        // Populate Table 6
        if (window.table6ViewData.length > 0) {
          const table6Tbody = document.getElementById("table6-body");
          if (table6Tbody) {
            table6Tbody.innerHTML = window.table6ViewData.map(window.createTable6Row).join("");
            console.log('Table 6 populated with', window.table6ViewData.length, 'items');
            
            // Update Table 6 header and subtitle if available
            if (window.table6MetaData.title) {
              const table6Header = document.querySelector('.table6-header');
              if (table6Header) {
                const dateHeader = window.table6MetaData.headers?.dateHeader || '(AS OF 8/1/2025)';
                table6Header.innerHTML = `${window.table6MetaData.title} <span class="table6-date">${dateHeader}</span>`;
              }
            }
            
            if (window.table6MetaData.subtitle) {
              const table6Subtitle = document.getElementById('table6-subtitle');
              if (table6Subtitle) {
                table6Subtitle.textContent = window.table6MetaData.subtitle;
              }
            }
            
            if (window.table6MetaData.footnote) {
              const table6Footnote = document.getElementById('table6-footnote');
              if (table6Footnote) {
                table6Footnote.textContent = window.table6MetaData.footnote;
              }
            }
          } else {
            console.error('Table 6 tbody element not found');
          }
        } else {
          console.log('Table 6: No data found, initializing with default data');
          // Initialize with default economic forecast data
          window.table6ViewData = [
            {
              indicator: "Real global GDP\n(% y/y annualized)",
              q1_2025a: "-",
              q2_2025a: "-", 
              q3_2025e: "-",
              q4_2025e: "-",
              "2025e": "3.0",
              "2026e": "3.1"
            },
            {
              indicator: "Real U.S. GDP\n(% q/q annualized)",
              q1_2025a: "-0.5",
              q2_2025a: "3.0*",
              q3_2025e: "1.0",
              q4_2025e: "1.6",
              "2025e": "1.7",
              "2026e": "1.7"
            },
            {
              indicator: "CPI inflation\n(% y/y)",
              q1_2025a: "2.7",
              q2_2025a: "2.5*",
              q3_2025e: "2.9",
              q4_2025e: "2.8",
              "2025e": "2.7",
              "2026e": "2.3"
            },
            {
              indicator: "Core CPI inflation\n(% y/y)",
              q1_2025a: "3.1",
              q2_2025a: "2.8*",
              q3_2025e: "3.1",
              q4_2025e: "3.1",
              "2025e": "3.0",
              "2026e": "2.6"
            },
            {
              indicator: "Unemployment rate (%)",
              q1_2025a: "4.1",
              q2_2025a: "4.2*",
              q3_2025e: "4.3",
              q4_2025e: "4.4",
              "2025e": "4.2",
              "2026e": "4.5"
            },
            {
              indicator: "Fed funds rate,\nend period (%)",
              q1_2025a: "4.38",
              q2_2025a: "4.38",
              q3_2025e: "4.38",
              q4_2025e: "4.38",
              "2025e": "4.38",
              "2026e": "3.38"
            }
          ];
          
          window.table6MetaData = {
            title: "ECONOMIC FORECASTS",
            headers: {
              dateHeader: "(AS OF 8/1/2025)"
            },
            subtitle: "Quarterly and annual economic forecasts for key macroeconomic indicators",
            footnote: "*Actual data. E = Estimated. The forecasts in the table above are as of Chief Global Research. The Chief Investment Office leverages the views and information from BofA Global Research."
          };
          
          const table6Tbody = document.getElementById("table6-body");
          if (table6Tbody) {
            table6Tbody.innerHTML = window.table6ViewData.map(window.createTable6Row).join("");
            console.log('Table 6 initialized with default data');
          }
          
          // Save the initialized data
          if (!currentData.table6ViewData) {
            currentData.table6ViewData = {
              ...window.table6MetaData,
              economicIndicators: window.table6ViewData
            };
            saveDataToStorage();
          }
        }

        // Populate Table 7
        if (window.table7ViewData.length > 0) {
          const table7Tbody = document.getElementById("table7-body");
          if (table7Tbody) {
            table7Tbody.innerHTML = window.table7ViewData.map(window.createTable7Row).join("");
            console.log('Table 7 populated with', window.table7ViewData.length, 'items');
          } else {
            console.error('Table 7 tbody element not found');
          }
        } else {
          console.log('Table 7: No data found, initializing with default data');
          // Initialize with default S&P 500 scenarios data based on the image
          window.table7ViewData = [
            {
              eps2025: "$305",
              pe_19x: "5,795",
              pe_20x: "6,100",
              pe_21x: "6,405",
              pe_22x: "6,710",
              pe_23x: "7,015"
            },
            {
              eps2025: "$295",
              pe_19x: "5,605",
              pe_20x: "5,900",
              pe_21x: "6,195",
              pe_22x: "6,490",
              pe_23x: "6,785"
            },
            {
              eps2025: "$285",
              pe_19x: "5,415",
              pe_20x: "5,700",
              pe_21x: "5,985",
              pe_22x: "6,270",
              pe_23x: "6,555"
            },
            {
              eps2025: "$275",
              pe_19x: "5,225",
              pe_20x: "5,500",
              pe_21x: "5,775",
              pe_22x: "6,050",
              pe_23x: "6,325"
            },
            {
              eps2025: "$265",
              pe_19x: "5,035",
              pe_20x: "5,300",
              pe_21x: "5,565",
              pe_22x: "5,830",
              pe_23x: "6,095"
            },
            {
              eps2025: "$255",
              pe_19x: "4,845",
              pe_20x: "5,100",
              pe_21x: "5,355",
              pe_22x: "5,610",
              pe_23x: "5,865"
            },
            {
              eps2025: "$245",
              pe_19x: "4,655",
              pe_20x: "4,900",
              pe_21x: "5,145",
              pe_22x: "5,390",
              pe_23x: "5,635"
            }
          ];
          
          window.table7MetaData = {
            title: "S&P 500 SCENARIOS BASED ON FORWARD P/E AND 2025 EARNINGS PER SHARE (EPS)",
            description: "The table below provides a rough indication of where the S&P 500 Index's central tendency could be, given various scenarios for EPS in 2025 and P/E ratio multiples. These scenarios are not official price targets and are not meant to signal levels where portfolio actions may always be needed. However, during times of market volatility, it's useful to keep this basic framework in mind when considering whether to incrementally add to or trim risk from portfolios while staying invested in one's strategic asset allocation framework.",
            footnote: "For illustrative purposes only. Source: Chief Investment Office as of August 5, 2025."
          };
          
          const table7Tbody = document.getElementById("table7-body");
          if (table7Tbody) {
            table7Tbody.innerHTML = window.table7ViewData.map(window.createTable7Row).join("");
            console.log('Table 7 initialized with default data');
          }
          
          // Save the initialized data
          if (!currentData.table7ViewData) {
            currentData.table7ViewData = {
              ...window.table7MetaData,
              scenarios: window.table7ViewData
            };
            saveDataToStorage();
          }
        }
        
        // Populate Table 8
        if (window.table8ViewData.length > 0) {
          const table8Tbody = document.getElementById("table8-body");
          if (table8Tbody) {
            table8Tbody.innerHTML = window.table8ViewData.map(window.createTable8Row).join("");
            console.log('Table 8 populated with', window.table8ViewData.length, 'items');
          } else {
            console.error('Table 8 tbody element not found');
          }
        } else {
          console.log('Table 8: No data found, initializing with default data');
          // Initialize with default CIO Views on Alts Strategies data based on the image
          window.table8ViewData = [
            {
              isStrategyHeader: true,
              strategyName: "Equity Hedge +"
            },
            {
              caseType: "Bull case",
              description: "Potential alpha* generation opportunities in high-dispersion or volatile markets; resumption of micro-dominated market would benefit stock selection; low net better positioned for market sell-off"
            },
            {
              caseType: "Bear case",
              description: "Macro-driven market dominated by trade challenging for fundamental stock pickers"
            },
            {
              isStrategyHeader: true,
              strategyName: "Event Driven"
            },
            {
              caseType: "Bull case",
              description: "Pressure of high rates could create distressed opportunities; if merger activity were to increase and deal spreads widen; higher risk-free rate positive for merger arbitrage"
            },
            {
              caseType: "Bear case",
              description: "Distress may not materialize in size or may be delayed; if merger activity fails to materialize; lower rates negative"
            },
            {
              isStrategyHeader: true,
              strategyName: "Relative Value"
            },
            {
              caseType: "Bull case",
              description: "Still in world of higher-though-volatile yields; tariff capitulation should support growth; decent dispersion in HY and Leveraged Loan."
            },
            {
              caseType: "Bear case",
              description: "Spreads very tight; potential increase in credit risk and defaults"
            },
            {
              isStrategyHeader: true,
              strategyName: "Macro +"
            },
            {
              caseType: "Bull case",
              description: "Possible 'higher-for-longer' rate regime could create cross-asset volatility in rates and foreign exchange; inflation stickiness with exacerbated macro volatility; possible transition to new trade regime could create long-term trends"
            },
            {
              caseType: "Bear case",
              description: "Choppy markets driven by erratic trade policy difficult for trend-following; if rate volatility structurally declined"
            },
            {
              isSection: true,
              sectionName: "PRIVATE EQUITY & CREDIT"
            },
            {
              isStrategyHeader: true,
              strategyName: "Buyout"
            },
            {
              caseType: "Bull case",
              description: "Current vintages likely attractive for long-term given profitability focus; within PE, Secondaries benefiting structural expansion; deal activity to increase if trade uncertainty declines"
            },
            {
              caseType: "Bear case",
              description: "Trade volatility could slow deals/exits, hurt margins; persistence of higher rates/valuation"
            },
            {
              isStrategyHeader: true,
              strategyName: "Venture/Growth"
            },
            {
              caseType: "Bull case",
              description: "Significant correction benefits capital providers; AI could drive investment supercycle; early stage/Venture Capital (VC) stages less insulated than later stages; falling rates would likely be tailwind Ex-AI VC market still challenged; VC focus on supporting portfolio companies, initial public offering drought could continue; timelines extended plus increased risk of dilution; higher rates falling"
            },
            {
              caseType: "Bear case",
              description: "Ex-AI VC market still challenged; VC focus on supporting portfolio companies, initial public offering drought could continue; timelines extended plus increased risk of dilution; higher rates falling"
            },
            {
              isStrategyHeader: true,
              strategyName: "Special Situations"
            },
            {
              caseType: "Bull case",
              description: "Default rates rising; higher-for-longer and tariffs would pressure levered balance sheets; companies seeking creative financing before maturities"
            },
            {
              caseType: "Bear case",
              description: "Trade policy capitulation or rate cuts could smooth out credit cycle keeping it more average"
            },
            {
              isStrategyHeader: true,
              strategyName: "Private Credit +"
            },
            {
              caseType: "Bull case",
              description: "High-though-declining yields; healthy spread to public credit at time; economy/corporate supportive of credit; secular tailwinds; fresh capital can underwrite to current risks"
            },
            {
              caseType: "Bear case",
              description: "Credit risk could rise & lower-quality most at risk; regulatory scrutiny; public leveraged credit competition; significant capital allocating to PC; rates falling."
            }
          ];
          
          window.table8MetaData = {
            title: "CIO Views on Alts Strategies",
            subtitle: "HEDGE STRATEGIES",
            footnote: "*Alpha is a measure of how well an investment performs relative to a benchmark index at what's expected based on its risk level. Bull case is an environment or set of factors that could represent tailwinds for the strategy. Bear case is an environment or set of factors that could represent headwinds for the strategy. + symbol indicates the strategy CIO views as having a relative opportunity for new investment within the Alts asset class."
          };
          
          const table8Tbody = document.getElementById("table8-body");
          if (table8Tbody) {
            table8Tbody.innerHTML = window.table8ViewData.map(window.createTable8Row).join("");
            console.log('Table 8 initialized with default data');
          }
          
          // Save the initialized data
          if (!currentData.table8ViewData) {
            currentData.table8ViewData = {
              ...window.table8MetaData,
              strategies: window.table8ViewData
            };
            saveDataToStorage();
          }
        }
        
        // Initialize all interactive functionality
        makeHeadersEditable();
        makeTextCellsEditable();
        
        // Initialize table-specific functionality
        addRangeHandleEditing(); // Add range handle editing for Table 1
        addTable2WeightIndicatorEditing();
        addTable3WeightIndicatorEditing();
        addTable3RowEditing();
        addTable4WeightIndicatorEditing();
        addTable4RowEditing();
        addTable5Editing(); // Add Table 5 editing functionality
        addTable6Editing(); // Add Table 6 editing functionality
        addTable7Editing(); // Add Table 7 editing functionality
        addTable8Editing(); // Add Table 8 editing functionality
        initializeTable9(); // Initialize Table 9
        
        console.log('Dashboard initialized successfully');
        
      } catch (error) {
        console.error('Error initializing dashboard:', error);
        showUpdateNotification('Error loading dashboard data');
      }
    }

    // Start the application when DOM is ready
    document.addEventListener('DOMContentLoaded', initializeApp);

    // JSON Preview and Copy Functions
    function previewJSON() {
      const currentJSONData = generateCurrentJSONData();
      showJSONPreviewModal(currentJSONData);
    }

    function copyCurrentJSON() {
      const currentJSONData = generateCurrentJSONData();
      const jsonString = JSON.stringify(currentJSONData, null, 2);
      
      navigator.clipboard.writeText(jsonString).then(() => {
        showCopySuccessNotification();
      }).catch(() => {
        // Fallback for older browsers
        const textarea = document.createElement('textarea');
        textarea.value = jsonString;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        showCopySuccessNotification();
      });
    }

    function generateCurrentJSONData() {
      // Get current data from the dashboard
      const currentJSONData = {
        dashboardInfo: {
          title: document.getElementById('header-title')?.textContent || 'CIO Viewpoint Dashboard',
          subtitle: 'Comprehensive Investment Outlook',
          lastUpdated: new Date().toISOString(),
          version: '1.0'
        },
        equityFactors: {
          headers: window.headerData || {
            factorHeader: 'Factor',
            implicationHeader: 'Implication for Equities',
            cioViewHeader: 'CIO View'
          },
          subtitle: 'Current readings on the key drivers of Equities for investors to consider, with arrows representing the recent trend:',
          factors: window.factorsData || []
        },
        assetClassViews: {
          headers: {
            assetClassHeader: 'Asset Class',
            cioViewHeader: 'CIO View',
            commentsHeader: 'Comments'
          },
          subtitle: 'Current CIO views on asset classes with weight recommendations:',
          footnote: '*Asia Pac ex-Japan refers to the geographic area surrounding the Pacific Ocean.',
          assetClasses: window.cioViewData || []
        },
        table3Views: {
          headers: {
            sectorHeader: 'Sector',
            cioViewHeader: 'CIO View',
            commentsHeader: 'Comments'
          },
          subtitle: 'Additional CIO views on asset classes with weight recommendations:',
          footnote: '*This table represents additional asset class considerations for portfolio construction.',
          sectores: window.table3ViewData || []
        },
        table4ViewData: {
          headers: {
            assetClassHeader: 'Asset Class',
            cioViewHeader: 'CIO View'
          },
          subtitle: 'Current CIO views on asset classes with weight recommendations:',
          footnote: '*Alternative Investments include Hedge Strategies, Private Equity & Credit, and Real Assets.',
          assetClasses: window.table4ViewData || []
        },
        table5ViewData: window.table5ViewData || [],
        table6ViewData: {
          ...window.table6MetaData,
          economicIndicators: window.table6ViewData || []
        },
        table7ViewData: {
          ...window.table7MetaData,
          scenarios: window.table7ViewData || []
        },
        table8ViewData: {
          ...window.table8MetaData,
          strategies: window.table8ViewData || []
        },
        table9ViewData: window.table9ViewData || [],
        table9XAxisConfig: window.table9XAxisConfig || { start: 10, end: 35, interval: 5 }
      };

      return currentJSONData;
    }

    function showJSONPreviewModal(jsonData) {
      // Remove existing modal if any
      const existingModal = document.querySelector('.json-preview-modal');
      if (existingModal) {
        existingModal.remove();
      }

      // Create modal overlay
      const modal = document.createElement('div');
      modal.className = 'json-preview-modal';
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 1100;
        display: flex;
        align-items: center;
        justify-content: center;
        animation: modalFadeIn 0.3s ease;
      `;

      // Create modal content
      const content = document.createElement('div');
      content.style.cssText = `
        background: white;
        border-radius: 12px;
        padding: 24px;
        max-width: 90%;
        max-height: 90%;
        overflow: auto;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        position: relative;
      `;

      const jsonString = JSON.stringify(jsonData, null, 2);
      
      content.innerHTML = `
        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 20px; gap: 15px;">
          <h3 style="margin: 0; font-size: 20px; font-weight: bold; color: #333;">JSON Data Preview</h3>
          <div style="display: flex; gap: 10px; margin-left: auto;">
            <button onclick="copyJSONFromModal()" style="
              padding: 8px 16px; 
              background: #28a745; 
              color: white; 
              border: none; 
              border-radius: 6px; 
              cursor: pointer; 
              font-size: 14px;
              font-weight: 500;
              display: flex;
              align-items: center;
              gap: 6px;
            ">
              📋 Copy JSON
            </button>
            <button onclick="closeJSONPreviewModal()" style="
              padding: 8px 16px; 
              background: #6c757d; 
              color: white; 
              border: none; 
              border-radius: 6px; 
              cursor: pointer; 
              font-size: 14px;
              font-weight: 500;
            ">
              ✕ Close
            </button>
          </div>
        </div>
        
        <div style="margin-bottom: 15px;">
          <p style="margin: 0; font-size: 14px; color: #666;">
            Current dashboard data in JSON format. You can copy this to save your current state.
          </p>
        </div>
        
        <div style="background: #f8f9fa; border-radius: 8px; padding: 16px; border: 1px solid #e9ecef;">
          <pre style="
            margin: 0; 
            font-family: 'Monaco', 'Consolas', monospace; 
            font-size: 12px; 
            line-height: 1.4; 
            color: #333;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 60vh;
            overflow-y: auto;
          ">${jsonString}</pre>
        </div>
      `;

      modal.appendChild(content);
      document.body.appendChild(modal);

      // Store JSON for copying
      window.currentPreviewJSON = jsonString;

      // Close modal when clicking outside
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          closeJSONPreviewModal();
        }
      });

      // Add fade-in animation
      const style = document.createElement('style');
      style.textContent = `
        @keyframes modalFadeIn {
          from { opacity: 0; transform: scale(0.9); }
          to { opacity: 1; transform: scale(1); }
        }
      `;
      document.head.appendChild(style);
    }

    function copyJSONFromModal() {
      const jsonString = window.currentPreviewJSON;
      if (jsonString) {
        navigator.clipboard.writeText(jsonString).then(() => {
          showCopySuccessNotification('JSON data copied from preview!');
        }).catch(() => {
          // Fallback
          const textarea = document.createElement('textarea');
          textarea.value = jsonString;
          document.body.appendChild(textarea);
          textarea.select();
          document.execCommand('copy');
          document.body.removeChild(textarea);
          showCopySuccessNotification('JSON data copied from preview!');
        });
      }
    }

    function closeJSONPreviewModal() {
      const modal = document.querySelector('.json-preview-modal');
      if (modal) {
        modal.style.animation = 'modalFadeOut 0.2s ease';
        setTimeout(() => {
          if (modal.parentNode) {
            modal.parentNode.removeChild(modal);
          }
        }, 200);
      }
    }

    function showCopySuccessNotification(message = 'JSON data copied to clipboard!') {
      // Remove existing notification if any
      const existingNotif = document.querySelector('.copy-success-notification');
      if (existingNotif) {
        existingNotif.remove();
      }

      const notification = document.createElement('div');
      notification.className = 'copy-success-notification';
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #28a745;
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        z-index: 1200;
        font-size: 14px;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 8px;
        opacity: 0;
        transform: translateX(100px);
        transition: all 0.3s ease;
      `;
      notification.innerHTML = `✅ ${message}`;
      document.body.appendChild(notification);

      // Animate in
      setTimeout(() => {
        notification.style.opacity = '1';
        notification.style.transform = 'translateX(0)';
      }, 100);

      // Animate out and remove
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateX(100px)';
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 300);
      }, 3000);
    }

    // Add fade-out animation
    const modalStyle = document.createElement('style');
    modalStyle.textContent = `
      @keyframes modalFadeOut {
        from { opacity: 1; transform: scale(1); }
        to { opacity: 0; transform: scale(0.9); }
      }
    `;
    document.head.appendChild(modalStyle);
  </script>
</body>
</html>
